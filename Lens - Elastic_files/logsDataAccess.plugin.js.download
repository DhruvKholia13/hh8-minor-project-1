/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */(()=>{var e={256:(e,t,r)=>{"use strict";r.r(t),r.d(t,{LogSourcesProvider:()=>S,LogSourcesSettingSynchronisationInfo:()=>_,plugin:()=>b,useLogSourcesContext:()=>f});const n="observability:logSources",s=e=>e.map((e=>e.indexPattern)).join(","),o=__kbnSharedDeps__.Rxjs;function a(e){const t=function(e){const{uiSettings:t}=e.deps,r=async()=>t.get(n).map((e=>({indexPattern:e})));return{getLogSources:r,getFlattenedLogSources:async()=>{const e=await r();return s(e)},setLogSources:async e=>{await t.set(n,e.map((e=>e.indexPattern)))}}}(e),r=function(e){const{logSourcesService:t,deps:r}=e;return{getStatus:async function(){const e=await t.getFlattenedLogSources(),n=await(0,o.lastValueFrom)(r.search.search({params:{ignore_unavailable:!0,allow_no_indices:!0,index:e,size:0,terminate_after:1,track_total_hits:1}})).then((({rawResponse:e})=>{if(e._shards.total<=0)return"missing";return(e=>"number"==typeof e?e>0:Number(null==e?void 0:e.value)>0)(e.hits.total)?"available":"empty"}),(t=>{if(404===t.status)return"missing";throw new Error(`Failed to check status of log indices of "${e}": ${t}`)}));return{status:n,hasData:"available"===n}}}}({...e,logSourcesService:t});return{logSourcesService:t,logDataService:r}}class LogsDataAccessPlugin{setup(){}start(e,t){return{services:a({deps:{uiSettings:e.uiSettings,search:t.data.search}})}}stop(){}}const i=__kbnSharedDeps__.React;var c=r.n(i);r(721);var u={};var l=r(915);const g=__kbnSharedDeps__.ReactUse.useMountedState;var d=r.n(g);class CanceledPromiseError extends Error{constructor(e){super(e),(0,l.default)(this,"isCanceled",!0),Object.setPrototypeOf(this,new.target.prototype)}}class SilentCanceledPromiseError extends CanceledPromiseError{}const p=()=>{},[S,f]=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var s=[],o=[],a=function(e){var t=(0,i.createContext)(u);s.push(t),o.push(function(e){return function(){return(0,i.useContext)(e)}}(t))};r.length?r.forEach((function(e){return a(e.name)})):a(e.name);return[function(t){for(var n=t.children,o=function(e,t){if(null==e)return{};var r,n,s={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(s[r]=e[r]);return s}(t,["children"]),a=e(o),c=n,u=0;u<s.length;u+=1){var l=s[u],g=r[u]||function(e){return e};c=(0,i.createElement)(l.Provider,{value:g(a)},c)}return c}].concat(o)}((({logSourcesService:e})=>{const[t,r]=(0,i.useState)([]),[n,o]=(0,i.useState)(void 0),[a,c]=(({createPromise:e,onResolve:t=p,onReject:r=p,cancelPreviousOn:n="never",triggerOrThrow:s="whenMounted"},o)=>{const a=d()(),c=(0,i.useCallback)((()=>{switch(s){case"always":return!0;case"whenMounted":return a()}}),[a,s]),u=(0,i.useRef)([]),[l,g]=(0,i.useState)({state:"uninitialized"}),S=(0,i.useCallback)((()=>{g({state:"uninitialized"})}),[]),f=(0,i.useMemo)((()=>(...s)=>{let o;const a=new Promise(((e,t)=>{o=t})),i=u.current,l=()=>{i.forEach((e=>e.cancel()))},d=e(...s),S=Promise.race([d,a]);g({state:"pending",promise:S}),"creation"===n&&l();const f={cancel:()=>{o(new CanceledPromiseError)},cancelSilently:()=>{o(new SilentCanceledPromiseError)},promise:S.then((e=>(["settlement","resolution"].includes(n)&&l(),u.current=u.current.filter((e=>e.promise!==f.promise)),t&&c()&&t(e),g((t=>"pending"===t.state&&t.promise===S?{state:"resolved",promise:f.promise,value:e}:t)),e)),(e=>{if(!(e instanceof SilentCanceledPromiseError)){if(["settlement","rejection"].includes(n)&&l(),u.current=u.current.filter((e=>e.promise!==f.promise)),c()){if(!r)throw e;r(e)}g((t=>"pending"===t.state&&t.promise===S?{state:"rejected",promise:S,value:e}:t))}}))};return u.current=[...u.current,f],f.promise.catch(p),f.promise}),o);return(0,i.useEffect)((()=>()=>{u.current.forEach((e=>e.cancelSilently()))}),[]),[l,f,S]})({cancelPreviousOn:"resolution",createPromise:async()=>await e.getLogSources(),onResolve:e=>{r(e),o(void 0)},onReject:e=>{o(e)}},[]);(0,i.useEffect)((()=>{c()}),[c]);const u=(0,i.useMemo)((()=>s(t)),[t]);return{isUninitialized:"uninitialized"===a.state,isLoadingLogSources:"pending"===a.state,hasFailedLoadingLogSources:void 0!==n,logSourcesError:n,logSources:t,combinedIndices:u}})),h=__kbnSharedDeps__.ElasticEui,m=__kbnSharedDeps__.KbnI18nReact,v=__kbnSharedDeps__.EmotionReact,_=({isLoading:e,logSourcesValue:t,getUrlForApp:r,title:n})=>{const s=(0,i.useMemo)((()=>r("management",{path:`/kibana/settings?query=${encodeURIComponent("Log sources")}`})),[r]);return(0,v.jsx)(c().Fragment,null,(0,v.jsx)(h.EuiDescribedFormGroup,{fullWidth:!0,title:(0,v.jsx)("h4",null,null!=n?n:(0,v.jsx)(m.FormattedMessage,{id:"xpack.logsDataAccess.logSourcesSettingInfo.logSourcesSettingTitle",defaultMessage:"Log sources"})),description:(0,v.jsx)(m.FormattedMessage,{id:"xpack.logsDataAccess.logSourcesSettingInfo.logSourcesSettingDescription",defaultMessage:"This value is synchronised with the Kibana log sources advanced setting. It can be changed via the {advancedSettingsLink}.",values:{advancedSettingsLink:(0,v.jsx)(h.EuiLink,{"data-test-subj":"xpack.infra.logSourcesSettingInfo.logSourcesSettingLink",href:s},(0,v.jsx)(m.FormattedMessage,{id:"xpack.logsDataAccess.logSourcesSettingInfo.logSourcesSettingLinkText",defaultMessage:"advanced settings page"}))}})},(0,v.jsx)(h.EuiFormRow,{fullWidth:!0,label:(0,v.jsx)(m.FormattedMessage,{id:"xpack.logsDataAccess.logSourcesSettingInfo.logSourcesSettingLabel",defaultMessage:"Log sources advanced setting"})},(0,v.jsx)(h.EuiFieldText,{"data-test-subj":"logSourcesSettingInput",fullWidth:!0,disabled:!0,isLoading:e,value:t,isInvalid:!1}))))},b=()=>new LogsDataAccessPlugin},106:(e,t,r)=>{r.p=window.__kbnPublicPath__.logsDataAccess},721:(e,t,r)=>{e.exports=r(497)(4971)},915:(e,t,r)=>{e.exports=r(497)(67493)},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var s=n.length-1;s>-1&&(!e||!/^http(s?):/.test(e));)e=n[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),r(106),__kbnBundles__.define("plugin/logsDataAccess/public",r,256)})();