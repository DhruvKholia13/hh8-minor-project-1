/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */(()=>{var e={421:(e,t,r)=>{"use strict";r.r(t),r.d(t,{plugin:()=>h});var i=r(915);const o=__kbnSharedDeps__.React;var s=r.n(o);const l=__kbnSharedDeps__.Rxjs;function n(e){if(e)return e.split("/").pop()}var a=r(718).Buffer;function c(e,t="443"){const[r,i=t]=e.split(":");return[r,i]}function d(e){var t;if(e)return null===(t=[{cloudValue:"search",kibanaValue:"es"},{cloudValue:"elasticsearch",kibanaValue:"es"},{cloudValue:"observability",kibanaValue:"oblt"},{cloudValue:"security",kibanaValue:"security"}].find((({cloudValue:t})=>e.toLowerCase()===t)))||void 0===t?void 0:t.kibanaValue}function u(e,t){return e&&t?`${e}${t}`:""}class CloudUrlsService{constructor(){(0,i.default)(this,"config",void 0),(0,i.default)(this,"coreSetup",void 0),(0,i.default)(this,"kibanaUrl",void 0)}setup(e,t,r){this.config=e,this.coreSetup=t,this.kibanaUrl=r}getUrls(){if(!this.config)throw new Error("Cloud configuration is not set up");const e=this.kibanaUrl,{base_url:t,profile_url:r,organization_url:i,deployments_url:o,deployment_url:s,performance_url:l,users_and_roles_url:n,projects_url:a}=this.config,c=u(t,o),d=u(t,s);return{baseUrl:t,kibanaUrl:e,deploymentsUrl:c,deploymentUrl:d,profileUrl:u(t,r),organizationUrl:u(t,i),snapshotsUrl:`${d}/elasticsearch/snapshots/`,performanceUrl:u(t,l),usersAndRolesUrl:u(t,n),projectsUrl:u(t,a)}}async getPrivilegedUrls(){if(!this.config)throw new Error("Cloud configuration is not set up");return{billingUrl:(await this.getCurrentUserRoles()).includes("_ec_billing_admin")?u(this.config.base_url,this.config.billing_url):void 0}}async getCurrentUserRoles(){var e;const[t]=await(null===(e=this.coreSetup)||void 0===e?void 0:e.getStartServices())||[];if(!t)throw new Error("Core setup is not available");let r=[];try{r=(await t.security.authc.getCurrentUser()).roles}catch(e){}return r}}const p=__kbnSharedDeps__.EmotionReact;class CloudPlugin{constructor(e){var t;(0,i.default)(this,"config",void 0),(0,i.default)(this,"isCloudEnabled",void 0),(0,i.default)(this,"isServerlessEnabled",void 0),(0,i.default)(this,"contextProviders",[]),(0,i.default)(this,"logger",void 0),(0,i.default)(this,"elasticsearchConfig",void 0),(0,i.default)(this,"cloudUrls",new CloudUrlsService),this.initializerContext=e,this.config=this.initializerContext.config.get(),this.isCloudEnabled="string"==typeof this.config.id,this.isServerlessEnabled=!(null===(t=this.config.serverless)||void 0===t||!t.project_id),this.logger=e.logger.get(),this.elasticsearchConfig=void 0}setup(e){var t,r,i,o,s,u,p,h,g,f;!function(e,t){if(!t.id)return;const{id:r,organization_id:i,trial_end_date:o,is_elastic_staff_owned:s,serverless:{project_id:a,project_type:c,product_tier:d,orchestrator_target:u}={}}=t;e.registerContextProvider({name:"Cloud Deployment Metadata",context$:(0,l.of)({cloudId:r,organizationId:i,deploymentId:n(t.deployment_url),cloudTrialEndDate:o,cloudIsElasticStaffOwned:s,projectId:a,projectType:c,productTier:d,orchestratorTarget:u}),schema:{cloudId:{type:"keyword",_meta:{description:"The Cloud ID"}},organizationId:{type:"keyword",_meta:{description:"The Elastic Cloud Organization ID that owns the deployment/project",optional:!0}},deploymentId:{type:"keyword",_meta:{description:"The Deployment ID",optional:!0}},cloudTrialEndDate:{type:"date",_meta:{description:"When the Elastic Cloud trial ends/ended",optional:!0}},cloudIsElasticStaffOwned:{type:"boolean",_meta:{description:"`true` if the owner of the deployment is an Elastician",optional:!0}},projectId:{type:"keyword",_meta:{description:"The Serverless Project ID",optional:!0}},projectType:{type:"keyword",_meta:{description:"The Serverless Project type",optional:!0}},productTier:{type:"keyword",_meta:{description:"The Serverless Product Tier",optional:!0}},orchestratorTarget:{type:"keyword",_meta:{description:"The Orchestrator Target where it is deployed (canary/non-canary)",optional:!0}}}})}(e.analytics,this.config);const{id:v,cname:_,trial_end_date:b,is_elastic_staff_owned:y,csp:U}=this.config;let m;v&&(m=function(e,t){const r=e.split(":").pop();if(!r)return void t.debug(`Unable to decode ${r}`);let i;try{i=a.from(r,"base64").toString("utf8")}catch{return void t.debug(`base64 decoding failed on ${r}`)}const o=i.split("$");if(o.length<3)return void t.debug(`Expected at least 3 parts in ${i}`);const[s,l]=c(o[0]),[n,d]=c(o[1],l),[u,p]=c(o[2],l);return{host:s,defaultPort:l,elasticsearchUrl:`https://${n}.${s}:${d}`,kibanaUrl:`https://${u}.${s}:${p}`}}(v,this.logger));const w=null===(t=m)||void 0===t?void 0:t.kibanaUrl;return this.cloudUrls.setup(this.config,e,w),{cloudId:v,organizationId:this.config.organization_id,deploymentId:n(this.config.deployment_url),cname:_,csp:U,cloudHost:null===(r=m)||void 0===r?void 0:r.host,cloudDefaultPort:null===(i=m)||void 0===i?void 0:i.defaultPort,trialEndDate:b?new Date(b):void 0,isElasticStaffOwned:y,isCloudEnabled:this.isCloudEnabled,onboarding:{defaultSolution:d(null===(o=this.config.onboarding)||void 0===o?void 0:o.default_solution)},isServerlessEnabled:this.isServerlessEnabled,serverless:{projectId:null===(s=this.config.serverless)||void 0===s?void 0:s.project_id,projectName:null===(u=this.config.serverless)||void 0===u?void 0:u.project_name,projectType:null===(p=this.config.serverless)||void 0===p?void 0:p.project_type,orchestratorTarget:null===(h=this.config.serverless)||void 0===h?void 0:h.orchestrator_target,productTier:null===(g=this.config.serverless)||void 0===g?void 0:g.product_tier,organizationInTrial:null===(f=this.config.serverless)||void 0===f?void 0:f.in_trial},registerCloudService:e=>{this.contextProviders.push(e)},fetchElasticsearchConfig:this.fetchElasticsearchConfig.bind(this,e.http),...this.cloudUrls.getUrls(),getPrivilegedUrls:this.cloudUrls.getPrivilegedUrls.bind(this.cloudUrls),getUrls:this.cloudUrls.getUrls.bind(this.cloudUrls)}}start(e){var t,r,i,o;return e.chrome.setHelpSupportUrl(function(e){var t;let r="https://support.elastic.co/";return null!==(t=e.serverless)&&void 0!==t&&t.project_id?r+="?serverless_project_id="+e.serverless.project_id:e.id&&(r+="?cloud_deployment_id="+e.id),r}(this.config)),{CloudContextProvider:({children:e})=>(0,p.jsx)(s().Fragment,null,this.contextProviders.reduce(((e,t)=>(0,p.jsx)(t,null," ",e," ")),e)),isCloudEnabled:this.isCloudEnabled,cloudId:this.config.id,isServerlessEnabled:this.isServerlessEnabled,serverless:{projectId:null===(t=this.config.serverless)||void 0===t?void 0:t.project_id,projectName:null===(r=this.config.serverless)||void 0===r?void 0:r.project_name,projectType:null===(i=this.config.serverless)||void 0===i?void 0:i.project_type,organizationInTrial:null===(o=this.config.serverless)||void 0===o?void 0:o.in_trial},fetchElasticsearchConfig:this.fetchElasticsearchConfig.bind(this,e.http),...this.cloudUrls.getUrls(),getPrivilegedUrls:this.cloudUrls.getPrivilegedUrls.bind(this.cloudUrls),getUrls:this.cloudUrls.getUrls.bind(this.cloudUrls)}}stop(){}async fetchElasticsearchConfig(e){if(void 0!==this.elasticsearchConfig)return this.elasticsearchConfig;try{const t=await e.get("/api/internal/cloud/elasticsearch_config",{version:"1"});return this.elasticsearchConfig={elasticsearchUrl:t.elasticsearch_url||void 0},this.elasticsearchConfig}catch{return this.logger.error("Failed to fetch Elasticsearch config"),{elasticsearchUrl:void 0}}}}function h(e){return new CloudPlugin(e)}},66:(e,t,r)=>{r.p=window.__kbnPublicPath__.cloud},718:(e,t,r)=>{e.exports=r(497)(20183)},915:(e,t,r)=>{e.exports=r(497)(67493)},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},t={};function r(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var o=i.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=i[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),r(66),__kbnBundles__.define("plugin/cloud/public",r,421)})();