/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */(()=>{var e,t={951:(e,t,i)=>{"use strict";i.d(t,{RJ:()=>MessageReader,Y0:()=>NdjsonReader,H1:()=>TikaReader,RG:()=>l});var r=i(17),n=i(915);class FileReaderBase{constructor(){(0,n.default)(this,"_docArray",[])}read(e){let t=[];const i=new TextDecoder,n=100*r.MB,s=Math.ceil(e.byteLength/n);let a=0;for(let r=0;r<s;r++){const o=i.decode(e.slice(r*n-a,(r+1)*n)),{success:l,docs:c,remainder:d}=this._createDocs(o,r===s-1);if(!l)throw new Error(`Failed to create docs from chunk ${r}`);t=t.concat(c),a=d}return t}}class MessageReader extends FileReaderBase{constructor(e){super(),(0,n.default)(this,"_excludeLinesRegex",void 0),(0,n.default)(this,"_multilineStartRegex",void 0),this._excludeLinesRegex=void 0===e.excludeLinesPattern?null:new RegExp(e.excludeLinesPattern),this._multilineStartRegex=void 0===e.multilineStartPattern?null:new RegExp(e.multilineStartPattern)}_createDocs(e,t,i){let r=0;try{const n=[];let s="",a="";for(let r=0;r<e.length;r++){const o=e[r],l=r===e.length-1;if("\n"===o?(s=this._processLine(n,s,a),a=""):t&&l?(a+=o,s=this._processLine(n,s,a),a=""):a+=o,void 0!==i&&n.length>=i)break}return r=a.length,""!==s&&this._addMessage(n,s),n[0]&&""===n[0].message&&n.shift(),{success:!0,docs:n,remainder:r}}catch(e){return{success:!1,docs:[],remainder:r,error:e}}}_processLine(e,t,i){if(null===this._excludeLinesRegex||null===i.match(this._excludeLinesRegex)){if(null===this._multilineStartRegex||null!==i.match(this._multilineStartRegex))this._addMessage(e,t),t="";else{if(0===e.length)return"";t+="\n"}t+=i}return t}_addMessage(e,t){t=t.replace(/\r$/,""),e.push({message:t})}}class NdjsonReader extends FileReaderBase{_createDocs(e,t){let i=0;try{const t=e.split(/}\s*\n/),r=null===e.match(/}\s*\n?$/),n=[];if(t.length){for(let e=0;e<t.length-1;e++)""!==t[e]&&n.push(`${t[e]}}`);const e=t[t.length-1];e&&(!0===r?i=e.length:n.push(`${e}}`))}return{success:!0,docs:n,remainder:i}}catch(e){return{success:!1,docs:[],remainder:i,error:e}}}}var s=i(367);class TikaReader extends FileReaderBase{read(e){let t=[];const i=(0,s.fromByteArray)(new Uint8Array(e)),{success:r,docs:n}=this._createDocs(i);if(!r)throw new Error("Failed to create docs from TikaReader");return t=t.concat(n),t}_createDocs(e){try{return{success:!0,docs:[{data:e}],remainder:0}}catch(e){return{success:!1,docs:[],remainder:0,error:e}}}}const a=__kbnSharedDeps__.Moment;var o=i.n(a);function l(e){if(void 0!==e&&e.processors&&e.processors){const t=e.processors.find((e=>void 0!==e.date&&"{{ event.timezone }}"===e.date.timezone));t&&(t.date.timezone=o().tz.guess())}}},17:(e,t,i)=>{"use strict";i.d(t,{GM:()=>r,MB:()=>d,Mf:()=>a,UQ:()=>l,W0:()=>c,Yb:()=>o,ay:()=>n,w3:()=>s});const r={DELIMITED:"delimited",NDJSON:"ndjson",SEMI_STRUCTURED_TEXT:"semi_structured_text",TIKA:"tika"},n="fileUpload:maxFileSize",s="100MB",a=524288e3,o=1073741274,l="0,0.[0] b",c=62914560,d=Math.pow(2,20)},166:(e,t,i)=>{"use strict";i.d(t,{Pj:()=>p,fp:()=>h,xy:()=>m,Jc:()=>y,F1:()=>x,$Z:()=>g,BB:()=>f,zg:()=>v,Wd:()=>_});var r=i(367),n=i(723);let s;async function a(){return void 0!==s||(s=new Promise((async(e,t)=>{try{const{GeoUploadWizard:t,importerFactory:r,IndexNameForm:s}=await i.e(640).then(i.bind(i,640));e({GeoUploadWizard:t,importerFactory:r,getHttp:n.PA,IndexNameForm:s})}catch(e){t(e)}}))),s}var o=i(915),l=i(286),c=i.n(l),d=i(319),u=i(791);class GeoUploadWizardAsyncWrapper extends c().Component{constructor(...e){super(...e),(0,o.default)(this,"state",{GeoUploadWizard:null}),(0,o.default)(this,"_isMounted",!1)}componentDidMount(){this._isMounted=!0,a().then((e=>{this._isMounted&&this.setState({GeoUploadWizard:e.GeoUploadWizard})}))}componentWillUnmount(){this._isMounted=!1}render(){const{GeoUploadWizard:e}=this.state;return e?(0,u.jsx)(e,this.props):(0,u.jsx)(d.EuiSkeletonText,{lines:3})}}class IndexNameFormAsyncWrapper extends c().Component{constructor(...e){super(...e),(0,o.default)(this,"state",{IndexNameForm:null}),(0,o.default)(this,"_isMounted",!1)}componentWillUnmount(){this._isMounted=!1}componentDidMount(){this._isMounted=!0,a().then((e=>{this._isMounted&&this.setState({IndexNameForm:e.IndexNameForm})}))}render(){const{IndexNameForm:e}=this.state;return e?(0,u.jsx)(e,this.props):(0,u.jsx)(d.EuiSkeletonText,{lines:3})}}const p=GeoUploadWizardAsyncWrapper,h=IndexNameFormAsyncWrapper;async function f(e,t){return(await a()).importerFactory(e,t)}async function m(e,t={},i){const r=i?{...t,includePreview:"true"}:t,{getHttp:n}=await a(),s=JSON.stringify(e);return await n().fetch({path:"/internal/file_upload/analyze_file",method:"POST",version:"1",body:s,query:r})}async function _(e,t={}){const{getHttp:i}=await a(),n=(0,r.fromByteArray)(new Uint8Array(e)),s=JSON.stringify({base64File:n});return await i().fetch({path:"/internal/file_upload/preview_tika_contents",method:"POST",version:"1",body:s,query:t})}async function g(e){const t=await a();try{return(await t.getHttp().fetch({path:"/internal/file_upload/has_import_permission",method:"GET",version:"1",query:{...e}})).hasImportPermission}catch(e){return!1}}async function y(e,t={}){const i=JSON.stringify({index:e}),r=await a();try{const{exists:e}=await r.getHttp().fetch({path:"/internal/file_upload/index_exists",method:"POST",version:"1",body:i,query:t});return e}catch(e){return!1}}async function x(e,t,i){const r=JSON.stringify({index:e,timeFieldName:i,query:t}),n=await a();return await n.getHttp().fetch({path:"/internal/file_upload/time_field_range",method:"POST",version:"1",body:r})}async function v(e,t){const{getHttp:i}=await a(),r=JSON.stringify({index:e,expectedCount:t});return await i().fetch({path:"/internal/file_upload/index_searchable",method:"POST",version:"1",body:r})}},426:(e,t,i)=>{"use strict";i.d(t,{oq:()=>o,i3:()=>l,Zz:()=>c,D1:()=>d});const r=__kbnSharedDeps__.ElasticNumeral;var n=i.n(r),s=i(17),a=i(723);function o(){const e=(0,a.C_)().get(s.ay,s.w3),t=n()(e.toUpperCase()).value();return t<s.Mf?s.Mf:t<=s.Yb?t:s.Yb}function l(){return n()(o()).format(s.UQ)}function c(){return s.W0}function d(){return n()(c()).format(s.UQ)}},292:(e,t,i)=>{"use strict";i.d(t,{fL:()=>p,l9:()=>Importer,Oi:()=>u});var r=i(915),n=i(770),s=i(8);const a=(e,t=[])=>"object"==typeof e&&null!==e&&Object.keys(e).length>0&&(0===t.length||t.every((t=>Object.hasOwn(e,t))));var o=i(951),l=i(723),c=i(619),d=i(721);const u=1e6,p=5,h="@timestamp";class Importer{constructor(){(0,r.default)(this,"_docArray",[]),(0,r.default)(this,"_chunkSize",5e3),(0,r.default)(this,"_index",void 0),(0,r.default)(this,"_pipelines",[]),(0,r.default)(this,"_timeFieldName",void 0),(0,r.default)(this,"_initialized",!1)}initialized(){return this._initialized}getIndex(){return this._index}getTimeField(){return this._timeFieldName}read(e){return this._docArray=this._reader.read(e),{success:!0}}_initialize(e,t,i){for(let t=0;t<i.length;t++){const r=i[t];void 0!==r&&((0,o.RG)(r),m(r)&&(this._chunkSize=100)),this._pipelines.push({id:`${e}-${t}-pipeline`,pipeline:r})}this._index=e,this._timeFieldName=a(t.properties,[h])?h:void 0,this._initialized=!0}async initializeImport(e,t,i,r,n=!1){return this._initialize(e,i,r),await(0,c.l)({index:e,settings:t,mappings:i,ingestPipelines:this._pipelines,existingIndex:n})}async initializeWithoutCreate(e,t,i){this._initialize(e,t,i)}async import(e,t,i){if(!e)return{success:!1,error:s.i18n.translate("xpack.fileUpload.import.noIndexSuppliedErrorMessage",{defaultMessage:"No index supplied"})};const r=function(e,t){if(0===t)return[e];const i=[],r=(0,n.chunk)(e,t);for(let e=0;e<r.length;e++){const t=r[e],s=t.length,a=JSON.stringify(t).length;if(a>u){const e=Math.floor(u/a*s),r=(0,n.chunk)(t,e);i.push(...r)}else i.push(t)}return i}(this._docArray,this._chunkSize);let a=!0;const o=[];let l;for(let n=0;n<r.length;n++){let s=p,u={success:!1,failures:[],docCount:0,index:"",pipelineId:""};for(;!1===u.success&&s>0;)try{u=await(0,c.f)({index:e,ingestPipelineId:t,data:r[n]}),s<p&&d.log("Retrying import "+(p-s)),s--}catch(e){u.success=!1,u.error=e,s=0}if(!u.success){d.error(u),a=!1,l=u.error,f(u,o,n,this._chunkSize);break}i((n+1)/r.length*100),f(u,o,n,this._chunkSize)}const h={success:a,failures:o,docCount:this._docArray.length};return a?i(100):h.error=l,h}_getFirstReadDocs(e=1){return this._docArray.slice(0,e).map((e=>"string"==typeof e?JSON.parse(e):e))}_getLastReadDocs(e=1){return this._docArray.slice(-e).map((e=>"string"==typeof e?JSON.parse(e):e))}async previewIndexTimeRange(){const e=this._pipelines[0];if(!1===this._initialized||void 0===(null==e?void 0:e.pipeline))throw new Error("Import has not been initialized");const t=this._getFirstReadDocs(10),i=this._getLastReadDocs(10),r=JSON.stringify({docs:t.concat(i),pipeline:e.pipeline,timeField:this._timeFieldName});return await(0,l.PA)().fetch({path:"/internal/file_upload/preview_index_time_range",method:"POST",version:"1",body:r})}async deletePipelines(){const e=this._pipelines.filter((e=>void 0!==e.pipeline)).map((e=>e.id));return 0===e.length?[]:await(0,l.PA)().fetch({path:`/internal/file_upload/remove_pipelines/${e.join(",")}`,method:"DELETE",version:"1"})}async previewDocs(e,t,i=20){this.read(e);const r=(0,n.cloneDeep)(t);return(0,o.RG)(r),await(0,l.PA)().fetch({path:"/internal/file_upload/preview_docs",method:"POST",version:"1",body:JSON.stringify({docs:this._docArray.slice(1,i+1),pipeline:r})})}}function f(e,t,i,r){if(e.failures&&e.failures.length){for(let t=0;t<e.failures.length;t++){const n=e.failures[t];n.item=n.item+r*i}t.push(...e.failures)}}function m(e){const t=e=>{const i=[];return Object.entries(e).forEach((([e,r])=>{i.push(e),a(r)&&i.push(...t(r))})),i},i=t(e);return 0!==(0,n.intersection)(["inference","enrich"],i).length}},926:(e,t,i)=>{"use strict";i.d(t,{ud:()=>MessageImporter,BB:()=>o});var r=i(17),n=i(915),s=i(951),a=i(292);class MessageImporter extends a.l9{constructor(e){super(),(0,n.default)(this,"_reader",void 0),this._reader=new s.RJ(e)}}class NdjsonImporter extends a.l9{constructor(){super(),(0,n.default)(this,"_reader",void 0),this._reader=new s.Y0}}class TikaImporter extends a.l9{constructor(){super(),(0,n.default)(this,"_reader",void 0),this._reader=new s.H1,this._chunkSize=0}}function o(e,t){switch(e){case r.GM.DELIMITED:case r.GM.SEMI_STRUCTURED_TEXT:return new MessageImporter(t);case r.GM.NDJSON:return new NdjsonImporter;case r.GM.TIKA:return new TikaImporter;default:throw new Error("Importer not found for format")}}i(164)},619:(e,t,i)=>{"use strict";i.d(t,{f:()=>s,l:()=>n});var r=i(723);function n({index:e,settings:t,mappings:i,ingestPipelines:n,existingIndex:s}){const a=JSON.stringify({index:e,settings:t,mappings:i,ingestPipelines:n,existingIndex:s});return(0,r.PA)().fetch({path:"/internal/file_upload/initialize_import",method:"POST",version:"1",body:a})}function s({index:e,data:t,ingestPipelineId:i}){const n=JSON.stringify({index:e,ingestPipelineId:i,data:t});return(0,r.PA)().fetch({path:"/internal/file_upload/import",method:"POST",version:"2",body:n})}},164:(e,t,i)=>{"use strict";i.d(t,{Q:()=>s,n:()=>a});var r=i(8),n=i(426);function s(e){return"."+e.name.split(".").pop()}function a(e,t,i){if(e.size>(0,n.oq)()&&null!=i&&i.checkSizeLimit)throw new Error(r.i18n.translate("xpack.fileUpload.fileSizeError",{defaultMessage:"File size {fileSize} exceeds maximum file size of {maxFileSize}",values:{fileSize:o(e.size),maxFileSize:(0,n.i3)()}}));if(!e.name)throw new Error(r.i18n.translate("xpack.fileUpload.noFileNameError",{defaultMessage:"File name not provided"}));if(!t.includes(s(e)))throw new Error(r.i18n.translate("xpack.fileUpload.fileTypeError",{defaultMessage:"File is not one of acceptable types: {types}",values:{types:t.join(", ")}}))}function o(e){if(0===e)return"n/a";const t=["Bytes","KB","MB","GB","TB"],i=Math.round(Math.floor(Math.log(e)/Math.log(1024)));return 0===i?`${e} ${t[i]})`:`${(e/1024**i).toFixed(1)} ${t[i]}`}},11:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MessageImporter:()=>a.ud,plugin:()=>o});var r=i(166),n=i(723),s=i(426);class FileUploadPlugin{setup(){}start(e,t){return(0,n.b3)(e,t),{FileUploadComponent:r.Pj,IndexNameFormComponent:r.fp,importerFactory:r.BB,getMaxBytes:s.oq,getMaxBytesFormatted:s.i3,getMaxTikaBytes:s.Zz,getMaxTikaBytesFormatted:s.D1,hasImportPermission:r.$Z,checkIndexExists:r.Jc,getTimeFieldRange:r.F1,analyzeFile:r.xy,previewTikaFile:r.Wd,isIndexSearchable:r.zg}}}var a=i(926);function o(){return new FileUploadPlugin}},723:(e,t,i)=>{"use strict";let r,n;function s(e,t){r=e,n=t}i.d(t,{C_:()=>c,O4:()=>u,PA:()=>l,b3:()=>s,eP:()=>o,g9:()=>a,mt:()=>d});const a=()=>r.docLinks,o=()=>n.data.dataViews,l=()=>r.http,c=()=>r.settings.client,d=()=>r.settings,u=()=>r.theme},332:(e,t,i)=>{i.p=window.__kbnPublicPath__.fileUpload},627:(e,t,i)=>{i.r(t);var r=__kbnBundles__.get("plugin/data/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},409:(e,t,i)=>{i.r(t);var r=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},367:(e,t,i)=>{e.exports=i(497)(38422)},721:(e,t,i)=>{e.exports=i(497)(4971)},915:(e,t,i)=>{e.exports=i(497)(67493)},319:e=>{"use strict";e.exports=__kbnSharedDeps__.ElasticEui},791:e=>{"use strict";e.exports=__kbnSharedDeps__.EmotionReact},424:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnCodeEditor},8:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18n},879:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18nReact},770:e=>{"use strict";e.exports=__kbnSharedDeps__.Lodash},286:e=>{"use strict";e.exports=__kbnSharedDeps__.React},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},i={};function r(e){var n=i[e];if(void 0!==n)return n.exports;var s=i[e]={exports:{}};return t[e].call(s.exports,s,s.exports,r),s.exports}r.m=t,r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,i)=>(r.f[i](e,t),t)),[])),r.u=e=>"fileUpload.chunk."+e+".js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},r.l=(t,i,n,s)=>{if(e[t])e[t].push(i);else{var a,o;if(void 0!==n)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var d=l[c];if(d.getAttribute("src")==t){a=d;break}}a||(o=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.src=t),e[t]=[i];var u=(i,r)=>{a.onerror=a.onload=null,clearTimeout(p);var n=e[t];if(delete e[t],a.parentNode&&a.parentNode.removeChild(a),n&&n.forEach((e=>e(r))),i)return i(r)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),o&&document.head.appendChild(a)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=i[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{var e={50:0};r.f.j=(t,i)=>{var n=r.o(e,t)?e[t]:void 0;if(0!==n)if(n)i.push(n[2]);else{var s=new Promise(((i,r)=>n=e[t]=[i,r]));i.push(n[2]=s);var a=r.p+r.u(t),o=new Error;r.l(a,(i=>{if(r.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var s=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;o.message="Loading chunk "+t+" failed.\n("+s+": "+a+")",o.name="ChunkLoadError",o.type=s,o.request=a,n[1](o)}}),"chunk-"+t,t)}};var t=(t,i)=>{var n,s,[a,o,l]=i,c=0;if(a.some((t=>0!==e[t]))){for(n in o)r.o(o,n)&&(r.m[n]=o[n]);l&&l(r)}for(t&&t(i);c<a.length;c++)s=a[c],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0},i=self.fileUpload_bundle_jsonpfunction=self.fileUpload_bundle_jsonpfunction||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),r(332),__kbnBundles__.define("plugin/fileUpload/public",r,11)})();