(()=>{var e,t={3789:(e,t,a)=>{"use strict";a.d(t,{j:()=>s});const s={META_FIELDS:"metaFields",DOC_HIGHLIGHT:"doc_table:highlight",QUERY_STRING_OPTIONS:"query:queryString:options",QUERY_ALLOW_LEADING_WILDCARDS:"query:allowLeadingWildcards",SEARCH_QUERY_LANGUAGE:"search:queryLanguage",SORT_OPTIONS:"sort:options",COURIER_IGNORE_FILTER_IF_FIELD_NOT_IN_INDEX:"courier:ignoreFilterIfFieldNotInIndex",COURIER_SET_REQUEST_PREFERENCE:"courier:setRequestPreference",COURIER_CUSTOM_REQUEST_PREFERENCE:"courier:customRequestPreference",COURIER_MAX_CONCURRENT_SHARD_REQUESTS:"courier:maxConcurrentShardRequests",SEARCH_INCLUDE_FROZEN:"search:includeFrozen",SEARCH_TIMEOUT:"search:timeout",HISTOGRAM_BAR_TARGET:"histogram:barTarget",HISTOGRAM_MAX_BARS:"histogram:maxBars",HISTORY_LIMIT:"history:limit",TIMEPICKER_REFRESH_INTERVAL_DEFAULTS:"timepicker:refreshIntervalDefaults",TIMEPICKER_QUICK_RANGES:"timepicker:quickRanges",TIMEPICKER_TIME_DEFAULTS:"timepicker:timeDefaults",FILTERS_PINNED_BY_DEFAULT:"filters:pinnedByDefault",FILTERS_EDITOR_SUGGEST_VALUES:"filterEditor:suggestValues",AUTOCOMPLETE_USE_TIMERANGE:"autocomplete:useTimeRange",AUTOCOMPLETE_VALUE_SUGGESTION_METHOD:"autocomplete:valueSuggestionMethod",DATE_FORMAT:"dateFormat",DATEFORMAT_TZ:"dateFormat:tz"}},8351:(e,t,a)=>{"use strict";a.d(t,{F:()=>i});var s=a(3789);function i(e){return{allowLeadingWildcards:e.get(s.j.QUERY_ALLOW_LEADING_WILDCARDS),queryStringOptions:e.get(s.j.QUERY_STRING_OPTIONS),ignoreFilterIfFieldNotInIndex:e.get(s.j.COURIER_IGNORE_FILTER_IF_FIELD_NOT_IN_INDEX),dateFormatTZ:e.get("dateFormat:tz")}}},9806:(e,t,a)=>{"use strict";a.d(t,{VC:()=>i});var s=a(5008);s.i18n.translate("fieldFormats.blankLabel",{defaultMessage:"(blank)",description:"Represents the label used to replace an empty string value in tables and charts"}),s.i18n.translate("fieldFormats.nullLabel",{defaultMessage:"(null)",description:"Represents the label used to replace an null value in tables and charts"});const i="__missing__"},3313:(e,t,a)=>{"use strict";a.d(t,{_c:()=>i,fM:()=>r,qZ:()=>KbnFieldType,s0:()=>u});var s=a(8915);let i=function(e){return e._ID="_id",e._INDEX="_index",e._SOURCE="_source",e._TYPE="_type",e.STRING="string",e.TEXT="text",e.MATCH_ONLY_TEXT="match_only_text",e.KEYWORD="keyword",e.VERSION="version",e.BOOLEAN="boolean",e.OBJECT="object",e.DATE="date",e.DATE_NANOS="date_nanos",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.FLOAT="float",e.HALF_FLOAT="half_float",e.SCALED_FLOAT="scaled_float",e.DOUBLE="double",e.INTEGER="integer",e.LONG="long",e.SHORT="short",e.UNSIGNED_LONG="unsigned_long",e.AGGREGATE_METRIC_DOUBLE="aggregate_metric_double",e.FLOAT_RANGE="float_range",e.DOUBLE_RANGE="double_range",e.INTEGER_RANGE="integer_range",e.LONG_RANGE="long_range",e.NESTED="nested",e.BYTE="byte",e.IP="ip",e.IP_RANGE="ip_range",e.ATTACHMENT="attachment",e.TOKEN_COUNT="token_count",e.MURMUR3="murmur3",e.HISTOGRAM="histogram",e}({}),r=function(e){return e._SOURCE="_source",e.ATTACHMENT="attachment",e.BOOLEAN="boolean",e.DATE="date",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.IP="ip",e.IP_RANGE="ip_range",e.MURMUR3="murmur3",e.NUMBER="number",e.NUMBER_RANGE="number_range",e.STRING="string",e.UNKNOWN="unknown",e.CONFLICT="conflict",e.OBJECT="object",e.NESTED="nested",e.HISTOGRAM="histogram",e.MISSING="missing",e}({});class KbnFieldType{constructor(e={}){(0,s.default)(this,"name",void 0),(0,s.default)(this,"sortable",void 0),(0,s.default)(this,"filterable",void 0),(0,s.default)(this,"esTypes",void 0),this.name=e.name||r.UNKNOWN,this.sortable=e.sortable||!1,this.filterable=e.filterable||!1,this.esTypes=Object.freeze((e.esTypes||[]).slice())}}const n=new KbnFieldType({name:r.UNKNOWN}),o=[new KbnFieldType({name:r.STRING,sortable:!0,filterable:!0,esTypes:[i.STRING,i.TEXT,i.MATCH_ONLY_TEXT,i.KEYWORD,i.VERSION,i._TYPE,i._ID]}),new KbnFieldType({name:r.NUMBER,sortable:!0,filterable:!0,esTypes:[i.FLOAT,i.HALF_FLOAT,i.SCALED_FLOAT,i.DOUBLE,i.INTEGER,i.LONG,i.UNSIGNED_LONG,i.SHORT,i.BYTE,i.TOKEN_COUNT,i.AGGREGATE_METRIC_DOUBLE]}),new KbnFieldType({name:r.NUMBER_RANGE,sortable:!0,filterable:!0,esTypes:[i.FLOAT_RANGE,i.DOUBLE_RANGE,i.INTEGER_RANGE,i.LONG_RANGE]}),new KbnFieldType({name:r.DATE,sortable:!0,filterable:!0,esTypes:[i.DATE,i.DATE_NANOS]}),new KbnFieldType({name:r.DATE_RANGE,sortable:!0,filterable:!0,esTypes:[i.DATE_RANGE]}),new KbnFieldType({name:r.IP,sortable:!0,filterable:!0,esTypes:[i.IP]}),new KbnFieldType({name:r.IP_RANGE,sortable:!0,filterable:!0,esTypes:[i.IP_RANGE]}),new KbnFieldType({name:r.BOOLEAN,sortable:!0,filterable:!0,esTypes:[i.BOOLEAN]}),new KbnFieldType({name:r.OBJECT,esTypes:[i.OBJECT]}),new KbnFieldType({name:r.NESTED,esTypes:[i.NESTED]}),new KbnFieldType({name:r.GEO_POINT,esTypes:[i.GEO_POINT]}),new KbnFieldType({name:r.GEO_SHAPE,esTypes:[i.GEO_SHAPE]}),new KbnFieldType({name:r.ATTACHMENT,esTypes:[i.ATTACHMENT]}),new KbnFieldType({name:r.MURMUR3,esTypes:[i.MURMUR3]}),new KbnFieldType({name:r._SOURCE,esTypes:[i._SOURCE]}),new KbnFieldType({name:r.HISTOGRAM,filterable:!0,esTypes:[i.HISTOGRAM]}),new KbnFieldType({name:r.CONFLICT}),n],l=e=>{const t=o.find((t=>t.esTypes.includes(e)));return t&&t.name?t.name:r.UNKNOWN};function u(e){if(e.startsWith("counter_"))return r.NUMBER;switch(e){case i._INDEX:return r.STRING;case"_version":return r.NUMBER;case"datetime":return r.DATE;default:return l(e)}}},1241:(e,t,a)=>{"use strict";a.d(t,{B8:()=>l,sc:()=>c});var s=a(4286);const i=[25,50,100],r=50;var n=a(8915);class Storage{constructor(){(0,n.default)(this,"engine",window.localStorage),(0,n.default)(this,"prefix","tablePersist")}encode(e){return JSON.stringify(e)}decode(e){if("string"==typeof e)return JSON.parse(e)}encodeKey(e){return`${this.prefix}:${e}`}set(e,t){return this.engine.setItem(this.encodeKey(e),this.encode(t)),t}has(e){return null!=this.engine.getItem(this.encodeKey(e))}get(e,t){return this.has(e)?this.decode(this.engine.getItem(this.encodeKey(e))):t}}const o=(e,t)=>{const a=null==e?void 0:e.pageSize,s=null==e?void 0:e.sort;let i=a,r=s;if(a&&!t.includes(a)&&(i=void 0),s){const e=s.field,t=s.direction;"string"==typeof e&&["asc","desc"].includes(t)||(r=void 0)}return{pageSize:i,sort:r}};function l({tableId:e,customOnTableChange:t,initialSort:a,initialPageSize:n,pageSizeOptions:l}){var u;const d=new Storage,c=d.get(e,void 0),{pageSize:g,sort:h}=o(c,null!=l?l:i),[p,f]=(0,s.useState)(null!==(u=null!=g?g:n)&&void 0!==u?u:r),[m,y]=(0,s.useState)(null!=h?h:a);return{pageSize:p,sorting:!m||{sort:m},onTableChange:(0,s.useCallback)((a=>{var s,i,r,n,o,l,u;let c;t&&t(a);const p=""===(null===(s=a.sort)||void 0===s||null===(i=s.field)||void 0===i?void 0:i.toString());null!==(r=a.sort)&&void 0!==r&&r.field&&null!==(n=a.sort)&&void 0!==n&&n.direction&&(c=a.sort),(null!==(o=a.sort)&&void 0!==o&&o.field||null!==(l=a.sort)&&void 0!==l&&l.direction)&&y(c);const m=null===(u=a.page)||void 0===u?void 0:u.size;if(m&&f(m),m&&m!==g||c&&c!==h||p){const t={pageSize:m,sort:c};d.set(e,t)}}),[t,d,g,h,e])}}var u=a(3185),d=a(6791);function c(e,t){return a=>{const s=t.get?t.get(a):{},i={...t,...a.euiTablePersistProps,...s},{tableId:r,customOnTableChange:n,initialSort:o,initialPageSize:c,pageSizeOptions:g}=i;if(!r)throw new Error("tableId is required");const h=l({tableId:r,customOnTableChange:n,initialSort:o,initialPageSize:c,pageSizeOptions:g}),{euiTablePersistProps:p,...f}=a;return(0,d.jsx)(e,(0,u.default)({},f,{euiTablePersist:h}))}}},2787:(e,t,a)=>{"use strict";a.d(t,{JI:()=>o,JO:()=>i,M4:()=>n,SA:()=>s,nK:()=>r});const s="kuery",i="kibana.userQueryLanguage",r="/internal/saved_query",n="1",o="1"},4177:(e,t,a)=>{"use strict";a.r(t),a.d(t,{AggConfig:()=>c.CuU,AggConfigs:()=>c.dg3,AggGroupLabels:()=>c.qLR,AggGroupNames:()=>c.TO1,AggParamType:()=>c.Jnb,AggType:()=>c.sow,AggTypesRegistry:()=>c.QJv,AggsCommonService:()=>c.fXy,BUCKET_TYPES:()=>c.TDc,BaseParamType:()=>c.Lnr,BucketAggType:()=>c.aiG,CSV_FORMULA_CHARS:()=>h,CSV_MIME_TYPE:()=>T,CidrMask:()=>c.buk,DATA_VIEW_SAVED_OBJECT_TYPE:()=>M.DATA_VIEW_SAVED_OBJECT_TYPE,DEFAULT_ASSETS_TO_IGNORE:()=>M.DEFAULT_ASSETS_TO_IGNORE,DEFAULT_QUERY_LANGUAGE:()=>s.SA,DIVERSIFIED_SAMPLER_AGG_NAME:()=>c.yAE,DataView:()=>M.DataView,DataViewField:()=>M.DataViewField,DataViewSavedObjectConflictError:()=>M.DataViewSavedObjectConflictError,DataViewType:()=>M.DataViewType,DataViewsService:()=>M.DataViewsService,DatatableUtilitiesService:()=>DatatableUtilitiesService,DuplicateDataViewError:()=>M.DuplicateDataViewError,ENHANCED_ES_SEARCH_STRATEGY:()=>c.RNT,EQL_SEARCH_STRATEGY:()=>c.ky9,ESQL_ASYNC_SEARCH_STRATEGY:()=>c.mid,ESQL_SEARCH_STRATEGY:()=>c.fOT,ESQL_TABLE_TYPE:()=>c.AV0,ES_FIELD_TYPES:()=>g._,ES_SEARCH_STRATEGY:()=>c.kAj,FieldParamType:()=>c.Gwp,IP_RANGE_TYPES:()=>c.O0P,InvalidEsCalendarIntervalError:()=>c.zUd,InvalidEsIntervalFormatError:()=>c.mOS,IpAddress:()=>c.m8W,JsonParamType:()=>c.Oq5,KBN_FIELD_TYPES:()=>g.f,KIBANA_USER_QUERY_LANGUAGE_KEY:()=>s.JO,KQL_TELEMETRY_ROUTE_LATEST_VERSION:()=>s.M4,KbnFieldType:()=>u.qZ,META_FIELDS:()=>M.META_FIELDS,METRIC_TYPES:()=>c.zmd,MULTI_FIELD_KEY_SEPARATOR:()=>c.dY5,MetricAggType:()=>c.mz6,MultiFieldKey:()=>c.p0N,OptionedParamType:()=>c.o8K,REASON_IDS:()=>c.At2,RUNTIME_FIELD_TYPES:()=>M.RUNTIME_FIELD_TYPES,RangeKey:()=>c.FYW,RequestFailure:()=>c.e6x,SAMPLER_AGG_NAME:()=>c.z3F,SAVED_QUERY_BASE_URL:()=>s.nK,SCRIPT_LANGUAGES_ROUTE_LATEST_VERSION:()=>s.JI,SEARCH_SESSIONS_TABLE_ID:()=>c.MXb,SEARCH_SESSION_TYPE:()=>c.VNk,SHARD_DELAY_AGG_NAME:()=>c.vZc,SQL_SEARCH_STRATEGY:()=>c.UNd,SearchSessionStatus:()=>c.vdD,SearchSource:()=>c.Cyp,SearchSourceService:()=>c.zA1,SearchStatus:()=>c.zmL,SerializableField:()=>r.u,SerializableType:()=>n.gi,SortDirection:()=>c.UEL,StringParamType:()=>c.lug,TimeBuckets:()=>c.tTJ,UI_SETTINGS:()=>i.j,adaptToExpressionValueFilter:()=>c.Nh9,aggAvg:()=>c.OBf,aggAvgFnName:()=>c.hEG,aggBucketAvg:()=>c.Efy,aggBucketAvgFnName:()=>c.lbX,aggBucketMax:()=>c.cUf,aggBucketMaxFnName:()=>c.v3f,aggBucketMin:()=>c.gdu,aggBucketMinFnName:()=>c.Fb7,aggBucketSum:()=>c.zAP,aggBucketSumFnName:()=>c.e0w,aggCardinality:()=>c.mZy,aggCardinalityFnName:()=>c.rjA,aggCount:()=>c.ZmW,aggCountFnName:()=>c.OL7,aggCumulativeSum:()=>c.SsN,aggCumulativeSumFnName:()=>c.PAj,aggDateHistogram:()=>c.Ca8,aggDateHistogramFnName:()=>c.vQh,aggDateRange:()=>c.foF,aggDateRangeFnName:()=>c.C6H,aggDerivative:()=>c.bgr,aggDerivativeFnName:()=>c.i2N,aggDiversifiedSampler:()=>c.i5z,aggDiversifiedSamplerFnName:()=>c.TFY,aggFilter:()=>c.oXr,aggFilterFnName:()=>c.tbp,aggFilteredMetric:()=>c.T1k,aggFilteredMetricFnName:()=>c.om,aggFilters:()=>c.jfr,aggFiltersFnName:()=>c.ejh,aggGeoBounds:()=>c.WVh,aggGeoBoundsFnName:()=>c.dKG,aggGeoCentroid:()=>c.dHe,aggGeoCentroidFnName:()=>c.W8J,aggGeoTile:()=>c.jsV,aggGeoTileFnName:()=>c.qIu,aggHistogram:()=>c.qew,aggHistogramFnName:()=>c.Vjs,aggIpPrefix:()=>c.Du,aggIpPrefixFnName:()=>c.CWM,aggIpRange:()=>c.wB5,aggIpRangeFnName:()=>c.Vzo,aggMax:()=>c.uC8,aggMaxFnName:()=>c.jST,aggMedian:()=>c.AJK,aggMedianFnName:()=>c.rGL,aggMin:()=>c.y3o,aggMinFnName:()=>c.ZO1,aggMovingAvg:()=>c.mgw,aggMovingAvgFnName:()=>c.VD$,aggMultiTerms:()=>c.mXM,aggMultiTermsFnName:()=>c.Pp7,aggPercentileRanks:()=>c.mU8,aggPercentileRanksFnName:()=>c.tpD,aggPercentiles:()=>c.U6Y,aggPercentilesFnName:()=>c.jJm,aggRange:()=>c.v0U,aggRangeFnName:()=>c.qoF,aggRareTerms:()=>c.pMt,aggRareTermsFnName:()=>c.ibD,aggRate:()=>c.c9O,aggRateFnName:()=>c.xzq,aggSampler:()=>c.GFW,aggSamplerFnName:()=>c.tK_,aggSerialDiff:()=>c.REs,aggSerialDiffFnName:()=>c.si_,aggSignificantTerms:()=>c.aw4,aggSignificantTermsFnName:()=>c.HCP,aggSignificantText:()=>c.C98,aggSignificantTextFnName:()=>c.nv7,aggSinglePercentile:()=>c.f90,aggSinglePercentileFnName:()=>c.AUv,aggSinglePercentileRank:()=>c.L69,aggSinglePercentileRankFnName:()=>c.mwK,aggStdDeviation:()=>c._Fq,aggStdDeviationFnName:()=>c.$Bi,aggSum:()=>c.FeO,aggSumFnName:()=>c.W3G,aggTerms:()=>c.Vog,aggTermsFnName:()=>c.sAW,aggTimeSeries:()=>c.UGU,aggTimeSeriesFnName:()=>c.Rcq,aggTopHit:()=>c._xq,aggTopHitFnName:()=>c.FKr,aggTopMetrics:()=>c.qZi,aggTopMetricsFnName:()=>c.NkJ,aggValueCount:()=>c.IQS,aggValueCountFnName:()=>c.zfq,aggregateQueryToAst:()=>c.PSF,aggsRequiredUiSettings:()=>c.PX$,autoInterval:()=>c.B1X,boundsDescendingRaw:()=>c.OI_,calcAutoIntervalLessThan:()=>c.u0$,calcAutoIntervalNear:()=>c._er,calculateBounds:()=>d.AE,cellHasFormulas:()=>b,cidrFunction:()=>c.dtO,cidrToAst:()=>c.iJZ,convertDateRangeToString:()=>c.N2Z,convertIPRangeToString:()=>c.QyU,createEscapeValue:()=>S,createSearchSource:()=>c.kVi,datatableToCSV:()=>E,dateHistogramInterval:()=>c.I1L,dateRangeFunction:()=>c.Muh,dateRangeToAst:()=>c.lO1,deserializeField:()=>n.IZ,eqlRawResponse:()=>c.iLg,esRawResponse:()=>c.uzQ,existsFilterFunction:()=>c.rk1,extendedBoundsFunction:()=>c.BUn,extendedBoundsToAst:()=>c.w1E,extractReferences:()=>c.QDx,fieldFunction:()=>c.rgn,fieldList:()=>M.fieldList,filtersToAst:()=>c.tTg,flattenHit:()=>c.Ucw,functionWrapper:()=>c.i0A,geoBoundingBoxFunction:()=>c.TU9,geoBoundingBoxToAst:()=>c.y9c,geoPointFunction:()=>c.aw$,geoPointToAst:()=>c.VNn,getAbsoluteTimeRange:()=>d.qq,getAggTypes:()=>c.F6S,getAggTypesFunctions:()=>c.Obw,getAggsFormats:()=>c.LaZ,getAvgMetricAgg:()=>c.UeN,getBucketAvgMetricAgg:()=>c.ATn,getBucketMaxMetricAgg:()=>c._h9,getBucketMinMetricAgg:()=>c.i23,getBucketSumMetricAgg:()=>c.HLz,getCalculateAutoTimeExpression:()=>c.JKe,getCardinalityMetricAgg:()=>c.Kd5,getCountMetricAgg:()=>c.HAP,getCumulativeSumMetricAgg:()=>c.YNN,getDateHistogramBucketAgg:()=>c.MUp,getDateRangeBucketAgg:()=>c.H8h,getDerivativeMetricAgg:()=>c.DqD,getDiversifiedSamplerBucketAgg:()=>c.qvY,getEqlFn:()=>c.l5r,getEsPreference:()=>c.OD5,getEsQueryConfig:()=>l.F,getEsaggsMeta:()=>c.KKF,getEsdslFn:()=>c.utN,getEsqlFn:()=>c.yhm,getFieldSubtypeMulti:()=>M.getFieldSubtypeMulti,getFieldSubtypeNested:()=>M.getFieldSubtypeNested,getFilterBucketAgg:()=>c.mOK,getFilteredMetricAgg:()=>c.Bw4,getFiltersBucketAgg:()=>c.Zy4,getGeoBoundsMetricAgg:()=>c.azA,getGeoCentroidMetricAgg:()=>c.nP5,getGeoTitleBucketAgg:()=>c.Bum,getHistogramBucketAgg:()=>c.IYs,getIndexPatternLoadMeta:()=>M.getIndexPatternLoadMeta,getIpPrefixBucketAgg:()=>c.pSU,getIpRangeBucketAgg:()=>c.aZK,getMaxMetricAgg:()=>c.EzU,getMedianMetricAgg:()=>c.oUU,getMinMetricAgg:()=>c.kY9,getMovingAvgMetricAgg:()=>c.Alz,getMultiTermsBucketAgg:()=>c._Xw,getPercentileRanksMetricAgg:()=>c.yyA,getPercentilesMetricAgg:()=>c.aRc,getRangeBucketAgg:()=>c.ZJo,getRareTermsBucketAgg:()=>c.XLV,getRateMetricAgg:()=>c.mvy,getRelativeTime:()=>d.gs,getResponseInspectorStats:()=>c.EzV,getSamplerBucketAgg:()=>c.IH1,getSearchParamsFromRequest:()=>c.c2H,getSerialDiffMetricAgg:()=>c.jb4,getSignificantTermsBucketAgg:()=>c.YHK,getSignificantTextBucketAgg:()=>c.czt,getSinglePercentileMetricAgg:()=>c.rFf,getSinglePercentileRankMetricAgg:()=>c.vo0,getStdDeviationMetricAgg:()=>c.uSi,getSumMetricAgg:()=>c.JXX,getTermsBucketAgg:()=>c.x0l,getTime:()=>d.WB,getTimeSeriesBucketAgg:()=>c.OrF,getTopHitMetricAgg:()=>c.YhB,getTopMetricsMetricAgg:()=>c.cLp,getTotalLoaded:()=>c.AmH,getUserTimeZone:()=>c.fyU,getValueCountMetricAgg:()=>c.c12,handleEsaggsRequest:()=>c.Q_w,inferTimeZone:()=>c.s9S,injectReferences:()=>c.kiA,intervalOptions:()=>c.WB4,ipPrefixFunction:()=>c.eYm,ipPrefixToAst:()=>c.dJ0,ipRangeFunction:()=>c.rDs,ipRangeToAst:()=>c.IZ,isAbortResponse:()=>c.E8Q,isAbsoluteTimeShift:()=>c.JNE,isAutoInterval:()=>c.za8,isBucketAggType:()=>c.M3U,isDateHistogramBucketAggConfig:()=>c.itY,isFilterable:()=>M.isFilterable,isMetricAggType:()=>c.sy,isMultiField:()=>M.isMultiField,isNestedField:()=>M.isNestedField,isNumberType:()=>c.qSv,isQuery:()=>d.P4,isRunningResponse:()=>c.vQj,isSerializedSearchSource:()=>c.yPl,isStringOrNumberType:()=>c.Ehy,isStringType:()=>c.mgc,isTimeRange:()=>d.Df,isType:()=>c.Xjv,isValidEsInterval:()=>c.usJ,isValidInterval:()=>c.Cec,kibana:()=>c.L1,kibanaFilterFunction:()=>c.JjL,kibanaTimerangeFunction:()=>c.JW4,kqlFunction:()=>c.hnj,luceneFunction:()=>c.bOY,migrateIncludeExcludeFormat:()=>c.fYb,numericalRangeFunction:()=>c.wcW,numericalRangeToAst:()=>c.Lpc,parentPipelineAggHelper:()=>c.IJq,parentPipelineType:()=>c.$Ux,parseAbsoluteTimeShift:()=>c.spt,parseEsInterval:()=>c.njO,parseInterval:()=>c.P15,parseSearchSourceJSON:()=>c.zqr,parseTimeShift:()=>c.vC3,phraseFilterFunction:()=>c.SvO,pollSearch:()=>c.YV9,propFilter:()=>c.EyB,queryFilterFunction:()=>c.PFs,queryFilterToAst:()=>c.sjk,queryToAst:()=>c.EW1,queryToFields:()=>c.ri9,rangeFilterFunction:()=>c.c$p,rangeFunction:()=>c.EM$,removeFilterFunction:()=>c.LSk,searchSourceRequiredUiSettings:()=>c.EQP,selectFilterFunction:()=>c.XIV,serializeField:()=>n.tL,shimHitsTotal:()=>c.E1R,siblingPipelineAggHelper:()=>c.gJ6,siblingPipelineType:()=>c.RRC,splitStringInterval:()=>c.drh,tabifyAggResponse:()=>c.AXn,tabifyDocs:()=>c.FUj,tabifyGetColumns:()=>c.jZz,tableHasFormulas:()=>v,termsAggFilter:()=>c.zQf,textBasedQueryStateToAstWithValidation:()=>d.kh,textBasedQueryStateToExpressionAst:()=>d.L9,timerangeToAst:()=>c._Sh,toAbsoluteDates:()=>c.IIR,validateAbsoluteTimeShift:()=>c.pa7});var s=a(2787),i=a(3789),r=a(5336),n=a(7270),o=a(730);class DatatableUtilitiesService{constructor(e,t,a){this.aggs=e,this.dataViews=t,this.fieldFormats=a,this.getAggConfig=this.getAggConfig.bind(this),this.getDataView=this.getDataView.bind(this),this.getField=this.getField.bind(this),this.isFilterable=this.isFilterable.bind(this)}clearField(e){delete e.meta.field}clearFieldFormat(e){delete e.meta.params}async getAggConfig(e){const t=await this.getDataView(e);if(!t)return;const{aggs:a}=await this.aggs.createAggConfigs(t,e.meta.sourceParams&&[e.meta.sourceParams]);return a[0]}getDateHistogramMeta(e,t={}){if(!e.meta.sourceParams||!e.meta.sourceParams.params)return;const a=e.meta.sourceParams.params;let s;return a.used_interval&&"auto"!==a.used_interval&&(s=a.used_interval),{interval:s,timeZone:a.used_time_zone||t.timeZone,timeRange:e.meta.sourceParams.appliedTimeRange}}async getDataView(e){if(e.meta.index)return this.dataViews.get(e.meta.index)}async getField(e){if(!e.meta.field)return;const t=await this.getDataView(e);return t?t.getFieldByName(e.meta.field):void 0}getFieldFormat(e){return this.fieldFormats.deserialize(e.meta.params)}getInterval(e){var t;const a=null===(t=e.meta.sourceParams)||void 0===t?void 0:t.params;return null==a?void 0:a.interval}getNumberHistogramInterval(e){var t;if("esaggs"!==e.meta.source)return;if((null===(t=e.meta.sourceParams)||void 0===t?void 0:t.type)!==o.T.HISTOGRAM)return;const a=e.meta.sourceParams.params;return a.used_interval&&"string"!=typeof a.used_interval?a.used_interval:void 0}getTotalCount(e){var t,a;return null===(t=e.meta)||void 0===t||null===(a=t.statistics)||void 0===a?void 0:a.totalCount}hasPrecisionError(e){var t;return null===(t=e.meta.sourceParams)||void 0===t?void 0:t.hasPrecisionError}isFilterable(e){var t;if("esaggs"!==e.meta.source)return!1;const a=this.aggs.types.get(null===(t=e.meta.sourceParams)||void 0===t?void 0:t.type);return Boolean(a.createFilter)}setFieldFormat(e,t){e.meta.params=t.toJSON()}}var l=a(8351),u=a(3313),d=a(1373),c=a(5536),g=a(7371);const h=["=","+","-","@"],p=/[^a-zA-Z0-9]/,f=/"/g,m=new Set([",",";","\t"," ","|"]);var y=a(770);const b=e=>h.some((t=>(0,y.startsWith)(e,t))),v=(e,t)=>e.some((({name:e})=>b(e)))||t.some((t=>e.some((({id:e})=>b(t[e])))));function S({separator:e,quoteValues:t,escapeFormulaValues:a}){return function(s){if(s&&"string"==typeof s){const e=a&&b(s)?"'"+s:s;if(t&&p.test(e))return`"${e.replace(f,'""')}"`}const i=null==s?"":s.toString();return t&&function(e,t){const a=t.trim();return e.includes(a)&&m.has(a)}(i,e)?`"${i}"`:i}}const _="\r\n",T="text/plain;charset=utf-8";function E({columns:e,rows:t},{csvSeparator:a,quoteValues:s,formatFactory:i,raw:r,escapeFormulaValues:n}){const o=S({separator:a,quoteValues:s,escapeFormulaValues:n}),l=[],u=[],d={};if(e.forEach(((e,t)=>{var a;l[t]=o(e.name),u[t]=e.id,d[e.id]=i(null===(a=e.meta)||void 0===a?void 0:a.params)})),0===l.length)return"";const c=t.map((e=>u.map((t=>o(r?e[t]:d[t].convert(e[t]))))));return[l,...c].map((e=>e.join(a))).join(_)+_}var M=a(7674)},2956:(e,t,a)=>{"use strict";a.d(t,{_:()=>s._c,f:()=>s.fM});var s=a(3313)},71:(e,t,a)=>{"use strict";a.d(t,{R9:()=>u,WQ:()=>n,Y9:()=>o,kr:()=>l,o6:()=>r});var s=a(9472),i=a(7674);const r=e=>{const t=[];return{state:e.map((e=>{var a;if(null!==(a=e.meta)&&void 0!==a&&a.index){const a=(0,s.v4)();return t.push({type:i.DATA_VIEW_SAVED_OBJECT_TYPE,name:a,id:e.meta.index}),{...e,meta:{...e.meta,index:a}}}return e})),references:t}},n=(e,t)=>e.map((e=>{if(!e.meta.index)return e;const a=t.find((t=>t.name===e.meta.index));return{...e,meta:{...e.meta,index:a?a.id:e.meta.index}}})),o=(e,t)=>({}),l=e=>e.state,u=()=>({})},1373:(e,t,a)=>{"use strict";a.d(t,{AE:()=>s.AE,qq:()=>s.qq,gs:()=>s.gs,WB:()=>s.WB,P4:()=>r,Df:()=>i,kh:()=>d,L9:()=>u});var s=a(5265);const i=e=>!!e&&"object"==typeof e&&"string"==typeof e.from&&"string"==typeof e.to,r=e=>!!e&&"object"==typeof e&&"string"==typeof e.language&&("string"==typeof e.query||"object"==typeof e.query&&!!e.query);var n=a(5964),o=a(7876),l=a(4177);function u({filters:e,query:t,inputQuery:a,time:s,timeFieldName:i,titleForInspector:r,descriptionForInspector:u}){const d=(0,o.buildExpressionFunction)("kibana",{});let c;a&&(c=a);const g=(0,o.buildExpressionFunction)("kibana_context",{q:c&&(0,l.queryToAst)(c),timeRange:s&&(0,l.timerangeToAst)(s),filters:e&&(0,l.filtersToAst)(e)}),h=(0,o.buildExpression)([d,g]).toAst();if(t&&(0,n.isOfAggregateQueryType)(t)){const e=(0,l.aggregateQueryToAst)({query:t,timeField:i,titleForInspector:r,descriptionForInspector:u});e&&h.chain.push(e)}return h}async function d({filters:e,query:t,inputQuery:a,time:s,timeFieldName:i,titleForInspector:r,descriptionForInspector:o}){let l;return t&&(0,n.isOfAggregateQueryType)(t)&&(l=u({filters:e,query:t,inputQuery:a,time:s,timeFieldName:i,titleForInspector:r,descriptionForInspector:o})),l}},5265:(e,t,a)=>{"use strict";a.d(t,{AE:()=>c,WB:()=>h,gs:()=>p,qq:()=>g});var s=a(3313),i=a(6494),r=a.n(i),n=a(770),o=a(5964);const l=(e,t)=>r().parse(e,{forceNow:t}),u=(e,t)=>r().parse(e,{roundUp:!0,forceNow:t}),d=e=>"string"==typeof e&&e.includes("now");function c(e,t={}){return{min:l(e.from,t.forceNow),max:u(e.to,t.forceNow)}}function g(e,{forceNow:t}={}){const{min:a,max:s}=c(e,{forceNow:t});return{from:a?a.toISOString():e.from,to:s?s.toISOString():e.to}}function h(e,t,a){return f(e,t,(null==a?void 0:a.fieldName)||(null==e?void 0:e.timeFieldName),null==a?void 0:a.forceNow,!0)}function p(e,t,a){return f(e,t,(null==a?void 0:a.fieldName)||(null==e?void 0:e.timeFieldName),null==a?void 0:a.forceNow,!1)}function f(e,t,a,i,r=!0){const g=function(e,t){return!e&&t?{name:t,type:s.fM.DATE}:e?e.fields.find((a=>a.name===(t||e.timeFieldName))):void 0}(e,a);if(!g)return;let h={format:"strict_date_optional_time"};if(r){var p,f;const e=c(t,{forceNow:i});if(!e)return;h.gte=null===(p=e.min)||void 0===p?void 0:p.toISOString(),h.lte=null===(f=e.max)||void 0===f?void 0:f.toISOString()}else{var m,y;h.gte=d(t.from)?t.from:null===(m=l(t.from,i))||void 0===m?void 0:m.toISOString(),h.lte=d(t.to)?t.to:null===(y=u(t.to,i))||void 0===y?void 0:y.toISOString()}return h=(0,n.omitBy)(h,(e=>null==e)),(0,o.buildRangeFilter)(g,h,e)}},1616:(e,t,a)=>{"use strict";a.d(t,{C:()=>AggConfig});var s=a(8915),i=a(1783),r=a.n(i),n=a(770),o=a.n(n),l=a(5008),u=a(9800),d=a(2023);class AggConfig{static ensureIds(e){const t=[],a=[];e.forEach((function(e){(e.id?t:a).push(e)}));let s=AggConfig.nextId(t);return a.forEach((function(e){e.id=String(s++)})),e}static nextId(e){return 1+e.reduce((function(e,t){return Math.max(e,+t.id||0)}),0)}constructor(e,t){(0,s.default)(this,"aggConfigs",void 0),(0,s.default)(this,"id",void 0),(0,s.default)(this,"enabled",void 0),(0,s.default)(this,"params",void 0),(0,s.default)(this,"parent",void 0),(0,s.default)(this,"brandNew",void 0),(0,s.default)(this,"schema",void 0),(0,s.default)(this,"__type",void 0),(0,s.default)(this,"__typeDecorations",void 0),(0,s.default)(this,"subAggs",[]),this.aggConfigs=e,this.id=String(t.id||AggConfig.nextId(e.aggs)),this.enabled="boolean"!=typeof t.enabled||t.enabled,this.params={},this.setType(t.type),t.schema&&(this.schema=t.schema),this.setParams(t.params||{}),this.__type=this.__type}setParams(e){e=e||this.params||{};const t=this.params={};this.getAggParams().forEach((a=>{let s=e[a.name];if(null==s){if(null==a.default)return;if(o().isFunction(a.default)){if(s=a.default(this),null==s)return}else s=a.default}if(a.deserialize){var i;const e=null===(i=a.getValueType)||void 0===i?void 0:i.call(a,this),r=o().isFunction(e),n=r&&s instanceof e,l=!r&&o().isObject(s);return n||l||(s=a.deserialize(o().cloneDeep(s),this)),void(t[a.name]=s)}t[a.name]=o().cloneDeep(s)}))}getParam(e){return o().get(this.params,e)}hasTimeShift(){return Boolean(this.getParam("timeShift"))}getTimeShift(){const e=this.getParam("timeShift");if(!e)return;const t=(0,d.vC)(e);if("invalid"===t)throw new Error(`could not parse time shift ${e}`);if("previous"===t){const e=this.aggConfigs.getTimeShiftInterval();if(e)return e;if(!this.aggConfigs.timeRange)return;const t=this.aggConfigs.getResolvedTimeRange();return r().duration(r().tz(t.max,this.aggConfigs.timeZone).diff(t.min))}return t}write(e){return(0,u.m)(this.type.params,this,e)}isFilterable(){return o().isFunction(this.type.createFilter)}createFilter(e,t={}){const a=this.type.createFilter;if(!a)throw new TypeError(`The "${this.type.title}" aggregation does not support filtering.`);const s=this.getField(),i=this.getFieldDisplayName();if(s&&!s.filterable){let e=`The "${i}" field can not be used for filtering.`;throw s.scripted&&(e=`The "${i}" field is scripted and can not be used for filtering.`),new TypeError(e)}return a(this,e,t)}onSearchRequestStart(e,t){return this.type?Promise.all(this.type.params.map((a=>a.modifyAggConfigOnSearchRequestStart(this,e,t)))):Promise.resolve()}toDsl(e){if(this.type.hasNoDsl)return;const t=this.write(e),a={};if(this.type.hasNoDslParams||(a[this.type.dslName||this.type.name]=t.params),this.subAggs.length&&(t.subAggs?t.subAggs.push(...this.subAggs):t.subAggs=this.subAggs),t.subAggs){const s=a.aggs||(a.aggs={});t.subAggs.forEach((function(t){s[t.id]=t.toDsl(e)}))}if(t.parentAggs){const s=a.parentAggs||(a.parentAggs={});t.parentAggs.forEach((function(t){s[t.id]=t.toDsl(e)}))}return a}serialize(){const e=this.params,t=o().transform(this.getAggParams(),((t,a)=>{let s=e[a.name];null!=s&&(a.serialize&&(s=a.serialize(s,this)),null!=s&&(t[a.name]=o().cloneDeep(s)))}),{});return{id:this.id,enabled:this.enabled,type:this.type&&this.type.name,params:t,...this.schema&&{schema:this.schema}}}toJSON(){return this.serialize()}toSerializedFieldFormat(){return this.type?this.type.getSerializedFormat(this):{}}toExpressionAst(){const e=this.type&&this.type.expressionName,{type:t,...a}=this.serialize();if(e&&a.params)return{type:"expression",chain:[{type:"function",function:e,arguments:{...Object.entries(a.params).reduce(((e,[t,a])=>{const s=this.getAggParams().find((e=>e.name===t));if(s&&s.toExpressionAst){const a=s.toExpressionAst(this.getParam(t));a&&(e[t]=Array.isArray(a)?a:[a])}else if(a&&Array.isArray(a)){const s=a.filter((e=>null!=e));e[t]="object"==typeof s[0]?[JSON.stringify(s)]:s}else"object"==typeof a?e[t]=[JSON.stringify(a)]:void 0!==a&&(e[t]=[a]);return e}),{}),id:[this.id],enabled:[this.enabled],...this.schema?{schema:[this.schema]}:{}}}]}}getAggParams(){return[...o().hasIn(this,"type.params")?this.type.params:[]]}getRequestAggs(){return this.type&&this.type.getRequestAggs(this)||[this]}getResponseAggs(){return this.type&&this.type.getResponseAggs(this)||[this]}getValue(e){return this.type.getValue(this,e)}getResponseId(){return this.type.getResponseId(this)}getKey(e,t){return this.type.getKey?this.type.getKey(e,t,this):""}getFieldDisplayName(){const e=this.getField();return e?e.displayName||this.fieldName():""}getField(){return this.params.field}getValueBucketPath(){return this.type.getValueBucketPath(this)}makeLabel(e=!1){return this.params.customLabel?this.params.customLabel:this.type?e?l.i18n.translate("data.search.aggs.percentageOfLabel",{defaultMessage:"Percentage of {label}",values:{label:this.type.makeLabel(this)}}):`${this.type.makeLabel(this)}`:""}getIndexPattern(){return this.aggConfigs.indexPattern}getTimeRange(){return this.aggConfigs.timeRange}fieldName(){const e=this.getField();return e?e.name:""}fieldIsTimeField(){var e,t,a;const s=null===(e=this.getIndexPattern())||void 0===e||null===(t=e.getTimeField)||void 0===t||null===(a=t.call(e))||void 0===a?void 0:a.name,i=s?[s]:[],r=this.aggConfigs.timeFields&&this.aggConfigs.timeFields.length>0?this.aggConfigs.timeFields:i,n=this.fieldName();return r.includes(n)}get type(){return this.__type}set type(e){this.__typeDecorations&&o().forOwn(this.__typeDecorations,((e,t)=>{delete this[t]})),e&&o().isFunction(e.decorateAggConfig)&&(this.__typeDecorations=e.decorateAggConfig(),Object.defineProperties(this,this.__typeDecorations)),this.__type=e;let t=[];const a=this.type&&this.type.params.find((e=>"field"===e.type));a&&(t=a.getAvailableFields(this)),this.setParams({field:t.find((e=>e.name===this.getField()))})}setType(e){this.type=e}}},9800:(e,t,a)=>{"use strict";a.d(t,{V:()=>d,m:()=>c});var s=a(5675),i=a(6286),r=a(6252),n=a(8201),o=a(6490),l=a(8409);const u={field:i.G,optioned:r.o,string:n.l,json:o.O,agg:s.J,_default:l.L},d=e=>e.map((e=>new(u[e.type]||u._default)(e))),c=(e=[],t,a,s)=>{const i={params:{}};return s=s||{},e.forEach((e=>{e.write?e.write(t,i,a,s):e&&e.name&&(i.params[e.name]=t.params[e.name])})),i}},2666:(e,t,a)=>{"use strict";a.d(t,{s:()=>AggType});var s=a(8915),i=a(770),r=a(5008),n=a(9800),o=a(8409);class AggType{splitForTimeShift(e,t){return!1}constructor(e){if((0,s.default)(this,"name",void 0),(0,s.default)(this,"type",void 0),(0,s.default)(this,"subtype",void 0),(0,s.default)(this,"dslName",void 0),(0,s.default)(this,"expressionName",void 0),(0,s.default)(this,"title",void 0),(0,s.default)(this,"getValueType",void 0),(0,s.default)(this,"makeLabel",void 0),(0,s.default)(this,"ordered",void 0),(0,s.default)(this,"hasNoDsl",void 0),(0,s.default)(this,"hasNoDslParams",void 0),(0,s.default)(this,"createFilter",void 0),(0,s.default)(this,"params",void 0),(0,s.default)(this,"getRequestAggs",void 0),(0,s.default)(this,"getResponseAggs",void 0),(0,s.default)(this,"decorateAggConfig",void 0),(0,s.default)(this,"hasPrecisionError",void 0),(0,s.default)(this,"postFlightRequest",void 0),(0,s.default)(this,"getSerializedFormat",void 0),(0,s.default)(this,"getValue",void 0),(0,s.default)(this,"getKey",void 0),(0,s.default)(this,"paramByName",(e=>this.params.find((t=>t.name===e)))),(0,s.default)(this,"getValueBucketPath",(e=>e.id)),(0,s.default)(this,"getResponseId",void 0),this.name=e.name,this.type=e.type||"metrics",this.dslName=e.dslName||e.name,this.expressionName=e.expressionName,this.title=e.title,this.getValueType=e.getValueType,this.makeLabel=e.makeLabel||(0,i.constant)(this.name),this.ordered=e.ordered,this.hasNoDsl=!!e.hasNoDsl,this.hasNoDslParams=!!e.hasNoDslParams,e.createFilter&&(this.createFilter=e.createFilter),e.getValueBucketPath&&(this.getValueBucketPath=e.getValueBucketPath),e.params&&e.params.length&&e.params[0]instanceof o.L)this.params=e.params;else{const t=e.params?[...e.params]:[];!1!==e.json&&t.push({name:"json",type:"json",advanced:!0}),!1!==e.customLabels&&t.push({name:"customLabel",displayName:r.i18n.translate("data.search.aggs.string.customLabel",{defaultMessage:"Custom label"}),type:"string",write:i.noop}),this.params=(0,n.V)(t)}this.getRequestAggs=e.getRequestAggs||i.noop,this.getResponseAggs=e.getResponseAggs||(()=>{}),this.decorateAggConfig=e.decorateAggConfig||(()=>({})),this.postFlightRequest=e.postFlightRequest||i.identity,this.hasPrecisionError=e.hasPrecisionError,this.getSerializedFormat=e.getSerializedFormat||(e=>e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{}),this.getValue=e.getValue||((e,t)=>{}),this.getResponseId=e.getResponseId||(e=>e.id)}}},6763:(e,t,a)=>{"use strict";a.d(t,{B1:()=>i,WB:()=>n,z:()=>r});var s=a(5008);const i="auto",r=e=>e===i,n=[{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.autoDisplayName",{defaultMessage:"Auto"}),val:i,enabled:e=>e.fieldIsTimeField()},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.millisecondDisplayName",{defaultMessage:"Millisecond"}),val:"ms"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.secondDisplayName",{defaultMessage:"Second"}),val:"s"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.minuteDisplayName",{defaultMessage:"Minute"}),val:"m"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.hourlyDisplayName",{defaultMessage:"Hour"}),val:"h"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.dailyDisplayName",{defaultMessage:"Day"}),val:"d"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.weeklyDisplayName",{defaultMessage:"Week"}),val:"w"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.monthlyDisplayName",{defaultMessage:"Month"}),val:"M"},{display:s.i18n.translate("data.search.aggs.buckets.intervalOptions.yearlyDisplayName",{defaultMessage:"Year"}),val:"y"}]},5371:(e,t,a)=>{"use strict";a.d(t,{M:()=>n,a:()=>BucketAggType});var s=a(8915),i=a(2666);const r="buckets";class BucketAggType extends i.s{getShiftedKey(e,t,a){return t}getTimeShiftInterval(e){}orderBuckets(e,t,a){return Number(t.key)-Number(a.key)}constructor(e){super(e),(0,s.default)(this,"getKey",void 0),(0,s.default)(this,"type",r),this.getKey=e.getKey||((e,t)=>t||e.key),e.getShiftedKey&&(this.getShiftedKey=e.getShiftedKey),e.orderBuckets&&(this.orderBuckets=e.orderBuckets),e.getTimeShiftInterval&&(this.getTimeShiftInterval=e.getTimeShiftInterval),e.splitForTimeShift&&(this.splitForTimeShift=e.splitForTimeShift)}}function n(e){return e&&e.type===r}},730:(e,t,a)=>{"use strict";a.d(t,{T:()=>s});let s=function(e){return e.FILTER="filter",e.FILTERS="filters",e.HISTOGRAM="histogram",e.IP_PREFIX="ip_prefix",e.IP_RANGE="ip_range",e.DATE_RANGE="date_range",e.RANGE="range",e.TERMS="terms",e.MULTI_TERMS="multi_terms",e.RARE_TERMS="rare_terms",e.SIGNIFICANT_TERMS="significant_terms",e.SIGNIFICANT_TEXT="significant_text",e.GEOTILE_GRID="geotile_grid",e.DATE_HISTOGRAM="date_histogram",e.SAMPLER="sampler",e.DIVERSIFIED_SAMPLER="diversified_sampler",e.TIME_SERIES="time_series",e}({})},6034:(e,t,a)=>{"use strict";function s({from:e,to:t},a){return e?t?a(e)+" to "+a(t):"After "+a(e):"Before "+a(t)}a.d(t,{N:()=>s})},4611:(e,t,a)=>{"use strict";a.d(t,{Q:()=>s});const s=(e,t)=>"mask"===e.type?t(e.mask):`${e.from?t(e.from):"-Infinity"} to ${e.to?t(e.to):"Infinity"}`},1410:(e,t,a)=>{"use strict";a.d(t,{OI:()=>g,u0:()=>y,_e:()=>m});var s=a(1783),i=a.n(s),r=a(5008);const n=e=>r.i18n.translate("data.search.timeBuckets.dayLabel",{defaultMessage:"{amount, plural, one {a day} other {# days}}",values:{amount:e}}),o=e=>r.i18n.translate("data.search.timeBuckets.hourLabel",{defaultMessage:"{amount, plural, one {an hour} other {# hours}}",values:{amount:e}}),l=()=>r.i18n.translate("data.search.timeBuckets.yearLabel",{defaultMessage:"a year"}),u=e=>r.i18n.translate("data.search.timeBuckets.minuteLabel",{defaultMessage:"{amount, plural, one {a minute} other {# minutes}}",values:{amount:e}}),d=e=>r.i18n.translate("data.search.timeBuckets.secondLabel",{defaultMessage:"{amount, plural, one {a second} other {# seconds}}",values:{amount:e}}),c=e=>r.i18n.translate("data.search.timeBuckets.millisecondLabel",{defaultMessage:"{amount, plural, one {a millisecond} other {# milliseconds}}",values:{amount:e}}),g=[{bound:1/0,interval:i().duration(1,"year"),boundLabel:r.i18n.translate("data.search.timeBuckets.infinityLabel",{defaultMessage:"More than a year"}),intervalLabel:l()},{bound:i().duration(1,"year"),interval:i().duration(1,"month"),boundLabel:l(),intervalLabel:r.i18n.translate("data.search.timeBuckets.monthLabel",{defaultMessage:"a month"})},{bound:i().duration(3,"week"),interval:i().duration(1,"week"),boundLabel:n(21),intervalLabel:n(7)},{bound:i().duration(1,"week"),interval:i().duration(1,"d"),boundLabel:n(7),intervalLabel:n(1)},{bound:i().duration(24,"hour"),interval:i().duration(12,"hour"),boundLabel:n(1),intervalLabel:o(12)},{bound:i().duration(6,"hour"),interval:i().duration(3,"hour"),boundLabel:o(6),intervalLabel:o(3)},{bound:i().duration(2,"hour"),interval:i().duration(1,"hour"),boundLabel:o(2),intervalLabel:o(1)},{bound:i().duration(45,"minute"),interval:i().duration(30,"minute"),boundLabel:u(45),intervalLabel:u(30)},{bound:i().duration(20,"minute"),interval:i().duration(10,"minute"),boundLabel:u(20),intervalLabel:u(10)},{bound:i().duration(9,"minute"),interval:i().duration(5,"minute"),boundLabel:u(9),intervalLabel:u(5)},{bound:i().duration(3,"minute"),interval:i().duration(1,"minute"),boundLabel:u(3),intervalLabel:u(1)},{bound:i().duration(45,"second"),interval:i().duration(30,"second"),boundLabel:d(45),intervalLabel:d(30)},{bound:i().duration(15,"second"),interval:i().duration(10,"second"),boundLabel:d(15),intervalLabel:d(10)},{bound:i().duration(7.5,"second"),interval:i().duration(5,"second"),boundLabel:d(7.5),intervalLabel:d(5)},{bound:i().duration(5,"second"),interval:i().duration(1,"second"),boundLabel:d(5),intervalLabel:d(1)},{bound:i().duration(500,"ms"),interval:i().duration(100,"ms"),boundLabel:c(500),intervalLabel:c(100)}],h=g.map((({bound:e,interval:t})=>({bound:Number(e),interval:Number(t)})));function p(e,t){const a=t/e;return isFinite(a)?a:NaN}function f(e){const t=isNaN(e)?0:Math.max(Math.floor(e),1);return i().duration(t)}function m(e,t){const a=p(e,t),s=h.findIndex((({bound:e})=>Number(e)<=a));if(-1!==s){const e=h[s-1].interval;return i().duration(e)}return f(a)}function y(e,t){const a=p(e,t);for(const{interval:e}of h)if(e<=a)return i().duration(e);return f(a)}},4782:(e,t,a)=>{"use strict";a.d(t,{Tf:()=>c,YO:()=>h,tA:()=>g});var s=a(1783),i=a.n(s),r=a(6494),n=a.n(r),o=a(5008),l=a(2023);const u=n().unitsDesc,d=u.indexOf("w");function c(e,t){for(let a=0;a<u.length;a++){const s=u[a],i=e.as(s);if(i>=1&&Math.floor(i)===i){if(1===i&&t&&s!==t)continue;if(a<=d&&1!==i)continue;return{value:i,unit:s,expression:i+s}}}const a=e.as("ms");return{value:a,unit:"ms",expression:a+"ms"}}function g(e){const{value:t,unit:a}=(0,l.nj)(e);return{value:t,unit:a,expression:e}}function h(e,t){if("millisecond"===t)return 1===e?o.i18n.translate("data.search.aggs.buckets.intervalOptions.millisecond",{defaultMessage:"millisecond"}):o.i18n.translate("data.search.aggs.buckets.intervalOptions.milliseconds",{defaultMessage:"{n} milliseconds",values:{n:e}});const a=i().relativeTimeRounding(),s=[{unit:"m",value:60},{unit:"s",value:60},{unit:"ss",value:0},{unit:"ms",value:1e3}],r=s.map((({unit:e})=>i().relativeTimeThreshold(e))),n=Math.pow(10,2);i().relativeTimeRounding((e=>Math.round(e*n)/n)),s.forEach((({unit:e,value:t})=>i().relativeTimeThreshold(e,t)));const l=i().localeData()._config;i().updateLocale(i().locale(),{relativeTime:{ss:e=>1===e?o.i18n.translate("data.search.aggs.buckets.intervalOptions.second",{defaultMessage:"second"}):o.i18n.translate("data.search.aggs.buckets.intervalOptions.seconds",{defaultMessage:"{n} seconds",values:{n:e}}),m:o.i18n.translate("data.search.aggs.buckets.intervalOptions.minute",{defaultMessage:"minute"}),h:o.i18n.translate("data.search.aggs.buckets.intervalOptions.hourly",{defaultMessage:"hour"}),d:o.i18n.translate("data.search.aggs.buckets.intervalOptions.daily",{defaultMessage:"day"}),w:o.i18n.translate("data.search.aggs.buckets.intervalOptions.weekly",{defaultMessage:"week"}),M:o.i18n.translate("data.search.aggs.buckets.intervalOptions.monthly",{defaultMessage:"month"}),y:o.i18n.translate("data.search.aggs.buckets.intervalOptions.yearly",{defaultMessage:"year"})}});const u=i().duration(e,t).locale(o.i18n.getLocale()).humanize();return s.forEach((({unit:e},a)=>i().relativeTimeThreshold(t,r[a]))),i().relativeTimeRounding(a),i().updateLocale(i().locale(),l),u}},3894:(e,t,a)=>{"use strict";a.d(t,{t:()=>TimeBuckets});var s=a(8915),i=a(770),r=a(1783),n=a.n(r),o=a(2023),l=a(1410),u=a(4782),d=a(6763);function c(e){return e&&"isValid"in e&&e.isValid()}function g(e){return n().isDuration(e)&&Boolean(+e)}class TimeBuckets{constructor(e){(0,s.default)(this,"_timeBucketConfig",void 0),(0,s.default)(this,"_lb",void 0),(0,s.default)(this,"_ub",void 0),(0,s.default)(this,"_originalInterval",null),(0,s.default)(this,"_i",void 0),this._timeBucketConfig=e}getDuration(){if(void 0===this._ub||void 0===this._lb||!this.hasBounds())return;const e=this._ub.valueOf()-this._lb.valueOf();return n().duration(e,"ms")}setBounds(e){if(!e)return this.clearBounds();let t;t=(0,i.isPlainObject)(e)&&!Array.isArray(e)?[e.min,e.max]:Array.isArray(e)?e:[];const a=(0,i.sortBy)(t,Number);if(2!==a.length||!a.every(c))throw this.clearBounds(),new Error("invalid bounds set: "+e);this._lb=a.shift(),this._ub=a.pop();const s=this.getDuration();if(!s||s.asSeconds()<0)throw new TypeError("Intervals must be positive")}clearBounds(){this._lb=this._ub=void 0}hasBounds(){return c(this._ub)&&c(this._lb)}getBounds(){if(this.hasBounds())return{min:this._lb,max:this._ub}}setInterval(e){var t;if(this._originalInterval=null,this._i=(t=e,(0,i.isObject)(t)?e.val:e),this._i&&this._i!==d.B1){if((0,i.isString)(this._i)){const e=(0,o.P1)(this._i);g(e)&&(this._originalInterval=this._i,this._i=e)}if(!g(this._i))throw new TypeError('"'+this._i+'" is not a valid interval.')}else this._i=d.B1}getInterval(e=!0){const t=this.getDuration(),a=g(this._i)?this._i:(0,l._e)(this._timeBucketConfig["histogram:barTarget"],Number(t)),s=t=>{let a;var s;!t.scaled&&this._originalInterval&&(a=null===(s=(0,o.dr)(this._originalInterval))||void 0===s?void 0:s.unit);const i=e||!this._originalInterval?(0,u.Tf)(t,a):(0,u.tA)(this._originalInterval),r=n().normalizeUnits(i.unit),l=(0,u.YO)(i.value,r);return Object.assign(t,{description:l,esValue:i.value,esUnit:i.unit,expression:i.expression})};return s(e?(e=>{if(!this.hasBounds()||!t)return e;const a=this._timeBucketConfig["histogram:maxBars"],i=(0,l.u0)(a,Number(t));let r;return e<i?(r=i,e=s(e),Object.assign(r,{preScaled:e,scale:Number(e)/Number(r),scaled:!0})):e})(a):a)}getScaledDateFormat(){const e=this.getInterval(),t=this._timeBucketConfig["dateFormat:scaled"];for(let a=t.length-1;a>=0;a--){const s=t[a];if(!s[0]||e&&e>=n().duration(s[0]))return s[1]}return this._timeBucketConfig.dateFormat}}},4882:(e,t,a)=>{"use strict";a.d(t,{V:()=>n,v:()=>r});var s=a(5371),i=a(6721);const r="shard_delay",n=()=>new s.a({name:r,title:"Shard Delay",expressionName:i.k,createFilter:()=>({match_all:{}}),customLabels:!1,params:[{name:"delay",type:"string",default:"5s",write(e,t){t.params={...t.params,value:e.params.delay}}}]})},6721:(e,t,a)=>{"use strict";a.d(t,{H:()=>n,k:()=>r});var s=a(5008),i=a(4882);const r="aggShardDelay",n=()=>({name:r,help:s.i18n.translate("data.search.aggs.function.buckets.shardDelay.help",{defaultMessage:"Generates a serialized agg config for a Shard Delay agg"}),type:"agg_type",args:{id:{types:["string"],help:s.i18n.translate("data.search.aggs.buckets.shardDelay.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:s.i18n.translate("data.search.aggs.buckets.shardDelay.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:s.i18n.translate("data.search.aggs.buckets.shardDelay.schema.help",{defaultMessage:"Schema to use for this aggregation"})},delay:{types:["string"],help:s.i18n.translate("data.search.aggs.buckets.shardDelay.delay.help",{defaultMessage:'Delay between shards to process. Example: "5s".'})},json:{types:["string"],help:s.i18n.translate("data.search.aggs.buckets.shardDelay.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:s.i18n.translate("data.search.aggs.buckets.shardDelay.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:r,...n}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:r,type:i.v,params:{...n}}}}})},7451:(e,t,a)=>{"use strict";a.d(t,{CuU:()=>s.C,dg3:()=>AggConfigs,qLR:()=>h,TO1:()=>g,Jnb:()=>x.J,sow:()=>b.s,QJv:()=>AggTypesRegistry,fXy:()=>AggsCommonService,TDc:()=>_.T,Lnr:()=>k.L,aiG:()=>S.a,buk:()=>CidrMask,yAE:()=>qt,Gwp:()=>R.G,O0P:()=>Ne,zUd:()=>q.zU,mOS:()=>q.mO,m8W:()=>q.m8,Oq5:()=>N.O,zmd:()=>w,dY5:()=>Mt,mz6:()=>MetricAggType,p0N:()=>MultiFieldKey,o8K:()=>C.o,At2:()=>q.At,FYW:()=>RangeKey,z3F:()=>Lt,vZc:()=>Yt.v,lug:()=>L.l,tTJ:()=>A.t,OBf:()=>Qt,hEG:()=>Wt,Efy:()=>ea,lbX:()=>Zt,cUf:()=>ca,v3f:()=>da,gdu:()=>ma,Fb7:()=>fa,zAP:()=>_a,e0w:()=>Sa,mZy:()=>Ra,rjA:()=>ka,ZmW:()=>qa,OL7:()=>Ba,SsN:()=>Ua,PAj:()=>za,Ca8:()=>E,vQh:()=>T,foF:()=>V,C6H:()=>$,bgr:()=>Ja,i2N:()=>Qa,i5z:()=>Gt,TFY:()=>Ut,oXr:()=>J,tbp:()=>Q,T1k:()=>Aa,om:()=>Fa,jfr:()=>re,ejh:()=>ie,WVh:()=>as,dKG:()=>ts,dHe:()=>os,W8J:()=>ns,jsV:()=>ce,qIu:()=>de,qew:()=>fe,Vjs:()=>pe,Du:()=>Te,CWM:()=>_e,wB5:()=>xe,Vzo:()=>we,uC8:()=>gs,jST:()=>cs,AJK:()=>ms,rGL:()=>fs,y3o:()=>Ms,ZO1:()=>Es,mgw:()=>ws,VD$:()=>Is,mXM:()=>At,Pp7:()=>Ft,mU8:()=>Cs,tpD:()=>Ns,U6Y:()=>js,jJm:()=>qs,v0U:()=>Ge,qoF:()=>Ue,pMt:()=>Rt,ibD:()=>kt,c9O:()=>$s,xzq:()=>Gs,GFW:()=>Bt,tK_:()=>Ot,REs:()=>Xs,si_:()=>Js,aw4:()=>Ze,HCP:()=>Xe,C98:()=>rt,nv7:()=>it,f90:()=>Ss,AUv:()=>vs,L69:()=>Ys,mwK:()=>Hs,_Fq:()=>si,$Bi:()=>ai,FeO:()=>oi,W3G:()=>ni,Vog:()=>ut,sAW:()=>lt,UGU:()=>Vt,Rcq:()=>$t,_xq:()=>ci,FKr:()=>di,qZi:()=>fi,NkJ:()=>pi,IQS:()=>Pa,zfq:()=>La,PX$:()=>vi,B1X:()=>v.B1,OI_:()=>De.OI,u0$:()=>De.u0,_er:()=>De._e,N2Z:()=>Le.N,QyU:()=>Pe.Q,I1L:()=>q.I1,F6S:()=>yi,Obw:()=>bi,LaZ:()=>q.L,UeN:()=>Xt,ATn:()=>ua,_h9:()=>pa,i23:()=>va,HLz:()=>Ma,JKe:()=>q.JK,Kd5:()=>Ca,HAP:()=>ja,YNN:()=>Wa,MUp:()=>G,H8h:()=>W,DqD:()=>es,qvY:()=>zt,mOK:()=>se,Bw4:()=>xa,Zy4:()=>ue,azA:()=>rs,nP5:()=>ds,Bum:()=>he,IYs:()=>ve,pSU:()=>Ie,aZK:()=>Ce,EzU:()=>ps,oUU:()=>bs,kY9:()=>As,Alz:()=>Rs,_Xw:()=>xt,yyA:()=>Bs,aRc:()=>Us,ZJo:()=>Je,XLV:()=>Ct,mvy:()=>Ks,IH1:()=>Dt,jb4:()=>ti,YHK:()=>st,czt:()=>ot,rFf:()=>Ts,vo0:()=>Qs,uSi:()=>ri,JXX:()=>ui,x0l:()=>Tt,OrF:()=>Ht,YhB:()=>hi,cLp:()=>mi,c12:()=>Oa,s9S:()=>q.s9,WB4:()=>v.WB,JNE:()=>q.JN,za8:()=>v.z,M3U:()=>S.M,itY:()=>U,sy:()=>B,qSv:()=>Be,Ehy:()=>je,mgc:()=>qe,Xjv:()=>Oe,usJ:()=>q.us,Cec:()=>q.Ce,fYb:()=>ze,IJq:()=>Ka,$Ux:()=>Va,spt:()=>q.sp,njO:()=>q.nj,P15:()=>q.P1,vC3:()=>q.vC,EyB:()=>q.Ey,gJ6:()=>na,RRC:()=>ra,drh:()=>q.dr,zQf:()=>vt,IIR:()=>q.II,pa7:()=>q.p});var s=a(1616),i=a(8915),r=a(2488),n=a.n(r),o=a(770),l=a.n(o),u=a(5008),d=a(5964),c=a(7876);const g=Object.freeze({Buckets:"buckets",Metrics:"metrics",None:"none"}),h={[g.Buckets]:u.i18n.translate("data.search.aggs.aggGroups.bucketsText",{defaultMessage:"Buckets"}),[g.Metrics]:u.i18n.translate("data.search.aggs.aggGroups.metricsText",{defaultMessage:"Metrics"}),[g.None]:u.i18n.translate("data.search.aggs.aggGroups.noneText",{defaultMessage:"None"})};var p=a(4177);function f({type:e="random_sampler",probability:t,seed:a}){return{[e]:{probability:t,seed:a},aggs:{}}}function m(e){for(const t in e)if("parentAggs"===t)delete e[t];else if("object"==typeof e[t]){const a="parentAggs"in e[t];m(e[t]),a&&0===Object.keys(e[t]).length&&delete e[t]}}function y(e,t){t.parentAggs&&l().each(t.parentAggs,((t,a)=>{e[a]=t,y(e,t)}))}class AggConfigs{constructor(e,t=[],a,r){var n;(0,i.default)(this,"timeRange",void 0),(0,i.default)(this,"timeFields",void 0),(0,i.default)(this,"forceNow",void 0),(0,i.default)(this,"aggs",[]),(0,i.default)(this,"timeZone",void 0),(0,i.default)(this,"createAggConfig",((e,{addToAggConfigs:t=!0}={})=>{const{type:a}=e;let i;return e instanceof s.C?(i=e,e.parent=this):i=new s.C(this,{...e,type:"string"==typeof a?(e=>{const t=this.opts.typesRegistry.get(e);if(!t)throw new Error(u.i18n.translate("data.search.aggs.error.aggNotFound",{defaultMessage:'Unable to find a registered agg type for "{type}".',values:{type:a}}));return t})(a):a}),t&&this.aggs.push(i),i})),this.indexPattern=e,this.opts=a,this.getConfig=r,this.timeZone=(0,p.getUserTimeZone)(this.getConfig,null==a||null===(n=a.aggExecutionContext)||void 0===n?void 0:n.shouldDetectTimeZone),(t=s.C.ensureIds(t)).forEach((e=>this.createAggConfig(e)))}get hierarchical(){var e;return null!==(e=this.opts.hierarchical)&&void 0!==e&&e}get partialRows(){var e;return null!==(e=this.opts.partialRows)&&void 0!==e&&e}get samplerConfig(){var e;return{probability:null!==(e=this.opts.probability)&&void 0!==e?e:1,seed:this.opts.samplerSeed}}isSamplingEnabled(){return null!=(e=this.opts.probability)&&1!==e&&this.getRequestAggs().some((e=>!e.type.hasNoDsl));var e}setTimeFields(e){this.timeFields=e}setForceNow(e){this.forceNow=e}setTimeRange(e){this.timeRange=e;const t=a=>{l().each(a.params,(e=>{e instanceof s.C&&t(e)})),"date_histogram"===l().get(a,"type.name")&&(a.params.timeRange=e)};this.aggs.forEach(t)}getResolvedTimeRange(){return this.timeRange&&(0,p.calculateBounds)(this.timeRange,{forceNow:this.forceNow})}clone({enabledOnly:e=!0,opts:t}={}){return new AggConfigs(this.indexPattern,this.aggs.filter((t=>!e||t.enabled)),{...this.opts,...t},this.getConfig)}jsonDataEquals(e){if(e.length!==this.aggs.length)return!1;for(let t=0;t<this.aggs.length;t+=1)if(!l().isEqual(e[t].toJSON(),this.aggs[t].toJSON()))return!1;return!0}toDsl(){const e={};let t,a;const s=this.getTimeShifts(),i=Object.keys(s).length>1;if(this.hierarchical){if(i)throw new Error("Multiple time shifts not supported for hierarchical metrics");a=this.aggs.filter((function(e){return"metrics"===e.type.type&&"count"!==e.type.name})).map((e=>({config:e,dsl:e.toDsl(this)})))}const r=this.getRequestAggs(),o=r.filter((e=>!e.type.hasNoDsl)).length,u=this.getAll().findIndex((e=>"splitForTimeShift"in e.type&&e.type.splitForTimeShift(e,this)));var d;return this.isSamplingEnabled()&&(e.sampling=f({probability:null!==(d=this.opts.probability)&&void 0!==d?d:1,seed:this.opts.samplerSeed})),r.forEach(((r,d,c)=>{if(t){const e=c[d-1],a=t[e.id];t=(null==a?void 0:a.aggs)||t}else t=e,this.isSamplingEnabled()&&(t=t.sampling.aggs);if(i&&(t=function(e,t,a,s,i){if("splitForTimeShift"in t.type&&!t.type.splitForTimeShift(t,e))return s;if(!e.timeFields||e.timeFields.length<1)throw new Error("Time shift can only be used with configured time field");if(!e.timeRange)throw new Error("Time shift can only be used with configured time range");const r=e.timeRange,o={},l=e.timeFields[0],u=(0,p.getTime)(e.indexPattern,r,{fieldName:l,forceNow:e.forceNow});return Object.entries(a).forEach((([e,t])=>{u&&(o[e]={range:{[l]:{format:"strict_date_optional_time",gte:n().tz(u.query.range[l].gte,i).subtract(t).toISOString(),lte:n().tz(u.query.range[l].lte,i).subtract(t).toISOString()}}})})),s.time_offset_split={filters:{filters:o},aggs:{}},s.time_offset_split.aggs}(this,r,s,t,this.timeZone)),r.type.hasNoDsl)return;const h=r.type.hasNoDslParams?r.toDsl(this):t[r.id]=r.toDsl(this);let f;y(t,h),r.type.type===g.Buckets&&(d<o-1||u>d)&&(f=h.aggs||(h.aggs={})),f&&l().each(f,(e=>{y(f,e)})),f&&a&&a.forEach((e=>{f[e.config.id]=e.dsl,e.dsl.parentAggs&&Object.entries(e.dsl.parentAggs).forEach((([e,t])=>{f[e]=t}))}))})),m(e),e}getAll(){return[...this.aggs]}byIndex(e){return this.aggs[e]}byId(e){return this.aggs.find((t=>t.id===e))}byName(e){return this.aggs.filter((t=>{var a;return(null===(a=t.type)||void 0===a?void 0:a.name)===e}))}byType(e){return this.aggs.filter((t=>{var a;return(null===(a=t.type)||void 0===a?void 0:a.type)===e}))}byTypeName(e){return this.byName(e)}bySchemaName(e){return this.aggs.filter((t=>t.schema===e))}getRequestAggs(){const e=this.aggs.filter((e=>e.enabled&&e.type)).reduce(((e,t)=>{const a=t.getRequestAggs();return a?e.concat(a):e}),[]);return l().sortBy(e,(e=>e.type.type===g.Metrics?1:0))}getTimeShifts(){const e={};return this.getAll().filter((e=>"metric"===e.schema)).map((e=>e.getTimeShift())).forEach((t=>{t?e[String(t.asMilliseconds())]=t:e[0]=n().duration(0)})),e}getTimeShiftInterval(){const e=this.getAll().filter((e=>e.type.type===g.Buckets)).find((e=>e.type.splitForTimeShift(e,this)));return null==e?void 0:e.type.getTimeShiftInterval(e)}hasTimeShifts(){return this.getAll().some((e=>e.hasTimeShift()))}getSearchSourceTimeFilter(e){var t;if(!this.timeFields||!this.timeRange)return[];const a=this.timeRange,s=this.timeFields,i=this.getTimeShifts();return this.hasTimeShifts()?[{meta:{index:null===(t=this.indexPattern)||void 0===t?void 0:t.id,params:{},alias:"",disabled:!1,negate:!1},query:{bool:{should:Object.entries(i).map((([,t])=>({bool:{filter:s.map((t=>[(0,p.getTime)(this.indexPattern,a,{fieldName:t,forceNow:e}),t])).filter((([e])=>(0,d.isRangeFilter)(e))).map((([e,a])=>({range:{[a]:{format:"strict_date_optional_time",gte:n().tz(null==e?void 0:e.query.range[a].gte,this.timeZone).subtract(t).toISOString(),lte:n().tz(null==e?void 0:e.query.range[a].lte,this.timeZone).subtract(t).toISOString()}}})))}}))),minimum_should_match:1}}}]:this.timeFields.map((t=>(0,p.getTime)(this.indexPattern,a,{fieldName:t,forceNow:e}))).filter(d.isRangeFilter)}postFlightTransform(e){if(!this.hasTimeShifts())return e;const t=structuredClone(e.rawResponse);var a;return e.rawResponse.aggregations||(t.aggregations={doc_count:null===(a=e.rawResponse.hits)||void 0===a?void 0:a.total}),function(e,t){const a=e.getTimeShifts(),s=Object.keys(a).length>1,i=e.getRequestAggs(),r=e.aggs.filter((e=>e.type.type===g.Buckets)),n=(e,t,a,s)=>{Object.entries(t).forEach((([l,u])=>{if("number"==typeof u&&"doc_count"===l)0===a.asMilliseconds()?e.doc_count=u:e[`doc_count_${a.asMilliseconds()}`]=u;else{if("object"!=typeof u)return;{const d=i.find((e=>l===e.getResponseId()));if(d&&d.type.type===g.Metrics){const s=d.getTimeShift();(s&&s.asMilliseconds()===a.asMilliseconds()||0===a.asMilliseconds()&&!s)&&(e[l]=t[l])}else if(d&&d===r[s]){const t=d,i="buckets"in u?u.buckets:void 0;e[l]||(e[l]={buckets:(0,o.isArray)(i)?[]:{}});const r=e[l],c="buckets"in r?r.buckets:void 0;if((0,o.isArray)(i)&&(0,o.isArray)(c)){const e={};c.forEach((t=>{e[String(t.key)]=t})),i.forEach((i=>{const r=t.type.getShiftedKey(t,i.key,a);e[r]||(e[String(r)]={key:r}),n(e[r],i,a,s+1)})),r.buckets=Object.values(e).sort(((e,a)=>t.type.orderBuckets(t,e,a)))}else c&&i&&!(0,o.isArray)(c)&&Object.entries(i).forEach((([e,t])=>{c[e]||(c[e]={}),n(c[e],t,a,s+1)}))}}}}))},l=(t,i)=>{if(e.aggs[i].type.splitForTimeShift(e.aggs[i],e))if(s&&t.time_offset_split){const e=t.time_offset_split.buckets,s={};Object.entries(a).forEach((([t,a])=>{n(s,e[t],a,i)})),delete t.time_offset_split,Object.assign(t,s)}else{const[[,e]]=Object.entries(a),s={};n(s,t,e,i),Object.assign(t,s)}else Object.keys(t).forEach((e=>{const a=t[e];"object"==typeof a&&"buckets"in a&&((0,o.isArray)(a.buckets)?a.buckets.forEach((e=>l(e,i+1))):Object.values(a.buckets).forEach((e=>l(e,i+1))))}))};l(t,0)}(this,this.isSamplingEnabled()?t.aggregations.sampling:t.aggregations),{...e,rawResponse:t}}getRequestAggById(e){return this.aggs.find((t=>t.id===e))}getResponseAggs(){return this.getRequestAggs().reduce((function(e,t){const a=t.getResponseAggs();return a?e.concat(a):e}),[])}getResponseAggById(e){e=String(e);const t=l().find(this.getRequestAggs(),(function(t){const a=String(t.id);return e.includes("[")||e.includes(".")?e.substring(0,-1!==e.indexOf("[")?e.indexOf("["):e.indexOf("."))===a:e===a}));if(t)return l().find(t.getResponseAggs(),{id:e})}onSearchRequestStart(e,t){return Promise.all(this.getRequestAggs().map((a=>a.onSearchRequestStart(e,t))))}toExpressionAst(){return(0,c.buildExpression)([(0,c.buildExpressionFunction)("esaggs",{index:(0,c.buildExpression)([(0,c.buildExpressionFunction)("indexPatternLoad",{id:this.indexPattern.id})]),metricsAtAllLevels:this.hierarchical,partialRows:this.partialRows,aggs:this.aggs.map((e=>(0,c.buildExpression)(e.toExpressionAst()))),probability:this.opts.probability,samplerSeed:this.opts.samplerSeed})]).toAst()}}var b=a(2666),v=a(6763),S=a(5371),_=a(730);const T="aggDateHistogram",E=()=>({name:T,help:u.i18n.translate("data.search.aggs.function.buckets.dateHistogram.help",{defaultMessage:"Generates a serialized agg config for a Histogram agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.dateHistogram.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.buckets.dateHistogram.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.dateHistogram.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.dateHistogram.field.help",{defaultMessage:"Field to use for this aggregation"})},useNormalizedEsInterval:{types:["boolean"],help:u.i18n.translate("data.search.aggs.buckets.dateHistogram.useNormalizedEsInterval.help",{defaultMessage:"Specifies whether to use useNormalizedEsInterval for this aggregation"})},time_zone:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.dateHistogram.timeZone.help",{defaultMessage:"Time zone to use for this aggregation"})},format:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.dateHistogram.format.help",{defaultMessage:"Format to use for this aggregation"})},scaleMetricValues:{types:["boolean"],help:u.i18n.translate("data.search.aggs.buckets.dateHistogram.scaleMetricValues.help",{defaultMessage:"Specifies whether to use scaleMetricValues for this aggregation"})},interval:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.dateHistogram.interval.help",{defaultMessage:"Interval to use for this aggregation"})},timeRange:{types:["timerange"],help:u.i18n.translate("data.search.aggs.buckets.dateHistogram.timeRange.help",{defaultMessage:"Time Range to use for this aggregation"})},min_doc_count:{types:["number"],help:u.i18n.translate("data.search.aggs.buckets.dateHistogram.minDocCount.help",{defaultMessage:"Minimum document count to use for this aggregation"})},drop_partials:{types:["boolean"],help:u.i18n.translate("data.search.aggs.buckets.dateHistogram.dropPartials.help",{defaultMessage:"Specifies whether to use drop_partials for this aggregation"})},extended_bounds:{types:["extended_bounds"],help:u.i18n.translate("data.search.aggs.buckets.dateHistogram.extendedBounds.help",{defaultMessage:'With extended_bounds setting, you now can "force" the histogram aggregation to start building buckets on a specific min value and also keep on building buckets up to a max value '})},extendToTimeRange:{types:["boolean"],help:u.i18n.translate("data.search.aggs.buckets.dateHistogram.extendToTimeRange.help",{defaultMessage:"Auto-sets the extended bounds to the currently applied time range. Is ignored if extended_bounds is set"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.dateHistogram.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.dateHistogram.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,timeRange:i,extended_bounds:r,...n})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...n,timeRange:i&&(0,o.omit)(i,"type"),extended_bounds:r&&(0,o.omit)(r,"type")},type:_.T.DATE_HISTOGRAM}})});var M=a(8686);const F=(e,t)=>{const a=n().tz(t,e.aggConfigs.timeZone),s=e.buckets.getInterval();return(0,d.buildRangeFilter)(e.params.field,{gte:a.toISOString(),lt:a.add(s).toISOString(),format:"strict_date_optional_time"},e.getIndexPattern())};var A=a(3894),I=a(9800);let w=function(e){return e.AVG="avg",e.FILTERED_METRIC="filtered_metric",e.CARDINALITY="cardinality",e.VALUE_COUNT="value_count",e.AVG_BUCKET="avg_bucket",e.MAX_BUCKET="max_bucket",e.MIN_BUCKET="min_bucket",e.SUM_BUCKET="sum_bucket",e.COUNT="count",e.CUMULATIVE_SUM="cumulative_sum",e.DERIVATIVE="derivative",e.GEO_BOUNDS="geo_bounds",e.GEO_CENTROID="geo_centroid",e.MEDIAN="median",e.SINGLE_PERCENTILE="single_percentile",e.SINGLE_PERCENTILE_RANK="single_percentile_rank",e.MIN="min",e.MAX="max",e.MOVING_FN="moving_avg",e.SERIAL_DIFF="serial_diff",e.SUM="sum",e.TOP_HITS="top_hits",e.TOP_METRICS="top_metrics",e.PERCENTILES="percentiles",e.PERCENTILE_RANKS="percentile_ranks",e.RATE="rate",e.STD_DEV="std_dev",e}({});var x=a(5675),k=a(8409),R=a(6286),N=a(6490),C=a(6252),L=a(8201);const P=(e,t)=>{const a=e.getIndexPattern();if(e.getField())return(0,d.buildExistsFilter)(e.getField(),a)},D=(e,t)=>{const a=e.getIndexPattern(),s=e.getField();if(s)return Array.isArray(t)?(0,d.buildCombinedFilter)(d.BooleanRelation.OR,t.map((e=>(0,d.buildPhraseFilter)(s,e,a))),a):(0,d.buildPhraseFilter)(s,t,a)},O="metrics";class MetricAggType extends b.s{constructor(e){e.createFilter||(e.createFilter=P),super(e),(0,i.default)(this,"subtype",void 0),(0,i.default)(this,"isScalable",void 0),(0,i.default)(this,"type",O),(0,i.default)(this,"getKey",(()=>{})),this.params.push(new k.L({name:"timeShift",type:"string",write:()=>{}})),e.enableEmptyAsNull&&this.params.push(new k.L({name:"emptyAsNull",type:"boolean",default:!1,write:()=>{}})),this.getValue=e.getValue||((e,t)=>{const a=[w.CARDINALITY,w.VALUE_COUNT,w.SUM].includes(e.type.name);if(!t[e.id]&&a&&!e.params.emptyAsNull)return 0;const s=t[e.id]&&t[e.id].value;return 0===s&&e.params.emptyAsNull?null:s}),this.subtype=e.subtype||u.i18n.translate("data.search.aggs.metrics.metricAggregationsSubtypeTitle",{defaultMessage:"Metric Aggregations"}),this.isScalable=e.isScalable||(()=>!1),this.splitForTimeShift=(e,t)=>t.hasTimeShifts()&&t.byType(g.Metrics)[0]===e&&!t.byType(g.Buckets).some((e=>e.type.splitForTimeShift(e,t)))}}function B(e){return e&&e.type===O}var q=a(2023),j=a(3721);const z=(e,t,a)=>{const s=e.params.timeRange&&(e.fieldIsTimeField()||(0,v.z)(e.params.interval))?t(e.params.timeRange):void 0,i=a||e.buckets;i.setBounds(s),i.setInterval(e.params.interval)};function U(e){return Boolean(e.buckets)}const G=({calculateBounds:e,aggExecutionContext:t,getConfig:a})=>new S.a({name:_.T.DATE_HISTOGRAM,expressionName:T,title:u.i18n.translate("data.search.aggs.buckets.dateHistogramTitle",{defaultMessage:"Date Histogram"}),ordered:{date:!0},makeLabel(e){let t={};this.params&&(t=(0,I.m)(this.params,e));const a=e.getFieldDisplayName();return u.i18n.translate("data.search.aggs.buckets.dateHistogramLabel",{defaultMessage:"{fieldName} per {intervalDescription}",values:{fieldName:a,intervalDescription:t.metricScaleText||t.bucketInterval.description}})},createFilter:F,decorateAggConfig(){let t;return{buckets:{configurable:!0,get(){if(t)return t;t=new A.t({"histogram:maxBars":a(p.UI_SETTINGS.HISTOGRAM_MAX_BARS),"histogram:barTarget":a(p.UI_SETTINGS.HISTOGRAM_BAR_TARGET),dateFormat:a("dateFormat"),"dateFormat:scaled":a("dateFormat:scaled")});try{z(this,e,t)}catch(e){j.error(e)}return t}}}},getSerializedFormat:e=>({id:"date",params:{pattern:e.buckets.getScaledDateFormat()}}),getShiftedKey(e,s,i){const r=(0,q.s9)(e.params,e.getIndexPattern(),"date_histogram",a,t);return n().tz(s,r).add(i).valueOf()},splitForTimeShift(e,t){var a;return t.hasTimeShifts()&&Boolean(null===(a=t.timeFields)||void 0===a?void 0:a.includes(e.fieldName()))},getTimeShiftInterval(e){const{useNormalizedEsInterval:t}=e.params;return e.buckets.getInterval(t)},params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.DATE_RANGE],default(e){var t,a,s;return null===(t=(a=e.getIndexPattern()).getTimeField)||void 0===t||null===(s=t.call(a))||void 0===s?void 0:s.name},onChange(e){(0,v.z)((0,o.get)(e,"params.interval"))&&!e.fieldIsTimeField()&&delete e.params.interval}},{name:"timeRange",default:null,write:o.noop,toExpressionAst:M.timerangeToAst},{name:"useNormalizedEsInterval",default:!0,write:o.noop},{name:"extendToTimeRange",default:!1,write:o.noop},{name:"scaleMetricValues",default:!1,write:o.noop,advanced:!0},{name:"interval",deserialize:(e,t)=>"custom"===e?(0,o.get)(t,"params.customInterval"):(0,o.find)(v.WB,{val:e})||"year"!==e?e:"y",default:v.B1,options:v.WB,write(t,a,s){var i,r;z(t,e);const{useNormalizedEsInterval:n,scaleMetricValues:l}=t.params,u=t.buckets.getInterval(n);if(a.bucketInterval=u,"0ms"===u.expression)return;const d=null===(i=t.params.field)||void 0===i||null===(r=i.fixedInterval)||void 0===r?void 0:r.length;if(a.params={...a.params,...(0,q.I1)(u.expression,d)},l&&u.scaled&&u.scale&&u.scale<1&&s){const e=s.aggs.filter((e=>B(e.type)));var c;(0,o.every)(e,(e=>{const{type:t}=e;if(B(t))return t.isScalable()}))&&(a.metricScale=u.scale,a.metricScaleText=(null===(c=u.preScaled)||void 0===c?void 0:c.description)||"")}}},{name:"used_interval",default:v.B1,shouldShow:()=>!1,write:()=>{},serialize(e,t){if(!t)return;const{useNormalizedEsInterval:a}=t.params;return t.buckets.getInterval(a).expression},toExpressionAst:()=>{}},{name:"time_zone",default:void 0,serialize:o.noop,write(e,s){var i,r;const n=(0,q.s9)(e.params,e.getIndexPattern(),"date_histogram",a,t),o=null===(i=e.params.field)||void 0===i||null===(r=i.timeZone)||void 0===r?void 0:r.includes("UTC");s.params.time_zone=o?"UTC":n}},{name:"used_timezone",shouldShow:()=>!1,write:()=>{},serialize(e,s){if(s)return(0,q.s9)(s.params,s.getIndexPattern(),"date_histogram",a,t)},toExpressionAst:()=>{}},{name:"drop_partials",default:!1,write:o.noop,shouldShow:e=>{const t=e.params.field;return t&&t.name&&t.name===e.getIndexPattern().timeFieldName}},{name:"format"},{name:"min_doc_count",default:1},{name:"extended_bounds",default:{},write(e,s){const i=e.params.extended_bounds,r=(0,q.s9)(e.params,e.getIndexPattern(),"date_histogram",a,t);if(null==i.min&&null==i.max){if(e.params.extendToTimeRange&&e.buckets.hasBounds()&&!e.aggConfigs.hasTimeShifts()){var l,u;const t=e.buckets.getBounds();s.params.extended_bounds=(0,o.omitBy)({min:null===(l=t.min)||void 0===l?void 0:l.valueOf(),max:null===(u=t.max)||void 0===u?void 0:u.valueOf()},o.isNil)}}else s.params.extended_bounds={min:n().tz(i.min,r).valueOf(),max:n().tz(i.max,r).valueOf()}},toExpressionAst:M.extendedBoundsToAst}]}),$="aggDateRange",V=()=>({name:$,help:u.i18n.translate("data.search.aggs.function.buckets.dateRange.help",{defaultMessage:"Generates a serialized agg config for a Date Range agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.dateRange.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.buckets.dateRange.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.dateRange.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.dateRange.field.help",{defaultMessage:"Field to use for this aggregation"})},ranges:{types:["date_range"],multi:!0,help:u.i18n.translate("data.search.aggs.buckets.dateRange.ranges.help",{defaultMessage:"Ranges to use for this aggregation."})},time_zone:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.dateRange.timeZone.help",{defaultMessage:"Time zone to use for this aggregation."})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.dateRange.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.dateRange.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,ranges:i,...r})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...r,ranges:null==i?void 0:i.map((e=>(0,o.omit)(e,"type")))},type:_.T.DATE_RANGE}})}),K=(e,{from:t,to:a})=>{const s={};return t&&(s.gte=n().tz(t,e.aggConfigs.timeZone).toISOString()),a&&(s.lt=n().tz(a,e.aggConfigs.timeZone).toISOString()),a&&t&&(s.format="strict_date_optional_time"),(0,d.buildRangeFilter)(e.params.field,s,e.getIndexPattern())};var H=a(2956);const Y=u.i18n.translate("data.search.aggs.buckets.dateRangeTitle",{defaultMessage:"Date Range"}),W=({aggExecutionContext:e,getConfig:t})=>new S.a({name:_.T.DATE_RANGE,expressionName:$,title:Y,createFilter:K,getKey:({from:e,to:t})=>({from:e,to:t}),getSerializedFormat:e=>({id:"date_range",params:e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{}}),makeLabel:e=>e.getFieldDisplayName()+" date ranges",params:[{name:"field",type:"field",filterFieldTypes:[H.f.DATE,H.f.DATE_RANGE],default(e){var t,a,s;return null===(t=(a=e.getIndexPattern()).getTimeField)||void 0===t||null===(s=t.call(a))||void 0===s?void 0:s.name}},{name:"ranges",default:[{from:"now-1w/w",to:"now"}],toExpressionAst:e=>null==e?void 0:e.map(M.dateRangeToAst)},{name:"time_zone",default:void 0,serialize:()=>{},write:(a,s)=>{const i=(0,p.inferTimeZone)(a.params,a.getIndexPattern(),"date_range",t,e);s.params.time_zone=i}}]}),Q="aggFilter",J=()=>({name:Q,help:u.i18n.translate("data.search.aggs.function.buckets.filter.help",{defaultMessage:"Generates a serialized agg config for a Filter agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.filter.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.buckets.filter.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.filter.schema.help",{defaultMessage:"Schema to use for this aggregation"})},geo_bounding_box:{types:["geo_bounding_box"],help:u.i18n.translate("data.search.aggs.buckets.filter.geoBoundingBox.help",{defaultMessage:"Filter results based on a point location within a bounding box"})},filter:{types:["kibana_query"],help:u.i18n.translate("data.search.aggs.buckets.filter.filter.help",{defaultMessage:"Filter results based on a kql or lucene query. Do not use together with geo_bounding_box"})},timeWindow:{types:["string"],help:""},timeShift:{types:["string"],help:""},json:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.filter.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.filter.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,geo_bounding_box:i,filter:r,...n})=>{if(i&&r)throw new Error("filter and geo_bounding_box can't be used together");return{type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...n,geo_bounding_box:i&&(0,o.omit)(i,"type"),filter:r&&(0,o.omit)(r,"type")},type:_.T.FILTER}}}});var X=a(1783),Z=a.n(X),ee=a(8351),te=a(3721);const ae=u.i18n.translate("data.search.aggs.buckets.filterTitle",{defaultMessage:"Filter"}),se=({getConfig:e,calculateBounds:t})=>new S.a({name:_.T.FILTER,expressionName:Q,title:ae,makeLabel:()=>ae,params:[{name:"geo_bounding_box",toExpressionAst:M.geoBoundingBoxToAst},{name:"timeShift",type:"string",write:()=>{}},{name:"timeWindow",write:()=>{}},{name:"filter",write(a,s,i){const r=a.params.filter,n=a.params.timeWindow,l=(0,o.cloneDeep)(r);if(!l&&!n)return;if(!i)return;let u;if(l){const t=(0,ee.F)({get:e});if(u=(0,d.buildEsQuery)(a.getIndexPattern(),[l],[],t),!u)return void te.log('malformed filter agg params, missing "query" on input')}const c=i.timeRange?Z()(t(i.timeRange).max):void 0;s.params=n&&c&&a.getIndexPattern().timeFieldName?{bool:{filter:[{range:{[a.getIndexPattern().timeFieldName]:{format:"strict_date_optional_time",gte:c.clone().subtract((0,q.P1)(n)).subtract(a.getTimeShift()).toISOString(),lte:c.clone().subtract(a.getTimeShift()).toISOString()}}},u||void 0].filter(Boolean)}}:u},toExpressionAst:M.queryToAst}]}),ie="aggFilters",re=()=>({name:ie,help:u.i18n.translate("data.search.aggs.function.buckets.filters.help",{defaultMessage:"Generates a serialized agg config for a Filter agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.filters.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.buckets.filters.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.filters.schema.help",{defaultMessage:"Schema to use for this aggregation"})},filters:{types:["kibana_query_filter"],multi:!0,help:u.i18n.translate("data.search.aggs.buckets.filters.filters.help",{defaultMessage:"Filters to use for this aggregation"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.filters.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})}},fn:(e,{id:t,enabled:a,schema:s,filters:i,...r})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...r,filters:null==i?void 0:i.map((e=>(0,o.omit)(e,"type")))},type:_.T.FILTERS}})}),ne=(e,t)=>{const a=(0,o.get)(e.toDsl(),"filters.filters")[t],s=e.getIndexPattern();if(a&&s&&s.id)return(0,d.buildQueryFilter)(a,s.id,t)};var oe=a(3721);const le=u.i18n.translate("data.search.aggs.buckets.filtersTitle",{defaultMessage:"Filters",description:"The name of an aggregation, that allows to specify multiple individual filters to group data by."}),ue=({getConfig:e})=>new S.a({name:_.T.FILTERS,expressionName:ie,title:le,createFilter:ne,customLabels:!1,params:[{name:"filters",default:()=>[{input:{query:"",language:e(p.UI_SETTINGS.SEARCH_QUERY_LANGUAGE)},label:""}],write(t,a){const s=t.params.filters;if(!(0,o.size)(s))return;const i=(0,o.transform)(s,(function(a,s){const i=(0,o.cloneDeep)(s.input);if(!i)return void oe.log('malformed filter agg params, missing "input" query');const r=(0,p.getEsQueryConfig)({get:e}),n=(0,d.buildEsQuery)(t.getIndexPattern(),[i],[],r);if(!n)return void oe.log('malformed filter agg params, missing "query" on input');const l=""===s.input.query?"*":"";a[s.label||l||("string"==typeof s.input.query?s.input.query:JSON.stringify(s.input.query))]=n}),{});(0,o.size)(i)&&((a.params||(a.params={})).filters=i)},toExpressionAst:e=>null==e?void 0:e.map(M.queryFilterToAst)}]}),de="aggGeoTile",ce=()=>({name:de,help:u.i18n.translate("data.search.aggs.function.buckets.geoTile.help",{defaultMessage:"Generates a serialized agg config for a Geo Tile agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.geoTile.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.buckets.geoTile.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.geoTile.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.buckets.geoTile.field.help",{defaultMessage:"Field to use for this aggregation"})},useGeocentroid:{types:["boolean"],help:u.i18n.translate("data.search.aggs.buckets.geoTile.useGeocentroid.help",{defaultMessage:"Specifies whether to use geocentroid for this aggregation"})},precision:{types:["number"],help:u.i18n.translate("data.search.aggs.buckets.geoTile.precision.help",{defaultMessage:"Precision to use for this aggregation."})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.geoTile.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.geoTile.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:_.T.GEOTILE_GRID,params:{...r}}}}}),ge=u.i18n.translate("data.search.aggs.buckets.geotileGridTitle",{defaultMessage:"Geotile"}),he=()=>new S.a({name:_.T.GEOTILE_GRID,expressionName:de,title:ge,params:[{name:"field",type:"field",filterFieldTypes:p.KBN_FIELD_TYPES.GEO_POINT},{name:"useGeocentroid",default:!0,write:o.noop},{name:"precision",default:0}],getRequestAggs(e){const t=[],a=e.getParam("useGeocentroid");if(t.push(e),a){const a={type:w.GEO_CENTROID,enabled:!0,params:{field:e.getField()}};t.push(e.aggConfigs.createAggConfig(a,{addToAggConfigs:!1}))}return t}}),pe="aggHistogram",fe=()=>({name:pe,help:u.i18n.translate("data.search.aggs.function.buckets.histogram.help",{defaultMessage:"Generates a serialized agg config for a Histogram agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.histogram.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.buckets.histogram.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.histogram.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.buckets.histogram.field.help",{defaultMessage:"Field to use for this aggregation"})},interval:{types:["number","string"],required:!0,help:u.i18n.translate("data.search.aggs.buckets.histogram.interval.help",{defaultMessage:"Interval to use for this aggregation"})},intervalBase:{types:["number"],help:u.i18n.translate("data.search.aggs.buckets.histogram.intervalBase.help",{defaultMessage:"IntervalBase to use for this aggregation"})},min_doc_count:{types:["boolean"],help:u.i18n.translate("data.search.aggs.buckets.histogram.minDocCount.help",{defaultMessage:"Specifies whether to use min_doc_count for this aggregation"})},maxBars:{types:["number"],help:u.i18n.translate("data.search.aggs.buckets.histogram.maxBars.help",{defaultMessage:"Calculate interval to get approximately this many bars"})},autoExtendBounds:{types:["boolean"],help:u.i18n.translate("data.search.aggs.buckets.histogram.autoExtendBounds.help",{defaultMessage:"Set to true to extend bounds to the domain of the data. This makes sure each interval bucket within these bounds will create a separate table row"})},has_extended_bounds:{types:["boolean"],help:u.i18n.translate("data.search.aggs.buckets.histogram.hasExtendedBounds.help",{defaultMessage:"Specifies whether to use has_extended_bounds for this aggregation"})},extended_bounds:{types:["extended_bounds"],help:u.i18n.translate("data.search.aggs.buckets.histogram.extendedBounds.help",{defaultMessage:'With extended_bounds setting, you now can "force" the histogram aggregation to start building buckets on a specific min value and also keep on building buckets up to a max value '})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.histogram.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.histogram.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,extended_bounds:i,...r})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...r,extended_bounds:i&&(0,o.omit)(i,"type")},type:_.T.HISTOGRAM}})}),me=e=>(t,a)=>{const{deserialize:s}=e(),i=parseInt(a,10),r={gte:i,lt:i+("number"==typeof t.params.used_interval?t.params.used_interval:t.params.interval)};return(0,d.buildRangeFilter)(t.params.field,r,t.getIndexPattern(),s(t.toSerializedFieldFormat()).convert(a))};var ye=a(7371);const be=({interval:e,maxBucketsUiSettings:t,maxBucketsUserInput:a,intervalBase:s,values:i,esTypes:r})=>{const n=(0,v.z)(e);let o=n?0:"number"!=typeof e?parseFloat(e):e;if(Number.isNaN(o))return o;if(i){const e=i.max-i.min;e&&(o=n?((e,t,a)=>{const s=e/t;if(e<t&&a.every((e=>[ye._.INTEGER,ye._.LONG,ye._.SHORT,ye._.BYTE].includes(e))))return 1;const i=Math.pow(10,Math.floor(Math.log10(s))),r=e/i;return r>t?r/2<=t?2*i:r/5<=t?5*i:10*i:i})(e,Math.min(t,a||t),r):((e,t,a)=>e/t>a?(e=>{const t=Math.pow(10,Math.floor(Math.log10(e)));let a=t;for(;a<e;)a+=t;return a})(e/a):t)(e,o,t))}return s&&(o<s?o=s:o%s!==0&&(o=Math.round(o/s)*s)),o||1},ve=({getConfig:e,getFieldFormatsStart:t})=>new S.a({name:_.T.HISTOGRAM,expressionName:pe,title:u.i18n.translate("data.search.aggs.buckets.histogramTitle",{defaultMessage:"Histogram"}),ordered:{},makeLabel:e=>e.getFieldDisplayName(),createFilter:me(t),decorateAggConfig(){let e;return{setAutoBounds:{configurable:!0,value(t){e=t}},getAutoBounds:{configurable:!0,value:()=>e}}},params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.NUMBER_RANGE]},{name:"intervalBase",default:null,write:()=>{}},{name:"autoExtendBounds",default:!1,write:()=>{}},{name:"interval",default:v.B1,modifyAggConfigOnSearchRequestStart(e,t,a){const s=e.getField();if("number_range"===(null==s?void 0:s.type))return;const i=s.scripted?{script:{source:s.script,lang:s.lang}}:{field:s.name};return t.createChild().setField("size",0).setField("aggs",{maxAgg:{max:i},minAgg:{min:i}}).fetch(a).then((t=>{var a,s,i,r,n,o;const l=null!==(a=null===(s=t.aggregations)||void 0===s||null===(i=s.minAgg)||void 0===i?void 0:i.value)&&void 0!==a?a:0,u=null!==(r=null===(n=t.aggregations)||void 0===n||null===(o=n.maxAgg)||void 0===o?void 0:o.value)&&void 0!==r?r:0;e.setAutoBounds({min:l,max:u})})).catch((e=>{if("AbortError"!==e.name){if("KQLSyntaxError"===e.name)throw e;throw new Error(u.i18n.translate("data.search.aggs.histogram.missingMaxMinValuesWarning",{defaultMessage:"Unable to retrieve max and min values to auto-scale histogram buckets. This may lead to poor visualization performance."}))}}))},write(t,a){a.params.interval=Se(t,e)}},{name:"used_interval",default:v.B1,shouldShow:()=>!1,write:()=>{},serialize(t,a){if(a)return Se(a,e)},toExpressionAst:()=>{}},{name:"maxBars",shouldShow(e){const t=e.getField();return"number_range"!==(null==t?void 0:t.type)&&(0,v.z)((0,o.get)(e,"params.interval"))},write:()=>{}},{name:"min_doc_count",default:!1,write(e,t){e.params.min_doc_count?t.params.min_doc_count=0:t.params.min_doc_count=1}},{name:"has_extended_bounds",default:!1,write:()=>{}},{name:"extended_bounds",default:{min:"",max:""},write(e,t){const{min:a,max:s}=e.params.extended_bounds;!e.params.has_extended_bounds||!a&&0!==a||!s&&0!==s?e.params.autoExtendBounds&&e.getAutoBounds()&&(t.params.extended_bounds=e.getAutoBounds()):t.params.extended_bounds={min:a,max:s}},shouldShow:e=>e.params.has_extended_bounds,toExpressionAst:M.extendedBoundsToAst}]});function Se(e,t){var a,s;const i=e.getAutoBounds();return be({values:i,interval:e.params.interval,maxBucketsUiSettings:t(p.UI_SETTINGS.HISTOGRAM_MAX_BARS),maxBucketsUserInput:e.params.maxBars,intervalBase:e.params.intervalBase,esTypes:(null===(a=e.params.field)||void 0===a||null===(s=a.spec)||void 0===s?void 0:s.esTypes)||[]})}const _e="aggIpPrefix",Te=()=>({name:_e,help:u.i18n.translate("data.search.aggs.function.buckets.ipPrefix.help",{defaultMessage:"Generates a serialized agg config for a Ip Prefix agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.ipPrefix.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.buckets.ipPrefix.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.ipPrefix.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.buckets.ipPrefix.field.help",{defaultMessage:"Field to use for this aggregation"})},ipPrefix:{types:["ip_prefix"],help:u.i18n.translate("data.search.aggs.buckets.ipPrefix.help",{defaultMessage:"Length of the network prefix and whether it is for IPv4 or IPv6"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.ipPrefix.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.ipPrefix.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,...i})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,type:_.T.IP_PREFIX,params:{...i}}})});var Ee=a(6880),Me=a.n(Ee);class CidrMask{static getNetmask(e,t){return new Array(e).fill(255).map(((e,a)=>{const s=8-Math.min(Math.max(t-8*a,0),8);return e>>s<<s}))}constructor(e){(0,i.default)(this,"address",void 0),(0,i.default)(this,"netmask",void 0),(0,i.default)(this,"prefix",void 0);try{const[t,a]=Me().parseCIDR(e);this.address=t.toByteArray(),this.netmask=CidrMask.getNetmask(this.address.length,a),this.prefix=a}catch{throw Error("Invalid CIDR mask: "+e)}}getBroadcastAddress(){const e=this.address.map(((e,t)=>e|255^this.netmask[t]));return new q.m8(e).toString()}getNetworkAddress(){const e=this.address.map(((e,t)=>e&this.netmask[t]));return new q.m8(e).toString()}getRange(){return{from:this.getNetworkAddress(),to:this.getBroadcastAddress()}}toString(){return`${new q.m8(this.address)}/${this.prefix}`}}const Fe=(e,t)=>{let a=t.address;a.includes(".")&&t.prefix_length>=96&&(a="::ffff:"+t.address);const s=new CidrMask(a+"/"+t.prefix_length).getRange();return(0,d.buildRangeFilter)(e.params.field,{gte:s.from,lte:s.to},e.getIndexPattern())},Ae=u.i18n.translate("data.search.aggs.buckets.ipPrefixTitle",{defaultMessage:"IP Prefix"}),Ie=()=>new S.a({name:_.T.IP_PREFIX,expressionName:_e,title:Ae,createFilter:Fe,getKey:(e,t,a)=>({type:"ip_prefix",address:t,prefix_length:e.prefix_length}),getSerializedFormat:e=>({id:"ip_prefix",params:e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{}}),makeLabel:e=>u.i18n.translate("data.search.aggs.buckets.ipPrefixLabel",{defaultMessage:"{fieldName} IP prefixes",values:{fieldName:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:p.KBN_FIELD_TYPES.IP},{name:"ipPrefix",default:{prefixLength:0,isIpv6:!1},write:(e,t)=>{t.params.prefix_length=e.params.ipPrefix.prefixLength,t.params.is_ipv6=e.params.ipPrefix.isIpv6},toExpressionAst:M.ipPrefixToAst}]}),we="aggIpRange",xe=()=>({name:we,help:u.i18n.translate("data.search.aggs.function.buckets.ipRange.help",{defaultMessage:"Generates a serialized agg config for a Ip Range agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.ipRange.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.buckets.ipRange.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.ipRange.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.buckets.ipRange.field.help",{defaultMessage:"Field to use for this aggregation"})},ipRangeType:{types:["string"],options:["mask","fromTo"],help:u.i18n.translate("data.search.aggs.buckets.ipRange.ipRangeType.help",{defaultMessage:"IP range type to use for this aggregation. Takes one of the following values: mask, fromTo."})},ranges:{types:["cidr","ip_range"],multi:!0,help:u.i18n.translate("data.search.aggs.buckets.ipRange.ranges.help",{defaultMessage:"Ranges to use for this aggregation."})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.ipRange.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.ipRange.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,ranges:i,...r})=>{const{ip_range:n,cidr:l}=(0,o.mapValues)((0,o.groupBy)(i,"type"),(e=>(0,o.map)(e,(e=>(0,o.omit)(e,"type"))))),u=(0,o.omitBy)({fromTo:n,mask:l},o.isNil);return{type:"agg_type",value:{id:t,enabled:a,schema:s,type:_.T.IP_RANGE,params:{...r,ranges:(0,o.isEmpty)(u)?void 0:u}}}}}),ke=(e,t)=>{let a;return a="mask"===t.type?new CidrMask(t.mask).getRange():{from:t.from?t.from:-1/0,to:t.to?t.to:1/0},(0,d.buildRangeFilter)(e.params.field,{gte:a.from,lte:a.to},e.getIndexPattern())},Re=u.i18n.translate("data.search.aggs.buckets.ipRangeTitle",{defaultMessage:"IP Range"});let Ne=function(e){return e.FROM_TO="fromTo",e.MASK="mask",e}({});const Ce=()=>new S.a({name:_.T.IP_RANGE,expressionName:we,title:Re,createFilter:ke,getKey:(e,t,a)=>a.params.ipRangeType===Ne.MASK?{type:"mask",mask:t}:{type:"range",from:e.from,to:e.to},getSerializedFormat:e=>({id:"ip_range",params:e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{}}),makeLabel:e=>u.i18n.translate("data.search.aggs.buckets.ipRangeLabel",{defaultMessage:"{fieldName} IP ranges",values:{fieldName:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:p.KBN_FIELD_TYPES.IP},{name:"ipRangeType",default:Ne.FROM_TO,write:o.noop},{name:"ranges",default:{fromTo:[{from:"0.0.0.0",to:"127.255.255.255"},{from:"128.0.0.0",to:"191.255.255.255"}],mask:[{mask:"0.0.0.0/1"},{mask:"128.0.0.0/2"}]},write(e,t){const a=e.params.ipRangeType;let s=e.params.ranges[a];a===Ne.FROM_TO&&(s=(0,o.map)(s,(e=>(0,o.omitBy)(e,o.isNull)))),t.params.ranges=s},toExpressionAst:e=>[...(0,o.map)(null==e?void 0:e[Ne.FROM_TO],M.ipRangeToAst),...(0,o.map)(null==e?void 0:e[Ne.MASK],M.cidrToAst)]}]});var Le=a(6034),Pe=a(4611),De=a(1410);const Oe=(...e)=>t=>{const a=t.params.field;return e.some((e=>a&&a.type===e))},Be=Oe("number"),qe=Oe("string"),je=Oe("string","number"),ze={serialize(e,t){if(!this.shouldShow||this.shouldShow(t))return!e||(0,o.isString)(e)||Array.isArray(e)?e:e.pattern},write(e,t){const a=e.getParam(this.name);if(Array.isArray(a)&&a.length>0&&Be(e)){const e=a.filter((e=>Number.isFinite(e)));e.length&&(t.params[this.name]=e)}else if(Array.isArray(a)&&a.length>0&&qe(e)){const s=a.filter((e=>""!==e));if(s.length){const a=e.getParam(`${this.name}IsRegex`);t.params[this.name]=a?s[0]:s}}else(0,o.isObject)(a)?t.params[this.name]=a.pattern:a&&qe(e)&&(t.params[this.name]=a)}},Ue="aggRange",Ge=()=>({name:Ue,help:u.i18n.translate("data.search.aggs.function.buckets.range.help",{defaultMessage:"Generates a serialized agg config for a Range agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.range.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.buckets.range.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.range.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.buckets.range.field.help",{defaultMessage:"Field to use for this aggregation"})},ranges:{types:["numerical_range"],multi:!0,help:u.i18n.translate("data.search.aggs.buckets.range.ranges.help",{defaultMessage:"Serialized ranges to use for this aggregation."})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.range.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.range.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,{id:t,enabled:a,schema:s,ranges:i,...r})=>({type:"agg_type",value:{id:t,enabled:a,schema:s,params:{...r,ranges:null==i?void 0:i.map((e=>(0,o.omit)(e,"type")))},type:_.T.RANGE}})});var $e=a(5336),Ve=a(7270);const Ke=(e,t)=>{const a=e&&"object"==typeof e&&t in e&&e[t];return null==a||["string","number"].includes(typeof a)?a:null},He=e=>({from:Ke(e,"from"),to:Ke(e,"to")}),Ye=/^from:(-?\d+?|undefined),to:(-?\d+?|undefined)$/;class RangeKey extends $e.u{static isInstance(e){return e instanceof RangeKey}static deserialize(e){const{to:t,from:a,ranges:s}=e;return new RangeKey({to:t,from:a},s)}static idBucket(e){const{from:t,to:a}=He(e);return`from:${t},to:${a}`}static isRangeKeyString(e){return Ye.test(e)}static fromString(e){var t;const[a,s]=(null!==(t=Ye.exec(e))&&void 0!==t?t:[]).slice(1).map(Number).map((e=>isNaN(e)?void 0:e));return new RangeKey({from:a,to:s})}constructor(e,t){super(),(0,i.default)(this,"gte",void 0),(0,i.default)(this,"lt",void 0),(0,i.default)(this,"label",void 0);const{from:a,to:s}=He(e);this.gte=null==a?-1/0:a,this.lt=null==s?1/0:s,this.label=function(e,t,a){var s;return null===(s=(a||[]).find((a=>(null==e&&null==a.from||a.from===e)&&(null==t&&null==a.to||a.to===t))))||void 0===s?void 0:s.label}(a,s,t)}toString(){return`from:${this.gte},to:${this.lt}`}serialize(){const e="string"==typeof this.gte||isFinite(this.gte)?this.gte:null,t="string"==typeof this.lt||isFinite(this.lt)?this.lt:null;return{type:Ve.gi.RangeKey,from:e,to:t,ranges:void 0===this.label?[]:[{from:e,to:t,label:this.label}]}}}const We=e=>(t,{label:a,...s})=>{const{deserialize:i}=e();return(0,d.buildRangeFilter)(t.params.field,s,t.getIndexPattern(),i(t.toSerializedFieldFormat()).convert(s))},Qe=u.i18n.translate("data.search.aggs.buckets.rangeTitle",{defaultMessage:"Range"}),Je=({getFieldFormatsStart:e})=>{const t=new WeakMap;return new S.a({name:_.T.RANGE,expressionName:Ue,title:Qe,createFilter:We(e),makeLabel:e=>u.i18n.translate("data.search.aggs.aggTypesLabel",{defaultMessage:"{fieldName} ranges",values:{fieldName:e.getFieldDisplayName()}}),getKey(e,a,s){let i=t.get(s);i||(i=new Map,t.set(s,i));const r=RangeKey.idBucket(e);return(a=i.get(r))||(a=new RangeKey(e,s.params.ranges),i.set(r,a)),a},getSerializedFormat(e){const t=e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{id:void 0,params:void 0};return{id:"range",params:{id:t.id,params:t.params}}},params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER]},{name:"ranges",default:[{from:0,to:1e3},{from:1e3,to:2e3}],write(e,t){var a;t.params.ranges=null===(a=e.params.ranges)||void 0===a?void 0:a.map((e=>({to:e.to,from:e.from}))),t.params.keyed=!0},toExpressionAst:e=>null==e?void 0:e.map(M.numericalRangeToAst)}]})},Xe="aggSignificantTerms",Ze=()=>({name:Xe,help:u.i18n.translate("data.search.aggs.function.buckets.significantTerms.help",{defaultMessage:"Generates a serialized agg config for a Significant Terms agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.significantTerms.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.buckets.significantTerms.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.significantTerms.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.buckets.significantTerms.field.help",{defaultMessage:"Field to use for this aggregation"})},size:{types:["number"],help:u.i18n.translate("data.search.aggs.buckets.significantTerms.size.help",{defaultMessage:"Max number of buckets to retrieve"})},shardSize:{types:["number"],help:u.i18n.translate("data.search.aggs.buckets.significantTerms.shardSize.help",{defaultMessage:"Number of terms provided by each shard and returned to coordinating node"})},exclude:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.significantTerms.exclude.help",{defaultMessage:"Specific bucket values to exclude from results"}),multi:!0},include:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.significantTerms.include.help",{defaultMessage:"Specific bucket values to include in results"}),multi:!0},json:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.significantTerms.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.significantTerms.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:_.T.SIGNIFICANT_TERMS,params:{...r}}}}});var et=a(9806);const tt=(e,t,a)=>{const s=e.params.field,i=e.aggConfigs.indexPattern;if("__other__"===t){const e=a.terms,t=(0,d.buildPhrasesFilter)(s,e,i);t.meta.negate=!0;const r=[t];return e.some((e=>e===et.VC))&&r.push((0,d.buildExistsFilter)(s,i)),r}if(t===et.VC){const e=(0,d.buildExistsFilter)(s,i);return e.meta.negate=!0,e}return(0,d.buildPhraseFilter)(s,t,i)},at=u.i18n.translate("data.search.aggs.buckets.significantTermsTitle",{defaultMessage:"Significant Terms"}),st=()=>new S.a({name:_.T.SIGNIFICANT_TERMS,expressionName:Xe,title:at,makeLabel:e=>u.i18n.translate("data.search.aggs.buckets.significantTermsLabel",{defaultMessage:"Top {size} unusual terms in {fieldName}",values:{size:e.params.size,fieldName:e.getFieldDisplayName()}}),createFilter:tt,params:[{name:"field",type:"field",scriptable:!1,filterFieldTypes:p.KBN_FIELD_TYPES.STRING},{name:"size",default:""},{name:"shardSize",write:(e,t)=>{t.params.shard_size=e.params.shardSize}},{name:"exclude",displayName:u.i18n.translate("data.search.aggs.buckets.significantTerms.excludeLabel",{defaultMessage:"Exclude"}),type:"string",advanced:!0,shouldShow:qe,...ze},{name:"include",displayName:u.i18n.translate("data.search.aggs.buckets.significantTerms.includeLabel",{defaultMessage:"Include"}),type:"string",advanced:!0,shouldShow:qe,...ze}]}),it="aggSignificantText",rt=()=>({name:it,help:u.i18n.translate("data.search.aggs.function.buckets.significantText.help",{defaultMessage:"Generates a serialized agg config for a Significant Text agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.significantText.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.buckets.significantText.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.significantText.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.buckets.significantText.field.help",{defaultMessage:"Field to use for this aggregation"})},size:{types:["number"],help:u.i18n.translate("data.search.aggs.buckets.significantText.size.help",{defaultMessage:"Max number of buckets to retrieve"})},min_doc_count:{types:["number"],help:u.i18n.translate("data.search.aggs.buckets.significantText.minDocCount.help",{defaultMessage:"Return terms that match more than a configured number"})},filter_duplicate_text:{types:["boolean"],help:u.i18n.translate("data.search.aggs.buckets.significantText.filterDuplicateText.help",{defaultMessage:"Filtering near-duplicate text"})},exclude:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.significantText.exclude.help",{defaultMessage:"Specific bucket values to exclude from results"})},include:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.significantText.include.help",{defaultMessage:"Specific bucket values to include in results"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.significantText.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.significantText.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:_.T.SIGNIFICANT_TEXT,params:{...r}}}}}),nt=u.i18n.translate("data.search.aggs.buckets.significantTextTitle",{defaultMessage:"Significant Text"}),ot=()=>new S.a({name:_.T.SIGNIFICANT_TEXT,expressionName:it,title:nt,makeLabel:e=>u.i18n.translate("data.search.aggs.buckets.significantTextLabel",{defaultMessage:'Top {size} unusual terms from "{fieldName}" text',values:{size:e.params.size,fieldName:e.getFieldDisplayName()}}),createFilter:tt,params:[{name:"field",type:"field",filterField:e=>{var t;return Boolean(e.type===p.KBN_FIELD_TYPES.STRING&&(null===(t=e.esTypes)||void 0===t?void 0:t.includes(p.ES_FIELD_TYPES.TEXT)))}},{name:"size",type:"number"},{name:"min_doc_count",type:"number"},{name:"filter_duplicate_text",type:"boolean"},{name:"exclude",displayName:u.i18n.translate("data.search.aggs.buckets.significantText.excludeLabel",{defaultMessage:"Exclude"}),type:"string",advanced:!0,...ze},{name:"include",displayName:u.i18n.translate("data.search.aggs.buckets.significantText.includeLabel",{defaultMessage:"Include"}),type:"string",advanced:!0,...ze}]}),lt="aggTerms",ut=()=>({name:lt,help:u.i18n.translate("data.search.aggs.function.buckets.terms.help",{defaultMessage:"Generates a serialized agg config for a Terms agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.terms.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.buckets.terms.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.terms.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.buckets.terms.field.help",{defaultMessage:"Field to use for this aggregation"})},order:{types:["string"],options:["asc","desc"],help:u.i18n.translate("data.search.aggs.buckets.terms.order.help",{defaultMessage:"Order in which to return the results: asc or desc"})},orderBy:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.terms.orderBy.help",{defaultMessage:"Field to order results by"})},orderAgg:{types:["agg_type"],help:u.i18n.translate("data.search.aggs.buckets.terms.orderAgg.help",{defaultMessage:"Agg config to use for ordering results"})},size:{types:["number"],help:u.i18n.translate("data.search.aggs.buckets.terms.size.help",{defaultMessage:"Max number of buckets to retrieve"})},shardSize:{types:["number"],help:u.i18n.translate("data.search.aggs.buckets.terms.shardSize.help",{defaultMessage:"Number of terms to evaluate during the aggregation."})},missingBucket:{types:["boolean"],help:u.i18n.translate("data.search.aggs.buckets.terms.missingBucket.help",{defaultMessage:"When set to true, groups together any buckets with missing fields"})},missingBucketLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.terms.missingBucketLabel.help",{defaultMessage:"Default label used in charts when documents are missing a field."})},otherBucket:{types:["boolean"],help:u.i18n.translate("data.search.aggs.buckets.terms.otherBucket.help",{defaultMessage:"When set to true, groups together any buckets beyond the allowed size"})},otherBucketLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.terms.otherBucketLabel.help",{defaultMessage:"Default label used in charts for documents in the Other bucket"})},exclude:{types:["string","number"],help:u.i18n.translate("data.search.aggs.buckets.terms.exclude.help",{defaultMessage:"Specific bucket values to exclude from results"}),multi:!0},include:{types:["string","number"],help:u.i18n.translate("data.search.aggs.buckets.terms.include.help",{defaultMessage:"Specific bucket values to include in results"}),multi:!0},includeIsRegex:{types:["boolean"],help:u.i18n.translate("data.search.aggs.buckets.terms.includeIsRegex.help",{defaultMessage:"When set to true, the include property is handled as regex"})},excludeIsRegex:{types:["boolean"],help:u.i18n.translate("data.search.aggs.buckets.terms.excludeIsRegex.help",{defaultMessage:"When set to true, the exclude property is handled as regex"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.terms.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.terms.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{var a;const{id:s,enabled:i,schema:r,...n}=t;return{type:"agg_type",value:{id:s,enabled:i,schema:r,type:_.T.TERMS,params:{...n,orderAgg:null===(a=t.orderAgg)||void 0===a?void 0:a.value}}}}});var dt=a(190);const ct="",gt=new RegExp(`^${ct}`),ht=(e,t)=>{if(e[t])return e[t];const a=(0,o.values)(e);let s;for(let e=0;e<a.length;e++)if(a[e].aggs&&(s=ht(a[e].aggs,t)))return s},pt=(e,t)=>{const a=[];if(e[t]){const s=e[t].buckets.find((e=>e.key===et.VC));return s&&a.push(s),a}return(0,o.each)(e,(e=>{e.buckets&&(0,o.each)(e.buckets,(e=>{a.push(...pt(e,t))}))})),a},ft=(e,t)=>{var a;return t.isSamplingEnabled()?null===(a=e.aggregations)||void 0===a?void 0:a.sampling:e.aggregations};function mt(e,t,a){const s=((e,t,a)=>e["other-filter"].filters.filters[t].bool.must_not.filter((e=>e.match_phrase&&null!=e.match_phrase[a.params.field.name])).map((e=>e.match_phrase[a.params.field.name])))(e,t,a),i=(0,d.buildPhrasesFilter)(a.params.field,s,a.aggConfigs.indexPattern);return i.meta.negate=!0,i}function yt(e,t){return{query:e["other-filter"].filters.filters[t],meta:{}}}const bt=e=>async(t,a,s,i,r,n,l,c)=>{if(!t.aggregations)return t;const h=i.createChild();if(s.params.otherBucket){const i=((e,t,a)=>{const s=e.aggs.filter((e=>e.type.type===g.Buckets&&e.enabled)),i=s.findIndex((e=>e.id===t.id)),r=e.toDsl(),n=t.aggConfigs.indexPattern,l=e.createAggConfig({type:"filters",id:"other",params:{filters:[]},enabled:!1},{addToAggConfigs:!1}),u={aggs:ht(r,t.id).aggs,filters:l.toDsl()};let c=!1,h=!0;const p=(e,a,r,l,g)=>{var f;const m=a[r];if(!m||(Array.isArray(m.buckets)?!m.buckets.length:!Object.values(m.buckets).length))return void(c=!0);const y=e+1,b=s[y],v=s[e];if(e===i&&m&&m.sum_other_doc_count>0&&(h=!1),e<i)return void(0,o.each)(null==m?void 0:m.buckets,((e,t)=>{const a=v.getKey(e,(0,o.isNumber)(t)?void 0:t),s=structuredClone(e.filters)||v.createFilter(a),i=(0,o.flatten)([...l,s]);p(y,e,b.id,i,`${g}${ct}${a.toString()}`)}));const S=!(null===(f=t.params.field)||void 0===f||!f.scripted),_=!!t.params.missingBucket,T=m.buckets.some((e=>e.key===et.VC));!t.params.field||S||_&&!T||l.push((0,d.buildExistsFilter)(t.params.field,t.aggConfigs.indexPattern)),(0,o.each)(m.buckets,(e=>{if(e.key===et.VC)return;const t=v.createFilter(v.getKey(e,e.key));t.meta.negate=!0,l.push(t)})),u.filters.filters[g]={bool:(0,d.buildQueryFromFilters)(l,n)}};return p(0,ft(a,e),s[0].id,[],""),!c&&!h&&(()=>e.isSamplingEnabled()?{sampling:{...f(e.samplerConfig),aggs:{"other-filter":u}}}:{"other-filter":u})})(a,s,t);if(!i)return t;h.setField("aggs",i);const{rawResponse:p}=await(0,dt.lastValueFrom)(h.fetch$({abortSignal:n,sessionId:l,disableWarningToasts:c,inspector:{adapter:r,title:u.i18n.translate("data.search.aggs.buckets.terms.otherBucketTitle",{defaultMessage:"Other bucket"}),description:u.i18n.translate("data.search.aggs.buckets.terms.otherBucketDescription",{defaultMessage:"This request counts the number of documents that fall outside the criterion of the data buckets."})}}));t=((e,t,a,s,i,r)=>{const n=structuredClone(t),l=structuredClone(a),u=ft(l,e),c=ft(n,e),g="buckets"in u["other-filter"]?u["other-filter"].buckets:{};return(0,o.each)(g,((t,a)=>{if(!t.doc_count||void 0===a)return;const n=a.replace(gt,""),l=((e,t,a,s)=>{var i;const r=s.split(ct);let n=t;for(const t in r)if(null!=r[t]){const s=(0,o.values)(n);for(let i=0;i<s.length;i++){const u=s[i],d=(0,o.keys)(n)[i],c=(0,o.find)(e.aggs,(e=>e.id===d));if(c){const e=(0,o.find)(u.buckets,((e,a)=>c.getKey(e,(0,o.isNumber)(a)?void 0:a).toString()===r[t]));var l;if(e&&(null===(l=n)||void 0===l||!l[a.id]||""!==r[t])){n=e;break}}}}return null!==(i=n)&&void 0!==i&&i[a.id]?n[a.id].buckets:[]})(e,c,s,n),u=r(((e,t)=>t.isSamplingEnabled()?e.sampling.aggs:e)(i,e),a,s);t.filters=[u],t.key="__other__",l.some((e=>e.key===et.VC))&&t.filters.push((0,d.buildExistsFilter)(s.params.field,s.aggConfigs.indexPattern)),l.push(t)})),n})(a,t,p,s,i(),e)}return s.params.missingBucket&&(t=((e,t,a)=>{const s=structuredClone(e);return pt(ft(s,t),a.id).forEach((e=>{e.key=et.VC})),s})(t,a,s)),t},vt=["!top_hits","!percentiles","!percentile_ranks","!filtered_metric","!percentile","!percentile_rank","!geo_bounds","!geo_centroid","!std_dev","!derivative","!moving_avg","!serial_diff","!cumulative_sum","!avg_bucket","!max_bucket","!min_bucket","!sum_bucket"],St={name:"orderAgg",type:"agg",allowedAggs:vt,default:null,makeAgg(e,t={type:"count"}){t.schema="orderAgg";const a=e.aggConfigs.createAggConfig(t,{addToAggConfigs:!1});return a.id=e.id+"-orderAgg",a},write(e,t,a){const s=e.params.order.value,i=t.params.order={};let r=e.params.orderAgg||a.getResponseAggById(e.params.orderBy);if(t.params.script&&(t.params.value_type="number"===e.getField().type?"float":e.getField().type),e.params.missingBucket&&"string"===e.params.field.type&&(t.params.missing=et.VC),!r)return void(i[e.params.orderBy||"_count"]=s);if(null!=a&&a.hasTimeShifts()&&Object.keys(null==a?void 0:a.getTimeShifts()).length>1&&a.timeRange){const e=r.getTimeShift(),t=a.getResolvedTimeRange();r=a.createAggConfig({type:"filtered_metric",id:r.id,params:{customBucket:a.createAggConfig({type:"filter",id:"shift",params:{filter:{language:"lucene",query:{range:{[a.timeFields[0]]:{gte:n().tz(null==t?void 0:t.min,a.timeZone).subtract(e||0).toISOString(),lte:n().tz(null==t?void 0:t.max,a.timeZone).subtract(e||0).toISOString()}}}}}},{addToAggConfigs:!1}).serialize(),customMetric:r.serialize()},enabled:!1},{addToAggConfigs:!1})}if("count"===r.type.name)return void(i._count=s);const o=r.getValueBucketPath();r.parentId&&a&&(r=a.byId(r.parentId)),t.subAggs=(t.subAggs||[]).concat(r),i[o]=s}},_t=u.i18n.translate("data.search.aggs.buckets.termsTitle",{defaultMessage:"Terms"}),Tt=()=>new S.a({name:_.T.TERMS,expressionName:lt,title:_t,makeLabel(e){const t=e.params;return e.getFieldDisplayName()+": "+t.order.text},getSerializedFormat(e){const t=e.params.field?e.aggConfigs.indexPattern.getFormatterForField(e.params.field).toJSON():{id:void 0,params:void 0};return{id:"terms",params:{id:t.id,...t.params?{params:t.params}:{},otherBucketLabel:e.params.otherBucketLabel,missingBucketLabel:e.params.missingBucketLabel}}},createFilter:tt,postFlightRequest:bt(mt),hasPrecisionError:e=>Boolean(null==e?void 0:e.doc_count_error_upper_bound),params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.BOOLEAN,p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.IP,p.KBN_FIELD_TYPES.STRING]},{name:"orderBy",write:o.noop},St,{name:"order",type:"optioned",default:"desc",options:[{text:u.i18n.translate("data.search.aggs.buckets.terms.orderDescendingTitle",{defaultMessage:"Descending"}),value:"desc"},{text:u.i18n.translate("data.search.aggs.buckets.terms.orderAscendingTitle",{defaultMessage:"Ascending"}),value:"asc"}],write:o.noop},{name:"size",default:5},{name:"shardSize",write:(e,t)=>{e.params.shardSize?t.params.shard_size=e.params.shardSize:e.params.size<=10&&(t.params.shard_size=25)}},{name:"otherBucket",default:!1,write:o.noop},{name:"otherBucketLabel",type:"string",default:u.i18n.translate("data.search.aggs.buckets.terms.otherBucketLabel",{defaultMessage:"Other"}),displayName:u.i18n.translate("data.search.aggs.otherBucket.labelForOtherBucketLabel",{defaultMessage:"Label for other bucket"}),shouldShow:e=>e.getParam("otherBucket"),write:o.noop},{name:"missingBucket",default:!1,write:o.noop},{name:"missingBucketLabel",type:"string",displayName:u.i18n.translate("data.search.aggs.otherBucket.labelForMissingValuesLabel",{defaultMessage:"Label for missing values"}),shouldShow:e=>e.getParam("missingBucket"),write:o.noop},{name:"exclude",displayName:u.i18n.translate("data.search.aggs.buckets.terms.excludeLabel",{defaultMessage:"Exclude"}),type:"string",advanced:!0,shouldShow:je,...ze},{name:"include",displayName:u.i18n.translate("data.search.aggs.buckets.terms.includeLabel",{defaultMessage:"Include"}),type:"string",advanced:!0,shouldShow:je,...ze},{name:"includeIsRegex",default:!0,write:o.noop},{name:"excludeIsRegex",default:!0,write:o.noop}]});function Et(e){if(!(e=>Boolean(e&&"object"==typeof e&&"key"in e))(e))throw new Error("bucket malformed - no key found");return Array.isArray(e.key)?e.key.map(String):[String(e.key)]}class MultiFieldKey extends $e.u{static isInstance(e){return e instanceof MultiFieldKey}static deserialize(e){return new MultiFieldKey({key:e.keys})}static idBucket(e){return Et(e).join(",")}constructor(e){super(),(0,i.default)(this,"keys",void 0),this.keys=Et(e)}toString(){return this.keys.join(",")}serialize(){return{type:Ve.gi.MultiFieldKey,keys:this.keys}}}const Mt="  ",Ft="aggMultiTerms",At=()=>({name:Ft,help:u.i18n.translate("data.search.aggs.function.buckets.multiTerms.help",{defaultMessage:"Generates a serialized agg config for a Multi-Terms agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.multiTerms.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.buckets.multiTerms.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.multiTerms.schema.help",{defaultMessage:"Schema to use for this aggregation"})},fields:{types:["string"],multi:!0,required:!0,help:u.i18n.translate("data.search.aggs.buckets.multiTerms.fields.help",{defaultMessage:"Fields to use for this aggregation"})},order:{types:["string"],options:["asc","desc"],help:u.i18n.translate("data.search.aggs.buckets.multiTerms.order.help",{defaultMessage:"Order in which to return the results: asc or desc"})},orderBy:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.multiTerms.orderBy.help",{defaultMessage:"Field to order results by"})},orderAgg:{types:["agg_type"],help:u.i18n.translate("data.search.aggs.buckets.multiTerms.orderAgg.help",{defaultMessage:"Agg config to use for ordering results"})},size:{types:["number"],help:u.i18n.translate("data.search.aggs.buckets.multiTerms.size.help",{defaultMessage:"Max number of buckets to retrieve"})},shardSize:{types:["number"],help:u.i18n.translate("data.search.aggs.buckets.terms.shardSize.help",{defaultMessage:"Number of terms to evaluate during the aggregation."})},otherBucket:{types:["boolean"],help:u.i18n.translate("data.search.aggs.buckets.multiTerms.otherBucket.help",{defaultMessage:"When set to true, groups together any buckets beyond the allowed size"})},otherBucketLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.multiTerms.otherBucketLabel.help",{defaultMessage:"Default label used in charts for documents in the Other bucket"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.multiTerms.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.multiTerms.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},separatorLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.multiTerms.separatorLabel.help",{defaultMessage:"The separator label used to join each term combination"})}},fn:(e,t)=>{var a;const{id:s,enabled:i,schema:r,...n}=t;return{type:"agg_type",value:{id:s,enabled:i,schema:r,type:_.T.MULTI_TERMS,params:{...n,orderAgg:null===(a=t.orderAgg)||void 0===a?void 0:a.value}}}}}),It=(e,t,a)=>{const s=e.params.fields,i=e.aggConfigs.indexPattern;if("__other__"===String(t)){const e=a.terms,t=e.map((e=>e.keys.map(((e,t)=>(0,d.buildPhraseFilter)(i.getFieldByName(s[t]),e,i).query))));return{meta:{negate:!0,alias:e.map((e=>e.keys.join(", "))).join(` ${u.i18n.translate("data.search.aggs.buckets.multiTerms.otherFilterJoinName",{defaultMessage:"or"})} `),index:i.id},query:{bool:{should:t.map((e=>({bool:{must:e}}))),minimum_should_match:1}}}}const r=t.keys.map(((e,t)=>(0,d.buildPhraseFilter)(i.getFieldByName(s[t]),e,i)));return{meta:{alias:t.keys.join(", "),index:i.id},query:{bool:{must:r.map((e=>e.query))}}}},wt=u.i18n.translate("data.search.aggs.buckets.multiTermsTitle",{defaultMessage:"Multi-Terms"}),xt=()=>{const e=new WeakMap;return new S.a({name:_.T.MULTI_TERMS,expressionName:Ft,title:wt,makeLabel(e){const t=e.params;return e.getFieldDisplayName()+": "+t.order.text},getKey(t,a,s){let i=e.get(s);i||(i=new Map,e.set(s,i));const r=MultiFieldKey.idBucket(t);return(a=i.get(r))||(a=new MultiFieldKey(t),i.set(r,a)),a},getSerializedFormat(e){const t=e.params,a=t.fields?t.fields.map((t=>{const a=e.aggConfigs.indexPattern.getFieldByName(t);return a?e.aggConfigs.indexPattern.getFormatterForField(a).toJSON():{id:void 0,params:void 0}})):[{id:void 0,params:void 0}];return{id:"multi_terms",params:{otherBucketLabel:t.otherBucketLabel,paramsPerField:a,separator:e.params.separatorLabel}}},createFilter:It,postFlightRequest:bt(yt),hasPrecisionError:e=>Boolean(null==e?void 0:e.doc_count_error_upper_bound),params:[{name:"fields",write(e,t,a){const s=e.params;t.params.terms=s.fields.map((e=>({field:e})))}},{name:"orderBy",write:o.noop},St,{name:"order",type:"optioned",default:"desc",options:[{text:u.i18n.translate("data.search.aggs.buckets.terms.orderDescendingTitle",{defaultMessage:"Descending"}),value:"desc"},{text:u.i18n.translate("data.search.aggs.buckets.terms.orderAscendingTitle",{defaultMessage:"Ascending"}),value:"asc"}],write:o.noop},{name:"size",default:5},{name:"shardSize",write:(e,t)=>{t.params.shard_size=e.params.shardSize}},{name:"otherBucket",default:!1,write:o.noop},{name:"otherBucketLabel",type:"string",default:u.i18n.translate("data.search.aggs.buckets.terms.otherBucketLabel",{defaultMessage:"Other"}),displayName:u.i18n.translate("data.search.aggs.otherBucket.labelForOtherBucketLabel",{defaultMessage:"Label for other bucket"}),shouldShow:e=>e.getParam("otherBucket"),write:o.noop},{name:"separatorLabel",type:"string",write:o.noop}]})},kt="aggRareTerms",Rt=()=>({name:kt,help:u.i18n.translate("data.search.aggs.function.buckets.rareTerms.help",{defaultMessage:"Generates a serialized agg config for a Rare-Terms agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.rareTerms.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.buckets.rareTerms.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.rareTerms.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.buckets.rareTerms.fields.help",{defaultMessage:"Field to use for this aggregation"})},max_doc_count:{types:["number"],help:u.i18n.translate("data.search.aggs.buckets.rareTerms.maxDocCount.help",{defaultMessage:"Maximum number of times a term is allowed to occur to qualify as rare"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.multiTerms.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:_.T.RARE_TERMS,params:{...r}}}}}),Nt=u.i18n.translate("data.search.aggs.buckets.rareTermsTitle",{defaultMessage:"Rare terms"}),Ct=()=>new S.a({name:_.T.RARE_TERMS,expressionName:kt,title:Nt,makeLabel:e=>u.i18n.translate("data.search.aggs.rareTerms.aggTypesLabel",{defaultMessage:"Rare terms of {fieldName}",values:{fieldName:e.getFieldDisplayName()}}),createFilter:tt,params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.BOOLEAN,p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.IP,p.KBN_FIELD_TYPES.STRING]},{name:"max_doc_count",default:1}]}),Lt="sampler",Pt=u.i18n.translate("data.search.aggs.buckets.samplerTitle",{defaultMessage:"Sampler",description:"Sampler aggregation title"}),Dt=()=>new S.a({name:Lt,title:Pt,customLabels:!1,expressionName:Ot,params:[{name:"shard_size",type:"number"}]}),Ot="aggSampler",Bt=()=>({name:Ot,help:u.i18n.translate("data.search.aggs.function.buckets.sampler.help",{defaultMessage:"Generates a serialized agg config for a Sampler agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.sampler.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.buckets.sampler.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.sampler.schema.help",{defaultMessage:"Schema to use for this aggregation"})},shard_size:{types:["number"],help:u.i18n.translate("data.search.aggs.buckets.sampler.shardSize.help",{defaultMessage:"The shard_size parameter limits how many top-scoring documents are collected in the sample processed on each shard."})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:Lt,params:{...r}}}}}),qt="diversified_sampler",jt=u.i18n.translate("data.search.aggs.buckets.diversifiedSamplerTitle",{defaultMessage:"Diversified sampler",description:"Diversified sampler aggregation title"}),zt=()=>new S.a({name:qt,title:jt,customLabels:!1,expressionName:Ut,params:[{name:"shard_size",type:"number"},{name:"max_docs_per_value",type:"number"},{name:"field",type:"field"}]}),Ut="aggDiversifiedSampler",Gt=()=>({name:Ut,help:u.i18n.translate("data.search.aggs.function.buckets.diversifiedSampler.help",{defaultMessage:"Generates a serialized agg config for a Diversified sampler agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.diversifiedSampler.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.buckets.diversifiedSampler.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.diversifiedSampler.schema.help",{defaultMessage:"Schema to use for this aggregation"})},shard_size:{types:["number"],help:u.i18n.translate("data.search.aggs.buckets.diversifiedSampler.shardSize.help",{defaultMessage:"The shard_size parameter limits how many top-scoring documents are collected in the sample processed on each shard."})},max_docs_per_value:{types:["number"],help:u.i18n.translate("data.search.aggs.buckets.diversifiedSampler.maxDocsPerValue.help",{defaultMessage:"Limits how many documents are permitted per choice of de-duplicating value."})},field:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.diversifiedSampler.field.help",{defaultMessage:"Used to provide values used for de-duplication."})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:qt,params:{...r}}}}}),$t="aggTimeSeries",Vt=()=>({name:$t,help:u.i18n.translate("data.search.aggs.function.buckets.timeSeries.help",{defaultMessage:"Generates a serialized agg config for a Time Series agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.timeSeries.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.buckets.timeSeries.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.timeSeries.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.buckets.terms.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:_.T.TIME_SERIES,params:{...r}}}}}),Kt=u.i18n.translate("data.search.aggs.buckets.timeSeriesTitle",{defaultMessage:"Time Series"}),Ht=()=>new S.a({name:_.T.TIME_SERIES,expressionName:$t,title:Kt,params:[]});var Yt=a(4882);const Wt="aggAvg",Qt=()=>({name:Wt,help:u.i18n.translate("data.search.aggs.function.metrics.avg.help",{defaultMessage:"Generates a serialized agg config for a Avg agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.avg.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.avg.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.avg.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.avg.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.avg.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.avg.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.AVG,params:{...r}}}}}),Jt=u.i18n.translate("data.search.aggs.metrics.averageTitle",{defaultMessage:"Average"}),Xt=()=>new MetricAggType({name:w.AVG,expressionName:Wt,title:Jt,getValueType:()=>"number",makeLabel:e=>u.i18n.translate("data.search.aggs.metrics.averageLabel",{defaultMessage:"Average {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.HISTOGRAM]}]}),Zt="aggBucketAvg",ea=()=>({name:Zt,help:u.i18n.translate("data.search.aggs.function.metrics.bucket_avg.help",{defaultMessage:"Generates a serialized agg config for a Avg Bucket agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.bucket_avg.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.bucket_avg.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.bucket_avg.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customBucket:{types:["agg_type"],help:u.i18n.translate("data.search.aggs.metrics.bucket_avg.customBucket.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},customMetric:{types:["agg_type"],help:u.i18n.translate("data.search.aggs.metrics.bucket_avg.customMetric.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.bucket_avg.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.bucket_avg.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a,s;const{id:i,enabled:r,schema:n,...o}=t;return{type:"agg_type",value:{id:i,enabled:r,schema:n,type:w.AVG_BUCKET,params:{...o,customBucket:null===(a=t.customBucket)||void 0===a?void 0:a.value,customMetric:null===(s=t.customMetric)||void 0===s?void 0:s.value}}}}}),ta=(e,t)=>{const a=(0,o.startCase)(t),s=e.getParam("customMetric"),i=e.getParam("metricAgg");if(s){let e=s.makeLabel();return e.includes(`${a} of `)?(e=e.substring(`${a} of `.length),e=`2. ${t} of ${e}`):e=e.includes(`${t} of `)?parseInt(e.substring(0,1),10)+1+e.substring(1):`${a} of ${e}`,e}const r=e.aggConfigs.byId(i);return r?`${a} of ${r.makeLabel()}`:""},aa=e=>(t,a,s)=>{if(!t||!t.params)return;const i=t.getParam(e);i&&i.type&&i.type.params&&i.type.params.forEach((e=>{e.modifyAggConfigOnSearchRequestStart&&e.modifyAggConfigOnSearchRequestStart(i,a,s)}))},sa=["!top_hits","!top_metrics","!percentiles","!percentile_ranks","!median","!std_dev","!sum_bucket","!avg_bucket","!min_bucket","!max_bucket","!derivative","!moving_avg","!serial_diff","!cumulative_sum","!geo_bounds","!geo_centroid","!filtered_metric","!single_percentile"],ia=["!filter","!sampler","!diversified_sampler","!multi_terms"],ra=u.i18n.translate("data.search.aggs.metrics.siblingPipelineAggregationsSubtypeTitle",{defaultMessage:"Sibling pipeline aggregations"}),na={subtype:ra,params:(e=ia)=>[{name:"customBucket",type:"agg",allowedAggs:e,default:null,makeAgg(e,t={type:"date_histogram"}){const a=e.aggConfigs.createAggConfig(t,{addToAggConfigs:!1});return a.id=e.id+"-bucket",a},modifyAggConfigOnSearchRequestStart:aa("customBucket"),write:()=>{}},{name:"customMetric",type:"agg",allowedAggs:sa,default:null,makeAgg(e,t={type:"count"}){const a=e.aggConfigs.createAggConfig(t,{addToAggConfigs:!1});return a.id=e.id+"-metric",a},modifyAggConfigOnSearchRequestStart:aa("customMetric"),write:(e,t)=>((e,t)=>{const a=e.getParam("customMetric"),s=e.getParam("customBucket");if(a){if(a.type.name!==w.COUNT){if(s.subAggs=(t.subAggs||[]).concat(a),t.params.buckets_path=`${s.id}>${a.id}`,a.type.subtype===p.siblingPipelineType){const e=a.getParam("customBucket");e&&s.subAggs.push(e)}}else t.params.buckets_path=s.id+">_count";t.parentAggs=(t.parentAggs||[]).concat(s)}})(e,t)}],getSerializedFormat(e){const t=e.getParam("customMetric");return t?t.type.getSerializedFormat(t):{}}},oa=u.i18n.translate("data.search.aggs.metrics.overallAverageLabel",{defaultMessage:"overall average"}),la=u.i18n.translate("data.search.aggs.metrics.averageBucketTitle",{defaultMessage:"Average Bucket"}),ua=()=>{const{subtype:e,params:t,getSerializedFormat:a}=na;return new MetricAggType({name:w.AVG_BUCKET,expressionName:Zt,title:la,makeLabel:e=>ta(e,oa),subtype:e,params:[...t()],getSerializedFormat:a,getValue(e,t){const a=e.getParam("customMetric"),s=e.getParam("customBucket"),i=a.type&&a.type.isScalable();let r=t[e.id]&&t[e.id].value;if(i&&"date_histogram"===s.type.name){const e=s.write();r*=(0,o.get)(e,"bucketInterval.scale",1)}return r}})},da="aggBucketMax",ca=()=>({name:da,help:u.i18n.translate("data.search.aggs.function.metrics.bucket_max.help",{defaultMessage:"Generates a serialized agg config for a Max Bucket agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.bucket_max.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.bucket_max.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.bucket_max.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customBucket:{types:["agg_type"],help:u.i18n.translate("data.search.aggs.metrics.bucket_max.customBucket.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},customMetric:{types:["agg_type"],help:u.i18n.translate("data.search.aggs.metrics.bucket_max.customMetric.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.bucket_max.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.bucket_max.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a,s;const{id:i,enabled:r,schema:n,...o}=t;return{type:"agg_type",value:{id:i,enabled:r,schema:n,type:w.MAX_BUCKET,params:{...o,customBucket:null===(a=t.customBucket)||void 0===a?void 0:a.value,customMetric:null===(s=t.customMetric)||void 0===s?void 0:s.value}}}}}),ga=u.i18n.translate("data.search.aggs.metrics.overallMaxLabel",{defaultMessage:"overall max"}),ha=u.i18n.translate("data.search.aggs.metrics.maxBucketTitle",{defaultMessage:"Max Bucket"}),pa=()=>{const{subtype:e,params:t,getSerializedFormat:a}=na;return new MetricAggType({name:w.MAX_BUCKET,expressionName:da,title:ha,makeLabel:e=>ta(e,ga),subtype:e,params:[...t()],getSerializedFormat:a})},fa="aggBucketMin",ma=()=>({name:fa,help:u.i18n.translate("data.search.aggs.function.metrics.bucket_min.help",{defaultMessage:"Generates a serialized agg config for a Min Bucket agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.bucket_min.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.bucket_min.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.bucket_min.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customBucket:{types:["agg_type"],help:u.i18n.translate("data.search.aggs.metrics.bucket_min.customBucket.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},customMetric:{types:["agg_type"],help:u.i18n.translate("data.search.aggs.metrics.bucket_min.customMetric.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.bucket_min.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.bucket_min.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a,s;const{id:i,enabled:r,schema:n,...o}=t;return{type:"agg_type",value:{id:i,enabled:r,schema:n,type:w.MIN_BUCKET,params:{...o,customBucket:null===(a=t.customBucket)||void 0===a?void 0:a.value,customMetric:null===(s=t.customMetric)||void 0===s?void 0:s.value}}}}}),ya=u.i18n.translate("data.search.aggs.metrics.overallMinLabel",{defaultMessage:"overall min"}),ba=u.i18n.translate("data.search.aggs.metrics.minBucketTitle",{defaultMessage:"Min Bucket"}),va=()=>{const{subtype:e,params:t,getSerializedFormat:a}=na;return new MetricAggType({name:w.MIN_BUCKET,expressionName:fa,title:ba,makeLabel:e=>ta(e,ya),subtype:e,params:[...t()],getSerializedFormat:a})},Sa="aggBucketSum",_a=()=>({name:Sa,help:u.i18n.translate("data.search.aggs.function.metrics.bucket_sum.help",{defaultMessage:"Generates a serialized agg config for a Sum Bucket agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.bucket_sum.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.bucket_sum.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.bucket_sum.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customBucket:{types:["agg_type"],help:u.i18n.translate("data.search.aggs.metrics.bucket_sum.customBucket.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},customMetric:{types:["agg_type"],help:u.i18n.translate("data.search.aggs.metrics.bucket_sum.customMetric.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.bucket_sum.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.bucket_sum.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a,s;const{id:i,enabled:r,schema:n,...o}=t;return{type:"agg_type",value:{id:i,enabled:r,schema:n,type:w.SUM_BUCKET,params:{...o,customBucket:null===(a=t.customBucket)||void 0===a?void 0:a.value,customMetric:null===(s=t.customMetric)||void 0===s?void 0:s.value}}}}}),Ta=u.i18n.translate("data.search.aggs.metrics.overallSumLabel",{defaultMessage:"overall sum"}),Ea=u.i18n.translate("data.search.aggs.metrics.sumBucketTitle",{defaultMessage:"Sum Bucket"}),Ma=()=>{const{subtype:e,params:t,getSerializedFormat:a}=na;return new MetricAggType({name:w.SUM_BUCKET,expressionName:Sa,title:Ea,makeLabel:e=>ta(e,Ta),subtype:e,params:[...t()],getSerializedFormat:a})},Fa="aggFilteredMetric",Aa=()=>({name:Fa,help:u.i18n.translate("data.search.aggs.function.metrics.filtered_metric.help",{defaultMessage:"Generates a serialized agg config for a filtered metric agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.filtered_metric.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.filtered_metric.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.filtered_metric.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customBucket:{types:["agg_type"],help:u.i18n.translate("data.search.aggs.metrics.filtered_metric.customBucket.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations. Has to be a filter aggregation"})},customMetric:{types:["agg_type"],help:u.i18n.translate("data.search.aggs.metrics.filtered_metric.customMetric.help",{defaultMessage:"Agg config to use for building sibling pipeline aggregations"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.filtered_metric.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a,s;const{id:i,enabled:r,schema:n,...o}=t;return{type:"agg_type",value:{id:i,enabled:r,schema:n,type:w.FILTERED_METRIC,params:{...o,customBucket:null===(a=t.customBucket)||void 0===a?void 0:a.value,customMetric:null===(s=t.customMetric)||void 0===s?void 0:s.value}}}}}),Ia=u.i18n.translate("data.search.aggs.metrics.filteredMetricLabel",{defaultMessage:"filtered"}),wa=u.i18n.translate("data.search.aggs.metrics.filteredMetricTitle",{defaultMessage:"Filtered metric"}),xa=({getConfig:e})=>{const{subtype:t,params:a,getSerializedFormat:s}=na;return new MetricAggType({name:w.FILTERED_METRIC,expressionName:Fa,title:wa,makeLabel:e=>ta(e,Ia),subtype:t,params:[...a(["filter"])],hasNoDslParams:!0,getSerializedFormat:s,createFilter:(t,a)=>{const s=t.getIndexPattern();if("top_hits"===t.params.customMetric.type.name||"top_metrics"===t.params.customMetric.type.name)return t.params.customMetric.createFilter(a);if(!t.params.customBucket.params.filter)return;const i=(0,p.getEsQueryConfig)({get:e});return(0,d.buildQueryFilter)((0,d.buildEsQuery)(s,[t.params.customBucket.params.filter],[],i),s.id,t.params.customBucket.params.filter.query)},getValue(e,t){const a=e.getParam("customMetric"),s=e.getParam("customBucket");return t&&t[s.id]&&a.getValue(t[s.id])},getValueType(e){var t,a,s;const i=e.getParam("customMetric");return(null===(t=(a=i.type).getValueType)||void 0===t?void 0:t.call(a,i))||(null===(s=i.params.field)||void 0===s?void 0:s.type)||"number"},getValueBucketPath(e){const t=e.getParam("customBucket"),a=e.getParam("customMetric");return"count"===a.type.name?t.getValueBucketPath():`${t.getValueBucketPath()}>${a.getValueBucketPath()}`},getResponseId:e=>e.params.customBucket.id})},ka="aggCardinality",Ra=()=>({name:ka,help:u.i18n.translate("data.search.aggs.function.metrics.cardinality.help",{defaultMessage:"Generates a serialized agg config for a Cardinality agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.cardinality.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.cardinality.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.cardinality.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.cardinality.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.cardinality.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.cardinality.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})},emptyAsNull:{types:["boolean"],help:u.i18n.translate("data.search.aggs.metrics.emptyAsNull.help",{defaultMessage:'If set to true, a missing value is treated as null in the resulting data table. If set to false, a "zero" is filled in'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.CARDINALITY,params:{...r}}}}}),Na=u.i18n.translate("data.search.aggs.metrics.uniqueCountTitle",{defaultMessage:"Unique Count"}),Ca=()=>new MetricAggType({name:w.CARDINALITY,getValueType:()=>"number",expressionName:ka,title:Na,enableEmptyAsNull:!0,makeLabel:e=>u.i18n.translate("data.search.aggs.metrics.uniqueCountLabel",{defaultMessage:"Unique count of {field}",values:{field:e.getFieldDisplayName()}}),getSerializedFormat:e=>({id:"number"}),params:[{name:"field",type:"field",filterFieldTypes:Object.values(p.KBN_FIELD_TYPES).filter((e=>e!==p.KBN_FIELD_TYPES.HISTOGRAM))}]}),La="aggValueCount",Pa=()=>({name:La,help:u.i18n.translate("data.search.aggs.function.metrics.valueCount.help",{defaultMessage:"Generates a serialized agg config for a value count agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.value_count.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.value_count.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.value_count.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.value_count.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.value_count.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.value_count.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})},emptyAsNull:{types:["boolean"],help:u.i18n.translate("data.search.aggs.metrics.emptyAsNull.help",{defaultMessage:'If set to true, a missing value is treated as null in the resulting data table. If set to false, a "zero" is filled in'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.VALUE_COUNT,params:{...r}}}}}),Da=u.i18n.translate("data.search.aggs.metrics.valueCountTitle",{defaultMessage:"Value Count"}),Oa=()=>new MetricAggType({name:w.VALUE_COUNT,getValueType:()=>"number",expressionName:La,title:Da,enableEmptyAsNull:!0,makeLabel:e=>u.i18n.translate("data.search.aggs.metrics.valueCountLabel",{defaultMessage:"Value count of {field}",values:{field:e.getFieldDisplayName()}}),getSerializedFormat:e=>({id:"number"}),params:[{name:"field",type:"field"}]}),Ba="aggCount",qa=()=>({name:Ba,help:u.i18n.translate("data.search.aggs.function.metrics.count.help",{defaultMessage:"Generates a serialized agg config for a Count agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.count.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.count.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.count.schema.help",{defaultMessage:"Schema to use for this aggregation"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.count.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})},emptyAsNull:{types:["boolean"],help:u.i18n.translate("data.search.aggs.metrics.emptyAsNull.help",{defaultMessage:'If set to true, a missing value is treated as null in the resulting data table. If set to false, a "zero" is filled in'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.COUNT,params:r}}}}),ja=()=>new MetricAggType({name:w.COUNT,expressionName:Ba,title:u.i18n.translate("data.search.aggs.metrics.countTitle",{defaultMessage:"Count"}),hasNoDsl:!0,json:!1,enableEmptyAsNull:!0,makeLabel:()=>u.i18n.translate("data.search.aggs.metrics.countLabel",{defaultMessage:"Count"}),getSerializedFormat:e=>({id:"number"}),getValue(e,t){const a=e.getTimeShift();let s;return s=a?t[`doc_count_${a.asMilliseconds()}`]:t.doc_count,0===s&&e.params.emptyAsNull?null:null==s?e.params.emptyAsNull?null:0:s},isScalable:()=>!0}),za="aggCumulativeSum",Ua=()=>({name:za,help:u.i18n.translate("data.search.aggs.function.metrics.cumulative_sum.help",{defaultMessage:"Generates a serialized agg config for a Cumulative Sum agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.cumulative_sum.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.cumulative_sum.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.cumulative_sum.schema.help",{defaultMessage:"Schema to use for this aggregation"})},metricAgg:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.cumulative_sum.metricAgg.help",{defaultMessage:"Id for finding agg config to use for building parent pipeline aggregations"})},customMetric:{types:["agg_type"],help:u.i18n.translate("data.search.aggs.metrics.cumulative_sum.customMetric.help",{defaultMessage:"Agg config to use for building parent pipeline aggregations"})},buckets_path:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.cumulative_sum.buckets_path.help",{defaultMessage:"Path to the metric of interest"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.cumulative_sum.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.cumulative_sum.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a;const{id:s,enabled:i,schema:r,...n}=t;return{type:"agg_type",value:{id:s,enabled:i,schema:r,type:w.CUMULATIVE_SUM,params:{...n,customMetric:null===(a=t.customMetric)||void 0===a?void 0:a.value}}}}}),Ga=(e,t,a)=>{const s=e.getParam("customMetric"),i=e.getParam("metricAgg"),r=s||a&&a.getResponseAggById(i);s&&"count"!==s.type.name&&(t.parentAggs=(t.parentAggs||[]).concat(r)),t.params={buckets_path:"count"===r.type.name?"_count":r.id}},$a=["!top_hits","!top_metrics","!percentiles","!percentile_ranks","!median","!std_dev","!geo_bounds","!geo_centroid","!filtered_metric","!single_percentile"],Va=u.i18n.translate("data.search.aggs.metrics.parentPipelineAggregationsSubtypeTitle",{defaultMessage:"Parent Pipeline Aggregations"}),Ka={subtype:Va,params:()=>[{name:"metricAgg",default:"custom",write:Ga},{name:"customMetric",type:"agg",allowedAggs:$a,makeAgg(e,t={type:"count"}){const a=e.aggConfigs.createAggConfig(t,{addToAggConfigs:!1});return a.id=e.id+"-metric",a},modifyAggConfigOnSearchRequestStart:aa("customMetric"),write:o.noop},{name:"buckets_path",write:o.noop}],getSerializedFormat(e){let t;return t=e.getParam("customMetric")||e.aggConfigs.byId(e.getParam("metricAgg")),t?t.type.getSerializedFormat(t):{}}},Ha=u.i18n.translate("data.search.aggs.metrics.cumulativeSumLabel",{defaultMessage:"cumulative sum"}),Ya=u.i18n.translate("data.search.aggs.metrics.cumulativeSumTitle",{defaultMessage:"Cumulative Sum"}),Wa=()=>{const{subtype:e,params:t,getSerializedFormat:a}=Ka;return new MetricAggType({name:w.CUMULATIVE_SUM,expressionName:za,title:Ya,makeLabel:e=>ta(e,Ha),subtype:e,params:[...t()],getSerializedFormat:a})},Qa="aggDerivative",Ja=()=>({name:Qa,help:u.i18n.translate("data.search.aggs.function.metrics.derivative.help",{defaultMessage:"Generates a serialized agg config for a Derivative agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.derivative.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.derivative.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.derivative.schema.help",{defaultMessage:"Schema to use for this aggregation"})},metricAgg:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.derivative.metricAgg.help",{defaultMessage:"Id for finding agg config to use for building parent pipeline aggregations"})},customMetric:{types:["agg_type"],help:u.i18n.translate("data.search.aggs.metrics.derivative.customMetric.help",{defaultMessage:"Agg config to use for building parent pipeline aggregations"})},buckets_path:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.derivative.buckets_path.help",{defaultMessage:"Path to the metric of interest"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.derivative.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.derivative.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a;const{id:s,enabled:i,schema:r,...n}=t;return{type:"agg_type",value:{id:s,enabled:i,schema:r,type:w.DERIVATIVE,params:{...n,customMetric:null===(a=t.customMetric)||void 0===a?void 0:a.value}}}}}),Xa=u.i18n.translate("data.search.aggs.metrics.derivativeLabel",{defaultMessage:"derivative"}),Za=u.i18n.translate("data.search.aggs.metrics.derivativeTitle",{defaultMessage:"Derivative"}),es=()=>{const{subtype:e,params:t,getSerializedFormat:a}=Ka;return new MetricAggType({name:w.DERIVATIVE,expressionName:Qa,title:Za,makeLabel:e=>ta(e,Xa),subtype:e,params:[...t()],getSerializedFormat:a})},ts="aggGeoBounds",as=()=>({name:ts,help:u.i18n.translate("data.search.aggs.function.metrics.geo_bounds.help",{defaultMessage:"Generates a serialized agg config for a Geo Bounds agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.geo_bounds.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.geo_bounds.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.geo_bounds.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.geo_bounds.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.geo_bounds.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.geo_bounds.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.GEO_BOUNDS,params:{...r}}}}}),ss=u.i18n.translate("data.search.aggs.metrics.geoBoundsTitle",{defaultMessage:"Geo Bounds"}),is=u.i18n.translate("data.search.aggs.metrics.geoBoundsLabel",{defaultMessage:"Geo Bounds"}),rs=()=>new MetricAggType({name:w.GEO_BOUNDS,expressionName:ts,title:ss,makeLabel:()=>is,params:[{name:"field",type:"field",filterFieldTypes:p.KBN_FIELD_TYPES.GEO_POINT}]}),ns="aggGeoCentroid",os=()=>({name:ns,help:u.i18n.translate("data.search.aggs.function.metrics.geo_centroid.help",{defaultMessage:"Generates a serialized agg config for a Geo Centroid agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.geo_centroid.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.geo_centroid.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.geo_centroid.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.geo_centroid.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.geo_centroid.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.geo_centroid.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.GEO_CENTROID,params:{...r}}}}}),ls=u.i18n.translate("data.search.aggs.metrics.geoCentroidTitle",{defaultMessage:"Geo Centroid"}),us=u.i18n.translate("data.search.aggs.metrics.geoCentroidLabel",{defaultMessage:"Geo Centroid"}),ds=()=>new MetricAggType({name:w.GEO_CENTROID,expressionName:ns,title:ls,makeLabel:()=>us,params:[{name:"field",type:"field",filterFieldTypes:p.KBN_FIELD_TYPES.GEO_POINT}],getValue:(e,t)=>t[e.id]&&t[e.id].location}),cs="aggMax",gs=()=>({name:cs,help:u.i18n.translate("data.search.aggs.function.metrics.max.help",{defaultMessage:"Generates a serialized agg config for a Max agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.max.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.max.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.max.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.max.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.max.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.max.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.MAX,params:{...r}}}}}),hs=u.i18n.translate("data.search.aggs.metrics.maxTitle",{defaultMessage:"Max"}),ps=()=>new MetricAggType({name:w.MAX,expressionName:cs,title:hs,makeLabel:e=>u.i18n.translate("data.search.aggs.metrics.maxLabel",{defaultMessage:"Max {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.HISTOGRAM]}]}),fs="aggMedian",ms=()=>({name:fs,help:u.i18n.translate("data.search.aggs.function.metrics.median.help",{defaultMessage:"Generates a serialized agg config for a Median agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.median.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.median.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.median.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.median.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.median.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.median.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.MEDIAN,params:{...r}}}}}),ys=u.i18n.translate("data.search.aggs.metrics.medianTitle",{defaultMessage:"Median"}),bs=()=>new MetricAggType({name:w.MEDIAN,expressionName:fs,dslName:"percentiles",title:ys,getValueType:()=>"number",makeLabel:e=>u.i18n.translate("data.search.aggs.metrics.medianLabel",{defaultMessage:"Median {field}",values:{field:e.getFieldDisplayName()}}),getValueBucketPath:e=>`${e.id}.50`,params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.HISTOGRAM]},{name:"percents",default:[50],shouldShow:()=>!1,serialize:()=>{}}],getValue(e,t){var a;return null===(a=t[e.id])||void 0===a?void 0:a.values["50.0"]}}),vs="aggSinglePercentile",Ss=()=>({name:vs,help:u.i18n.translate("data.search.aggs.function.metrics.singlePercentile.help",{defaultMessage:"Generates a serialized agg config for a single percentile agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.singlePercentile.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.singlePercentile.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.singlePercentile.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.singlePercentile.field.help",{defaultMessage:"Field to use for this aggregation"})},percentile:{types:["number"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.singlePercentile.percentile.help",{defaultMessage:"Percentile to fetch"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.singlePercentile.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.singlePercentile.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.SINGLE_PERCENTILE,params:{...r}}}}}),_s=u.i18n.translate("data.search.aggs.metrics.singlePercentileTitle",{defaultMessage:"Percentile"}),Ts=()=>new MetricAggType({name:w.SINGLE_PERCENTILE,expressionName:vs,dslName:"percentiles",title:_s,getValueType:()=>"number",makeLabel:e=>u.i18n.translate("data.search.aggs.metrics.singlePercentileLabel",{defaultMessage:"Percentile {field}",values:{field:e.getFieldDisplayName()}}),getValueBucketPath:e=>`${e.id}.${e.params.percentile}`,params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.HISTOGRAM]},{name:"percentile",default:95,write:(e,t)=>{t.params.percents=[e.params.percentile]}}],getValue(e,t){var a;let s=String(e.params.percentile);Number.isInteger(e.params.percentile)&&(s+=".0");const{values:i}=null!==(a=t[e.id])&&void 0!==a?a:{};return i?i[s]:NaN}}),Es="aggMin",Ms=()=>({name:Es,help:u.i18n.translate("data.search.aggs.function.metrics.min.help",{defaultMessage:"Generates a serialized agg config for a Min agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.min.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.min.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.min.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.min.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.min.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.min.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.MIN,params:{...r}}}}}),Fs=u.i18n.translate("data.search.aggs.metrics.minTitle",{defaultMessage:"Min"}),As=()=>new MetricAggType({name:w.MIN,expressionName:Es,title:Fs,makeLabel:e=>u.i18n.translate("data.search.aggs.metrics.minLabel",{defaultMessage:"Min {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.HISTOGRAM]}]}),Is="aggMovingAvg",ws=()=>({name:Is,help:u.i18n.translate("data.search.aggs.function.metrics.moving_avg.help",{defaultMessage:"Generates a serialized agg config for a Moving Average agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.moving_avg.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.moving_avg.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.moving_avg.schema.help",{defaultMessage:"Schema to use for this aggregation"})},metricAgg:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.moving_avg.metricAgg.help",{defaultMessage:"Id for finding agg config to use for building parent pipeline aggregations"})},customMetric:{types:["agg_type"],help:u.i18n.translate("data.search.aggs.metrics.moving_avg.customMetric.help",{defaultMessage:"Agg config to use for building parent pipeline aggregations"})},window:{types:["number"],help:u.i18n.translate("data.search.aggs.metrics.moving_avg.window.help",{defaultMessage:'The size of window to "slide" across the histogram.'})},buckets_path:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.derivative.buckets_path.help",{defaultMessage:"Path to the metric of interest"})},script:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.moving_avg.script.help",{defaultMessage:"Id for finding agg config to use for building parent pipeline aggregations"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.moving_avg.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.moving_avg.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a;const{id:s,enabled:i,schema:r,...n}=t;return{type:"agg_type",value:{id:s,enabled:i,schema:r,type:w.MOVING_FN,params:{...n,customMetric:null===(a=t.customMetric)||void 0===a?void 0:a.value}}}}}),xs=u.i18n.translate("data.search.aggs.metrics.movingAvgTitle",{defaultMessage:"Moving Avg"}),ks=u.i18n.translate("data.search.aggs.metrics.movingAvgLabel",{defaultMessage:"moving avg"}),Rs=()=>{const{subtype:e,params:t,getSerializedFormat:a}=Ka;return new MetricAggType({name:w.MOVING_FN,expressionName:Is,dslName:"moving_fn",title:xs,makeLabel:e=>ta(e,ks),subtype:e,getSerializedFormat:a,params:[...t(),{name:"window",default:5},{name:"script",default:"MovingFunctions.unweightedAvg(values)"}],getValue:(e,t)=>t[e.id]?t[e.id].value:null})},Ns="aggPercentileRanks",Cs=()=>({name:Ns,help:u.i18n.translate("data.search.aggs.function.metrics.percentile_ranks.help",{defaultMessage:"Generates a serialized agg config for a Percentile Ranks agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.percentile_ranks.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.percentile_ranks.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.percentile_ranks.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.percentile_ranks.field.help",{defaultMessage:"Field to use for this aggregation"})},values:{types:["number"],multi:!0,help:u.i18n.translate("data.search.aggs.metrics.percentile_ranks.values.help",{defaultMessage:"Range of percentiles ranks"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.percentile_ranks.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.percentile_ranks.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.PERCENTILE_RANKS,params:{...r}}}}}),Ls=(e,t)=>e.$$_ResponseAggConfigClass?e.$$_ResponseAggConfigClass:e.$$_ResponseAggConfigClass=Ps(e,t),Ps=(e,t)=>{function a(t){const a=e.id;this.id=function(e,t){const a=String(t);return a.indexOf(".")>-1?e+"['"+a.replace(/[\\']/g,"\\$&")+"']":e+"."+a}(a,t),this.key=t,this.parentId=a}return a.prototype=Object.create(e),a.prototype.constructor=a,(0,o.assignIn)(a.prototype,t),a},Ds=(e,t)=>{var a;const{values:s}=null!==(a=t[e.parentId])&&void 0!==a?a:{},i=(0,o.find)(s,(({key:t})=>t===e.key));return i?i.value:NaN},Os=e=>({makeLabel(){const{getDefaultInstance:t}=e(),a=this.getField(),s=a&&a.format||t(p.KBN_FIELD_TYPES.NUMBER),i=this.getParam("customLabel")||this.getFieldDisplayName();return u.i18n.translate("data.search.aggs.metrics.percentileRanks.valuePropsLabel",{defaultMessage:'Percentile rank {format} of "{label}"',values:{format:s.convert(this.key,"text"),label:i}})}}),Bs=({getFieldFormatsStart:e})=>new MetricAggType({name:w.PERCENTILE_RANKS,expressionName:Ns,title:u.i18n.translate("data.search.aggs.metrics.percentileRanksTitle",{defaultMessage:"Percentile Ranks"}),makeLabel:e=>u.i18n.translate("data.search.aggs.metrics.percentileRanksLabel",{defaultMessage:"Percentile ranks of {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.HISTOGRAM]},{name:"values",default:[]},{write(e,t){t.params.keyed=!1}}],getResponseAggs(t){const a=Ls(t,Os(e));return t.getParam("values").map((e=>new a(e)))},getSerializedFormat:e=>({id:"percent"}),getValue:(e,t)=>Ds(e,t)/100}),qs="aggPercentiles",js=()=>({name:qs,help:u.i18n.translate("data.search.aggs.function.metrics.percentiles.help",{defaultMessage:"Generates a serialized agg config for a Percentiles agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.percentiles.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.percentiles.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.percentiles.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.percentiles.field.help",{defaultMessage:"Field to use for this aggregation"})},percents:{types:["number"],multi:!0,help:u.i18n.translate("data.search.aggs.metrics.percentiles.percents.help",{defaultMessage:"Range of percentiles ranks"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.percentiles.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.percentiles.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.PERCENTILES,params:{...r}}}}});const zs={makeLabel(){const e=this.getParam("customLabel")||this.getFieldDisplayName();return u.i18n.translate("data.search.aggs.metrics.percentiles.valuePropsLabel",{defaultMessage:"{percentile} percentile of {label}",values:{percentile:(t=this.key,t+""+function(e){const t=Math.floor(parseFloat(e)),a=t%100;if(a>=11&&a<=13)return"th";const s=t%10;return 1===s?"st":2===s?"nd":3===s?"rd":"th"}(t)),label:e}});var t}},Us=()=>new MetricAggType({name:w.PERCENTILES,expressionName:qs,title:u.i18n.translate("data.search.aggs.metrics.percentilesTitle",{defaultMessage:"Percentiles"}),getValueType:()=>"number",makeLabel:e=>u.i18n.translate("data.search.aggs.metrics.percentilesLabel",{defaultMessage:"Percentiles of {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.HISTOGRAM]},{name:"percents",default:[1,5,25,50,75,95,99]},{write(e,t){t.params.keyed=!1}}],getResponseAggs(e){const t=Ls(e,zs);return e.getParam("percents").map((e=>new t(e)))},getValue:Ds}),Gs="aggRate",$s=()=>({name:Gs,help:u.i18n.translate("data.search.aggs.function.metrics.rate.help",{defaultMessage:"Generates a serialized agg config for a Rate agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.rate.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.rate.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.rate.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.rate.field.help",{defaultMessage:"Field to use for this aggregation"})},unit:{types:["string"],required:!0,options:["second","minute","hour","day","week","month","quarter","year"],help:u.i18n.translate("data.search.aggs.metrics.rate.unit.help",{defaultMessage:"Unit to use for this aggregation"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.rate.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.rate.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.RATE,params:{...r}}}}}),Vs=u.i18n.translate("data.search.aggs.metrics.rateTitle",{defaultMessage:"Rate"}),Ks=()=>new MetricAggType({name:w.RATE,expressionName:Gs,title:Vs,getValueType:()=>"number",makeLabel:e=>u.i18n.translate("data.search.aggs.metrics.rateLabel",{defaultMessage:"Rate of {field} per {unit}",values:{field:e.getFieldDisplayName(),unit:e.getParam("unit")}}),params:[{name:"field",type:"field",required:!1,filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.HISTOGRAM]},{name:"unit",type:"string",displayName:u.i18n.translate("data.search.aggs.metrics.rate.unit.displayName",{defaultMessage:"Unit"}),required:!0,options:[{text:u.i18n.translate("data.search.aggs.metrics.rate.unit.second",{defaultMessage:"Second"}),value:"second"},{text:u.i18n.translate("data.search.aggs.metrics.rate.unit.minute",{defaultMessage:"Minute"}),value:"minute"},{text:u.i18n.translate("data.search.aggs.metrics.rate.unit.hour",{defaultMessage:"Hour"}),value:"hour"},{text:u.i18n.translate("data.search.aggs.metrics.rate.unit.day",{defaultMessage:"Day"}),value:"day"},{text:u.i18n.translate("data.search.aggs.metrics.rate.unit.week",{defaultMessage:"Week"}),value:"week"},{text:u.i18n.translate("data.search.aggs.metrics.rate.unit.month",{defaultMessage:"Month"}),value:"month"},{text:u.i18n.translate("data.search.aggs.metrics.rate.unit.quarter",{defaultMessage:"Quarter"}),value:"quarter"},{text:u.i18n.translate("data.search.aggs.metrics.rate.unit.year",{defaultMessage:"Year"}),value:"year"}]}]}),Hs="aggSinglePercentileRank",Ys=()=>({name:Hs,help:u.i18n.translate("data.search.aggs.function.metrics.singlePercentileRank.help",{defaultMessage:"Generates a serialized agg config for a single percentile rank agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.singlePercentileRank.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.singlePercentileRank.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.singlePercentileRank.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.singlePercentileRank.field.help",{defaultMessage:"Field to use for this aggregation"})},value:{types:["number"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.singlePercentileRank.value.help",{defaultMessage:"Percentile rank value to fetch"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.singlePercentileRank.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.singlePercentileRank.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.SINGLE_PERCENTILE_RANK,params:{...r}}}}}),Ws=u.i18n.translate("data.search.aggs.metrics.singlePercentileRankTitle",{defaultMessage:"Percentile rank"}),Qs=()=>new MetricAggType({name:w.SINGLE_PERCENTILE_RANK,expressionName:Hs,dslName:"percentile_ranks",title:Ws,getValueType:()=>"number",makeLabel:e=>u.i18n.translate("data.search.aggs.metrics.singlePercentileRankLabel",{defaultMessage:"Percentile rank of {field}",values:{field:e.getFieldDisplayName()}}),getValueBucketPath:e=>`${e.id}.${e.params.value}`,getSerializedFormat:e=>({id:"percent"}),params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.HISTOGRAM]},{name:"value",default:0,write:(e,t)=>{t.params.values=[e.params.value]}}],getValue(e,t){var a;let s=String(e.params.value);Number.isInteger(e.params.value)&&(s+=".0");const{values:i}=null!==(a=t[e.id])&&void 0!==a?a:{};return i?i[s]/100:NaN}}),Js="aggSerialDiff",Xs=()=>({name:Js,help:u.i18n.translate("data.search.aggs.function.metrics.serial_diff.help",{defaultMessage:"Generates a serialized agg config for a Serial Differencing agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.serial_diff.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.serial_diff.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.serial_diff.schema.help",{defaultMessage:"Schema to use for this aggregation"})},metricAgg:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.serial_diff.metricAgg.help",{defaultMessage:"Id for finding agg config to use for building parent pipeline aggregations"})},customMetric:{types:["agg_type"],help:u.i18n.translate("data.search.aggs.metrics.serial_diff.customMetric.help",{defaultMessage:"Agg config to use for building parent pipeline aggregations"})},buckets_path:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.serial_diff.buckets_path.help",{defaultMessage:"Path to the metric of interest"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.serial_diff.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.serial_diff.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{var a;const{id:s,enabled:i,schema:r,...n}=t;return{type:"agg_type",value:{id:s,enabled:i,schema:r,type:w.SERIAL_DIFF,params:{...n,customMetric:null===(a=t.customMetric)||void 0===a?void 0:a.value}}}}}),Zs=u.i18n.translate("data.search.aggs.metrics.serialDiffTitle",{defaultMessage:"Serial Diff"}),ei=u.i18n.translate("data.search.aggs.metrics.serialDiffLabel",{defaultMessage:"serial diff"}),ti=()=>{const{subtype:e,params:t,getSerializedFormat:a}=Ka;return new MetricAggType({name:w.SERIAL_DIFF,expressionName:Js,title:Zs,makeLabel:e=>ta(e,ei),subtype:e,params:[...t()],getSerializedFormat:a})},ai="aggStdDeviation",si=()=>({name:ai,help:u.i18n.translate("data.search.aggs.function.metrics.std_deviation.help",{defaultMessage:"Generates a serialized agg config for a Standard Deviation agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.std_deviation.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.std_deviation.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.std_deviation.schema.help",{defaultMessage:"Schema to use for this aggregation"})},showBounds:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.std_deviation.showBounds.help",{defaultMessage:"Specifies whether this aggregation should return upper and lower bound or the standard deviation itself"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.std_deviation.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.std_deviation.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.std_deviation.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.STD_DEV,params:{...r}}}}}),ii={valProp(){const e=this.getParam("customLabel");return this.keyedDetails(e)[this.key].valProp},makeLabel(){const e=this.getFieldDisplayName(),t=this.getParam("customLabel"),a=this.keyedDetails(t,e);return(0,o.get)(a,[this.key,"title"])},keyedDetails(e,t){const a=e||u.i18n.translate("data.search.aggs.metrics.standardDeviation.keyDetailsLabel",{defaultMessage:"Standard Deviation of {fieldDisplayName}",values:{fieldDisplayName:t}});return{std_lower:{valProp:["std_deviation_bounds","lower"],title:u.i18n.translate("data.search.aggs.metrics.standardDeviation.lowerKeyDetailsTitle",{defaultMessage:"Lower {label}",values:{label:a}})},std_upper:{valProp:["std_deviation_bounds","upper"],title:u.i18n.translate("data.search.aggs.metrics.standardDeviation.upperKeyDetailsTitle",{defaultMessage:"Upper {label}",values:{label:a}})}}}},ri=()=>new MetricAggType({name:w.STD_DEV,expressionName:ai,dslName:"extended_stats",title:u.i18n.translate("data.search.aggs.metrics.standardDeviationTitle",{defaultMessage:"Standard Deviation"}),makeLabel:e=>u.i18n.translate("data.search.aggs.metrics.standardDeviationLabel",{defaultMessage:"Standard Deviation of {field}",values:{field:e.getFieldDisplayName()}}),params:[{name:"field",type:"field",filterFieldTypes:p.KBN_FIELD_TYPES.NUMBER},{name:"showBounds",type:"boolean",write:()=>{},shouldShow:()=>!1}],getResponseAggs(e){if(!1===e.getParam("showBounds"))return[e];const t=Ls(e,ii);return[new t("std_lower"),new t("std_upper")]},getValueBucketPath:e=>`${e.id}.std_deviation`,getValue(e,t){var a;return!1===e.getParam("showBounds")?null===(a=t[e.id])||void 0===a?void 0:a.std_deviation:(0,o.get)(t[e.parentId],e.valProp())}}),ni="aggSum",oi=()=>({name:ni,help:u.i18n.translate("data.search.aggs.function.metrics.sum.help",{defaultMessage:"Generates a serialized agg config for a Sum agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.sum.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.sum.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.sum.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.sum.field.help",{defaultMessage:"Field to use for this aggregation"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.sum.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.sum.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})},emptyAsNull:{types:["boolean"],help:u.i18n.translate("data.search.aggs.metrics.emptyAsNull.help",{defaultMessage:'If set to true, a missing value is treated as null in the resulting data table. If set to false, a "zero" is filled in'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.SUM,params:{...r}}}}}),li=u.i18n.translate("data.search.aggs.metrics.sumTitle",{defaultMessage:"Sum"}),ui=()=>new MetricAggType({name:w.SUM,expressionName:ni,title:li,getValueType:()=>"number",enableEmptyAsNull:!0,makeLabel:e=>u.i18n.translate("data.search.aggs.metrics.sumLabel",{defaultMessage:"Sum of {field}",values:{field:e.getFieldDisplayName()}}),isScalable:()=>!0,params:[{name:"field",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.HISTOGRAM]}]}),di="aggTopHit",ci=()=>({name:di,help:u.i18n.translate("data.search.aggs.function.metrics.top_hit.help",{defaultMessage:"Generates a serialized agg config for a Top Hit agg"}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.top_hit.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.top_hit.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.top_hit.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.top_hit.field.help",{defaultMessage:"Field to use for this aggregation"})},aggregate:{types:["string"],required:!0,options:["min","max","sum","average","concat"],help:u.i18n.translate("data.search.aggs.metrics.top_hit.aggregate.help",{defaultMessage:"Aggregate type"})},size:{types:["number"],help:u.i18n.translate("data.search.aggs.metrics.top_hit.size.help",{defaultMessage:"Max number of buckets to retrieve"})},sortOrder:{types:["string"],options:["desc","asc"],help:u.i18n.translate("data.search.aggs.metrics.top_hit.sortOrder.help",{defaultMessage:"Order in which to return the results: asc or desc"})},sortField:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.top_hit.sortField.help",{defaultMessage:"Field to order results by"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.top_hit.json.help",{defaultMessage:"Advanced json to include when the agg is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.top_hit.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})},timeShift:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.timeShift.help",{defaultMessage:'Shift the time range for the metric by a set time, for example 1h or 7d. "previous" will use the closest time range from the date histogram or time range filter.'})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.TOP_HITS,params:{...r}}}}}),gi=e=>{const t=e.getParam("field");return t&&t.type&&t.type===p.KBN_FIELD_TYPES.NUMBER},hi=()=>new MetricAggType({name:w.TOP_HITS,expressionName:di,title:u.i18n.translate("data.search.aggs.metrics.topHitTitle",{defaultMessage:"Top Hit"}),getValueType:e=>{var t;return null===(t=e.getParam("field"))||void 0===t?void 0:t.type},makeLabel(e){const t=u.i18n.translate("data.search.aggs.metrics.topHit.lastPrefixLabel",{defaultMessage:"Last"}),a=u.i18n.translate("data.search.aggs.metrics.topHit.firstPrefixLabel",{defaultMessage:"First"});let s="desc"===e.getParam("sortOrder").value?t:a;const i=e.getParam("size");1!==i&&(s+=` ${i}`);const r=e.getParam("field");return`${s} ${r?r.displayName:""}`},params:[{name:"field",type:"field",onlyAggregatable:!1,filterFieldTypes:Object.values(p.KBN_FIELD_TYPES).filter((e=>e!==p.KBN_FIELD_TYPES.HISTOGRAM)),write(e,t){const a=e.getParam("field");t.params={},a.scripted?t.params.script_fields={[a.name]:{script:{source:a.script,lang:a.lang}}}:("_source"!==a.name&&(t.params.fields=[{field:a.name,...a.type===p.KBN_FIELD_TYPES.DATE&&{format:"date_time"}}]),t.params._source="_source"===a.name)}},{name:"aggregate",type:"optioned",options:[{text:u.i18n.translate("data.search.aggs.metrics.topHit.minLabel",{defaultMessage:"Min"}),isCompatible:gi,disabled:!0,value:"min"},{text:u.i18n.translate("data.search.aggs.metrics.topHit.maxLabel",{defaultMessage:"Max"}),isCompatible:gi,disabled:!0,value:"max"},{text:u.i18n.translate("data.search.aggs.metrics.topHit.sumLabel",{defaultMessage:"Sum"}),isCompatible:gi,disabled:!0,value:"sum"},{text:u.i18n.translate("data.search.aggs.metrics.topHit.averageLabel",{defaultMessage:"Average"}),isCompatible:gi,disabled:!0,value:"average"},{text:u.i18n.translate("data.search.aggs.metrics.topHit.concatenateLabel",{defaultMessage:"Concatenate"}),isCompatible:e=>"*"===l().get(e.params,"field.filterFieldTypes","*"),disabled:!0,value:"concat"}],write:l().noop},{name:"size",default:1},{name:"sortField",type:"field",filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.DATE,p.KBN_FIELD_TYPES.IP,p.KBN_FIELD_TYPES.STRING],default:e=>e.getIndexPattern().timeFieldName,write:l().noop},{name:"sortOrder",type:"optioned",default:"desc",options:[{text:u.i18n.translate("data.search.aggs.metrics.topHit.descendingLabel",{defaultMessage:"Descending"}),value:"desc"},{text:u.i18n.translate("data.search.aggs.metrics.topHit.ascendingLabel",{defaultMessage:"Ascending"}),value:"asc"}],write(e,t){const a=e.params.sortField,s=e.params.sortOrder;a.scripted?t.params.sort=[{_script:{script:{source:a.script,lang:a.lang},type:a.type,order:s.value}}]:t.params.sort=[{[a.name]:{order:s.value}}]}}],getValue(e,t){const a=l().get(t,`${e.id}.hits.hits`);if(!a||!a.length)return null;const s=e.getParam("field").name;let i=l().flatten(a.map((t=>"_source"===s?t._source:(0,p.flattenHit)(t,e.getIndexPattern())[s])));if(1===i.length&&(i=i[0]),Array.isArray(i)){if(!l().compact(i).length)return null;switch(e.getParam("aggregate").value){case"max":return l().max(i);case"min":return l().min(i);case"sum":return l().sum(i);case"average":return l().sum(i)/i.length}}return i},createFilter:D}),pi="aggTopMetrics",fi=()=>({name:pi,help:u.i18n.translate("data.search.aggs.function.metrics.topMetrics.help",{defaultMessage:"Generates a serialized aggregation configuration for Top metrics."}),type:"agg_type",args:{id:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.topMetrics.id.help",{defaultMessage:"ID for this aggregation"})},enabled:{types:["boolean"],default:!0,help:u.i18n.translate("data.search.aggs.metrics.topMetrics.enabled.help",{defaultMessage:"Specifies whether this aggregation should be enabled"})},schema:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.topMetrics.schema.help",{defaultMessage:"Schema to use for this aggregation"})},field:{types:["string"],required:!0,help:u.i18n.translate("data.search.aggs.metrics.topMetrics.field.help",{defaultMessage:"Field to use for this aggregation"})},size:{types:["number"],help:u.i18n.translate("data.search.aggs.metrics.topMetrics.size.help",{defaultMessage:"Number of top values to retrieve"})},sortOrder:{types:["string"],options:["desc","asc"],help:u.i18n.translate("data.search.aggs.metrics.topMetrics.sortOrder.help",{defaultMessage:"Order in which to return the results: asc or desc"})},sortField:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.topMetrics.sortField.help",{defaultMessage:"Field to order results by"})},json:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.topMetrics.json.help",{defaultMessage:"Advanced JSON to include when the aggregation is sent to Elasticsearch"})},customLabel:{types:["string"],help:u.i18n.translate("data.search.aggs.metrics.topMetrics.customLabel.help",{defaultMessage:"Represents a custom label for this aggregation"})}},fn:(e,t)=>{const{id:a,enabled:s,schema:i,...r}=t;return{type:"agg_type",value:{id:a,enabled:s,schema:i,type:w.TOP_METRICS,params:{...r}}}}}),mi=()=>new MetricAggType({name:w.TOP_METRICS,expressionName:pi,title:u.i18n.translate("data.search.aggs.metrics.topMetricsTitle",{defaultMessage:"Top metrics"}),getValueType:e=>{var t;return null===(t=e.getParam("field"))||void 0===t?void 0:t.type},makeLabel(e){const t="desc"===e.getParam("sortOrder").value,a=e.getParam("size"),s=e.getParam("field"),i=e.getParam("sortField");var r,n,o,l;return t?a>1?u.i18n.translate("data.search.aggs.metrics.topMetrics.descWithSizeLabel",{defaultMessage:'Last {size} "{fieldName}" values by "{sortField}"',values:{size:a,fieldName:null==s?void 0:s.displayName,sortField:null!==(r=null==i?void 0:i.displayName)&&void 0!==r?r:"_score"}}):u.i18n.translate("data.search.aggs.metrics.topMetrics.descNoSizeLabel",{defaultMessage:'Last "{fieldName}" value by "{sortField}"',values:{fieldName:null==s?void 0:s.displayName,sortField:null!==(n=null==i?void 0:i.displayName)&&void 0!==n?n:"_score"}}):a>1?u.i18n.translate("data.search.aggs.metrics.topMetrics.ascWithSizeLabel",{defaultMessage:'First {size} "{fieldName}" values by "{sortField}"',values:{size:a,fieldName:null==s?void 0:s.displayName,sortField:null!==(o=null==i?void 0:i.displayName)&&void 0!==o?o:"_score"}}):u.i18n.translate("data.search.aggs.metrics.topMetrics.ascNoSizeLabel",{defaultMessage:'First "{fieldName}" value by "{sortField}"',values:{fieldName:null==s?void 0:s.displayName,sortField:null!==(l=null==i?void 0:i.displayName)&&void 0!==l?l:"_score"}})},params:[{name:"field",type:"field",scriptable:!1,filterFieldTypes:[p.KBN_FIELD_TYPES.STRING,p.KBN_FIELD_TYPES.IP,p.KBN_FIELD_TYPES.BOOLEAN,p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.DATE],write(e,t){const a=e.getParam("field");t.params.metrics={field:a.name}}},{name:"size",default:1},{name:"sortField",type:"field",scriptable:!1,filterFieldTypes:[p.KBN_FIELD_TYPES.NUMBER,p.KBN_FIELD_TYPES.DATE],default:e=>e.getIndexPattern().timeFieldName,write:l().noop},{name:"sortOrder",type:"optioned",default:"desc",options:[{text:u.i18n.translate("data.search.aggs.metrics.topMetrics.descendingLabel",{defaultMessage:"Descending"}),value:"desc"},{text:u.i18n.translate("data.search.aggs.metrics.topMetrics.ascendingLabel",{defaultMessage:"Ascending"}),value:"asc"}],write(e,t){const a=e.params.sortField,s=e.params.sortOrder;t.params.sort=a&&s?{[a.name]:s.value}:"_score"}}],getValueBucketPath(e){const t=e.getParam("field").name;return`${e.id}[${t}]`},getValue(e,t){var a,s;const i=e.getParam("field").name,r=null!==(a=null===(s=t[e.id])||void 0===s?void 0:s.top.map((e=>e.metrics[i])))&&void 0!==a?a:[];return 0===r.length?null:1===r.length?r[0]:r},createFilter:D}),yi=()=>({metrics:[{name:w.COUNT,fn:ja},{name:w.AVG,fn:Xt},{name:w.SUM,fn:ui},{name:w.MEDIAN,fn:bs},{name:w.SINGLE_PERCENTILE,fn:Ts},{name:w.SINGLE_PERCENTILE_RANK,fn:Qs},{name:w.MIN,fn:As},{name:w.MAX,fn:ps},{name:w.STD_DEV,fn:ri},{name:w.CARDINALITY,fn:Ca},{name:w.VALUE_COUNT,fn:Oa},{name:w.PERCENTILES,fn:Us},{name:w.PERCENTILE_RANKS,fn:Bs},{name:w.RATE,fn:Ks},{name:w.TOP_HITS,fn:hi},{name:w.TOP_METRICS,fn:mi},{name:w.DERIVATIVE,fn:es},{name:w.CUMULATIVE_SUM,fn:Wa},{name:w.MOVING_FN,fn:Rs},{name:w.SERIAL_DIFF,fn:ti},{name:w.AVG_BUCKET,fn:ua},{name:w.SUM_BUCKET,fn:Ma},{name:w.MIN_BUCKET,fn:va},{name:w.MAX_BUCKET,fn:pa},{name:w.FILTERED_METRIC,fn:xa},{name:w.GEO_BOUNDS,fn:rs},{name:w.GEO_CENTROID,fn:ds}],buckets:[{name:_.T.DATE_HISTOGRAM,fn:G},{name:_.T.HISTOGRAM,fn:ve},{name:_.T.RANGE,fn:Je},{name:_.T.DATE_RANGE,fn:W},{name:_.T.IP_PREFIX,fn:Ie},{name:_.T.IP_RANGE,fn:Ce},{name:_.T.TERMS,fn:Tt},{name:_.T.MULTI_TERMS,fn:xt},{name:_.T.RARE_TERMS,fn:Ct},{name:_.T.FILTER,fn:se},{name:_.T.FILTERS,fn:ue},{name:_.T.SIGNIFICANT_TERMS,fn:st},{name:_.T.SIGNIFICANT_TEXT,fn:ot},{name:_.T.GEOTILE_GRID,fn:he},{name:_.T.SAMPLER,fn:Dt},{name:_.T.DIVERSIFIED_SAMPLER,fn:zt},{name:_.T.TIME_SERIES,fn:Ht}]}),bi=()=>[J,re,Ze,rt,Te,xe,V,Ge,ce,fe,E,ut,Vt,At,Rt,Bt,Gt,Qt,ea,ca,ma,_a,Aa,Ra,Pa,qa,Ua,Ja,as,os,gs,ms,Ss,Ys,Ms,ws,Cs,js,$s,Xs,si,oi,ci,fi];class AggTypesRegistry{constructor(){(0,i.default)(this,"bucketAggs",new Map),(0,i.default)(this,"metricAggs",new Map),(0,i.default)(this,"legacyAggs",new Map),(0,i.default)(this,"setup",(()=>({registerBucket:(e,t)=>{if(this.bucketAggs.get(e)||this.metricAggs.get(e))throw new Error(`Agg has already been registered with name: ${e}`);this.bucketAggs.set(e,t)},registerMetric:(e,t)=>{if(this.bucketAggs.get(e)||this.metricAggs.get(e))throw new Error(`Agg has already been registered with name: ${e}`);this.metricAggs.set(e,t)},registerLegacy:(e,t)=>{if(this.legacyAggs.get(e)||this.legacyAggs.get(e))throw new Error(`Agg has already been registered with name: ${e}`);this.legacyAggs.set(e,t)}}))),(0,i.default)(this,"start",(e=>{const t=new Map,a=(a,s)=>{if(t.has(a))return t.get(a);const i=s(e);return t.set(a,i),i};return{get:e=>{const t=this.bucketAggs.get(e)||this.metricAggs.get(e)||this.legacyAggs.get(e);return t?a(e,t):void 0},getAll:()=>({buckets:Array.from(this.bucketAggs.entries()).map((([e,t])=>a(e,t))),metrics:Array.from(this.metricAggs.entries()).map((([e,t])=>a(e,t)))})}}))}}const vi=["dateFormat","dateFormat:scaled","dateFormat:tz",p.UI_SETTINGS.HISTOGRAM_BAR_TARGET,p.UI_SETTINGS.HISTOGRAM_MAX_BARS,p.UI_SETTINGS.SEARCH_QUERY_LANGUAGE,p.UI_SETTINGS.QUERY_ALLOW_LEADING_WILDCARDS,p.UI_SETTINGS.QUERY_STRING_OPTIONS,p.UI_SETTINGS.COURIER_IGNORE_FILTER_IF_FIELD_NOT_IN_INDEX];class AggsCommonService{constructor(e){(0,i.default)(this,"aggTypesRegistry",new AggTypesRegistry),this.aggExecutionContext=e}setup({registerFunction:e}){const t=this.aggTypesRegistry.setup(),a=yi();return a.buckets.forEach((({name:e,fn:a})=>t.registerBucket(e,a))),a.metrics.forEach((({name:e,fn:a})=>t.registerMetric(e,a))),bi().forEach((t=>e(t))),{types:t}}start({getConfig:e,fieldFormats:t,calculateBounds:a}){const s=this.aggTypesRegistry.start({getConfig:e,getFieldFormatsStart:()=>t,aggExecutionContext:this.aggExecutionContext,calculateBounds:a});return{types:s,calculateAutoTimeExpression:(0,q.JK)(e),createAggConfigs:(t,a,i)=>new AggConfigs(t,a,{...i,typesRegistry:s,aggExecutionContext:this.aggExecutionContext},e)}}}},5675:(e,t,a)=>{"use strict";a.d(t,{J:()=>AggParamType});var s=a(8915),i=a(1616),r=a(8409);class AggParamType extends r.L{constructor(e){super(e),(0,s.default)(this,"makeAgg",void 0),(0,s.default)(this,"allowedAggs",[]),e.allowedAggs&&(this.allowedAggs=e.allowedAggs),e.write||(this.write=(e,t)=>{e.params[this.name]&&e.params[this.name].length&&(t.params[this.name]=e.params[this.name])}),e.serialize||(this.serialize=e=>e.serialize()),e.deserialize||(this.deserialize=(e,t)=>{if(!t)throw new Error("aggConfig was not provided to AggParamType deserialize function");return this.makeAgg(t,e)}),e.toExpressionAst||(this.toExpressionAst=e=>{if(!e||!e.toExpressionAst)throw new Error("aggConfig was not provided to AggParamType toExpressionAst function");return e.toExpressionAst()}),this.makeAgg=e.makeAgg,this.getValueType=()=>i.C}}},8409:(e,t,a)=>{"use strict";a.d(t,{L:()=>BaseParamType});var s=a(8915);class BaseParamType{constructor(e){(0,s.default)(this,"name",void 0),(0,s.default)(this,"type",void 0),(0,s.default)(this,"displayName",void 0),(0,s.default)(this,"required",void 0),(0,s.default)(this,"advanced",void 0),(0,s.default)(this,"default",void 0),(0,s.default)(this,"write",void 0),(0,s.default)(this,"serialize",void 0),(0,s.default)(this,"deserialize",void 0),(0,s.default)(this,"toExpressionAst",void 0),(0,s.default)(this,"options",void 0),(0,s.default)(this,"getValueType",void 0),(0,s.default)(this,"modifyAggConfigOnSearchRequestStart",void 0),this.name=e.name,this.type=e.type,this.displayName=e.displayName||this.name,this.required=!0===e.required,this.advanced=e.advanced||!1,this.onChange=e.onChange,this.shouldShow=e.shouldShow,this.default=e.default,this.write=e.write||((e,t)=>{e.params[this.name]&&(t.params[this.name]=e.params[this.name]||this.default)}),this.serialize=e.serialize,this.deserialize=e.deserialize,this.toExpressionAst=e.toExpressionAst,this.options=e.options,this.modifyAggConfigOnSearchRequestStart=e.modifyAggConfigOnSearchRequestStart||function(){},this.getValueType=e.getValueType}}},6286:(e,t,a)=>{"use strict";a.d(t,{G:()=>FieldParamType});var s=a(8915),i=a(5008),r=a(1359),n=a(7674),o=a(8409),l=a(2023),u=a(2956);const d=(0,l.Ey)("type");class FieldParamType extends o.L{constructor(e){super(e),(0,s.default)(this,"required",!0),(0,s.default)(this,"scriptable",!0),(0,s.default)(this,"filterFieldTypes",void 0),(0,s.default)(this,"onlyAggregatable",void 0),(0,s.default)(this,"filterField",void 0),(0,s.default)(this,"getAvailableFields",(e=>e.getIndexPattern().fields.filter((e=>{const{onlyAggregatable:t,scriptable:a,filterFieldTypes:s,filterField:i}=this;return i?i(e):!(t&&(!e.aggregatable||(0,n.isNestedField)(e))||!a&&e.scripted)&&0!==d([e],s).length})))),this.filterFieldTypes=e.filterFieldTypes||"*",this.onlyAggregatable=!1!==e.onlyAggregatable,this.scriptable=!1!==e.scriptable,this.filterField=e.filterField,e.write||(this.write=(t,a)=>{const s=t.getField();if(!s){if(!1===e.required)return;throw new TypeError(i.i18n.translate("data.search.aggs.paramTypes.field.requiredFieldParameterErrorMessage",{defaultMessage:"{fieldParameter} is a required parameter",values:{fieldParameter:'"field"'}}))}const n=s.type===u.f.MISSING?s:this.getAvailableFields(t).find((e=>e.name===s.name));var o;if(!n)throw new r.SavedFieldTypeInvalidForAgg(i.i18n.translate("data.search.aggs.paramTypes.field.invalidSavedFieldParameterErrorMessage",{defaultMessage:'Saved field "{fieldParameter}" of data view "{indexPatternTitle}" is invalid for use with the "{aggType}" aggregation. Please select a new field.',values:{fieldParameter:s.name,aggType:null==t||null===(o=t.type)||void 0===o?void 0:o.title,indexPatternTitle:t.getIndexPattern().title}}));n.scripted?a.params.script={source:n.script,lang:n.lang}:a.params.field=n.name}),this.serialize=e=>e.name,this.deserialize=(e,t)=>{if(!t)throw new Error("aggConfig was not provided to FieldParamType deserialize function");return t.getIndexPattern().fields.getByName(e)||new n.DataViewField({type:u.f.MISSING,name:e,searchable:!1,aggregatable:!1})}}}},6490:(e,t,a)=>{"use strict";a.d(t,{O:()=>JsonParamType});var s=a(770),i=a.n(s),r=a(8409);class JsonParamType extends r.L{constructor(e){super(e),this.name=e.name||"json",e.write||(this.write=(e,t)=>{let a;const s=e.params[this.name];if(s){try{a=JSON.parse(function(e){const t=e.split('"""');for(let e=1;e<t.length-1;e+=2)t[e]=JSON.stringify(t[e]);return t.join("")}(s))}catch(e){return}t.params=function e(t,a){return i().isPlainObject(t)&&i().isPlainObject(a)?function(t,a){return i()(t).keys().union(i().keys(a)).transform((function(s,i){const r=e(t[i],a[i]);void 0!==r&&(s[i]=r)}),{}).value()}(t,a):Array.isArray(t)&&Array.isArray(a)?function(t,a){return i().times(Math.max(t.length,a.length),(function(s){return e(t[s],a[s])}))}(t,a):null!==a?void 0!==a?a:t:void 0}(t.params,a)}})}}},6252:(e,t,a)=>{"use strict";a.d(t,{o:()=>OptionedParamType});var s=a(8915),i=a(8409);class OptionedParamType extends i.L{constructor(e){super(e),(0,s.default)(this,"options",void 0),e.write||(this.write=(e,t)=>{t.params[this.name]=e.params[this.name].value}),e.serialize||(this.serialize=e=>e.value),e.deserialize||(this.deserialize=e=>this.options.find((t=>t.value===e))),this.options=e.options||[]}}},8201:(e,t,a)=>{"use strict";a.d(t,{l:()=>StringParamType});var s=a(8409);class StringParamType extends s.L{constructor(e){super(e),e.write||(this.write=(e,t)=>{e.params[this.name]&&e.params[this.name].length&&(t.params[this.name]=e.params[this.name])})}}},2023:(e,t,a)=>{"use strict";a.d(t,{zU:()=>InvalidEsCalendarIntervalError,mO:()=>InvalidEsIntervalFormatError,m8:()=>IpAddress,At:()=>Y,I1:()=>p,L:()=>N,JK:()=>F,s9:()=>O,JN:()=>H,us:()=>f,Ce:()=>b,sp:()=>W,nj:()=>g,P1:()=>T,vC:()=>K,Ey:()=>P,dr:()=>_,II:()=>E,p:()=>J});var s=a(1783),i=a.n(s),r=a(3789),n=a(3894),o=a(6494),l=a.n(o),u=a(5008);class InvalidEsCalendarIntervalError extends Error{constructor(e,t,a,s){super(u.i18n.translate("data.parseEsInterval.invalidEsCalendarIntervalErrorMessage",{defaultMessage:"Invalid calendar interval: {interval}, value must be 1",values:{interval:e}})),this.interval=e,this.value=t,this.unit=a,this.type=s,this.name="InvalidEsCalendarIntervalError",this.value=t,this.unit=a,this.type=s,Error.captureStackTrace&&Error.captureStackTrace(this,InvalidEsCalendarIntervalError),Object.setPrototypeOf(this,InvalidEsCalendarIntervalError.prototype)}}class InvalidEsIntervalFormatError extends Error{constructor(e){super(u.i18n.translate("data.parseEsInterval.invalidEsIntervalFormatErrorMessage",{defaultMessage:"Invalid interval format: {interval}",values:{interval:e}})),this.interval=e,this.name="InvalidEsIntervalFormatError",Error.captureStackTrace&&Error.captureStackTrace(this,InvalidEsIntervalFormatError),Object.setPrototypeOf(this,InvalidEsIntervalFormatError.prototype)}}const d=new RegExp("^([1-9][0-9]*)\\s*("+l().units.join("|")+")$"),c=e=>{switch(e){case"minute":return"1m";case"hour":return"1h";case"day":return"1d";case"week":return"1w";case"month":return"1M";case"quarter":return"1q";case"year":return"1y"}return e};function g(e){const t=String(c(e)).trim().match(d);if(!t)throw new InvalidEsIntervalFormatError(e);const a=parseFloat(t[1]),s=t[2],i=l().unitsMap[s].type;if("calendar"===i&&1!==a)throw new InvalidEsCalendarIntervalError(e,a,s,i);return{value:a,unit:s,type:"mixed"===i&&1===a||"calendar"===i?"calendar":"fixed"}}const h={w:"7d",M:"30d",y:"365d"};function p(e,t){const{type:a,unit:s}=g(e);return"calendar"!==a||t?"calendar"===a?{fixed_interval:h[s]||e}:{fixed_interval:e}:{calendar_interval:e}}function f(e){try{return g(e),!0}catch{return!1}}function m(e,t){return 0===e?Math.abs(t):m(t%e,e)}function y(e,t){return Math.abs(e*t/m(e,t))}function b(e,t){return t?function(e,t){try{return function(e,t){const{unitsMap:a,unitsDesc:s}=l(),i=g(e),r=g(t);if(e===t)return e;const n=a[i.unit],o=a[r.unit];if(i.type!==r.type)throw Error(`Incompatible intervals: ${e} (${i.type}), ${t} (${r.type})`);if("calendar"===i.type||"calendar"===r.type)return n.weight>o.weight?`${i.value}${i.unit}`:`${r.value}${r.unit}`;const u=i.value*n.base,d=r.value*o.base,c=y(u,d);if(c===d)return t.replace(/\s/g,"");if(c===u)return e.replace(/\s/g,"");const h=s.find((e=>{const t=a[e];return!("calendar"===t.type||c%t.base!==0)}));if(!h)throw Error(`Unable to find common interval for: ${e}, ${t}`);return`${c/a[h].base}${h}`}(t,e)===e.replace(/\s/g,"")}catch(e){return!1}}(e,t):f(e)}var v=a(770);const S=new RegExp("^([0-9\\.]*)\\s*("+l().units.join("|")+")$"),_=e=>{if(e){const t=e.toString().trim().match(S);if(t)return{value:parseFloat(t[1])||1,unit:t[2]}}return null};function T(e){const t=_(e);if(!t)return null;try{const{value:e,unit:a}=t,s=i().duration(e,a),r=(0,v.find)(l().units,(e=>Math.abs(s.as(e))>=1));return l().units.indexOf(r)<l().units.indexOf(a)?s:i().duration(s.as(r),r)}catch(e){return null}}function E(e){const t=l().parse(e.from),a=l().parse(e.to,{roundUp:!0});if(t&&a)return{from:t.toDate(),to:a.toDate()}}var M=a(6763);function F(e){return function(t,a=M.B1,s=!0){const o=E(t);if(!o)return;const l=new n.t({"histogram:maxBars":e(r.j.HISTOGRAM_MAX_BARS),"histogram:barTarget":e(r.j.HISTOGRAM_BAR_TARGET),dateFormat:e("dateFormat"),"dateFormat:scaled":e("dateFormat:scaled")});l.setInterval(a),l.setBounds({min:i()(o.from),max:i()(o.to)});const u=l.getInterval();return s?u.expression:u}}var A=a(8915),I=a(2374),w=a(9806),x=a(6034);const k=(e,t)=>t(e.address);var R=a(4611);function N(e){var t,a,s,i,r,n;class FieldFormatWithCache extends I.FieldFormat{constructor(...e){super(...e),(0,A.default)(this,"formatCache",new Map)}getCachedFormat(t){const a=this.formatCache.has(t),s=this.formatCache.get(t)||e(t);return a||this.formatCache.set(t,s),s}}return[(t=class AggsRangeFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),(0,A.default)(this,"textConvert",(e=>{const t=this._params;if(null==e)return"";if(e.label)return e.label;const a=t,s=this.getCachedFormat(a);let i=s.convert(e.gte),r=s.convert(e.lt);if(t.replaceInfinity&&null==a.id){const t="",a="+";i=isFinite(e.gte)?i:t,r=isFinite(e.lt)?r:a}return"arrow_right"===t.template?u.i18n.translate("data.aggTypes.buckets.ranges.rangesFormatMessageArrowRight",{defaultMessage:"{from}  {to}",values:{from:i,to:r}}):u.i18n.translate("data.aggTypes.buckets.ranges.rangesFormatMessage",{defaultMessage:"{gte} {from} and {lt} {to}",values:{gte:"",from:i,lt:"<",to:r}})}))}},(0,A.default)(t,"id","range"),(0,A.default)(t,"hidden",!0),t),(a=class AggsDateRangeFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),(0,A.default)(this,"textConvert",(e=>{if(null==e)return"";const t=this._params,a=this.getCachedFormat(t);return(0,x.N)(e,a.convert.bind(a))}))}},(0,A.default)(a,"id","date_range"),(0,A.default)(a,"hidden",!0),a),(s=class AggsIpPrefixFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),(0,A.default)(this,"textConvert",(e=>{if(null==e)return"";const t=this._params,a=this.getCachedFormat(t);return k(e,a.convert.bind(a))}))}},(0,A.default)(s,"id","ip_prefix"),(0,A.default)(s,"hidden",!0),s),(i=class AggsIpRangeFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),(0,A.default)(this,"textConvert",(e=>{if(null==e)return"";const t=this._params,a=this.getCachedFormat(t);return(0,R.Q)(e,a.convert.bind(a))}))}},(0,A.default)(i,"id","ip_range"),(0,A.default)(i,"hidden",!0),i),(r=class AggsTermsFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),(0,A.default)(this,"convert",((e,t)=>{const a=this._params,s=this.getCachedFormat(a);return"__other__"===e&&a.otherBucketLabel?`${a.otherBucketLabel}`:e===w.VC&&a.missingBucketLabel?`${a.missingBucketLabel}`:s.convert(e,t)})),(0,A.default)(this,"getConverterFor",(e=>t=>this.convert(t,e)))}},(0,A.default)(r,"id","terms"),(0,A.default)(r,"hidden",!0),r),(n=class AggsMultiTermsFieldFormat extends FieldFormatWithCache{constructor(...e){super(...e),(0,A.default)(this,"convert",((e,t)=>{var a,s,i;const r=this._params,n=r.paramsPerField.map((e=>this.getCachedFormat(e)));if("__other__"===String(e)&&r.otherBucketLabel)return`${r.otherBucketLabel}`;const o=`${null!==(a=r.separator)&&void 0!==a?a:"  "}`;return null!==(s=null==e||null===(i=e.keys)||void 0===i?void 0:i.map(((e,a)=>n[a].convert(e,t))).join(o))&&void 0!==s?s:""})),(0,A.default)(this,"getConverterFor",(e=>t=>this.convert(t,e)))}},(0,A.default)(n,"id","multi_terms"),(0,A.default)(n,"hidden",!0),n)]}var C=a(6880),L=a.n(C);class IpAddress{constructor(e){(0,A.default)(this,"value",void 0);try{this.value=Array.isArray(e)?L().fromByteArray(e):L().parse(`${e}`)}catch{throw Error("Invalid IP address: "+e)}}toString(){return"ipv6"===this.value.kind()?this.value.toRFC5952String():this.value.toString()}}function P(e){return function(t,a=[]){if((0,v.isFunction)(a))return t.filter((t=>a(t[e])));if(Array.isArray(a)||(a=a.split(",")),0===a.length)return t;if(a.includes("*"))return t;const s=a.reduce(((e,t)=>{let a="include",s=t;return"!"===t.charAt(0)&&(a="exclude",s=t.substr(1)),e[a]||(e[a]=[]),e[a].push(s),e}),{});return t.filter((t=>{const a=t[e];return(!s.exclude||!s.exclude.includes(a))&&!(s.include&&!s.include.includes(a))}))}}var D=a(7278);function O(e,t,a,s,{shouldDetectTimeZone:i}={}){let r=e.time_zone;if(!r&&e.field){var n,o,l,u;const s="string"==typeof e.field?e.field:e.field.name;r=null===(n=t.typeMeta)||void 0===n||null===(o=n.aggs)||void 0===o||null===(l=o[a])||void 0===l||null===(u=l[s])||void 0===u?void 0:u.time_zone}return r||(0,D.fy)(s,i)}var B=a(5265);const q=["s","m","h","d","w","M","y"],j=/^(startAt|endAt)\((.+)\)$/,z=/^(\d+)\s*(\w)$/,U="invalid",G="previous",$="startAt",V=i().HTML5_FMT.DATETIME_LOCAL_MS+"Z",K=e=>{const t=e.trim();if(t===G)return G;const[,a,s]=t.match(z)||[],r=Number(a);return Number.isNaN(r)||!q.includes(s)?U:i().duration(Number(a),s)},H=e=>null!=e&&j.test(e),Y={missingTimerange:"missingTimerange",notAbsoluteTimeShift:"notAbsoluteTimeShift",invalidDate:"invalidDate",shiftAfterTimeRange:"shiftAfterTimeRange"},W=(e,t)=>{const a=e.trim();if(null==t)return{value:U,reason:Y.missingTimerange};const s=J(a,t);if(s)return{value:U,reason:s};const{anchor:r,timestamp:n}=Q(a),o=i()(n,V,!0),l=i()(t.to).diff(i()(t.from)),u=r===$?o.add(l):o;return{value:i().duration(i()(t.to).diff(u)),reason:null}};function Q(e){const[,t,a]=e.match(j)||[];return{anchor:t,timestamp:a}}function J(e,t){const a=e.trim();if(!H(a))return Y.notAbsoluteTimeShift;const{anchor:s,timestamp:r}=Q(a),n=i()(r,V,!0);if(!n.isValid())return Y.invalidDate;if(t){const e=(0,B.qq)(t),a=i()(e.to).diff(i()(e.from));if(s===$&&n.isAfter(e.from)||n.subtract(a).isAfter(e.from))return Y.shiftAfterTimeRange}}},4825:(e,t,a)=>{"use strict";a.d(t,{l:()=>u});var s=a(5008),i=a(5964),r=a(190),n=a(8370),o=a(5536),l=a(8351);const u=({getStartDependencies:e})=>({name:"eql",type:"eql_raw_response",inputTypes:["kibana_context","null"],allowCache:!0,help:s.i18n.translate("data.search.eql.help",{defaultMessage:"Run Elasticsearch request"}),args:{query:{types:["string"],aliases:["_","q","query"],help:s.i18n.translate("data.search.eql.q.help",{defaultMessage:"Query DSL"}),required:!0},index:{types:["string"],help:s.i18n.translate("data.search.eql.index.help",{defaultMessage:"ElasticSearch index to query"}),required:!0},size:{types:["number"],help:s.i18n.translate("data.search.eql.size.help",{defaultMessage:"ElasticSearch searchAPI size parameter"}),default:10},field:{types:["string"],help:s.i18n.translate("data.search.eql.field.help",{defaultMessage:"List of fields to retrieve"}),multi:!0,required:!1}},async fn(t,a,{inspectorAdapters:u,abortSignal:d,getKibanaRequest:c}){const{search:g,uiSettingsClient:h,dataViews:p}=await e(c),f={query:a.query,size:a.size,fields:a.field};if(t){const e=a.index?await p.create({title:a.index}):void 0,s=(0,l.F)(h),r=(0,i.buildEsQuery)(e,t.query||[],t.filters||[],s);f.filter=r}u.requests||(u.requests=new n.RequestAdapter);const m=u.requests.start(s.i18n.translate("data.search.dataRequest.title",{defaultMessage:"Data"}),{description:s.i18n.translate("data.search.es_search.dataRequest.description",{defaultMessage:"This request queries Elasticsearch to fetch the data for the visualization."})});m.stats({indexPattern:{label:s.i18n.translate("data.search.es_search.dataViewLabel",{defaultMessage:"Data view"}),value:a.index,description:s.i18n.translate("data.search.es_search.indexPatternDescription",{defaultMessage:"The data view that connected to the Elasticsearch indices."})}});try{const e=await(0,r.lastValueFrom)(g({params:{...f,index:a.index}},{abortSignal:d,strategy:o.ky9})),t={};return m.stats(t).ok({json:e}),m.json(f),{type:"eql_raw_response",body:e.rawResponse}}catch(e){throw m.error({json:"attributes"in e?e.attributes:{message:e.message}}),e}}})},8700:(e,t,a)=>{"use strict";a.d(t,{u:()=>l});var s=a(5008),i=a(5964),r=a(190),n=a(8370),o=a(8351);const l=({getStartDependencies:e})=>({name:"esdsl",type:"es_raw_response",inputTypes:["kibana_context","null"],allowCache:!0,help:s.i18n.translate("data.search.esdsl.help",{defaultMessage:"Run Elasticsearch request"}),args:{dsl:{types:["string"],aliases:["_","q","query"],help:s.i18n.translate("data.search.esdsl.q.help",{defaultMessage:"Query DSL"}),required:!0},index:{types:["string"],help:s.i18n.translate("data.search.esdsl.index.help",{defaultMessage:"ElasticSearch index to query"}),required:!0},size:{types:["number"],help:s.i18n.translate("data.search.esdsl.size.help",{defaultMessage:"ElasticSearch searchAPI size parameter"}),default:10}},async fn(t,a,{inspectorAdapters:l,abortSignal:u,getKibanaRequest:d}){const{search:c,uiSettingsClient:g}=await e(d),h=JSON.parse(a.dsl);if(t){const e=(0,o.F)(g),a=(0,i.buildEsQuery)(void 0,t.query||[],t.filters||[],e);h.query&&a.bool.must.push(h.query),h.query=a}l.requests||(l.requests=new n.RequestAdapter);const p=l.requests.start(s.i18n.translate("data.search.dataRequest.title",{defaultMessage:"Data"}),{description:s.i18n.translate("data.search.es_search.dataRequest.description",{defaultMessage:"This request queries Elasticsearch to fetch the data for the visualization."})});p.stats({indexPattern:{label:s.i18n.translate("data.search.es_search.dataViewLabel",{defaultMessage:"Data view"}),value:a.index,description:s.i18n.translate("data.search.es_search.indexPatternDescription",{defaultMessage:"The data view that connected to the Elasticsearch indices."})}});try{const{rawResponse:e,requestParams:t}=await(0,r.lastValueFrom)(c({params:{index:a.index,size:a.size,...h}},{abortSignal:u})),i={};return null!=e&&e.took&&(i.queryTime={label:s.i18n.translate("data.search.es_search.queryTimeLabel",{defaultMessage:"Query time"}),value:s.i18n.translate("data.search.es_search.queryTimeValue",{defaultMessage:"{queryTime}ms",values:{queryTime:e.took}}),description:s.i18n.translate("data.search.es_search.queryTimeDescription",{defaultMessage:"The time it took to process the query. Does not include the time to send the request or parse it in the browser."})}),null!=e&&e.hits&&(i.hitsTotal={label:s.i18n.translate("data.search.es_search.hitsTotalLabel",{defaultMessage:"Hits (total)"}),value:`${e.hits.total}`,description:s.i18n.translate("data.search.es_search.hitsTotalDescription",{defaultMessage:"The number of documents that match the query."})},i.hits={label:s.i18n.translate("data.search.es_search.hitsLabel",{defaultMessage:"Hits"}),value:`${e.hits.hits.length}`,description:s.i18n.translate("data.search.es_search.hitsDescription",{defaultMessage:"The number of documents returned by the query."})}),p.stats(i).ok({json:e,requestParams:t}),p.json(h),{type:"es_raw_response",body:e}}catch(e){throw p.error({json:"attributes"in e?e.attributes:{message:e.message}}),e}}})},206:(e,t,a)=>{"use strict";a.d(t,{y:()=>v});var s=a(3313),i=a(5008),r=a(8370),n=a(6494),o=a.n(n),l=a(190);var u=a(1991);let d=function(e){return e.TIME_LITERAL="time_literal",e.FIELDS="fields",e.VALUES="values",e.FUNCTIONS="functions",e}({});const c=e=>{const{root:t}=(0,u.parse)(e);return u.Walker.params(t).map((e=>e.text.replace(/^\?+/,"")))},g=(e,t)=>{const a=c(e);if(!a.length)return e;const s=null==t?void 0:t.filter((e=>a.includes(e.key)&&(e.type===d.FIELDS||e.type===d.FUNCTIONS)));return null!=s&&s.length?(s.forEach((t=>{const a=new RegExp(`(?<!\\?)\\?${t.key}`);e=e.replace(a,`??${t.key}`)})),e):e};var h=a(770),p=a(5964),f=a(8351),m=a(1373),y=a(5536);function b(e){return["type","reason"].every((t=>t in e))?e:"error"in e?b(e.error):{}}const v=({getStartDependencies:e})=>({name:"esql",type:"datatable",inputTypes:["kibana_context","null"],help:i.i18n.translate("data.search.esql.help",{defaultMessage:"Queries Elasticsearch using ES|QL."}),args:{query:{aliases:["_","q"],types:["string"],help:i.i18n.translate("data.search.esql.query.help",{defaultMessage:"An ES|QL query."})},timeField:{aliases:["timeField"],types:["string"],help:i.i18n.translate("data.search.essql.timeField.help",{defaultMessage:"The time field to use in the time range filter set in the context."})},locale:{aliases:["locale"],types:["string"],help:i.i18n.translate("data.search.essql.locale.help",{defaultMessage:"The locale to use."})},titleForInspector:{aliases:["titleForInspector"],types:["string"],help:i.i18n.translate("data.search.esql.titleForInspector.help",{defaultMessage:"The title to show in Inspector."})},descriptionForInspector:{aliases:["descriptionForInspector"],types:["string"],help:i.i18n.translate("data.search.esql.descriptionForInspector.help",{defaultMessage:"The description to show in Inspector."})},ignoreGlobalFilters:{types:["boolean"],default:!1,help:i.i18n.translate("data.search.esql.ignoreGlobalFilters.help",{defaultMessage:"Whether to ignore or use global query and filters"})}},allowCache:{withSideEffects:(e,{inspectorAdapters:t})=>(0,y.nDt)(t)},fn:(t,{query:a,timeField:n,locale:d,titleForInspector:v,descriptionForInspector:S,ignoreGlobalFilters:_},{abortSignal:T,inspectorAdapters:E,getKibanaRequest:M,getSearchSessionId:F})=>(0,l.defer)((()=>e((()=>{const e=null==M?void 0:M();if(!e)throw new Error("A KibanaRequest is required to run queries on the server. Please provide a request object to the expression execution params.");return e})))).pipe((0,l.switchMap)((({search:e,uiSettings:s})=>{var u;const c=g(a,null!==(u=null==t?void 0:t.esqlVariables)&&void 0!==u?u:[]),h={query:c,locale:d,include_execution_metadata:!0};if(t){var M;const e=(0,f.F)(s),a=((e,t,a)=>{const s=((e,t)=>{const a=/\?_tstart/i.test(e),s=/\?_tend/i.test(e);if(t&&(a||s)){var i,r;const e={start:a?null===(i=o().parse(t.from))||void 0===i?void 0:i.toISOString():void 0,end:s?null===(r=o().parse(t.to,{roundUp:!0}))||void 0===r?void 0:r.toISOString():void 0},n=[];return null!=e&&e.start&&n.push({_tstart:e.start}),null!=e&&e.end&&n.push({_tend:e.end}),n}return[]})(e,t);return null!=a&&a.length&&(null==a||a.forEach((({key:e,value:t})=>{s.push({[e]:t})}))),s})(c,t.timeRange,t.esqlVariables);a.length&&(h.params=a);const i=t.timeRange&&(0,m.WB)(void 0,t.timeRange,{fieldName:n}),r=window.ELASTIC_ESQL_DELAY_SECONDS?{meta:{},query:{error_query:{indices:[{name:"*",error_type:"warning",stall_time_seconds:window.ELASTIC_ESQL_DELAY_SECONDS}]}}}:void 0,l=[..._?[]:null!==(M=t.filters)&&void 0!==M?M:[],...i?[i]:[],...r?[r]:[]];h.filter=(0,p.buildEsQuery)(void 0,t.query||[],l,e)}let A=Date.now();const I=()=>{E.requests||(E.requests=new r.RequestAdapter);const e=E.requests.start(null!=v?v:i.i18n.translate("data.search.dataRequest.title",{defaultMessage:"Data"}),{description:null!=S?S:i.i18n.translate("data.search.es_search.dataRequest.description",{defaultMessage:"This request queries Elasticsearch to fetch the data for the visualization."})},A);return A=Date.now(),e};return e({params:{...h,dropNullColumns:!0}},{abortSignal:T,strategy:y.mid,sessionId:F()}).pipe((0,l.catchError)((e=>{if(e.attributes){const{type:t,reason:a}=b(e.attributes);e.message="parsing_exception"===t?`Couldn't parse Elasticsearch ES|QL query. Check your query and try again. Error: ${a}`:`Unexpected error from Elasticsearch: ${t} - ${a}`}else e.message=`Unexpected error from Elasticsearch: ${e.message}`;return(0,l.throwError)((()=>e))})),(0,l.tap)({next(e){if((0,y.vQj)(e))return;const{rawResponse:t,requestParams:a}=e;I().stats({hits:{label:i.i18n.translate("data.search.es_search.hitsLabel",{defaultMessage:"Hits"}),value:`${t.values.length}`,description:i.i18n.translate("data.search.es_search.hitsDescription",{defaultMessage:"The number of documents returned by the query."})},...(null==t?void 0:t.took)&&{queryTime:{label:i.i18n.translate("data.search.es_search.queryTimeLabel",{defaultMessage:"Query time"}),value:i.i18n.translate("data.search.es_search.queryTimeValue",{defaultMessage:"{queryTime}ms",values:{queryTime:t.took}}),description:i.i18n.translate("data.search.es_search.queryTimeDescription",{defaultMessage:"The time it took to process the query. Does not include the time to send the request or parse it in the browser."})}}}).json(h).ok({json:{rawResponse:t},requestParams:a})},error(e){I().json(h).error({json:"attributes"in e?e.attributes:{message:e.message}})}}))})),(0,l.map)((({rawResponse:e,warning:i})=>{var r,n,l,d,p,f,m,b,v;const S=e.all_columns&&(null===(r=e.all_columns)||void 0===r?void 0:r.length)>e.columns.length,_=new Set(S&&(null===(n=e.columns)||void 0===n?void 0:n.map((({name:e})=>e)))||[]),T=function(e){var t;const{ast:a}=(0,u.parse)(e),s=a.find((({name:e})=>["from","ts"].includes(e))),i=(null!==(t=null==s?void 0:s.args)&&void 0!==t?t:[]).filter((e=>"index"===e.sourceType));return null==i?void 0:i.map((e=>e.name)).join(",")}(a),E=null!=t&&t.timeRange?{from:null===(l=o().parse(t.timeRange.from))||void 0===l?void 0:l.toISOString(),to:null===(d=o().parse(t.timeRange.to,{roundUp:!0}))||void 0===d?void 0:d.toISOString()}:void 0,M=null!==(p=null===(f=null!==(m=e.all_columns)&&void 0!==m?m:e.columns)||void 0===f?void 0:f.map((({name:e,type:t,original_types:a})=>{const i="unsupported"===t&&(null!=a?a:[]).length>1?s.fM.CONFLICT:(0,s.s0)(t);return{id:e,name:e,meta:{type:i,esType:t,sourceParams:"date"===t?{appliedTimeRange:E,params:{},indexPattern:T,sourceField:e}:{indexPattern:T,sourceField:e},params:{id:i}},isNull:!!S&&!_.has(e)}})))&&void 0!==p?p:[],F=((e,t,a)=>{if(!t.length)return a;const s=c(e),i=new Set(s);return a.map((e=>{if(t.some((t=>t.value===e.id))){var a;const s=t.filter((t=>t.value===e.id)),r=s.find((e=>i.has(e.key)));e.variable=null!==(a=null==r?void 0:r.key)&&void 0!==a?a:""}})),a})(g(a,null!==(b=null==t?void 0:t.esqlVariables)&&void 0!==b?b:[]),null!==(v=null==t?void 0:t.esqlVariables)&&void 0!==v?v:[],M);S&&F.sort(((e,t)=>Number(e.isNull)-Number(t.isNull)));const A=null==F?void 0:F.map((({name:e})=>e)),I=e.values.map((e=>(0,h.zipObject)(A,e)));return{type:"datatable",meta:{type:y.AV0,query:a,statistics:{totalCount:e.values.length}},columns:F,rows:I,warning:i}})))})},8686:(e,t,a)=>{"use strict";a.r(t),a.d(t,{adaptToExpressionValueFilter:()=>z,aggregateQueryToAst:()=>k,cidrFunction:()=>i,cidrToAst:()=>n,dateRangeFunction:()=>o,dateRangeToAst:()=>l,eqlRawResponse:()=>ie,esRawResponse:()=>ae,existsFilterFunction:()=>H,extendedBoundsFunction:()=>d,extendedBoundsToAst:()=>c,fieldFunction:()=>$,filtersToAst:()=>X,functionWrapper:()=>B,geoBoundingBoxFunction:()=>g,geoBoundingBoxToAst:()=>f,geoPointFunction:()=>m,geoPointToAst:()=>h,getEqlFn:()=>ne.l,getEsaggsMeta:()=>O,getEsdslFn:()=>re.u,getEsqlFn:()=>oe.y,getSideEffectFunction:()=>U,handleEsaggsRequest:()=>D,ipPrefixFunction:()=>y,ipPrefixToAst:()=>b,ipRangeFunction:()=>v,ipRangeToAst:()=>S,kibana:()=>T,kibanaFilterFunction:()=>J,kibanaTimerangeFunction:()=>Z,kqlFunction:()=>E,luceneFunction:()=>M,numericalRangeFunction:()=>F,numericalRangeToAst:()=>A,phraseFilterFunction:()=>K,queryFilterFunction:()=>I,queryFilterToAst:()=>x,queryToAst:()=>w,rangeFilterFunction:()=>Y,rangeFunction:()=>G,removeFilterFunction:()=>W,selectFilterFunction:()=>Q,timerangeToAst:()=>R});var s=a(5008);const i={name:"cidr",type:"cidr",inputTypes:["null"],help:s.i18n.translate("data.search.functions.cidr.help",{defaultMessage:"Create a CIDR-based range"}),args:{mask:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.cidr.cidr.help",{defaultMessage:"Specify the CIDR block"})}},fn:(e,{mask:t})=>({mask:t,type:"cidr"})};var r=a(7876);const n=e=>(0,r.buildExpression)([(0,r.buildExpressionFunction)("cidr",e)]).toAst(),o={name:"dateRange",type:"date_range",inputTypes:["null"],help:s.i18n.translate("data.search.functions.dateRange.help",{defaultMessage:"Create a date range"}),args:{from:{types:["number","string"],help:s.i18n.translate("data.search.functions.dateRange.from.help",{defaultMessage:"Specify the starting date"})},to:{types:["number","string"],help:s.i18n.translate("data.search.functions.dateRange.to.help",{defaultMessage:"Specify the ending date"})}},fn:(e,{from:t,to:a})=>({from:t,to:a,type:"date_range"})},l=e=>(0,r.buildExpression)([(0,r.buildExpressionFunction)("dateRange",e)]).toAst();var u=a(770);const d={name:"extendedBounds",type:"extended_bounds",inputTypes:["null"],help:s.i18n.translate("data.search.functions.extendedBounds.help",{defaultMessage:"Create extended bounds"}),args:{min:{types:["number"],help:s.i18n.translate("data.search.functions.extendedBounds.min.help",{defaultMessage:"Specify the lower boundary value"})},max:{types:["number"],help:s.i18n.translate("data.search.functions.extendedBounds.max.help",{defaultMessage:"Specify the upper boundary value"})}},fn:(e,{min:t,max:a})=>({type:"extended_bounds",...(0,u.omitBy)({min:t,max:a},u.isNil)})},c=e=>(0,r.buildExpression)([(0,r.buildExpressionFunction)("extendedBounds",e)]).toAst(),g={name:"geoBoundingBox",type:"geo_bounding_box",inputTypes:["null"],help:s.i18n.translate("data.search.functions.geoBoundingBox.help",{defaultMessage:"Create a geo bounding box"}),args:{top:{types:["number"],help:s.i18n.translate("data.search.functions.geoBoundingBox.top.help",{defaultMessage:"Specify the top coordinate"})},left:{types:["number"],help:s.i18n.translate("data.search.functions.geoBoundingBox.left.help",{defaultMessage:"Specify the left coordinate"})},bottom:{types:["number"],help:s.i18n.translate("data.search.functions.geoBoundingBox.bottom.help",{defaultMessage:"Specify the bottom coordinate"})},right:{types:["number"],help:s.i18n.translate("data.search.functions.geoBoundingBox.right.help",{defaultMessage:"Specify the right coordinate"})},wkt:{types:["string"],help:s.i18n.translate("data.search.functions.geoBoundingBox.wkt.help",{defaultMessage:"Specify the Well-Known Text (WKT)"})},topLeft:{types:["geo_point"],help:s.i18n.translate("data.search.functions.geoBoundingBox.top_left.help",{defaultMessage:"Specify the top left corner"})},bottomRight:{types:["geo_point"],help:s.i18n.translate("data.search.functions.geoBoundingBox.bottom_right.help",{defaultMessage:"Specify the bottom right corner"})},topRight:{types:["geo_point"],help:s.i18n.translate("data.search.functions.geoBoundingBox.top_right.help",{defaultMessage:"Specify the top right corner"})},bottomLeft:{types:["geo_point"],help:s.i18n.translate("data.search.functions.geoBoundingBox.bottom_left.help",{defaultMessage:"Specify the bottom left corner"})}},fn(e,t){if(null!=(null==(a=t)?void 0:a.wkt))return{...(0,u.pick)(t,"wkt"),type:"geo_bounding_box"};var a;if(function(e){return null!=(null==e?void 0:e.top)&&null!=(null==e?void 0:e.left)&&null!=(null==e?void 0:e.bottom)&&null!=(null==e?void 0:e.right)}(t))return{...(0,u.pick)(t,["top","left","bottom","right"]),type:"geo_bounding_box"};if(function(e){return null!=(null==e?void 0:e.topLeft)&&null!=(null==e?void 0:e.bottomRight)||null!=(null==e?void 0:e.topRight)&&null!=(null==e?void 0:e.bottomLeft)}(t))return{...(0,u.chain)(t).pick(["topLeft","bottomRight","topRight","bottomLeft"]).omitBy(u.isNil).mapKeys(((e,t)=>(0,u.snakeCase)(t))).mapValues((({value:e})=>e)).value(),type:"geo_bounding_box"};throw new Error(s.i18n.translate("data.search.functions.geoBoundingBox.arguments.error",{defaultMessage:"At least one of the following groups of parameters must be provided: {parameters}.",values:{parameters:[["wkt"],["top","left","bottom","right"],["topLeft","bottomRight"],["topRight","bottomLeft"]].map((e=>e.join(", "))).join("; ")}}))}},h=e=>(0,r.buildExpression)([(0,r.buildExpressionFunction)("geoPoint","object"!=typeof e||Array.isArray(e)?{point:Array.isArray(e)?e:[e]}:e)]).toAst(),p=["top_left","bottom_right","top_right","bottom_left"],f=e=>(0,r.buildExpression)([(0,r.buildExpressionFunction)("geoBoundingBox",{...(0,u.omit)(e,p),...(0,u.chain)(e).pick(p).omitBy(u.isNil).mapKeys(((e,t)=>(0,u.camelCase)(t))).mapValues((e=>h(e))).value()})]).toAst(),m={name:"geoPoint",type:"geo_point",inputTypes:["null"],help:s.i18n.translate("data.search.functions.geoPoint.help",{defaultMessage:"Create a geo point"}),args:{lat:{types:["number"],help:s.i18n.translate("data.search.functions.geoPoint.lat.help",{defaultMessage:"Specify the latitude"})},lon:{types:["number"],help:s.i18n.translate("data.search.functions.geoPoint.lon.help",{defaultMessage:"Specify the longitude"})},point:{aliases:["_"],types:["number","string"],multi:!0,help:s.i18n.translate("data.search.functions.geoPoint.point.help",{defaultMessage:"Specify the point as a string with comma-separated coordinates or as two numeric values"})}},fn(e,{lat:t,lon:a,point:i}){if(null!=t&&null!=a)return{type:"geo_point",value:{lat:t,lon:a}};if(!i)throw new Error(s.i18n.translate("data.search.functions.geoPoint.arguments.error",{defaultMessage:'Either "lat" and "lon" or "point" parameters should be specified.'}));const[r]=i;if("string"==typeof r)return{value:r,type:"geo_point"};if(2!==i.length)throw new Error(s.i18n.translate("data.search.functions.geoPoint.point.error",{defaultMessage:"The point parameter should either be a string or two numeric values."}));return{type:"geo_point",value:[...i]}}},y={name:"ipPrefix",type:"ip_prefix",inputTypes:["null"],help:s.i18n.translate("data.search.functions.ipPrefix.help",{defaultMessage:"Create an IP prefix"}),args:{prefixLength:{types:["number"],help:s.i18n.translate("data.search.functions.ipPrefix.prefixLength.help",{defaultMessage:"Specify the length of the network prefix"})},isIpv6:{types:["boolean"],help:s.i18n.translate("data.search.functions.ipPrefix.isIpv6.help",{defaultMessage:"Specify whether the prefix applies to IPv6 addresses"})}},fn:(e,{prefixLength:t,isIpv6:a})=>({type:"ip_prefix",prefixLength:t,isIpv6:a})},b=e=>(0,r.buildExpression)([(0,r.buildExpressionFunction)("ipPrefix",e)]).toAst(),v={name:"ipRange",type:"ip_range",inputTypes:["null"],help:s.i18n.translate("data.search.functions.ipRange.help",{defaultMessage:"Create an IP range"}),args:{from:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.ipRange.from.help",{defaultMessage:"Specify the starting address"})},to:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.ipRange.to.help",{defaultMessage:"Specify the ending address"})}},fn:(e,{from:t,to:a})=>({from:t,to:a,type:"ip_range"})},S=e=>(0,r.buildExpression)([(0,r.buildExpressionFunction)("ipRange",e)]).toAst(),_=e=>e?Array.isArray(e)?e:[e]:[],T={name:"kibana",type:"kibana_context",inputTypes:["kibana_context","null"],help:s.i18n.translate("data.search.functions.kibana.help",{defaultMessage:"Gets kibana global context"}),args:{},fn(e,t,{getSearchContext:a}){var s;return{...e,type:"kibana_context",now:null!==(s=a().now)&&void 0!==s?s:Date.now(),query:[..._(a().query),..._((e||{}).query)],filters:[...a().filters||[],...(e||{}).filters||[]],timeRange:a().timeRange||(e?e.timeRange:void 0),esqlVariables:a().esqlVariables||(e?e.esqlVariables:void 0)}}},E={name:"kql",type:"kibana_query",inputTypes:["null"],help:s.i18n.translate("data.search.functions.kql.help",{defaultMessage:"Create kibana kql query"}),args:{q:{types:["string"],required:!0,aliases:["query","_"],help:s.i18n.translate("data.search.functions.kql.q.help",{defaultMessage:"Specify Kibana KQL free form text query"})}},fn:(e,t)=>({type:"kibana_query",language:"kuery",query:t.q})},M={name:"lucene",type:"kibana_query",inputTypes:["null"],help:s.i18n.translate("data.search.functions.lucene.help",{defaultMessage:"Create kibana lucene query"}),args:{q:{types:["string"],required:!0,aliases:["query","_"],help:s.i18n.translate("data.search.functions.lucene.q.help",{defaultMessage:"Specify Lucene free form text query"})}},fn:(e,t)=>({type:"kibana_query",language:"lucene",query:JSON.parse(t.q)})},F={name:"numericalRange",type:"numerical_range",inputTypes:["null"],help:s.i18n.translate("data.search.functions.numericalRange.help",{defaultMessage:"Create a numerical range"}),args:{from:{types:["number"],help:s.i18n.translate("data.search.functions.numericalRange.from.help",{defaultMessage:"Specify the starting value"})},to:{types:["number"],help:s.i18n.translate("data.search.functions.numericalRange.to.help",{defaultMessage:"Specify the ending value"})},label:{types:["string"],help:s.i18n.translate("data.search.functions.numericalRange.label.help",{defaultMessage:"Specify the range label"})}},fn:(e,{from:t,to:a,label:s})=>({type:"numerical_range",...(0,u.omitBy)({from:t,to:a,label:s},u.isNil)})},A=e=>(0,r.buildExpression)([(0,r.buildExpressionFunction)("numericalRange",e)]).toAst(),I={name:"queryFilter",type:"kibana_query_filter",inputTypes:["null"],help:s.i18n.translate("data.search.functions.queryFilter.help",{defaultMessage:"Create a query filter"}),args:{input:{types:["kibana_query"],aliases:["_"],required:!0,help:s.i18n.translate("data.search.functions.queryFilter.input.help",{defaultMessage:"Specify the query filter"})},label:{types:["string"],help:s.i18n.translate("data.search.functions.queryFilter.label.help",{defaultMessage:"Specify the filter label"})}},fn:(e,{input:t,label:a})=>({type:"kibana_query_filter",input:(0,u.omit)(t,"type"),...(0,u.omitBy)({label:a},u.isNil)})},w=e=>"kuery"===e.language?(0,r.buildExpression)([(0,r.buildExpressionFunction)("kql",{q:e.query})]).toAst():(0,r.buildExpression)([(0,r.buildExpressionFunction)("lucene",{q:JSON.stringify(e.query)})]).toAst(),x=({input:e,label:t})=>(0,r.buildExpression)([(0,r.buildExpressionFunction)("queryFilter",{label:t,input:w(e)})]).toAst(),k=({query:e,timeField:t,titleForInspector:a,descriptionForInspector:i})=>(0,r.buildExpressionFunction)("esql",{query:e.esql,timeField:t,locale:s.i18n.getLocale(),titleForInspector:a,descriptionForInspector:i}).toAst(),R=e=>(0,r.buildExpression)([(0,r.buildExpressionFunction)("timerange",e)]).toAst();var N=a(7451),C=a(190),L=a(4177),P=a(9235);const D=({abortSignal:e,aggs:t,filters:a,indexPattern:i,inspectorAdapters:r,query:n,searchSessionId:o,searchSourceService:l,timeFields:u,timeRange:d,disableWarningToasts:c,getNow:g,executionContext:h,title:p,description:f})=>(0,C.defer)((async()=>{var e;const s=null==g?void 0:g(),r=await l.create();r.setField("index",i),r.setField("size",0);const o=r.createChild({callParentStartHandlers:!0}),c=o.createChild({callParentStartHandlers:!0}),h=null==i||null===(e=i.getTimeField)||void 0===e?void 0:e.call(i),p=h?[h.name]:[],f=null!=u&&u.length?u:p;return t.setTimeRange(d),t.setForceNow(s),t.setTimeFields(f),Object.defineProperty(c,"history",{get:()=>r.history,set:e=>r.history=e}),c.setField("aggs",t),c.onRequestStart(((e,a)=>t.onSearchRequestStart(e,a))),d&&f.length>0&&o.setField("filter",(()=>t.getSearchSourceTimeFilter(s))),c.setField("filter",a),c.setField("query",n),{allTimeFields:f,forceNow:s,requestSearchSource:c}})).pipe((0,C.switchMap)((({allTimeFields:a,forceNow:i,requestSearchSource:n})=>n.fetch$({abortSignal:e,disableWarningToasts:c,sessionId:o,inspector:{adapter:r.requests,title:null!=p?p:s.i18n.translate("data.functions.esaggs.inspector.dataRequest.title",{defaultMessage:"Data"}),description:null!=f?f:s.i18n.translate("data.functions.esaggs.inspector.dataRequest.description",{defaultMessage:"This request queries Elasticsearch to fetch the data for the visualization."})},executionContext:h}).pipe((0,C.map)((({rawResponse:e})=>{const s=d?(0,L.calculateBounds)(d,{forceNow:i}):null,r={metricsAtAllLevels:t.hierarchical,partialRows:t.partialRows,timeRange:s?{from:s.min,to:s.max,timeFields:a}:void 0};return(0,P.AX)(t,e,r)})))))),O=()=>({name:"esaggs",type:"datatable",inputTypes:["kibana_context","null"],help:s.i18n.translate("data.functions.esaggs.help",{defaultMessage:"Run AggConfig aggregation"}),args:{index:{types:["index_pattern"],required:!0,help:s.i18n.translate("data.search.functions.esaggs.index.help",{defaultMessage:"Data view retrieved with indexPatternLoad"})},aggs:{types:["agg_type"],multi:!0,default:`{${(0,r.buildExpressionFunction)(N.OL7,{}).toString()}}`,help:s.i18n.translate("data.search.functions.esaggs.aggConfigs.help",{defaultMessage:"List of aggs configured with agg_type functions"})},metricsAtAllLevels:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.esaggs.metricsAtAllLevels.help",{defaultMessage:"Whether to include columns with metrics for each bucket level"})},partialRows:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.esaggs.partialRows.help",{defaultMessage:"Whether to return rows that only contain partial data"})},timeFields:{types:["string"],multi:!0,help:s.i18n.translate("data.search.functions.esaggs.timeFields.help",{defaultMessage:"Provide time fields to get the resolved time ranges for the query"})},probability:{types:["number"],default:1,help:s.i18n.translate("data.search.functions.esaggs.probability.help",{defaultMessage:"The probability that a document will be included in the aggregated data. Uses random sampler."})},samplerSeed:{types:["number"],help:s.i18n.translate("data.search.functions.esaggs.samplerSeed.help",{defaultMessage:"The seed to generate the random sampling of documents. Uses random sampler."})},ignoreGlobalFilters:{types:["boolean"],help:s.i18n.translate("data.search.functions.esaggs.ignoreGlobalFilters.help",{defaultMessage:"Whether to ignore or use global query and filters"})}}}),B=e=>{const t=(0,u.mapValues)(e.args,(e=>e.default));return(a,s={},i={})=>e.fn(a,{...t,...s},i)};function q(e){const{meta:t}=e,{group:a}=null!=t?t:{};return a}const j={range:function(e){var t;const{query:a}=e,{range:s}=null!=a?a:{},i=Object.keys(s)[0],{gte:r,lte:n}=null!==(t=s[i])&&void 0!==t?t:{};return{filterGroup:q(e),from:r,to:n,column:i,type:"filter",filterType:"time",and:[]}},term:function(e){var t;const{query:a}=e,{term:s}=null!=a?a:{},i=Object.keys(s)[0],{value:r}=null!==(t=s[i])&&void 0!==t?t:{};return{filterGroup:q(e),column:i,value:r,type:"filter",filterType:"exactly",and:[]}},luceneQueryString:function(e){const{query:t}=e,{query_string:a}=null!=t?t:{},{query:s}=a;return{filterGroup:q(e),query:s,type:"filter",filterType:"luceneQueryString",and:[]}}};function z(e){const{query:t={}}=e,a=Object.keys(t)[0],s=j[a];if(!s||"function"!=typeof s)throw new Error(`Unknown filter type: ${a}`);return s(e)}const U=e=>{const t=(e=>{var t;return null===(t=e.requests)||void 0===t?void 0:t.getRequestEntries()})(e);return()=>{var a;if(!t||0===t.length)return;const s=new Map(t.map((([e])=>[e.id,e]))),i=new WeakMap(t);null===(a=e.requests)||void 0===a||a.loadFromEntries(s,i)}},G={name:"range",type:"kibana_range",inputTypes:["null"],help:s.i18n.translate("data.search.functions.range.help",{defaultMessage:"Create kibana range filter"}),args:{gt:{types:["string","number"],help:s.i18n.translate("data.search.functions.range.gt.help",{defaultMessage:"Greater than"})},lt:{types:["string","number"],help:s.i18n.translate("data.search.functions.range.lt.help",{defaultMessage:"Less than"})},gte:{types:["string","number"],help:s.i18n.translate("data.search.functions.range.gte.help",{defaultMessage:"Greater or equal than"})},lte:{types:["string","number"],help:s.i18n.translate("data.search.functions.range.lte.help",{defaultMessage:"Less or equal than"})}},fn(e,t){if(void 0===t.lt&&void 0===t.lte)throw new Error("lt or lte must be provided");if(void 0===t.gt&&void 0===t.gte)throw new Error("gt or gte must be provided");return{type:"kibana_range",...t}}},$={name:"field",type:"kibana_field",inputTypes:["null"],help:s.i18n.translate("data.search.functions.field.help",{defaultMessage:"Create a Kibana field."}),args:{name:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.field.name.help",{defaultMessage:"Name of the field"})},type:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.field.type.help",{defaultMessage:"Type of the field"})},script:{types:["string"],help:s.i18n.translate("data.search.functions.field.script.help",{defaultMessage:"A field script, in case the field is scripted."})}},fn:(e,t)=>({type:"kibana_field",spec:{name:t.name,type:t.type,scripted:!!t.script,script:t.script}})};var V=a(5964);const K={name:"phraseFilter",type:"kibana_filter",inputTypes:["null"],help:s.i18n.translate("data.search.functions.phraseFilter.help",{defaultMessage:"Create kibana phrase or phrases filter"}),args:{field:{types:["kibana_field"],required:!0,help:s.i18n.translate("data.search.functions.phraseFilter.field.help",{defaultMessage:"Specify the field you want to filter on. Use `field` function."})},phrase:{types:["string"],multi:!0,required:!0,help:s.i18n.translate("data.search.functions.phraseFilter.phrase.help",{defaultMessage:"Specify the phrases"})},negate:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.phraseFilter.negate.help",{defaultMessage:"Should the filter be negated"})}},fn:(e,t)=>1===t.phrase.length?{type:"kibana_filter",...(0,V.buildFilter)({},t.field.spec,V.FILTERS.PHRASE,t.negate||!1,!1,t.phrase[0],null)}:{type:"kibana_filter",...(0,V.buildFilter)({},t.field.spec,V.FILTERS.PHRASES,t.negate||!1,!1,t.phrase,null)}},H={name:"existsFilter",type:"kibana_filter",inputTypes:["null"],help:s.i18n.translate("data.search.functions.existsFilter.help",{defaultMessage:"Create kibana exists filter"}),args:{field:{types:["kibana_field"],required:!0,help:s.i18n.translate("data.search.functions.existsFilter.field.help",{defaultMessage:"Specify the field you want to filter on. Use `field` function."})},negate:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.existsFilter.negate.help",{defaultMessage:"Should the filter be negated."})}},fn:(e,t)=>({type:"kibana_filter",...(0,V.buildFilter)({},t.field.spec,V.FILTERS.EXISTS,t.negate||!1,!1,{},null)})},Y={name:"rangeFilter",type:"kibana_filter",inputTypes:["null"],help:s.i18n.translate("data.search.functions.rangeFilter.help",{defaultMessage:"Create kibana range filter"}),args:{field:{types:["kibana_field"],required:!0,help:s.i18n.translate("data.search.functions.rangeFilter.field.help",{defaultMessage:"Specify the field you want to filter on. Use `field` function."})},range:{types:["kibana_range"],required:!0,help:s.i18n.translate("data.search.functions.rangeFilter.range.help",{defaultMessage:"Specify the range, use `range` function."})},negate:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.rangeFilter.negate.help",{defaultMessage:"Should the filter be negated"})}},fn:(e,t)=>({type:"kibana_filter",...(0,V.buildFilter)({},t.field.spec,V.FILTERS.RANGE,t.negate||!1,!1,{from:t.range.gt||t.range.gte,to:t.range.lt||t.range.lte},null)})},W={name:"removeFilter",type:"kibana_context",inputTypes:["kibana_context"],help:s.i18n.translate("data.search.functions.removeFilter.help",{defaultMessage:"Removes filters from context"}),args:{group:{types:["string"],aliases:["_"],help:s.i18n.translate("data.search.functions.removeFilter.group.help",{defaultMessage:"Removes only filters belonging to the provided group"})},from:{types:["string"],help:s.i18n.translate("data.search.functions.removeFilter.from.help",{defaultMessage:"Removes only filters owned by the provided id"})},ungrouped:{types:["boolean"],aliases:["nogroup","nogroups"],default:!1,help:s.i18n.translate("data.search.functions.removeFilter.ungrouped.help",{defaultMessage:"Should filters without group be removed"})}},fn(e,{group:t,from:a,ungrouped:s}){var i;return{...e,filters:(null===(i=e.filters)||void 0===i?void 0:i.filter((({meta:e})=>{const i=!t&&!s||t===e.group||s&&!e.group,r=!a||a===e.controlledBy;return!i||!r})))||[]}}},Q={name:"selectFilter",type:"kibana_context",inputTypes:["kibana_context"],help:s.i18n.translate("data.search.functions.selectFilter.help",{defaultMessage:"Selects filters from context"}),args:{group:{types:["string"],aliases:["_"],help:s.i18n.translate("data.search.functions.selectFilter.group.help",{defaultMessage:"Select only filters belonging to the provided group"}),multi:!0},from:{types:["string"],help:s.i18n.translate("data.search.functions.selectFilter.from.help",{defaultMessage:"Select only filters owned by the provided id"})},ungrouped:{types:["boolean"],aliases:["nogroup","nogroups"],default:!1,help:s.i18n.translate("data.search.functions.selectFilter.ungrouped.help",{defaultMessage:"Should filters without group be included"})}},fn(e,{group:t=[],ungrouped:a,from:s}){var i;return{...e,filters:(null===(i=e.filters)||void 0===i?void 0:i.filter((({meta:e})=>{const i=!t.length&&!a||e.group&&t.length&&t.includes(e.group)||a&&!e.group,r=!s||s===e.controlledBy;return i&&r})))||[]}}},J={name:"kibanaFilter",type:"kibana_filter",inputTypes:["null"],help:s.i18n.translate("data.search.functions.kibanaFilter.help",{defaultMessage:"Create kibana filter"}),args:{query:{types:["string"],aliases:["q","_"],required:!0,help:s.i18n.translate("data.search.functions.kibanaFilter.field.help",{defaultMessage:"Specify free form esdsl query"})},negate:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.kibanaFilter.negate.help",{defaultMessage:"Should the filter be negated"})},disabled:{types:["boolean"],default:!1,help:s.i18n.translate("data.search.functions.kibanaFilter.disabled.help",{defaultMessage:"Should the filter be disabled"})}},fn:(e,t)=>({type:"kibana_filter",meta:{negate:t.negate||!1,alias:"",disabled:t.disabled||!1},query:JSON.parse(t.query)})},X=e=>(Array.isArray(e)?e:[e]).map((e=>{const t=e.meta.type===V.FILTERS.COMBINED?(0,V.fromCombinedFilter)(e):e,{meta:a,$state:s,query:i,...n}=t;return(0,r.buildExpression)([(0,r.buildExpressionFunction)("kibanaFilter",{query:JSON.stringify(i||n),negate:a.negate,disabled:a.disabled})]).toAst()})),Z={name:"timerange",type:"timerange",inputTypes:["null"],help:s.i18n.translate("data.search.functions.timerange.help",{defaultMessage:"Create kibana timerange"}),args:{from:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.timerange.from.help",{defaultMessage:"Specify the start date"})},to:{types:["string"],required:!0,help:s.i18n.translate("data.search.functions.timerange.to.help",{defaultMessage:"Specify the end date"})},mode:{types:["string"],options:["absolute","relative"],help:s.i18n.translate("data.search.functions.timerange.mode.help",{defaultMessage:"Specify the mode (absolute or relative)"})}},fn:(e,t)=>({type:"timerange",from:t.from,to:t.to,mode:t.mode})};function ee(e,t=""){let a={};const s=[],i=t?t+".":"";return Object.keys(e).forEach((t=>{if(Array.isArray(e[t]))s.push(...e[t].map((e=>ee(e,i+t))).reduce(((e,t)=>(e.push(...t),e)),[]));else if("object"==typeof e[t]&&null!==e[t]){const r=ee(e[t],i+t);1===r.length?a={...a,...r[0]}:s.push(...r)}else a[i+t]=e[t]})),0===s.length?[a]:s.map((e=>({...e,...a})))}const te=e=>e.aggregations?ee(e.aggregations):e.hits.hits.map((e=>e.fields||e._source)).filter((e=>e)),ae={name:"es_raw_response",to:{datatable:e=>{var t;const a=te(e.body),s=a.length?Object.keys(a[0]).map((e=>({id:e,name:e,meta:{type:typeof a[0][e],field:e,params:{}}}))):[];return{type:"datatable",meta:{type:"esdsl",source:"*",statistics:{totalCount:"number"==typeof e.body.hits.total?e.body.hits.total:null===(t=e.body.hits.total)||void 0===t?void 0:t.value}},columns:s,rows:a}}}},se=(e,t)=>e.map((e=>e.fields||e._source)).filter((e=>e)).map((e=>(e=>{const t=(e,a=[])=>Object.keys(e).map((s=>{if("object"!=typeof e[s]||null===e[s]||Array.isArray(e[s])){const t=[...a,s].join(".");return{[t]:e[s]}}return t(e[s],[...a,s])})).flat();return Object.assign({},...t(e))})(e))).map((e=>(t&&(e.joinKeys=t),e))),ie={name:"eql_raw_response",to:{datatable:e=>{var t;const a=(s=e.body.hits).sequences?s.sequences.flatMap((e=>se(e.events,e.join_keys))):se(s.events);var s;const i=a.length?Object.keys(a[0]).map((e=>({id:e,name:e,meta:{type:typeof a[0][e],field:e,params:{}}}))):[];return{type:"datatable",meta:{type:"eql",source:"*",statistics:{totalCount:null===(t=e.body.hits.total)||void 0===t?void 0:t.value}},columns:i,rows:a}}}};var re=a(8700),ne=a(4825),oe=a(206)},5536:(e,t,a)=>{"use strict";a.d(t,{CuU:()=>s.CuU,dg3:()=>s.dg3,qLR:()=>s.qLR,TO1:()=>s.TO1,Jnb:()=>s.Jnb,sow:()=>s.sow,QJv:()=>s.QJv,fXy:()=>s.fXy,TDc:()=>s.TDc,Lnr:()=>s.Lnr,aiG:()=>s.aiG,buk:()=>s.buk,yAE:()=>s.yAE,RNT:()=>V,ky9:()=>$,mid:()=>Y,fOT:()=>H,AV0:()=>W,kAj:()=>z,Gwp:()=>s.Gwp,O0P:()=>s.O0P,zUd:()=>s.zUd,mOS:()=>s.mOS,m8W:()=>s.m8W,Oq5:()=>s.Oq5,zmd:()=>s.zmd,dY5:()=>s.dY5,mz6:()=>s.mz6,p0N:()=>s.p0N,o8K:()=>s.o8K,At2:()=>s.At2,FYW:()=>s.FYW,e6x:()=>RequestFailure,z3F:()=>s.z3F,MXb:()=>B,VNk:()=>O,vZc:()=>s.vZc,UNd:()=>K,vdD:()=>D.v,Cyp:()=>SearchSource,zA1:()=>SearchSourceService,zmL:()=>D.z,UEL:()=>N,lug:()=>s.lug,tTJ:()=>s.tTJ,Nh9:()=>i.adaptToExpressionValueFilter,OBf:()=>s.OBf,hEG:()=>s.hEG,Efy:()=>s.Efy,lbX:()=>s.lbX,cUf:()=>s.cUf,v3f:()=>s.v3f,gdu:()=>s.gdu,Fb7:()=>s.Fb7,zAP:()=>s.zAP,e0w:()=>s.e0w,mZy:()=>s.mZy,rjA:()=>s.rjA,ZmW:()=>s.ZmW,OL7:()=>s.OL7,SsN:()=>s.SsN,PAj:()=>s.PAj,Ca8:()=>s.Ca8,vQh:()=>s.vQh,foF:()=>s.foF,C6H:()=>s.C6H,bgr:()=>s.bgr,i2N:()=>s.i2N,i5z:()=>s.i5z,TFY:()=>s.TFY,oXr:()=>s.oXr,tbp:()=>s.tbp,T1k:()=>s.T1k,om:()=>s.om,jfr:()=>s.jfr,ejh:()=>s.ejh,WVh:()=>s.WVh,dKG:()=>s.dKG,dHe:()=>s.dHe,W8J:()=>s.W8J,jsV:()=>s.jsV,qIu:()=>s.qIu,qew:()=>s.qew,Vjs:()=>s.Vjs,Du:()=>s.Du,CWM:()=>s.CWM,wB5:()=>s.wB5,Vzo:()=>s.Vzo,uC8:()=>s.uC8,jST:()=>s.jST,AJK:()=>s.AJK,rGL:()=>s.rGL,y3o:()=>s.y3o,ZO1:()=>s.ZO1,mgw:()=>s.mgw,VD$:()=>s.VD$,mXM:()=>s.mXM,Pp7:()=>s.Pp7,mU8:()=>s.mU8,tpD:()=>s.tpD,U6Y:()=>s.U6Y,jJm:()=>s.jJm,v0U:()=>s.v0U,qoF:()=>s.qoF,pMt:()=>s.pMt,ibD:()=>s.ibD,c9O:()=>s.c9O,xzq:()=>s.xzq,GFW:()=>s.GFW,tK_:()=>s.tK_,REs:()=>s.REs,si_:()=>s.si_,aw4:()=>s.aw4,HCP:()=>s.HCP,C98:()=>s.C98,nv7:()=>s.nv7,f90:()=>s.f90,AUv:()=>s.AUv,L69:()=>s.L69,mwK:()=>s.mwK,_Fq:()=>s._Fq,$Bi:()=>s.$Bi,FeO:()=>s.FeO,W3G:()=>s.W3G,Vog:()=>s.Vog,sAW:()=>s.sAW,UGU:()=>s.UGU,Rcq:()=>s.Rcq,_xq:()=>s._xq,FKr:()=>s.FKr,qZi:()=>s.qZi,NkJ:()=>s.NkJ,IQS:()=>s.IQS,zfq:()=>s.zfq,PSF:()=>i.aggregateQueryToAst,PX$:()=>s.PX$,B1X:()=>s.B1X,OI_:()=>s.OI_,u0$:()=>s.u0$,_er:()=>s._er,dtO:()=>i.cidrFunction,iJZ:()=>i.cidrToAst,N2Z:()=>s.N2Z,QyU:()=>s.QyU,kVi:()=>I,I1L:()=>s.I1L,Muh:()=>i.dateRangeFunction,lO1:()=>i.dateRangeToAst,iLg:()=>i.eqlRawResponse,uzQ:()=>i.esRawResponse,rk1:()=>i.existsFilterFunction,BUn:()=>i.extendedBoundsFunction,w1E:()=>i.extendedBoundsToAst,QDx:()=>M,rgn:()=>i.fieldFunction,tTg:()=>i.filtersToAst,Ucw:()=>L.Uc,i0A:()=>i.functionWrapper,TU9:()=>i.geoBoundingBoxFunction,y9c:()=>i.geoBoundingBoxToAst,aw$:()=>i.geoPointFunction,VNn:()=>i.geoPointToAst,F6S:()=>s.F6S,Obw:()=>s.Obw,LaZ:()=>s.LaZ,UeN:()=>s.UeN,ATn:()=>s.ATn,_h9:()=>s._h9,i23:()=>s.i23,HLz:()=>s.HLz,JKe:()=>s.JKe,Kd5:()=>s.Kd5,HAP:()=>s.HAP,YNN:()=>s.YNN,MUp:()=>s.MUp,H8h:()=>s.H8h,DqD:()=>s.DqD,qvY:()=>s.qvY,l5r:()=>i.getEqlFn,OD5:()=>S,KKF:()=>i.getEsaggsMeta,utN:()=>i.getEsdslFn,yhm:()=>i.getEsqlFn,mOK:()=>s.mOK,Bw4:()=>s.Bw4,Zy4:()=>s.Zy4,azA:()=>s.azA,nP5:()=>s.nP5,Bum:()=>s.Bum,IYs:()=>s.IYs,pSU:()=>s.pSU,aZK:()=>s.aZK,EzU:()=>s.EzU,oUU:()=>s.oUU,kY9:()=>s.kY9,Alz:()=>s.Alz,_Xw:()=>s._Xw,yyA:()=>s.yyA,aRc:()=>s.aRc,ZJo:()=>s.ZJo,XLV:()=>s.XLV,mvy:()=>s.mvy,EzV:()=>E,IH1:()=>s.IH1,c2H:()=>_,jb4:()=>s.jb4,nDt:()=>i.getSideEffectFunction,YHK:()=>s.YHK,czt:()=>s.czt,rFf:()=>s.rFf,vo0:()=>s.vo0,uSi:()=>s.uSi,JXX:()=>s.JXX,x0l:()=>s.x0l,OrF:()=>s.OrF,YhB:()=>s.YhB,cLp:()=>s.cLp,AmH:()=>U,fyU:()=>P.fy,c12:()=>s.c12,Q_w:()=>i.handleEsaggsRequest,s9S:()=>s.s9S,kiA:()=>w,WB4:()=>s.WB4,eYm:()=>i.ipPrefixFunction,dJ0:()=>i.ipPrefixToAst,rDs:()=>i.ipRangeFunction,IZ:()=>i.ipRangeToAst,E8Q:()=>P.E8,JNE:()=>s.JNE,za8:()=>s.za8,M3U:()=>s.M3U,itY:()=>s.itY,sy:()=>s.sy,qSv:()=>s.qSv,vQj:()=>P.vQ,yPl:()=>C,Ehy:()=>s.Ehy,mgc:()=>s.mgc,Xjv:()=>s.Xjv,usJ:()=>s.usJ,Cec:()=>s.Cec,L1:()=>i.kibana,JjL:()=>i.kibanaFilterFunction,JW4:()=>i.kibanaTimerangeFunction,hnj:()=>i.kqlFunction,bOY:()=>i.luceneFunction,fYb:()=>s.fYb,wcW:()=>i.numericalRangeFunction,Lpc:()=>i.numericalRangeToAst,IJq:()=>s.IJq,$Ux:()=>s.$Ux,spt:()=>s.spt,njO:()=>s.njO,P15:()=>s.P15,zqr:()=>x,vC3:()=>s.vC3,SvO:()=>i.phraseFilterFunction,YV9:()=>j,EyB:()=>s.EyB,PFs:()=>i.queryFilterFunction,sjk:()=>i.queryFilterToAst,EW1:()=>i.queryToAst,ri9:()=>m,c$p:()=>i.rangeFilterFunction,EM$:()=>i.rangeFunction,LSk:()=>i.removeFilterFunction,EQP:()=>F,XIV:()=>i.selectFilterFunction,E1R:()=>G,gJ6:()=>s.gJ6,RRC:()=>s.RRC,drh:()=>s.drh,AXn:()=>L.AX,FUj:()=>L.FU,jZz:()=>L.jZ,zQf:()=>s.zQf,_Sh:()=>i.timerangeToAst,IIR:()=>s.IIR,pa7:()=>s.pa7});var s=a(7451),i=a(8686),r=a(7674),n=a(5964),o=a(770),l=a(8915);const u=__kbnSharedDeps__.SaferLodashSet;var d=a(190),c=a(1359),g=a(2374),h=a(7876);function p(e){if(["number"].includes(e))return"number";if(["string","boolean"].includes(e))return"string";throw new Error(`Unsupported script sort type: ${e}`)}const f=(e,t=[])=>{var a,s,i;if(!(0,n.isFilter)(e)||!0===(null===(a=e.meta)||void 0===a?void 0:a.disabled))return t;if((0,n.isCombinedFilter)(e)){for(const a of null!==(r=e.meta.params)&&void 0!==r?r:[]){var r;f(a,t)}return t}const o=null!==(s=null===(i=e.meta)||void 0===i?void 0:i.key)&&void 0!==s?s:(0,n.getFilterField)(e);return o&&t.push(o),t};async function m({dataView:e,sort:t,request:a}){let s=e.timeFieldName?[e.timeFieldName]:[];if(t){const e=Array.isArray(t)?t:[t];s.push(...e.flatMap((e=>Object.keys(e))))}for(const e of(null!==(i=a.query)&&void 0!==i?i:[]).filter(n.isOfQueryType)){var i;if(e.query&&"kuery"===e.language){const t=(0,n.fromKueryExpression)(e.query),a=(0,n.getKqlFieldNames)(t);s=s.concat(a)}}const{filters:r=[]}=a,o="function"==typeof r?r():r;s=s.concat(o.flatMap((e=>f(e))));const l=e.getSourceFiltering()&&e.getSourceFiltering().excludes.length?["*"]:s;return l.length?(await e.getFields({fieldName:l})).getFieldMapSorted():{}}var y=a(4177),b=a(3789);const v=`${Date.now()}`;function S(e,t=v){const a=e(b.j.COURIER_SET_REQUEST_PREFERENCE);if("sessionId"===a)return t;const s=e(b.j.COURIER_CUSTOM_REQUEST_PREFERENCE);return"custom"===a?s:void 0}function _(e,t){var a,s;const{getConfig:i}=t,r={preference:S(i)},n="string"!=typeof e.index?e.index:void 0,o=null!==(a=null==n?void 0:n.title)&&void 0!==a?a:`${e.index}`,l=null!==(s=e.track_total_hits)&&void 0!==s?s:e.body.track_total_hits;return{...e,track_total_hits:l,index:o,...(null==n?void 0:n.getAllowHidden())&&{expand_wildcards:"all"},...r}}class RequestFailure extends c.KbnError{constructor(e=null,t){super(`Request to Elasticsearch failed: ${JSON.stringify((null==t?void 0:t.rawResponse)||(null==e?void 0:e.message))}`),(0,l.default)(this,"resp",void 0),this.resp=t}}var T=a(5008);function E(e,t){var a;const s=(null==t?void 0:t.history)&&t.history[t.history.length-1],i={};if(e&&e.took&&(i.queryTime={label:T.i18n.translate("data.search.searchSource.queryTimeLabel",{defaultMessage:"Query time"}),value:T.i18n.translate("data.search.searchSource.queryTimeValue",{defaultMessage:"{queryTime}ms",values:{queryTime:e.took}}),description:T.i18n.translate("data.search.searchSource.queryTimeDescription",{defaultMessage:"The time it took to process the query. Does not include the time to send the request or parse it in the browser."})}),e&&void 0!==(null===(a=e.hits)||void 0===a?void 0:a.total)){let t;if("number"==typeof e.hits.total)t=`${e.hits.total}`;else{const a=e.hits.total;t="eq"===a.relation?`${a.value}`:`> ${a.value}`}i.hitsTotal={label:T.i18n.translate("data.search.searchSource.hitsTotalLabel",{defaultMessage:"Hits (total)"}),value:t,description:T.i18n.translate("data.search.searchSource.hitsTotalDescription",{defaultMessage:"The number of documents that match the query."})}}return e&&e.hits&&(i.hits={label:T.i18n.translate("data.search.searchSource.hitsLabel",{defaultMessage:"Hits"}),value:`${e.hits.hits.length}`,description:T.i18n.translate("data.search.searchSource.hitsDescription",{defaultMessage:"The number of documents returned by the query."})}),s&&(0===s.ms||s.ms)&&(i.requestTime={label:T.i18n.translate("data.search.searchSource.requestTimeLabel",{defaultMessage:"Request time"}),value:T.i18n.translate("data.search.searchSource.requestTimeValue",{defaultMessage:"{requestTime}ms",values:{requestTime:s.ms}}),description:T.i18n.translate("data.search.searchSource.requestTimeDescription",{defaultMessage:"The time of the request from the browser to Elasticsearch and back. Does not include the time the requested waited in the queue."})}),i}const M=(e,t)=>{const a=null!=t&&t.refNamePrefix?`${t.refNamePrefix}.`:"";let s={...e};const i=[];if(s.index)if("string"==typeof s.index){const e=s.index,t=`${a}kibanaSavedObjectMeta.searchSourceJSON.index`;i.push({name:t,type:y.DATA_VIEW_SAVED_OBJECT_TYPE,id:e}),s={...s,indexRefName:t,index:void 0}}else{const{state:e,references:t}=r.DataViewPersistableStateService.extract(s.index);s.index=e,i.push(...t)}return s.filter&&(s={...s,filter:s.filter.map(((e,t)=>{if(!e.meta||!e.meta.index)return e;const s=`${a}kibanaSavedObjectMeta.searchSourceJSON.filter[${t}].meta.index`;return i.push({name:s,type:y.DATA_VIEW_SAVED_OBJECT_TYPE,id:e.meta.index}),{...e,meta:{...e.meta,indexRefName:s,index:void 0}}}))}),[s,i]},F=["dateFormat:tz",y.UI_SETTINGS.COURIER_CUSTOM_REQUEST_PREFERENCE,y.UI_SETTINGS.COURIER_IGNORE_FILTER_IF_FIELD_NOT_IN_INDEX,y.UI_SETTINGS.COURIER_MAX_CONCURRENT_SHARD_REQUESTS,y.UI_SETTINGS.COURIER_SET_REQUEST_PREFERENCE,y.UI_SETTINGS.DOC_HIGHLIGHT,y.UI_SETTINGS.META_FIELDS,y.UI_SETTINGS.QUERY_ALLOW_LEADING_WILDCARDS,y.UI_SETTINGS.QUERY_STRING_OPTIONS,y.UI_SETTINGS.SEARCH_INCLUDE_FROZEN,y.UI_SETTINGS.SORT_OPTIONS],A=e=>(0,o.omitBy)(e,o.isNil);class SearchSource{constructor(e={},t){(0,l.default)(this,"id",(0,o.uniqueId)("data_source")),(0,l.default)(this,"shouldOverwriteDataViewType",!1),(0,l.default)(this,"overwriteDataViewType",void 0),(0,l.default)(this,"parent",void 0),(0,l.default)(this,"requestStartHandlers",[]),(0,l.default)(this,"inheritOptions",{}),(0,l.default)(this,"history",[]),(0,l.default)(this,"fields",void 0),(0,l.default)(this,"dependencies",void 0),(0,l.default)(this,"getFieldName",(e=>"string"==typeof e?e:null==e?void 0:e.field));const{parent:a,...s}=e;this.fields=s,this.dependencies=t,a&&this.setParent(new SearchSource(a,t))}setOverwriteDataViewType(e){!1===e?(this.shouldOverwriteDataViewType=!1,this.overwriteDataViewType=void 0):(this.shouldOverwriteDataViewType=!0,this.overwriteDataViewType=e)}setField(e,t){return null==t?this.removeField(e):(this.fields[e]=t,this)}removeField(e){return delete this.fields[e],this}setFields(e){return this.fields=e,this}getId(){return this.id}getFields(){return{...this.fields}}getField(e,t=!0){if(!t||void 0!==this.fields[e])return this.fields[e];const a=this.getParent();return a&&a.getField(e)}getActiveIndexFilter(){var e,t;const{filter:a,query:s}=this.getFields();let i=[];a&&(i=this.getFilters(a));const r=Array.isArray(s)?s.map((e=>e.query)):(0,n.isOfQueryType)(s)?null==s?void 0:s.query:void 0,l="string"==typeof r?this.parseActiveIndexPatternFromQueryString(r):null!==(e=null==r?void 0:r.reduce(((e,t)=>e.concat(this.parseActiveIndexPatternFromQueryString(t))),[]))&&void 0!==e?e:[],u=null===(t=i)||void 0===t?void 0:t.reduce(((e,t)=>{var a;const s=(0,n.isPhraseFilter)(t),i=(0,n.isPhrasesFilter)(t),r=s?null===(a=t.meta.params)||void 0===a?void 0:a.query:t.meta.params,l=Array.isArray(r)?r:[r];return(s||i)&&"_index"===t.meta.key&&!1===t.meta.disabled?!1===t.meta.negate?(0,o.concat)(e,l):(0,o.difference)(e,l):e}),l);return[...new Set([...u])]}getOwnField(e){return this.getField(e,!1)}create(){return new SearchSource({},this.dependencies)}createCopy(){const e=new SearchSource({},this.dependencies);return e.setFields({...this.fields}),e.setField("index",this.getField("index")),e.setParent(this.getParent()),e}createChild(e={}){const t=new SearchSource({},this.dependencies);return t.setParent(this,e),t}setParent(e,t={}){return this.parent=e,this.inheritOptions=t,this}getParent(){return this.parent}fetch$(e={}){const t=(0,d.defer)((()=>this.requestIsStarting(e))).pipe((0,d.switchMap)((()=>{const t=this.flatten();return this.history=[t],t.index&&(e.indexPattern=t.index),this.fetchSearch$(t,e)})),(0,d.tap)((e=>{if(!e||e.error)throw new RequestFailure(null,e)})),(0,d.shareReplay)());return this.inspectSearch(t,e)}async fetch(e={}){return(await(0,d.lastValueFrom)(this.fetch$(e))).rawResponse}onRequestStart(e){this.requestStartHandlers.push(e)}getSearchRequestBody(){return this.flatten().body}destroy(){this.requestStartHandlers.length=0}inspectSearch(e,t){const{id:a,title:s,description:i,adapter:r}=t.inspector||{title:""},n=null==r?void 0:r.start(s,{id:a,description:i,searchSessionId:t.sessionId}),o=()=>{try{null==n||n.json(this.getSearchRequestBody())}catch(e){}},l=e.pipe((0,d.first)(void 0,null),(0,d.tap)((()=>{null==n||n.stats(function(e){const t={},a=e.getField("index"),s=e.getActiveIndexFilter();return a&&(s.length>0&&(t.indexFilter={label:T.i18n.translate("data.search.searchSource.indexFilterLabel",{defaultMessage:"Index Pattern"}),value:s.join(", "),description:T.i18n.translate("data.search.searchSource.indexFilterDescription",{defaultMessage:"The active index pattern."})}),t.indexPattern={label:T.i18n.translate("data.search.searchSource.dataViewLabel",{defaultMessage:"Data view"}),value:a.title,description:T.i18n.translate("data.search.searchSource.dataViewDescription",{defaultMessage:"The data view that was queried."})},t.indexPatternId={label:T.i18n.translate("data.search.searchSource.dataViewIdLabel",{defaultMessage:"Data view ID"}),value:a.id,description:T.i18n.translate("data.search.searchSource.indexPatternIdDescription",{defaultMessage:"The ID in the {kibanaIndexPattern} index.",values:{kibanaIndexPattern:".kibana"}})}),t}(this)),o()})),(0,d.catchError)((()=>(o(),d.EMPTY))),(0,d.finalize)((()=>{l.unsubscribe()}))).subscribe(),u=e.pipe((0,d.catchError)((e=>(null==n||n.error({json:"attributes"in e?e.attributes:{message:e.message}}),d.EMPTY))),(0,d.last)(void 0,null),(0,d.tap)((e=>{if(e){const t=e.rawResponse;null==n||n.stats(E(t,this)),null==n||n.ok({json:e})}})),(0,d.finalize)((()=>{u.unsubscribe()}))).subscribe();return e}hasPostFlightRequests(){const e=this.getField("aggs");return e instanceof y.AggConfigs&&e.aggs.some((e=>e.enabled&&"function"==typeof e.type.postFlightRequest&&(e.params.otherBucket||e.params.missingBucket)))}postFlightTransform(e){const t=this.getField("aggs");return t instanceof y.AggConfigs?t.postFlightTransform(e):e}async fetchOthers(e,t){const a=this.getField("aggs");if(a instanceof y.AggConfigs)for(const i of a.aggs){var s;i.enabled&&"function"==typeof i.type.postFlightRequest&&(e=await i.type.postFlightRequest(e,a,i,this,null===(s=t.inspector)||void 0===s?void 0:s.adapter,t.abortSignal,t.sessionId,t.disableWarningToasts))}return e}fetchSearch$(e,t){const{search:a,getConfig:s,onResponse:i}=this.dependencies,{indexType:r,...n}=e;return a({params:_(n,{getConfig:s}),indexType:r},t).pipe((0,d.switchMap)((e=>new d.Observable((a=>{if((0,y.isRunningResponse)(e))a.next(this.postFlightTransform(e));else if(this.hasPostFlightRequests()){a.next({...this.postFlightTransform(e),isPartial:!0,isRunning:!0});const s=(0,d.from)(this.fetchOthers(e.rawResponse,t)).subscribe({next:t=>{a.next(this.postFlightTransform({...e,rawResponse:t}))},error:e=>{a.error(e),s.unsubscribe()},complete:()=>{a.complete(),s.unsubscribe()}})}else a.next(this.postFlightTransform(e)),a.complete()})))),(0,d.map)((a=>(0,y.isRunningResponse)(a)?a:i(e,a,t))))}requestIsStarting(e={}){const t=[...this.requestStartHandlers];if(this.inheritOptions.callParentStartHandlers){let e=this.getParent();for(;e;)t.push(...e.requestStartHandlers),e=e.getParent()}return Promise.all(t.map((t=>t(this,e))))}mergeProp(e,t,a){if(null==(t="function"==typeof t?t(this):t)||!a)return;const s=(t,a)=>{e[t]=a},i=(t,a)=>{null==e.body[t]&&(e.body[t]=a)},{getConfig:r}=this.dependencies;switch(a){case"filter":return s("filters",("function"==typeof e.filters?e.filters():e.filters||[]).concat(t));case"query":return s(a,(e.query||[]).concat(t));case"fields":return i("fields",t);case"fieldsFromSource":return s(a,[...new Set((e.fieldsFromSource||[]).concat(t))]);case"index":case"type":case"highlightAll":return a&&null==e[a]&&s(a,t);case"searchAfter":return i("search_after",t);case"trackTotalHits":return i("track_total_hits",t);case"source":return i("_source",t);case"sort":return i(a,function(e,t,a={}){return(Array.isArray(e)?e:[e]).map((function(e){return function(e,t,a){const[[s,i]]=Object.entries(e),r="object"==typeof i?i:{order:i};if(t&&"string"!=typeof t&&!t.getRuntimeField(s)){const e=t.getScriptedField(s);if(e&&e.scripted&&"date"!==e.type)return{_script:{script:{source:e.script,lang:e.lang},type:p(e.type),...r}}}"string"==typeof a&&(a=JSON.parse(a));const{unmapped_type:n,...o}=a;return{[s]:{...r,..."_score"===s?o:a}}}(e,t,a)}))}(t,this.getField("index"),r(y.UI_SETTINGS.SORT_OPTIONS)));case"pit":return s(a,t);case"aggs":return t instanceof y.AggConfigs?i("aggs",t.toDsl()):i("aggs",t);default:return i(a,t)}}mergeProps(e=this,t={body:{}}){return Object.entries(this.fields).forEach((([e,a])=>{this.mergeProp(t,a,e)})),this.parent&&this.parent.mergeProps(e,t),t}getIndexType(e){var t;return this.shouldOverwriteDataViewType?this.overwriteDataViewType:null===(t=this.getDataView(e))||void 0===t?void 0:t.type}getDataView(e){return"string"!=typeof e?e:void 0}getFieldsWithoutSourceFilters(e,t){var a;if(!e)return t;const{fields:s}=e,i=e.getSourceFiltering();if(!i||0===(null===(a=i.excludes)||void 0===a?void 0:a.length)||0===t.length)return t;const r=i.excludes,n=t.find((e=>"*"===this.getFieldName(e))),o=(0,c.fieldWildcardFilter)(r,this.dependencies.getConfig(y.UI_SETTINGS.META_FIELDS)),l=e=>e&&o(e);return n?s.filter((e=>l(e.name))).map((e=>({field:e.name}))):t.filter((e=>l(this.getFieldName(e))))}getFieldFromDocValueFieldsOrIndexPattern(e,t,a){if("string"==typeof t)return t;const s=this.getFieldName(t),i=Object.assign({},e[s],t);if(!a)return i;const{fields:r}=a,n=r.getByType("date").find((e=>e.name===s));if(!n)return i;const{esTypes:o}=n;return null!=o&&o.includes("date_nanos")?i.format="strict_date_optional_time_nanos":null!=o&&o.includes("date")&&(i.format="strict_date_optional_time"),i}async loadDataViewFields(e){const t=this.mergeProps(this,{body:{}});return await m({dataView:e,request:t})}flatten(){var e,t;const{getConfig:a}=this.dependencies,s=null!==(e=a(y.UI_SETTINGS.META_FIELDS))&&void 0!==e?e:[],i=this.mergeProps(),r={...(0,o.omit)(i,["index","filters","highlightAll","fieldsFromSource","body"]),...i.body},n=this.getDataView(i.index),{docvalueFields:l,scriptFields:d,runtimeFields:c}=null!==(t=null==n?void 0:n.getComputedFields())&&void 0!==t?t:{docvalueFields:[],scriptFields:{},runtimeFields:{}},h=!!r.fields,p=i.index&&!Object.hasOwn(r,"_source")?null==n?void 0:n.getSourceFiltering():r._source,f=this.getFieldFilter({bodySourceExcludes:null==p?void 0:p.excludes,metaFields:s}),m=f(i.fieldsFromSource||[]),b=f(l),v=!!m.length,S=h||v?f(r.fields||[]):b,_=this.getUniqueFieldNames({fields:S,fieldsFromSource:m}),T=(()=>{const e=this.dependencies.scriptedFieldsEnabled?{...r.script_fields,...d}:{};return h||v?this.filterScriptFields({uniqFieldNames:_,scriptFields:e}):e})(),E=this.getRemainingFields({uniqFieldNames:_,scriptFields:T,runtimeFields:c,_source:p});r._source=p,v&&!(0,o.isEqual)(E,m)&&(0,u.setWith)(r,"_source.includes",E,(e=>(0,o.isObject)(e)?{}:e));const M=this.getBuiltEsQuery({index:i.index,query:i.query,filters:i.filters,getConfig:a,sort:r.sort}),F={...r,pit:i.pit,query:M,highlight:i.highlightAll&&M?(0,g.getHighlightRequest)(a(y.UI_SETTINGS.DOC_HIGHLIGHT)):void 0,_source:!(h&&!v)&&r._source,stored_fields:h||v?[...new Set(E)]:["*"],runtime_mappings:c,script_fields:T,fields:this.getFieldsList({index:n,fields:S,docvalueFields:r.docvalue_fields,fieldsFromSource:m,filteredDocvalueFields:b,metaFields:s,fieldListProvided:h,sourceFieldsProvided:v})};return A({...(0,o.omit)(i,["query","filters","fieldsFromSource"]),body:A(F),indexType:this.getIndexType(i.index),highlightAll:i.highlightAll&&M?void 0:i.highlightAll})}getFieldFilter({bodySourceExcludes:e,metaFields:t}){const a=(0,c.fieldWildcardFilter)(e,t);return e=>e.filter((e=>a(this.getFieldName(e))))}getUniqueFieldNames({fields:e,fieldsFromSource:t}){const a=e.map((e=>this.getFieldName(e)));return[...new Set([...a,...t])]}filterScriptFields({uniqFieldNames:e,scriptFields:t}){return e.includes("*")?t:(0,o.pick)(t,Object.keys(t).filter((t=>e.includes(t))))}getBuiltEsQuery({index:e,query:t=[],filters:a=[],getConfig:s,sort:i}){const r=(null!=i?i:[]).some((e=>Object.hasOwn(e,"_score"))),o={...(0,y.getEsQueryConfig)({get:s}),filtersInMustClause:r};return(0,n.buildEsQuery)(this.getDataView(e),t,"function"==typeof a?a():a,o)}getRemainingFields({uniqFieldNames:e,scriptFields:t,runtimeFields:a,_source:s}){return(0,o.difference)(e,[...Object.keys(t),...Object.keys(a)]).filter((e=>!(!e||s&&s.excludes&&s.excludes.includes(e))))}getFieldsList({index:e,fields:t,docvalueFields:a,fieldsFromSource:s,filteredDocvalueFields:i,metaFields:r,fieldListProvided:n,sourceFieldsProvided:o}){return n||o?o?[...t,...i.filter((e=>{const t=this.getFieldName(e);return s.includes(t)&&!(a||[]).map((e=>this.getFieldName(e))).includes(t)}))]:this.getUniqueFields({index:e,fields:t,metaFields:r,filteredDocvalueFields:i}):t}getUniqueFields({index:e,fields:t,metaFields:a,filteredDocvalueFields:s}){const i=this.getFieldsWithoutSourceFilters(e,t),r=(0,o.keyBy)(s,"field"),n=new Set(Object.keys(r)),l=new Set,u=[];for(const t of i.concat(s)){const s=this.getFieldName(t);a.includes(s)||l.has(s)||(l.add(s),n.has(s)?u.push("string"==typeof t?r[t]:this.getFieldFromDocValueFieldsOrIndexPattern(r,t,e)):u.push(t))}return u}getSerializedFields(e=!1){const{filter:t,aggs:a,parent:s,size:i,sort:r,index:n,...o}=this.getFields();let l={...o};if(n&&(l.index=n.isPersisted()?n.id:n.toMinimalSpec()),r&&(l.sort=Array.isArray(r)?r:[r]),t){const e=this.getFilters(t);l={...l,filter:e}}if(a){let e=a;"function"==typeof e&&(e=a()),e instanceof y.AggConfigs?l.aggs=e.getAll().map((e=>e.serialize())):l.aggs=e}return e&&this.getParent()&&(l.parent=this.getParent().getSerializedFields(e)),l}serialize(){const[e,t]=M(this.getSerializedFields());return{searchSourceJSON:JSON.stringify(e),references:t}}getFilters(e){return e?Array.isArray(e)?e:(0,o.isFunction)(e)?this.getFilters(e()):[e]:[]}toExpressionAst({asDatatable:e=!0}={}){const t=this.mergeProps(),{body:a,index:s,query:r}=t,o=this.getDataView(s),l="function"==typeof t.filters?t.filters():t.filters,u=(0,h.buildExpression)([(0,h.buildExpressionFunction)("kibana_context",{q:null==r?void 0:r.filter(n.isOfQueryType).map(i.queryToAst),filters:l&&(0,i.filtersToAst)(l)})]).toAst();if(!e)return u;const d=this.getField("aggs"),c="function"==typeof d?d():d,g=c instanceof y.AggConfigs?c:o&&c&&this.dependencies.aggs.createAggConfigs(o,c);return g?u.chain.push(...g.toExpressionAst().chain):u.chain.push((0,h.buildExpressionFunction)("esdsl",{size:null==a?void 0:a.size,dsl:JSON.stringify({}),index:"string"==typeof s?s:`${null==o?void 0:o.id}`}).toAst()),u}parseActiveIndexPatternFromQueryString(e){const t=new Set,a=/\s?(_index)\s*:\s*(['"]?)([^\s'"]+)\2/g;for(const s of e.matchAll(a)){const e=s[3];e&&t.add(e)}return[...t]}}const I=(e,t)=>{let a;const s=async(i={},n=!1)=>{const{index:o,parent:l,...u}=i,d={...u};if(i.index)if(n){a="string"==typeof i.index?await e.getDataViewLazy(i.index):await e.createDataViewLazy(i.index);const[s,n,o]=await Promise.all([a.toSpec(),t.dataViews.getShortDotsEnable(),t.dataViews.getMetaFields()]),l=new r.DataView({spec:s,fieldFormats:{},shortDotsEnable:n,metaFields:o});d.index=l}else d.index="string"==typeof i.index?await e.get(i.index):await e.create(i.index);return i.parent&&(d.parent=await s(i.parent)),d};return async(e={},i)=>{const r=await s(e,!!i),l=new SearchSource(r,t),u=l.getOwnField("query");if(void 0!==u&&l.setField("query",function(e){return(0,o.has)(e,"language")||"object"==typeof e&&(0,n.isOfAggregateQueryType)(e)?e:{query:e,language:"lucene"}}(u)),i&&a){var d;const e=await l.loadDataViewFields(a);null===(d=r.index)||void 0===d||d.fields.replaceAll(Object.values(e).map((e=>e.toSpec())))}return l}},w=(e,t)=>{const a={...e};if(e.indexRefName){const s=t.find((t=>t.name===e.indexRefName));if(!s)throw new Error(`Could not find reference for ${e.indexRefName}`);a.index=s.id,delete a.indexRefName}return e.index&&"string"!=typeof e.index&&(e.index=r.DataViewPersistableStateService.inject(e.index,t)),a.filter&&Array.isArray(a.filter)&&a.filter.forEach((e=>{if(!e.meta||!e.meta.indexRefName)return;const a=t.find((t=>t.name===e.meta.indexRefName));if(!a)throw new Error(`Could not find reference for ${e.meta.indexRefName}`);e.meta.index=a.id,delete e.meta.indexRefName})),a},x=e=>{let t;try{t=JSON.parse(e)}catch(t){throw new c.InvalidJSONProperty(`Invalid JSON in search source. ${t.message} JSON: ${e}`)}if(!t||"object"!=typeof t)throw new c.InvalidJSONProperty("Invalid JSON in search source.");return t};var k=a(71);const R=()=>{const e=(0,o.mapValues)((0,k.R9)(),(e=>t=>({...t,filter:e(t.filter)}))),t=(0,o.mapValues)(r.DataViewPersistableStateService.getAllMigrations(),(e=>t=>({...t,index:e(t.index)})));return(0,c.mergeMigrationFunctionMaps)((0,c.mergeMigrationFunctionMaps)({},e),t)};class SearchSourceService{setup(){return{getAllMigrations:R}}start(e,t){return{create:I(e,t),createLazy:(a={})=>I(e,t)(a,!0),createEmpty:()=>new SearchSource({},t),extract:e=>{const[t,a]=M(e);return{state:t,references:a}},inject:w,getAllMigrations:R,telemetry:()=>({})}}stop(){}}let N=function(e){return e.asc="asc",e.desc="desc",e}({});function C(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}var L=a(9235),P=a(7278),D=a(1036);const O="search-session",B="searchSessionsMgmtUiTable";var q=a(3721);const j=(e,t,{pollInterval:a,abortSignal:s}={})=>(0,d.defer)((()=>{const i=Date.now();if(null!=s&&s.aborted)throw new c.AbortError;t&&(null==s||s.addEventListener("abort",(()=>null==t?void 0:t().catch((e=>{q.error(e)}))),{once:!0}));const r=(s?(0,d.fromEvent)(s,"abort"):d.EMPTY).pipe((0,d.map)((()=>{throw new c.AbortError})));return(0,d.from)(e()).pipe((0,d.expand)((()=>{const t=Date.now()-i;return(0,d.timer)((e=>{if("number"==typeof a)return a;switch(!0){case e<1500:return 300;case e<5e3:return 1e3;case e<2e4:return 2500;default:return 5e3}})(t)).pipe((0,d.switchMap)((()=>e())))})),(0,d.tap)((e=>{if((0,y.isAbortResponse)(e))throw new c.AbortError})),(0,d.takeWhile)(y.isRunningResponse,!0),(0,d.takeUntil)(r))})),z="es";function U(e){const{total:t,failed:a,successful:s}=e._shards;return{total:t,loaded:a+s}}function G(e,{legacyHitsTotal:t=!0}={}){var a,s,i,r;if(!t)return e;const n=null!==(a=null===(s=e.hits)||void 0===s||null===(i=s.total)||void 0===i?void 0:i.value)&&void 0!==a?a:null===(r=e.hits)||void 0===r?void 0:r.total,o={...e.hits,total:n};return{...e,hits:o}}const $="eql",V="ese",K="sql",H="esql",Y="esql_async",W="es_ql"},1036:(e,t,a)=>{"use strict";a.d(t,{v:()=>s,z:()=>i});let s=function(e){return e.IN_PROGRESS="in_progress",e.ERROR="error",e.COMPLETE="complete",e.CANCELLED="cancelled",e.EXPIRED="expired",e}({}),i=function(e){return e.IN_PROGRESS="in_progress",e.ERROR="error",e.COMPLETE="complete",e}({})},9235:(e,t,a)=>{"use strict";a.d(t,{Uc:()=>n,AX:()=>v,FU:()=>l,jZ:()=>c});var s=a(770);const i=["_type","_source"];function r(e,t,a,i,n){for(const o in t){if(!Object.hasOwn(t,o))continue;const l=t[o],u=a+o,d=null==i?void 0:i.fields.getByName(u);if(!1===(null==n?void 0:n.shallow)){const t="nested"===(null==d?void 0:d.type);if(Array.isArray(l)&&!t){for(let t=0;t<l.length;t++){const a=l[t];(0,s.isPlainObject)(a)&&r(e,a,u+".",i,n)}continue}}else if(void 0!==e[u])continue;const c=d&&"conflict"!==d.type,g=!(0,s.isPlainObject)(l);c||g?e[u]?Array.isArray(e[u])?e[u].push(l):e[u]=[e[u],l]:e[u]=l:r(e,l,u+".",i,n)}}function n(e,t,a){const s={};if(r(s,e.fields||{},"",t,a),!1!==(null==a?void 0:a.source)&&e._source)r(s,e._source,"",t,a);else if(null!=a&&a.includeIgnoredValues&&e.ignored_field_values)for(const t in e.ignored_field_values){if(!Object.hasOwn(e.ignored_field_values,t))continue;const a=e.ignored_field_values[t];s[t]?Array.isArray(s[t])?s[t]=[...s[t],...a]:s[t]=[s[t],...a]:s[t]=a}if(null!=t&&t.metaFields)for(let a=0;a<(null==t?void 0:t.metaFields.length);a++){const r=null==t?void 0:t.metaFields[a];i.includes(r)||"_"!==r.charAt(0)||(s[r]=e[r])}return function(e,t,a){let s;return new Proxy(e,{defineProperty:(...e)=>(s=void 0,Reflect.defineProperty(...e)),deleteProperty:(...e)=>(s=void 0,Reflect.deleteProperty(...e)),ownKeys:e=>(s||(s=Reflect.ownKeys(e).sort(null!=a?a:o(t))),s)})}(s,t,null==a?void 0:a.flattenedFieldsComparator)}const o=e=>{const t=new Set(null==e?void 0:e.metaFields),a=new Map;let s,i;const r=(e,t)=>(s=a.get(e),void 0===s&&(s=e.toLowerCase(),a.set(e,s)),i=a.get(t),void 0===i&&(i=t.toLowerCase(),a.set(t,i)),s<i?-1:s>i?1:0);return(e,a)=>{if("symbol"==typeof e||"symbol"==typeof a)return 0;const s=t.has(e),i=t.has(a);return s&&i?r(e,a):s?1:i?-1:r(e,a)}},l=(e,t,a={})=>{const s=[],i=e.hits.hits.map((e=>{const i=n(e,t,a);if(i){for(const[e,a]of Object.entries(i)){const i=null==t?void 0:t.fields.getByName(e),r=(null==i?void 0:i.name)||e;if(!s.find((e=>e.id===r))){const e=(null==i?void 0:i.type)||typeof a,n=i&&(null==t?void 0:t.getFormatterForField(i));s.push({id:r,name:r,meta:{type:e,field:r,index:null==t?void 0:t.id,params:n?n.toJSON():void 0}})}}return i}})).filter((e=>e));return{type:"datatable",columns:s,rows:i}};var u=a(8915);const d=(e,t)=>{let a="";try{a=e.makeLabel()}catch(e){}return{aggConfig:e,id:`col-${t}-${e.id}`,name:a}};function c(e,t){if(t)return e.map(((e,t)=>d(e,t)));const a=[],i=(0,s.groupBy)(e,(e=>e.type.type));if(!i.buckets)return i.metrics.map(((e,t)=>d(e,t)));let r=0;return i.buckets.forEach((e=>{a.push(d(e,r++)),i.metrics.forEach((e=>{a.push(d(e,r++))}))})),a}class TabbedAggResponseWriter{constructor(e,t){(0,u.default)(this,"columns",void 0),(0,u.default)(this,"rows",[]),(0,u.default)(this,"bucketBuffer",[]),(0,u.default)(this,"metricBuffer",[]),(0,u.default)(this,"partialRows",void 0),(0,u.default)(this,"params",void 0),this.partialRows=t.partialRows||!1,this.params=t,this.columns=c(e.getResponseAggs(),!t.metricsAtAllLevels),this.rows=[]}row(){const e={};for(let t=0;t<this.bucketBuffer.length;t++){const a=this.bucketBuffer[t];e[a.id]=a.value}for(let t=0;t<this.metricBuffer.length;t++){const a=this.metricBuffer[t];e[a.id]=a.value}let t=!1;for(let a=0;a<this.columns.length;a++){const s=this.columns[a];if(!Object.hasOwn(e,s.id)){t=!0;break}}const a=t&&!this.partialRows;(0,s.isEmpty)(e)||a||this.rows.push(e)}response(){return{type:"datatable",columns:this.columns.map((e=>{var t,a,s,i,r,n,o,l,u,d,c,g;return{id:e.id,name:e.name,meta:{type:(null===(t=(a=e.aggConfig.type).getValueType)||void 0===t?void 0:t.call(a,e.aggConfig))||(null===(s=e.aggConfig.params.field)||void 0===s?void 0:s.type)||"number",field:null===(i=e.aggConfig.params.field)||void 0===i?void 0:i.name,index:null===(r=e.aggConfig.getIndexPattern())||void 0===r?void 0:r.title,params:e.aggConfig.toSerializedFieldFormat(),source:"esaggs",sourceParams:{hasPrecisionError:Boolean(e.hasPrecisionError),indexPatternId:null===(n=e.aggConfig.getIndexPattern())||void 0===n?void 0:n.id,appliedTimeRange:null!==(o=e.aggConfig.params.field)&&void 0!==o&&o.name&&this.params.timeRange&&this.params.timeRange.timeFields&&this.params.timeRange.timeFields.includes(null===(l=e.aggConfig.params.field)||void 0===l?void 0:l.name)?{from:null===(u=this.params.timeRange)||void 0===u||null===(d=u.from)||void 0===d?void 0:d.toISOString(),to:null===(c=this.params.timeRange)||void 0===c||null===(g=c.to)||void 0===g?void 0:g.toISOString()}:void 0,...e.aggConfig.serialize()}}}})),rows:this.rows}}}var g=a(2488),h=a.n(g),p=a(7451);const f=(e,t)=>(null==e?void 0:e.from)===(null==t?void 0:t.from)&&(null==e?void 0:e.to)===(null==t?void 0:t.to);class TabifyBuckets{constructor(e,t,a){(0,u.default)(this,"length",void 0),(0,u.default)(this,"objectMode",void 0),(0,u.default)(this,"buckets",void 0),(0,u.default)(this,"_keys",[]),e&&e.buckets?this.buckets=e.buckets:this.buckets=e?[e]:[],this.objectMode=(0,s.isPlainObject)(this.buckets),this.objectMode?(this._keys=(0,s.keys)(this.buckets),this.length=this._keys.length):this.length=this.buckets.length,this.length&&t&&(this.orderBucketsAccordingToParams(t.params),t.params.drop_partials&&this.dropPartials(t,a))}forEach(e){const t=this.buckets;if(this.objectMode)for(let a=0;a<this._keys.length;a++){const s=this._keys[a];e(t[s],s)}else for(let a=0;a<t.length;a++){const s=t[a];e(s,s.key)}}orderBucketsAccordingToParams(e){if(e.filters&&this.objectMode)this._keys=e.filters.map((e=>{const t=(0,s.get)(e,"input.query.query_string.query",e.input.query),a="string"==typeof t?t:JSON.stringify(t);return e.label||a||"*"}));else if(e.ranges&&this.objectMode)this._keys=e.ranges.map((e=>(0,s.findKey)(this.buckets,(t=>f(t,e)))));else if(e.ranges&&"date"!==e.field.type){let t=e.ranges;e.ipRangeType&&(t="mask"===e.ipRangeType?t.mask:t.fromTo),this.buckets=t.map((e=>e.mask?this.buckets.find((t=>t.key===e.mask)):this.buckets.find((t=>f(t,e)))))}}dropPartials(e,t){if(!t||this.buckets.length<=1||this.objectMode||!t.timeFields.includes(e.params.field.name))return;const a=e.params.used_interval?(0,p.P15)(e.serialize().params.used_interval):h().duration(this.buckets[1].key-this.buckets[0].key);this.buckets=this.buckets.filter((s=>!h().tz(s.key,e.aggConfigs.timeZone).isBefore(t.from)&&!h().tz(s.key,e.aggConfigs.timeZone).add(a).isAfter(t.to))),this.length=this.buckets.length}}function m(e,t,a,i,r,n){var o,l;const u=t.columns.shift();if(u){const d=u.aggConfig;if(d.getParam("scaleMetricValues")){const t=d.write(e);r*=t.metricScale||1}switch(d.type.type){case p.TO1.Buckets:const c=(0,s.get)(a,d.id),g=new TabifyBuckets(c,d,null==n?void 0:n.timeRange);(null===(o=(l=d.type).hasPrecisionError)||void 0===o?void 0:o.call(l,c))&&(u.hasPrecisionError=!0),g.length?g.forEach(((a,s)=>{const i=d.getKey(a,s),o=void 0!==i;o&&t.bucketBuffer.push({id:u.id,value:i}),m(e,t,a,d.getKey(a,s),r,n),o&&t.bucketBuffer.pop()})):null!=n&&n.partialRows?(t.columns.unshift(u),y(e,t,a,i,r),t.columns.shift()):t.row();break;case p.TO1.Metrics:let h=d.getValue(a);1!==r&&(h*=r),t.metricBuffer.push({id:u.id,value:h}),t.columns.length?m(e,t,a,i,r,n):t.row(),t.metricBuffer.pop()}t.columns.unshift(u)}}function y(e,t,a,s,i){const r=t.columns.shift();if(r){switch(r.aggConfig.type.type){case p.TO1.Metrics:return t.columns.unshift(r),void m(e,t,a,s,i);case p.TO1.Buckets:y(e,t,a,s,i)}t.columns.unshift(r)}}function b(e){return/doc_count_/.test(e)}function v(e,t,a){var s,i,r;const n=new TabbedAggResponseWriter(e,a||{});let o=!1;if(t.aggregations)for(const e in t.aggregations)if(b(e)){o=!0;break}const l={...e.isSamplingEnabled()?null===(s=t.aggregations)||void 0===s?void 0:s.sampling:t.aggregations,doc_count:null===(i=t.aggregations)||void 0===i?void 0:i.doc_count};var u;return l.doc_count||o||(l.doc_count=null===(u=t.hits)||void 0===u?void 0:u.total),m(e,n,l,"",1,a),{...n.response(),meta:{type:"esaggs",source:e.indexPattern.id,statistics:{totalCount:null===(r=t.hits)||void 0===r?void 0:r.total}}}}},7278:(e,t,a)=>{"use strict";a.d(t,{E8:()=>r,fy:()=>o,vQ:()=>n});var s=a(2488),i=a.n(s);const r=e=>!e||!("rawResponse"in e||"response"in e),n=e=>{var t;return null!==(t=null==e?void 0:e.isRunning)&&void 0!==t&&t},o=(e,t=!0)=>{const a=e("dateFormat:tz");if("Browser"===a){if(!t)return"UTC";const e=i().tz.guess(),a=i()().format("Z");return e||a}return null!=a?a:"UTC"}},5336:(e,t,a)=>{"use strict";a.d(t,{u:()=>SerializableField});class SerializableField{static isSerializable(e){return Boolean(e.serialize)}static deserialize(e){throw new Error("Must implement a static `deserialize` method to conform to /`SerializableField/`")}}},7270:(e,t,a)=>{"use strict";a.d(t,{IZ:()=>n,gi:()=>r,tL:()=>o});var s=a(5536),i=a(5336);const r={MultiFieldKey:"multiFieldKey",RangeKey:"rangeKey"};function n(e){switch(null!=e&&(null==e?void 0:e.type)){case r.MultiFieldKey:return s.p0N.deserialize(e);case r.RangeKey:return s.FYW.deserialize(e);default:return e}}function o(e){return null!=e&&i.u.isSerializable(e)?e.serialize():e}},7371:(e,t,a)=>{"use strict";a.d(t,{_:()=>s._,f:()=>s.f});var s=a(2956)},7611:(e,t,a)=>{"use strict";a.r(t),a.d(t,{APPLY_FILTER_TRIGGER:()=>we.B,AggGroupLabels:()=>s.AggGroupLabels,AggGroupNames:()=>s.AggGroupNames,BUCKET_TYPES:()=>s.BUCKET_TYPES,DuplicateDataViewError:()=>s.DuplicateDataViewError,ES_FIELD_TYPES:()=>s.ES_FIELD_TYPES,FilterManager:()=>i.qh,KBN_FIELD_TYPES:()=>s.KBN_FIELD_TYPES,METRIC_TYPES:()=>s.METRIC_TYPES,NowProvider:()=>NowProvider,QueryService:()=>i.cq,SEARCH_SESSIONS_MANAGEMENT_ID:()=>$.j,SearchSessionState:()=>q,SearchSource:()=>b.Cyp,SortDirection:()=>b.UEL,TimeHistory:()=>i.gr,UI_SETTINGS:()=>s.UI_SETTINGS,calculateBounds:()=>s.calculateBounds,connectToQueryState:()=>i.$9,convertIntervalToEsInterval:()=>r.tA,createSavedQueryService:()=>i.NF,exporters:()=>Ne,extractSearchSourceReferences:()=>b.QDx,fieldList:()=>s.fieldList,flattenHit:()=>s.flattenHit,generateFilters:()=>i.XH,getDefaultQuery:()=>i.Sy,getDisplayValueFromFilter:()=>i._b,getEsQueryConfig:()=>s.getEsQueryConfig,getFieldDisplayValueFromFilter:()=>i.Ix,getIndexPatternFromFilter:()=>i.FJ,getQueryLog:()=>i.zR,getSearchParamsFromRequest:()=>b.c2H,getTime:()=>s.getTime,indexPatterns:()=>Ce,injectSearchSourceReferences:()=>b.kiA,isQuery:()=>s.isQuery,isRunningResponse:()=>s.isRunningResponse,isTimeRange:()=>s.isTimeRange,mapAndFlattenFilters:()=>i.pH,noSearchSessionStorageCapabilityMessage:()=>W,parseSearchSourceJSON:()=>b.zqr,plugin:()=>Pe,search:()=>Le,syncGlobalQueryStateWithUrl:()=>i.X9,syncQueryStateWithUrl:()=>i.Qd,tabifyAggResponse:()=>s.tabifyAggResponse,waitUntilNextSessionCompletes$:()=>Q});var s=a(4177),i=a(3329),r=a(4782),n=a(7574),o=a(770),l=a(190),u=a(8686);function d({getStartServices:e}){return function({getStartDependencies:e}){return()=>({...(0,u.getEsaggsMeta)(),allowCache:{withSideEffects:(e,{inspectorAdapters:t})=>(0,u.getSideEffectFunction)(t)},fn:(t,s,{inspectorAdapters:i,abortSignal:r,getSearchSessionId:n,getExecutionContext:u,getSearchContext:d})=>(0,l.defer)((async()=>{var t,i;const[{aggs:r,indexPatterns:n,searchSource:o,getNow:l},{handleEsaggsRequest:u}]=await Promise.all([e(),Promise.resolve().then(a.bind(a,8686))]),d=await n.create(s.index.value,!0);return{aggConfigs:r.createAggConfigs(d,null!==(t=null===(i=s.aggs)||void 0===i?void 0:i.map((e=>e.value)))&&void 0!==t?t:[],{hierarchical:s.metricsAtAllLevels,partialRows:s.partialRows,probability:s.probability,samplerSeed:s.samplerSeed}),indexPattern:d,searchSource:o,getNow:l,handleEsaggsRequest:u}})).pipe((0,l.switchMap)((({aggConfigs:e,indexPattern:a,searchSource:l,getNow:c,handleEsaggsRequest:g})=>{const{disableWarningToasts:h}=d();return g({abortSignal:r,aggs:e,filters:s.ignoreGlobalFilters?void 0:(0,o.get)(t,"filters",void 0),indexPattern:a,inspectorAdapters:i,query:s.ignoreGlobalFilters?void 0:(0,o.get)(t,"query",void 0),searchSessionId:n(),searchSourceService:l,timeFields:s.timeFields,timeRange:(0,o.get)(t,"timeRange",void 0),disableWarningToasts:h||!1,getNow:c,executionContext:u()})})))})}({getStartDependencies:async()=>{const[,,t]=await e(),{indexPatterns:a,search:s,nowProvider:i}=t;return{aggs:s.aggs,indexPatterns:a,searchSource:s.searchSource,getNow:()=>i.get()}}})}var c=a(8700),g=a(5964),h=a(3313),p=a(5008),f=a(8370),m=a(8351),y=a(1373),b=a(5536);function v(e){return e.replace(/[\(\)]/g,"_")}var S=a(206),_=a(4825),T=a(8915),E=a(1783),M=a.n(E),F=a(2502),A=a(3721);const I="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,w=new Set,x="object"==typeof F&&F?F:{},k=(e,t,a,s)=>{"function"==typeof x.emitWarning?x.emitWarning(e,t,a,s):A.error(`[${a}] ${t}: ${e}`)};let R=globalThis.AbortController,N=globalThis.AbortSignal;if(void 0===R){N=class AbortSignal{onabort;_onabort=[];reason;aborted=!1;addEventListener(e,t){this._onabort.push(t)}},R=class AbortController{constructor(){t()}signal=new N;abort(e){if(!this.signal.aborted){this.signal.reason=e,this.signal.aborted=!0;for(const t of this.signal._onabort)t(e);this.signal.onabort?.(e)}}};let e="1"!==x.env?.LRU_CACHE_IGNORE_AC_WARNING;const t=()=>{e&&(e=!1,k("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}Symbol("type");const C=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),L=e=>C(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?ZeroArray:null:null;class ZeroArray extends Array{constructor(e){super(e),this.fill(0)}}class Stack{heap;length;static#e=!1;static create(e){const t=L(e);if(!t)return[];Stack.#e=!0;const a=new Stack(e,t);return Stack.#e=!1,a}constructor(e,t){if(!Stack.#e)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class LRUCache{#t;#a;#s;#i;#r;#n;#o;#l;get perf(){return this.#l}ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#u;#d;#c;#g;#h;#p;#f;#m;#y;#b;#v;#S;#_;#T;#E;#M;#F;#A;#I;static unsafeExposeInternals(e){return{starts:e.#_,ttls:e.#T,autopurgeTimers:e.#E,sizes:e.#S,keyMap:e.#c,keyList:e.#g,valList:e.#h,next:e.#p,prev:e.#f,get head(){return e.#m},get tail(){return e.#y},free:e.#b,isBackgroundFetch:t=>e.#w(t),backgroundFetch:(t,a,s,i)=>e.#x(t,a,s,i),moveToTail:t=>e.#k(t),indexes:t=>e.#R(t),rindexes:t=>e.#N(t),isStale:t=>e.#C(t)}}get max(){return this.#t}get maxSize(){return this.#a}get calculatedSize(){return this.#d}get size(){return this.#u}get fetchMethod(){return this.#n}get memoMethod(){return this.#o}get dispose(){return this.#s}get onInsert(){return this.#i}get disposeAfter(){return this.#r}constructor(e){const{max:t=0,ttl:a,ttlResolution:s=1,ttlAutopurge:i,updateAgeOnGet:r,updateAgeOnHas:n,allowStale:o,dispose:l,onInsert:u,disposeAfter:d,noDisposeOnSet:c,noUpdateTTL:g,maxSize:h=0,maxEntrySize:p=0,sizeCalculation:f,fetchMethod:m,memoMethod:y,noDeleteOnFetchRejection:b,noDeleteOnStaleGet:v,allowStaleOnFetchRejection:S,allowStaleOnFetchAbort:_,ignoreFetchAbort:T,perf:E}=e;if(void 0!==E&&"function"!=typeof E?.now)throw new TypeError("perf option must have a now() method if specified");if(this.#l=E??I,0!==t&&!C(t))throw new TypeError("max option must be a nonnegative integer");const M=t?L(t):Array;if(!M)throw new Error("invalid max value: "+t);if(this.#t=t,this.#a=h,this.maxEntrySize=p||this.#a,this.sizeCalculation=f,this.sizeCalculation){if(!this.#a&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(void 0!==y&&"function"!=typeof y)throw new TypeError("memoMethod must be a function if defined");if(this.#o=y,void 0!==m&&"function"!=typeof m)throw new TypeError("fetchMethod must be a function if specified");if(this.#n=m,this.#F=!!m,this.#c=new Map,this.#g=new Array(t).fill(void 0),this.#h=new Array(t).fill(void 0),this.#p=new M(t),this.#f=new M(t),this.#m=0,this.#y=0,this.#b=Stack.create(t),this.#u=0,this.#d=0,"function"==typeof l&&(this.#s=l),"function"==typeof u&&(this.#i=u),"function"==typeof d?(this.#r=d,this.#v=[]):(this.#r=void 0,this.#v=void 0),this.#M=!!this.#s,this.#I=!!this.#i,this.#A=!!this.#r,this.noDisposeOnSet=!!c,this.noUpdateTTL=!!g,this.noDeleteOnFetchRejection=!!b,this.allowStaleOnFetchRejection=!!S,this.allowStaleOnFetchAbort=!!_,this.ignoreFetchAbort=!!T,0!==this.maxEntrySize){if(0!==this.#a&&!C(this.#a))throw new TypeError("maxSize must be a positive integer if specified");if(!C(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#L()}if(this.allowStale=!!o,this.noDeleteOnStaleGet=!!v,this.updateAgeOnGet=!!r,this.updateAgeOnHas=!!n,this.ttlResolution=C(s)||0===s?s:1,this.ttlAutopurge=!!i,this.ttl=a||0,this.ttl){if(!C(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#P()}if(0===this.#t&&0===this.ttl&&0===this.#a)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#t&&!this.#a){const e="LRU_CACHE_UNBOUNDED";(e=>!w.has(e))(e)&&(w.add(e),k("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,LRUCache))}}getRemainingTTL(e){return this.#c.has(e)?1/0:0}#P(){const e=new ZeroArray(this.#t),t=new ZeroArray(this.#t);this.#T=e,this.#_=t;const a=this.ttlAutopurge?new Array(this.#t):void 0;this.#E=a,this.#D=(s,i,r=this.#l.now())=>{if(t[s]=0!==i?r:0,e[s]=i,a?.[s]&&(clearTimeout(a[s]),a[s]=void 0),0!==i&&a){const e=setTimeout((()=>{this.#C(s)&&this.#O(this.#g[s],"expire")}),i+1);e.unref&&e.unref(),a[s]=e}},this.#B=a=>{t[a]=0!==e[a]?this.#l.now():0},this.#q=(a,r)=>{if(e[r]){const n=e[r],o=t[r];if(!n||!o)return;a.ttl=n,a.start=o,a.now=s||i();const l=a.now-o;a.remainingTTL=n-l}};let s=0;const i=()=>{const e=this.#l.now();if(this.ttlResolution>0){s=e;const t=setTimeout((()=>s=0),this.ttlResolution);t.unref&&t.unref()}return e};this.getRemainingTTL=a=>{const r=this.#c.get(a);if(void 0===r)return 0;const n=e[r],o=t[r];return n&&o?n-((s||i())-o):1/0},this.#C=a=>{const r=t[a],n=e[a];return!!n&&!!r&&(s||i())-r>n}}#B=()=>{};#q=()=>{};#D=()=>{};#C=()=>!1;#L(){const e=new ZeroArray(this.#t);this.#d=0,this.#S=e,this.#j=t=>{this.#d-=e[t],e[t]=0},this.#z=(e,t,a,s)=>{if(this.#w(t))return 0;if(!C(a)){if(!s)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof s)throw new TypeError("sizeCalculation must be a function");if(a=s(t,e),!C(a))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return a},this.#U=(t,a,s)=>{if(e[t]=a,this.#a){const a=this.#a-e[t];for(;this.#d>a;)this.#G(!0)}this.#d+=e[t],s&&(s.entrySize=a,s.totalCalculatedSize=this.#d)}}#j=e=>{};#U=(e,t,a)=>{};#z=(e,t,a,s)=>{if(a||s)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#R({allowStale:e=this.allowStale}={}){if(this.#u)for(let t=this.#y;this.#$(t)&&(!e&&this.#C(t)||(yield t),t!==this.#m);)t=this.#f[t]}*#N({allowStale:e=this.allowStale}={}){if(this.#u)for(let t=this.#m;this.#$(t)&&(!e&&this.#C(t)||(yield t),t!==this.#y);)t=this.#p[t]}#$(e){return void 0!==e&&this.#c.get(this.#g[e])===e}*entries(){for(const e of this.#R())void 0===this.#h[e]||void 0===this.#g[e]||this.#w(this.#h[e])||(yield[this.#g[e],this.#h[e]])}*rentries(){for(const e of this.#N())void 0===this.#h[e]||void 0===this.#g[e]||this.#w(this.#h[e])||(yield[this.#g[e],this.#h[e]])}*keys(){for(const e of this.#R()){const t=this.#g[e];void 0===t||this.#w(this.#h[e])||(yield t)}}*rkeys(){for(const e of this.#N()){const t=this.#g[e];void 0===t||this.#w(this.#h[e])||(yield t)}}*values(){for(const e of this.#R())void 0===this.#h[e]||this.#w(this.#h[e])||(yield this.#h[e])}*rvalues(){for(const e of this.#N())void 0===this.#h[e]||this.#w(this.#h[e])||(yield this.#h[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(const a of this.#R()){const s=this.#h[a],i=this.#w(s)?s.__staleWhileFetching:s;if(void 0!==i&&e(i,this.#g[a],this))return this.get(this.#g[a],t)}}forEach(e,t=this){for(const a of this.#R()){const s=this.#h[a],i=this.#w(s)?s.__staleWhileFetching:s;void 0!==i&&e.call(t,i,this.#g[a],this)}}rforEach(e,t=this){for(const a of this.#N()){const s=this.#h[a],i=this.#w(s)?s.__staleWhileFetching:s;void 0!==i&&e.call(t,i,this.#g[a],this)}}purgeStale(){let e=!1;for(const t of this.#N({allowStale:!0}))this.#C(t)&&(this.#O(this.#g[t],"expire"),e=!0);return e}info(e){const t=this.#c.get(e);if(void 0===t)return;const a=this.#h[t],s=this.#w(a)?a.__staleWhileFetching:a;if(void 0===s)return;const i={value:s};if(this.#T&&this.#_){const e=this.#T[t],a=this.#_[t];if(e&&a){const t=e-(this.#l.now()-a);i.ttl=t,i.start=Date.now()}}return this.#S&&(i.size=this.#S[t]),i}dump(){const e=[];for(const t of this.#R({allowStale:!0})){const a=this.#g[t],s=this.#h[t],i=this.#w(s)?s.__staleWhileFetching:s;if(void 0===i||void 0===a)continue;const r={value:i};if(this.#T&&this.#_){r.ttl=this.#T[t];const e=this.#l.now()-this.#_[t];r.start=Math.floor(Date.now()-e)}this.#S&&(r.size=this.#S[t]),e.unshift([a,r])}return e}load(e){this.clear();for(const[t,a]of e){if(a.start){const e=Date.now()-a.start;a.start=this.#l.now()-e}this.set(t,a.value,a)}}set(e,t,a={}){if(void 0===t)return this.delete(e),this;const{ttl:s=this.ttl,start:i,noDisposeOnSet:r=this.noDisposeOnSet,sizeCalculation:n=this.sizeCalculation,status:o}=a;let{noUpdateTTL:l=this.noUpdateTTL}=a;const u=this.#z(e,t,a.size||0,n);if(this.maxEntrySize&&u>this.maxEntrySize)return o&&(o.set="miss",o.maxEntrySizeExceeded=!0),this.#O(e,"set"),this;let d=0===this.#u?void 0:this.#c.get(e);if(void 0===d)d=0===this.#u?this.#y:0!==this.#b.length?this.#b.pop():this.#u===this.#t?this.#G(!1):this.#u,this.#g[d]=e,this.#h[d]=t,this.#c.set(e,d),this.#p[this.#y]=d,this.#f[d]=this.#y,this.#y=d,this.#u++,this.#U(d,u,o),o&&(o.set="add"),l=!1,this.#I&&this.#i?.(t,e,"add");else{this.#k(d);const a=this.#h[d];if(t!==a){if(this.#F&&this.#w(a)){a.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:t}=a;void 0===t||r||(this.#M&&this.#s?.(t,e,"set"),this.#A&&this.#v?.push([t,e,"set"]))}else r||(this.#M&&this.#s?.(a,e,"set"),this.#A&&this.#v?.push([a,e,"set"]));if(this.#j(d),this.#U(d,u,o),this.#h[d]=t,o){o.set="replace";const e=a&&this.#w(a)?a.__staleWhileFetching:a;void 0!==e&&(o.oldValue=e)}}else o&&(o.set="update");this.#I&&this.onInsert?.(t,e,t===a?"update":"replace")}if(0===s||this.#T||this.#P(),this.#T&&(l||this.#D(d,s,i),o&&this.#q(o,d)),!r&&this.#A&&this.#v){const e=this.#v;let t;for(;t=e?.shift();)this.#r?.(...t)}return this}pop(){try{for(;this.#u;){const e=this.#h[this.#m];if(this.#G(!0),this.#w(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(void 0!==e)return e}}finally{if(this.#A&&this.#v){const e=this.#v;let t;for(;t=e?.shift();)this.#r?.(...t)}}}#G(e){const t=this.#m,a=this.#g[t],s=this.#h[t];return this.#F&&this.#w(s)?s.__abortController.abort(new Error("evicted")):(this.#M||this.#A)&&(this.#M&&this.#s?.(s,a,"evict"),this.#A&&this.#v?.push([s,a,"evict"])),this.#j(t),this.#E?.[t]&&(clearTimeout(this.#E[t]),this.#E[t]=void 0),e&&(this.#g[t]=void 0,this.#h[t]=void 0,this.#b.push(t)),1===this.#u?(this.#m=this.#y=0,this.#b.length=0):this.#m=this.#p[t],this.#c.delete(a),this.#u--,t}has(e,t={}){const{updateAgeOnHas:a=this.updateAgeOnHas,status:s}=t,i=this.#c.get(e);if(void 0!==i){const e=this.#h[i];if(this.#w(e)&&void 0===e.__staleWhileFetching)return!1;if(!this.#C(i))return a&&this.#B(i),s&&(s.has="hit",this.#q(s,i)),!0;s&&(s.has="stale",this.#q(s,i))}else s&&(s.has="miss");return!1}peek(e,t={}){const{allowStale:a=this.allowStale}=t,s=this.#c.get(e);if(void 0===s||!a&&this.#C(s))return;const i=this.#h[s];return this.#w(i)?i.__staleWhileFetching:i}#x(e,t,a,s){const i=void 0===t?void 0:this.#h[t];if(this.#w(i))return i;const r=new R,{signal:n}=a;n?.addEventListener("abort",(()=>r.abort(n.reason)),{signal:r.signal});const o={signal:r.signal,options:a,context:s},l=(s,i=!1)=>{const{aborted:n}=r.signal,l=a.ignoreFetchAbort&&void 0!==s;if(a.status&&(n&&!i?(a.status.fetchAborted=!0,a.status.fetchError=r.signal.reason,l&&(a.status.fetchAbortIgnored=!0)):a.status.fetchResolved=!0),n&&!l&&!i)return u(r.signal.reason);const c=d,g=this.#h[t];return(g===d||l&&i&&void 0===g)&&(void 0===s?void 0!==c.__staleWhileFetching?this.#h[t]=c.__staleWhileFetching:this.#O(e,"fetch"):(a.status&&(a.status.fetchUpdated=!0),this.set(e,s,o.options))),s},u=s=>{const{aborted:i}=r.signal,n=i&&a.allowStaleOnFetchAbort,o=n||a.allowStaleOnFetchRejection,l=o||a.noDeleteOnFetchRejection,u=d;if(this.#h[t]===d&&(l&&void 0!==u.__staleWhileFetching?n||(this.#h[t]=u.__staleWhileFetching):this.#O(e,"fetch")),o)return a.status&&void 0!==u.__staleWhileFetching&&(a.status.returnedStale=!0),u.__staleWhileFetching;if(u.__returned===u)throw s};a.status&&(a.status.fetchDispatched=!0);const d=new Promise(((t,s)=>{const n=this.#n?.(e,i,o);n&&n instanceof Promise&&n.then((e=>t(void 0===e?void 0:e)),s),r.signal.addEventListener("abort",(()=>{a.ignoreFetchAbort&&!a.allowStaleOnFetchAbort||(t(void 0),a.allowStaleOnFetchAbort&&(t=e=>l(e,!0)))}))})).then(l,(e=>(a.status&&(a.status.fetchRejected=!0,a.status.fetchError=e),u(e)))),c=Object.assign(d,{__abortController:r,__staleWhileFetching:i,__returned:void 0});return void 0===t?(this.set(e,c,{...o.options,status:void 0}),t=this.#c.get(e)):this.#h[t]=c,c}#w(e){if(!this.#F)return!1;const t=e;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof R}async fetch(e,t={}){const{allowStale:a=this.allowStale,updateAgeOnGet:s=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:r=this.ttl,noDisposeOnSet:n=this.noDisposeOnSet,size:o=0,sizeCalculation:l=this.sizeCalculation,noUpdateTTL:u=this.noUpdateTTL,noDeleteOnFetchRejection:d=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:c=this.allowStaleOnFetchRejection,ignoreFetchAbort:g=this.ignoreFetchAbort,allowStaleOnFetchAbort:h=this.allowStaleOnFetchAbort,context:p,forceRefresh:f=!1,status:m,signal:y}=t;if(!this.#F)return m&&(m.fetch="get"),this.get(e,{allowStale:a,updateAgeOnGet:s,noDeleteOnStaleGet:i,status:m});const b={allowStale:a,updateAgeOnGet:s,noDeleteOnStaleGet:i,ttl:r,noDisposeOnSet:n,size:o,sizeCalculation:l,noUpdateTTL:u,noDeleteOnFetchRejection:d,allowStaleOnFetchRejection:c,allowStaleOnFetchAbort:h,ignoreFetchAbort:g,status:m,signal:y};let v=this.#c.get(e);if(void 0===v){m&&(m.fetch="miss");const t=this.#x(e,v,b,p);return t.__returned=t}{const t=this.#h[v];if(this.#w(t)){const e=a&&void 0!==t.__staleWhileFetching;return m&&(m.fetch="inflight",e&&(m.returnedStale=!0)),e?t.__staleWhileFetching:t.__returned=t}const i=this.#C(v);if(!f&&!i)return m&&(m.fetch="hit"),this.#k(v),s&&this.#B(v),m&&this.#q(m,v),t;const r=this.#x(e,v,b,p),n=void 0!==r.__staleWhileFetching&&a;return m&&(m.fetch=i?"stale":"refresh",n&&i&&(m.returnedStale=!0)),n?r.__staleWhileFetching:r.__returned=r}}async forceFetch(e,t={}){const a=await this.fetch(e,t);if(void 0===a)throw new Error("fetch() returned undefined");return a}memo(e,t={}){const a=this.#o;if(!a)throw new Error("no memoMethod provided to constructor");const{context:s,forceRefresh:i,...r}=t,n=this.get(e,r);if(!i&&void 0!==n)return n;const o=a(e,n,{options:r,context:s});return this.set(e,o,r),o}get(e,t={}){const{allowStale:a=this.allowStale,updateAgeOnGet:s=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:r}=t,n=this.#c.get(e);if(void 0!==n){const t=this.#h[n],o=this.#w(t);return r&&this.#q(r,n),this.#C(n)?(r&&(r.get="stale"),o?(r&&a&&void 0!==t.__staleWhileFetching&&(r.returnedStale=!0),a?t.__staleWhileFetching:void 0):(i||this.#O(e,"expire"),r&&a&&(r.returnedStale=!0),a?t:void 0)):(r&&(r.get="hit"),o?t.__staleWhileFetching:(this.#k(n),s&&this.#B(n),t))}r&&(r.get="miss")}#V(e,t){this.#f[t]=e,this.#p[e]=t}#k(e){e!==this.#y&&(e===this.#m?this.#m=this.#p[e]:this.#V(this.#f[e],this.#p[e]),this.#V(this.#y,e),this.#y=e)}delete(e){return this.#O(e,"delete")}#O(e,t){let a=!1;if(0!==this.#u){const s=this.#c.get(e);if(void 0!==s)if(this.#E?.[s]&&(clearTimeout(this.#E?.[s]),this.#E[s]=void 0),a=!0,1===this.#u)this.#K(t);else{this.#j(s);const a=this.#h[s];if(this.#w(a)?a.__abortController.abort(new Error("deleted")):(this.#M||this.#A)&&(this.#M&&this.#s?.(a,e,t),this.#A&&this.#v?.push([a,e,t])),this.#c.delete(e),this.#g[s]=void 0,this.#h[s]=void 0,s===this.#y)this.#y=this.#f[s];else if(s===this.#m)this.#m=this.#p[s];else{const e=this.#f[s];this.#p[e]=this.#p[s];const t=this.#p[s];this.#f[t]=this.#f[s]}this.#u--,this.#b.push(s)}}if(this.#A&&this.#v?.length){const e=this.#v;let t;for(;t=e?.shift();)this.#r?.(...t)}return a}clear(){return this.#K("delete")}#K(e){for(const t of this.#N({allowStale:!0})){const a=this.#h[t];if(this.#w(a))a.__abortController.abort(new Error("deleted"));else{const s=this.#g[t];this.#M&&this.#s?.(a,s,e),this.#A&&this.#v?.push([a,s,e])}}if(this.#c.clear(),this.#h.fill(void 0),this.#g.fill(void 0),this.#T&&this.#_){this.#T.fill(0),this.#_.fill(0);for(const e of this.#E??[])void 0!==e&&clearTimeout(e);this.#E?.fill(void 0)}if(this.#S&&this.#S.fill(0),this.#m=0,this.#y=0,this.#b.length=0,this.#d=0,this.#u=0,this.#A&&this.#v){const e=this.#v;let t;for(;t=e?.shift();)this.#r?.(...t)}}}var P=a(9472),D=a(4513),O=a.n(D),B=a(1215);let q=function(e){return e.None="none",e.Loading="loading",e.Completed="completed",e.BackgroundLoading="backgroundLoading",e.BackgroundCompleted="backgroundCompleted",e.Restored="restored",e.Canceled="canceled",e}({}),j=function(e){return e.InProgress="inProgress",e.Completed="completed",e.Errored="errored",e}({});const z={start:e=>({appName:e})=>({sessionId:void 0,appName:void 0,isStored:!1,isRestore:!1,isCanceled:!1,isContinued:!1,isSaving:!1,isStarted:!1,trackedSearches:[],sessionId:(0,P.v4)(),startTime:new Date,appName:e}),restore:e=>e=>({sessionId:void 0,appName:void 0,isStored:!1,isRestore:!1,isCanceled:!1,isContinued:!1,isSaving:!1,isStarted:!1,trackedSearches:[],sessionId:e,isRestore:!0,isStored:!0}),clear:e=>()=>({sessionId:void 0,appName:void 0,isStored:!1,isRestore:!1,isCanceled:!1,isContinued:!1,isSaving:!1,isStarted:!1,trackedSearches:[]}),save:e=>()=>{if(!e.sessionId)throw new Error("Can't save session. Missing sessionId");if(e.isStored||e.isRestore)throw new Error("Can't save because current session is already stored\"");return{...e,isSaving:!0}},store:e=>t=>{if(!e.sessionId)throw new Error("Can't store session. Missing sessionId");if(e.isStored||e.isRestore)throw new Error("Can't store because current session is already stored\"");return{...e,isSaving:!1,isStored:!0,searchSessionSavedObject:t}},trackSearch:e=>(t,a={})=>{if(!e.sessionId)throw new Error("Can't track search. Missing sessionId");return{...e,isStarted:!0,trackedSearches:e.trackedSearches.concat({state:j.InProgress,searchDescriptor:t,searchMeta:a}),completedTime:void 0}},removeSearch:e=>t=>{const a=e.trackedSearches.filter((e=>e.searchDescriptor!==t));return{...e,trackedSearches:a,completedTime:0===a.filter((e=>e.state!==j.InProgress)).length?new Date:e.completedTime}},completeSearch:e=>t=>({...e,trackedSearches:e.trackedSearches.map((e=>e.searchDescriptor===t?{...e,state:j.Completed}:e))}),errorSearch:e=>t=>({...e,trackedSearches:e.trackedSearches.map((e=>e.searchDescriptor===t?{...e,state:j.Errored}:e))}),updateSearchMeta:e=>(t,a)=>({...e,trackedSearches:e.trackedSearches.map((e=>e.searchDescriptor===t?{...e,searchMeta:{...e.searchMeta,...a}}:e))}),cancel:e=>()=>{if(!e.sessionId)throw new Error("Can't cancel searches. Missing sessionId");if(e.isRestore)throw new Error("Can't cancel searches when restoring older searches");return{...e,pendingSearches:[],isCanceled:!0,canceledTime:new Date,isStored:!1,searchSessionSavedObject:void 0}},setSearchSessionSavedObject:e=>t=>{if(!e.sessionId)throw new Error("Can't add background search saved object session into the state. Missing sessionId");if(e.sessionId!==t.attributes.sessionId)throw new Error("Can't add background search saved object session into the state. SessionIds don't match.");return{...e,searchSessionSavedObject:t}}},U={getState:e=>()=>{if(!e.sessionId)return q.None;if(!e.isStarted)return q.None;if(e.isCanceled)return q.Canceled;const t=e.trackedSearches.filter((e=>e.state===j.InProgress));switch(!0){case e.isRestore:return t.length>0?q.BackgroundLoading:q.Restored;case e.isSaving:return q.BackgroundLoading;case e.isStored:return t.length>0?q.BackgroundLoading:q.BackgroundCompleted;default:return t.length>0?q.Loading:q.Completed}return q.None},getMeta(e){const t=this.getState(e)();return()=>{var a,s,i;return{state:t,name:null===(a=e.searchSessionSavedObject)||void 0===a?void 0:a.attributes.name,startTime:null!==(s=e.searchSessionSavedObject)&&void 0!==s&&s.attributes.created?new Date(null===(i=e.searchSessionSavedObject)||void 0===i?void 0:i.attributes.created):e.startTime,completedTime:e.completedTime,canceledTime:e.canceledTime,isContinued:e.isContinued}}},getSearch:e=>t=>{var a;return null!==(a=e.trackedSearches.find((e=>e.searchDescriptor===t)))&&void 0!==a?a:null}},G=({freeze:e=!0}={freeze:!0})=>{const t=(0,B.createStateContainer)({sessionId:void 0,appName:void 0,isStored:!1,isRestore:!1,isCanceled:!1,isContinued:!1,isSaving:!1,isStarted:!1,trackedSearches:[]},z,U,e?void 0:{freeze:e=>e}),a=t.state$.pipe((0,l.map)((()=>t.selectors.getMeta())),(0,l.distinctUntilChanged)(O()),(0,l.shareReplay)(1)),s=a.pipe((0,l.map)((e=>e.state)),(0,l.distinctUntilChanged)());return{stateContainer:t,sessionState$:s,sessionMeta$:a}};var $=a(1225);var V=a(3721);const K={max:30,ttl:36e5};class SessionService{constructor(e,t,a,s,i,{freezeState:r=!0}={freezeState:!0}){(0,T.default)(this,"state$",void 0),(0,T.default)(this,"state",void 0),(0,T.default)(this,"sessionMeta$",void 0),(0,T.default)(this,"_disableSaveAfterSearchesExpire$",new l.BehaviorSubject(!1)),(0,T.default)(this,"disableSaveAfterSearchesExpire$",void 0),(0,T.default)(this,"searchSessionInfoProvider",void 0),(0,T.default)(this,"searchSessionIndicatorUiConfig",void 0),(0,T.default)(this,"subscription",new l.Subscription),(0,T.default)(this,"currentApp",void 0),(0,T.default)(this,"hasAccessToSearchSessions",!1),(0,T.default)(this,"toastService",void 0),(0,T.default)(this,"sessionSnapshots",void 0),(0,T.default)(this,"logger",void 0),this.sessionsClient=a,this.nowProvider=s,this.usageCollector=i;const{stateContainer:n,sessionState$:o,sessionMeta$:u}=G({freeze:r});this.state$=o,this.state=n,this.sessionMeta$=u,this.sessionSnapshots=new LRUCache(K),this.logger=e.logger.get(),this.disableSaveAfterSearchesExpire$=(0,l.combineLatest)([this._disableSaveAfterSearchesExpire$,this.sessionMeta$.pipe((0,l.map)((e=>e.isContinued)))]).pipe((0,l.map)((([e,t])=>e||t)),(0,l.distinctUntilChanged)());const d=M().duration(e.config.get().search.sessions.notTouchedTimeout).asMilliseconds();this.subscription.add(this.state$.pipe((0,l.switchMap)((e=>e===q.Completed?(0,l.merge)((0,l.of)(!1),(0,l.timer)(d).pipe((0,l.mapTo)(!0))):(0,l.of)(!1))),(0,l.distinctUntilChanged)(),(0,l.tap)((e=>{var t;e&&(null===(t=this.usageCollector)||void 0===t||t.trackSessionIndicatorSaveDisabled())}))).subscribe(this._disableSaveAfterSearchesExpire$)),this.subscription.add(u.pipe((0,l.map)((e=>e.startTime)),(0,l.distinctUntilChanged)()).subscribe((e=>{e?this.nowProvider.set(e):this.nowProvider.reset()}))),t().then((([t])=>{var a,s;this.hasAccessToSearchSessions=null===(a=t.application.capabilities.management)||void 0===a||null===(s=a.kibana)||void 0===s?void 0:s[$.j],this.toastService=t.notifications.toasts,this.subscription.add(t.application.currentAppId$.subscribe((a=>{if(this.currentApp=a,!this.getSessionId())return;const s=`Application '${this.state.get().appName}' had an open session while navigating`;e.env.mode.dev?t.fatalErrors.add(s):V.warn(s)})))})),this.subscription.add(this.getSession$().pipe((0,l.switchMap)((e=>e?this.isStored()?l.EMPTY:this.hasAccess()&&this.isSessionStorageReady()?(()=>(0,l.timer)(3e4).pipe((0,l.mergeMap)((()=>{const t=this.state.get().trackedSearches.filter((e=>!e.searchMeta.isStored&&e.state===j.Completed&&e.searchMeta.lastPollingTime.getTime()<Date.now()-5e3));return(0,l.from)(Promise.all(t.map((t=>t.searchDescriptor.poll().catch((t=>{V.warn("Error while polling search to keep it alive. Considering that it is no longer possible to extend a session.",t),this.isCurrentSession(e)&&this._disableSaveAfterSearchesExpire$.next(!0)}))))))})),(0,l.repeat)(),(0,l.takeUntil)(this.disableSaveAfterSearchesExpire$.pipe((0,l.filter)((e=>e))))))():l.EMPTY:l.EMPTY))).subscribe((()=>{})))}hasAccess(){return this.hasAccessToSearchSessions}trackSearch(e){const t=this.getSessionId();return this.state.transitions.trackSearch(e,{lastPollingTime:new Date,isStored:!1}),{complete:()=>{const a=this.isCurrentSession(t)?this.state:this.sessionSnapshots.get(t);if(a){if(a.transitions.completeSearch(e),this.isStored(a)){const t=a.selectors.getSearch(e);t&&!t.searchMeta.isStored&&t.searchDescriptor.poll().catch((e=>{V.warn("Failed to extend search after it was completed",e)}))}}else this.logger.error(`SearchSessionService trackSearch complete: sessionId not found: "${t}"`)},error:()=>{const a=this.isCurrentSession(t)?this.state:this.sessionSnapshots.get(t);a?a.transitions.errorSearch(e):this.logger.error(`SearchSessionService trackSearch error: sessionId not found: "${t}"`)},beforePoll:()=>{var a,s;const i=this.isCurrentSession(t)?this.state:this.sessionSnapshots.get(t),r=null==i?void 0:i.selectors.getSearch(e);return null==i||i.transitions.updateSearchMeta(e,{lastPollingTime:new Date}),[{isSearchStored:null!==(a=null==r||null===(s=r.searchMeta)||void 0===s?void 0:s.isStored)&&void 0!==a&&a},({isSearchStored:t})=>{null==i||i.transitions.updateSearchMeta(e,{isStored:t})}]}}}destroy(){this.subscription.unsubscribe(),this.clear(),this.sessionSnapshots=new LRUCache(K)}getSessionId(){return this.state.get().sessionId}getSession$(){return this.state.state$.pipe((0,l.startWith)(this.state.get()),(0,l.map)((e=>e.sessionId)),(0,l.distinctUntilChanged)())}isSaving(e=this.state){return e.get().isSaving}isStored(e=this.state){return e.get().isStored}isRestore(e=this.state){return e.get().isRestore}start(){if(!this.currentApp)throw new Error("this.currentApp is missing");return this.storeSessionSnapshot(),this.state.transitions.start({appName:this.currentApp}),this.getSessionId()}restore(e){this.storeSessionSnapshot(),this.state.transitions.restore(e),this.refreshSearchSessionSavedObject()}continue(e,t=!1){const a=this.sessionSnapshots.get(e);a?(this.storeSessionSnapshot(),this.state.set({...a.get(),appName:this.currentApp,trackedSearches:t?a.get().trackedSearches:[],isContinued:!0}),this.sessionSnapshots.delete(e)):V.warn(`Unknown ${e} search session id recevied`)}reset(){this.storeSessionSnapshot(),this.state.transitions.clear()}storeSessionSnapshot(){if(!this.getSessionId())return;const e=G({freeze:!1});e.stateContainer.set(this.state.get()),this.sessionSnapshots.set(this.getSessionId(),e.stateContainer)}clear(){const e=this.state.get().appName;e&&e!==this.currentApp?V.warn(`Skip clearing session "${this.getSessionId()}" because it belongs to a different app. current: "${this.currentApp}", owner: "${e}"`):(this.storeSessionSnapshot(),this.state.transitions.clear(),this.searchSessionInfoProvider=void 0,this.searchSessionIndicatorUiConfig=void 0)}async cancel(){const e=this.isStored();this.state.get().trackedSearches.filter((e=>e.state===j.InProgress)).forEach((e=>{e.searchDescriptor.abort()})),this.state.transitions.cancel(),e&&await this.sessionsClient.delete(this.state.get().sessionId)}async save(){const e=this.getSessionId();if(!e)throw new Error("No current session");const t=this.state.get().appName;if(!t)throw new Error("No current session app");if(!this.hasAccess())throw new Error("No access to search sessions");const a=this.searchSessionInfoProvider;if(!a)throw new Error("No info provider for current session");const[s,{initialState:i,restoreState:r,id:n}]=await Promise.all([a.getName(),a.getLocatorData()]),o=(l=s,(u={sessionStartTime:this.state.get().startTime,appendStartTime:a.appendSessionStartTimeToName}).sessionStartTime&&u.appendStartTime&&(l=function(e,t){return`${e} - ${M()(t).format("L @ LT")}`}(l,u.sessionStartTime)),l);var l,u;this.state.transitions.save();const d=await this.sessionsClient.create({name:o,appId:t,locatorId:n,restoreState:r,initialState:i,sessionId:e});if(this.isCurrentSession(e)){this.state.transitions.store(d);const t=this.state.get().trackedSearches.filter((e=>e.state!==j.Errored&&!e.searchMeta.isStored)),a=Promise.all(t.map((e=>e.searchDescriptor.poll((new AbortController).signal).catch((e=>{V.warn("Failed to extend search after session was saved",e)})))));this.state.get().trackedSearches.filter((e=>e.searchDescriptor.onSavingSession)).forEach((t=>t.searchDescriptor.onSavingSession({sessionId:e,isRestore:this.isRestore(),isStored:this.isStored()}).catch((e=>{V.warn('Failed to execute "onSavingSession" handler after session was saved',e)})))),await a}return d}async renameCurrentSession(e){const t=this.getSessionId();if(t&&this.state.get().isStored){let s=!1;try{await this.sessionsClient.rename(t,e),s=!0}catch(e){var a;null===(a=this.toastService)||void 0===a||a.addError(e,{title:p.i18n.translate("data.searchSessions.sessionService.backgroundSearchEditNameError",{defaultMessage:"Failed to edit name of the background search"})})}s&&t===this.getSessionId()&&await this.refreshSearchSessionSavedObject()}}isCurrentSession(e){return!!e&&this.getSessionId()===e}getSearchOptions(e){if(!e)return null;if(!this.hasAccessToSearchSessions)return null;const t=this.isCurrentSession(e)?this.state:this.sessionSnapshots.get(e);return{sessionId:e,isRestore:!!t&&this.isRestore(t),isStored:!!t&&this.isStored(t)}}enableStorage(e,t){this.searchSessionInfoProvider={appendSessionStartTimeToName:!0,...e},this.searchSessionIndicatorUiConfig=t}isSessionStorageReady(){return!!this.searchSessionInfoProvider}getSearchSessionIndicatorUiConfig(){return{isDisabled:()=>({disabled:!1}),...this.searchSessionIndicatorUiConfig}}async refreshSearchSessionSavedObject(){const e=this.getSessionId();if(e&&this.state.get().isStored)try{const t=await this.sessionsClient.get(e);this.getSessionId()===e&&this.state.transitions.setSearchSessionSavedObject(t)}catch(e){var t;null===(t=this.toastService)||void 0===t||t.addError(e,{title:p.i18n.translate("data.searchSessions.sessionService.backgroundSearchObjectFetchError",{defaultMessage:"Failed to fetch background search info"})})}}}const H="1",Y={version:H};class SessionsClient{constructor(e){(0,T.default)(this,"http",void 0),this.http=e.http}get(e){return this.http.get(`/internal/session/${encodeURIComponent(e)}`,Y)}create({name:e,appId:t,locatorId:a,initialState:s,restoreState:i,sessionId:r}){return this.http.post("/internal/session",{version:H,body:JSON.stringify({name:e,appId:t,locatorId:a,initialState:s,restoreState:i,sessionId:r})})}find(e){return this.http.post("/internal/session/_find",{version:H,body:JSON.stringify(e)})}update(e,t){return this.http.put(`/internal/session/${encodeURIComponent(e)}`,{version:H,body:JSON.stringify(t)})}async rename(e,t){await this.update(e,{name:t})}async extend(e,t){await this.http.post(`/internal/session/${encodeURIComponent(e)}/_extend`,{version:H,body:JSON.stringify({expires:t})})}delete(e){return this.http.delete(`/internal/session/${encodeURIComponent(e)}`,Y)}}const W=p.i18n.translate("data.searchSessionIndicator.noCapability",{defaultMessage:"You don't have permissions to create background searches."});function Q(e,{waitForIdle:t=1e3}={waitForIdle:1e3}){return e.state$.pipe((0,l.skipUntil)(e.state$.pipe((0,l.first)((e=>e===q.None)))),(0,l.skipUntil)(e.state$.pipe((0,l.first)((e=>e===q.Loading)))),(0,l.debounceTime)(t),(0,l.first)((e=>e===q.Completed||e===q.BackgroundCompleted)))}var J=a(2798),X=a(5804);const Z=__kbnSharedDeps__.KbnSearchErrors;var ee=a(1359);const te="data_search_timeout",ae="timeout_ms",se="execution_context";var ie=a(4286),re=a.n(ie),ne=a(1319),oe=a(6791);let le=function(e){return e[e.CONTACT=0]="CONTACT",e[e.CHANGE=1]="CHANGE",e}({});class SearchTimeoutError extends ee.KbnError{constructor(e,t){super(`Request timeout: ${JSON.stringify(null==e?void 0:e.message)}`),(0,T.default)(this,"mode",void 0),this.mode=t}getMessage(){switch(this.mode){case le.CONTACT:return p.i18n.translate("data.search.timeoutContactAdmin",{defaultMessage:"Your query has timed out. Contact your system administrator to increase the run time."});case le.CHANGE:return p.i18n.translate("data.search.timeoutIncreaseSetting",{defaultMessage:"Your query has timed out. Increase run time with the search timeout advanced setting."})}}getActionText(){if(this.mode===le.CHANGE)return p.i18n.translate("data.search.timeoutIncreaseSettingActionText",{defaultMessage:"Edit setting"})}onClick(e){this.mode===le.CHANGE&&e.navigateToApp("management",{path:"/kibana/settings"})}getErrorMessage(e){const t=this.getActionText();return(0,oe.jsx)(re().Fragment,null,this.getMessage(),t&&(0,oe.jsx)(re().Fragment,null,(0,oe.jsx)(ne.EuiSpacer,{size:"s"}),(0,oe.jsx)(ne.EuiText,{textAlign:"right"},(0,oe.jsx)(ne.EuiButton,{color:"danger",onClick:()=>this.onClick(e),size:"s","data-test-subj":"searchTimeoutError"},t))))}}var ue=a(5879);class SearchResponseCache{constructor(e,t){(0,T.default)(this,"responseCache",void 0),(0,T.default)(this,"cacheSize",0),this.maxItems=e,this.maxCacheSizeMB=t,this.responseCache=new Map}byteToMb(e){return e/1048576}deleteItem(e,t=!0){const a=this.responseCache.get(e);a&&(t&&a.subs.unsubscribe(),this.cacheSize-=a.size,this.responseCache.delete(e))}setItem(e,t){this.deleteItem(e,!1),this.cacheSize+=t.size,this.responseCache.set(e,t)}clear(){this.cacheSize=0,this.responseCache.forEach((e=>{e.subs.unsubscribe()})),this.responseCache.clear()}shrink(){for(;this.responseCache.size>this.maxItems||this.byteToMb(this.cacheSize)>this.maxCacheSizeMB;){const[e]=[...this.responseCache.keys()];this.deleteItem(e)}}has(e){return this.responseCache.has(e)}set(e,t){if(this.responseCache.has(e))throw new Error("duplicate key");const{response$:a,searchAbortController:s}=t,i={response$:a,searchAbortController:s,subs:new l.Subscription,size:0};this.setItem(e,i),i.subs.add(a.subscribe({next:t=>{const a=new Blob([JSON.stringify(t)]).size;this.byteToMb(a)<this.maxCacheSizeMB?(this.setItem(e,{...i,size:a}),this.shrink()):this.deleteItem(e)},error:t=>{this.deleteItem(e)}})),this.shrink()}get(e){const t=this.responseCache.get(e);if(t)return this.setItem(e,t),{response$:t.response$,searchAbortController:t.searchAbortController}}}let de=function(e){return e.Timeout="timeout",e}({});class SearchAbortController{constructor(e){(0,T.default)(this,"inputAbortSignals",new Array),(0,T.default)(this,"abortController",new AbortController),(0,T.default)(this,"timeoutSub",void 0),(0,T.default)(this,"destroyed",!1),(0,T.default)(this,"reason",void 0),(0,T.default)(this,"abortHandler",(()=>{this.inputAbortSignals.every((e=>e.aborted))&&(this.abortController.abort(),this.cleanup())})),e&&(this.timeoutSub=(0,l.timer)(e).subscribe((()=>{this.reason=de.Timeout,this.abortController.abort(),this.timeoutSub.unsubscribe()})))}cleanup(){var e;this.destroyed||(this.destroyed=!0,null===(e=this.timeoutSub)||void 0===e||e.unsubscribe(),this.inputAbortSignals.forEach((e=>{e.removeEventListener("abort",this.abortHandler)})))}addAbortSignal(e){this.destroyed||(this.inputAbortSignals.push(e),e.aborted?this.abortHandler():e.addEventListener("abort",this.abortHandler))}getSignal(){return this.abortController.signal}abort(){this.cleanup(),this.abortController.abort()}isTimeout(){return this.reason===de.Timeout}}const ce=__kbnSharedDeps__.KbnCryptoBrowser;var ge=a(9457),he=a.n(ge),pe=a(3721);class SearchInterceptor{constructor(e){(0,T.default)(this,"uiSettingsSubs",[]),(0,T.default)(this,"searchTimeout",void 0),(0,T.default)(this,"responseCache",new SearchResponseCache(50,10)),(0,T.default)(this,"pendingCount$",new l.BehaviorSubject(0)),(0,T.default)(this,"application",void 0),(0,T.default)(this,"docLinks",void 0),(0,T.default)(this,"inspector",void 0),(0,T.default)(this,"startRenderServices",void 0),(0,T.default)(this,"showTimeoutErrorToast",((e,t)=>{this.deps.toasts.addDanger({title:"Timed out",text:(0,X.toMountPoint)(e.getErrorMessage(this.application),this.startRenderServices),toastLifeTimeMs:6048e5})})),(0,T.default)(this,"showTimeoutErrorMemoized",(0,o.memoize)(this.showTimeoutErrorToast,((e,t)=>t))),(0,T.default)(this,"showRestoreWarningToast",(async e=>{var t;this.deps.toasts.addWarning({title:p.i18n.translate("data.searchService.backgroundSearchRestoreWarning",{defaultMessage:"Your background search is still running"}),text:(0,X.toMountPoint)((t=this.docLinks,(0,oe.jsx)(re().Fragment,null,(0,oe.jsx)(ne.EuiSpacer,{size:"s"}),"It needs more time to fully render. You can wait here or come back to it later.",(0,oe.jsx)(ne.EuiSpacer,{size:"m"}),(0,oe.jsx)(ne.EuiText,{textAlign:"right"},(0,oe.jsx)(ne.EuiLink,{href:t.links.search.sessionLimits,color:"warning",target:"_blank","data-test-subj":"searchSessionIncompleteWarning",external:!0},(0,oe.jsx)(ue.FormattedMessage,{id:"data.searchSession.warning.readDocs",defaultMessage:"Read More"}))))),this.startRenderServices)},{toastLifeTimeMs:6e4})})),(0,T.default)(this,"showRestoreWarning",(0,o.memoize)(this.showRestoreWarningToast)),(0,T.default)(this,"showTimeoutError",((e,t)=>{t?this.showTimeoutErrorMemoized(e,t):this.showTimeoutErrorToast(e,t)})),this.deps=e,this.deps.http.addLoadingCountSource(this.pendingCount$),this.deps.startServices.then((([e,t])=>{const{application:a,docLinks:s,...i}=e;this.application=a,this.docLinks=s,this.startRenderServices=i,this.inspector=t.inspector})),this.searchTimeout=e.uiSettings.get(s.UI_SETTINGS.SEARCH_TIMEOUT),this.uiSettingsSubs.push(e.uiSettings.get$(s.UI_SETTINGS.SEARCH_TIMEOUT).subscribe((e=>{this.searchTimeout=e})))}stop(){this.responseCache.clear(),this.uiSettingsSubs.forEach((e=>e.unsubscribe()))}getTimeoutMode(){var e;return null!==(e=this.application.capabilities.advancedSettings)&&void 0!==e&&e.save?le.CHANGE:le.CONTACT}createRequestHash$(e,t){const{sessionId:a}=t,{preference:s,...i}=e.params||{},r={...i,sessionId:a};if(!a)return(0,l.of)(void 0);const n=this.deps.session.getSearchOptions(t.sessionId);return null!=n&&n.isRestore?(0,l.of)(void 0):(0,l.from)(async function(e){return(new ce.Sha256).update(he()(e),"utf8").digest("hex")}(r))}handleSearchError(e,t,a,s){if(s||"Request timed out"===e.message){const t=new SearchTimeoutError(e,this.getTimeoutMode());return this.showTimeoutError(t,null==a?void 0:a.sessionId),t}if(e instanceof B.AbortError)return e;if((0,Z.isEsError)(e)){const s=()=>{var s,i,r,n,o;const l=null!==(s=null==a||null===(i=a.inspector)||void 0===i?void 0:i.id)&&void 0!==s?s:(0,P.v4)(),u=null!==(r=null==a||null===(n=a.inspector)||void 0===n?void 0:n.adapter)&&void 0!==r?r:new J.RequestAdapter;if(null==a||null===(o=a.inspector)||void 0===o||!o.adapter){const a=u.start(p.i18n.translate("data.searchService.anonymousRequestTitle",{defaultMessage:"Request"}),{id:l});a.json(t),a.error({json:e.attributes})}this.inspector.open({requests:u},{options:{initialRequestId:l,initialTabs:["clusters","response"]}})};return(0,Z.createEsError)(e,s,{application:this.application,docLinks:this.docLinks},null==a?void 0:a.indexPattern)}return e instanceof Error?e:new Error(e.message)}getSerializableOptions(e){const{sessionId:t,...a}=e||{},s={},i={...a,...this.deps.session.getSearchOptions(t)};return void 0!==i.sessionId&&(s.sessionId=i.sessionId),void 0!==i.isRestore&&(s.isRestore=i.isRestore),void 0!==i.retrieveResults&&(s.retrieveResults=i.retrieveResults),void 0!==i.legacyHitsTotal&&(s.legacyHitsTotal=i.legacyHitsTotal),void 0!==i.strategy&&(s.strategy=i.strategy),void 0!==i.isStored&&(s.isStored=i.isStored),void 0!==i.isSearchStored&&(s.isSearchStored=i.isSearchStored),void 0!==i.executionContext&&(s.executionContext=i.executionContext),s}runSearch$({id:e,...t},a,i){const{sessionId:r,strategy:n}=a,u=({abortSignal:s=i.getSignal()}={})=>{var n;const[{isSearchStored:o},l]=null!==(n=null==d?void 0:d.beforePoll())&&void 0!==n?n:[{isSearchStored:!1},()=>{}];return this.runSearch({id:e,...t},{...a,...this.deps.session.getSearchOptions(r),abortSignal:s,isSearchStored:o}).then((e=>{var t;return l({isSearchStored:null!==(t=e.isStored)&&void 0!==t&&t}),e})).catch((e=>{throw l({isSearchStored:!1}),e}))},d=this.deps.session.isCurrentSession(r)?this.deps.session.trackSearch({abort:()=>i.abort(),poll:async t=>{e&&await u({abortSignal:t})}}):void 0;let c=this.deps.session.isCurrentSession(r)&&(this.deps.session.isSaving()||this.deps.session.isStored());c&&i.cleanup();const g=this.deps.session.isCurrentSession(r)&&this.deps.session.state$.pipe((0,l.skip)(1),(0,l.filter)((e=>this.deps.session.isCurrentSession(r)&&e===q.BackgroundLoading)),(0,l.take)(1)).subscribe((()=>{i.cleanup(),c=!0})),h=(0,o.once)((()=>this.deps.http.delete(`/internal/search/${n}/${e}`,{version:"1"}))),p=async()=>{if(e&&!c&&!i.isTimeout())try{await h()}catch(e){pe.error(e)}};let f;return(0,s.pollSearch)(u,p,{pollInterval:this.deps.searchConfig.asyncSearch.pollInterval,...a,abortSignal:i.getSignal()}).pipe((0,l.tap)((t=>{!f&&t.requestParams&&(f=t.requestParams),e=t.id,(0,s.isRunningResponse)(t)||null==d||d.complete()})),(0,l.map)((e=>f?{...e,requestParams:f}:e)),(0,l.catchError)((r=>i.isTimeout()?(this.startRenderServices.analytics.reportEvent(te,{[ae]:this.searchTimeout,[se]:a.executionContext}),(0,l.from)(this.runSearch({id:e,...t},{...a,retrieveResults:!0})).pipe((0,l.map)((e=>a.strategy===s.ENHANCED_ES_SEARCH_STRATEGY?function(e){const{rawResponse:t}=e,{_clusters:a}=t;if(a){const s=Object.fromEntries(Object.keys(a.details).map((e=>[e,"running"!==a.details[e].status?a.details[e]:{...a.details[e],status:"partial",timed_out:!0}])));return{...e,isRunning:!1,rawResponse:{...t,timed_out:!0,_clusters:{...a,details:s}}}}return{...e,isRunning:!1,rawResponse:{...t,timed_out:!0}}}(e):e)),(0,l.tap)((async()=>{var e,s;await h(),this.handleSearchError(r,null!==(e=null==t||null===(s=t.params)||void 0===s?void 0:s.body)&&void 0!==e?e:{},a,!0)})))):(c||(null==d||d.error(),p()),(0,l.throwError)(r)))),(0,l.finalize)((()=>{i.cleanup(),g&&g.unsubscribe()})),(0,l.shareReplay)(1))}runSearch(e,t){const{abortSignal:a}=t||{},{executionContext:i,strategy:r,...n}=this.getSerializableOptions(t);return this.deps.http.post(`/internal/search/${r}${e.id?`/${e.id}`:""}`,{version:"1",signal:a,context:this.deps.executionContext.withGlobalContext(i),body:JSON.stringify({...e,...n,stream:r===s.ESQL_ASYNC_SEARCH_STRATEGY||r===s.ENHANCED_ES_SEARCH_STRATEGY||void 0===r}),asResponse:!0}).then((e=>{var t,a,i,o;const l=null===(t=e.response)||void 0===t?void 0:t.headers.get("warning"),u=e.body&&"requestParams"in e.body?e.body.requestParams:JSON.parse((null===(a=e.response)||void 0===a?void 0:a.headers.get("kbn-search-request-params"))||"{}"),d=e.body&&"isRestored"in e.body?e.body.isRestored:"?1"===(null===(i=e.response)||void 0===i?void 0:i.headers.get("kbn-search-is-restored"));if(e.body&&"error"in e.body)throw{attributes:{error:e.body.error,rawResponse:e.body,requestParams:u,isRestored:d}};switch(r){case s.ENHANCED_ES_SEARCH_STRATEGY:if(null!==(o=e.body)&&void 0!==o&&o.rawResponse)return e.body;const t=e.body,a=(0,s.shimHitsTotal)(t.response,{legacyHitsTotal:n.legacyHitsTotal});return{id:t.id,isPartial:t.is_partial,isRunning:t.is_running,rawResponse:a,warning:l,requestParams:u,isRestored:d,...(0,s.getTotalLoaded)(a)};case s.ESQL_ASYNC_SEARCH_STRATEGY:const i=e.body;return{id:i.id,rawResponse:i,isPartial:i.is_partial,isRunning:i.is_running,isRestored:d,requestParams:u,warning:l};default:return e.body}})).catch((e=>{throw null!=e&&e.body?e.body:e}))}getSearchResponse$(e,t,a){var s;const i=a?this.responseCache.get(a):void 0,r=(null==i?void 0:i.searchAbortController)||new SearchAbortController(this.searchTimeout);r.addAbortSignal(null!==(s=t.abortSignal)&&void 0!==s?s:(new AbortController).signal);const n=(null==i?void 0:i.response$)||this.runSearch$(e,t,r);return a&&!this.responseCache.has(a)&&this.responseCache.set(a,{response$:n,searchAbortController:r}),{response$:n,searchAbortController:r}}search({id:e,...t},a={}){const i={...a};i.strategy||(i.strategy=s.ENHANCED_ES_SEARCH_STRATEGY);const{sessionId:r,abortSignal:n}=i;return this.createRequestHash$(t,i).pipe((0,l.switchMap)((e=>{const{searchAbortController:a,response$:s}=this.getSearchResponse$(t,i,e);this.pendingCount$.next(this.pendingCount$.getValue()+1);const o=(n?(0,l.fromEvent)(n,"abort"):l.EMPTY).pipe((0,l.map)((()=>{throw new B.AbortError})));return s.pipe((0,l.takeUntil)(o),(0,l.catchError)((e=>{var s,r;return(0,l.throwError)(this.handleSearchError(e,null!==(s=null==t||null===(r=t.params)||void 0===r?void 0:r.body)&&void 0!==s?s:{},i,a.isTimeout()))})),(0,l.tap)((e=>{r&&r===this.deps.session.getSessionId()&&this.deps.session.isRestore()&&!1===e.isRestored&&this.showRestoreWarning(r),(0,ee.defaultFreeze)(e)})),(0,l.finalize)((()=>{this.pendingCount$.next(this.pendingCount$.getValue()-1)})))})))}showError(e){if(e instanceof B.AbortError||e instanceof SearchTimeoutError)return;const t=(0,Z.renderSearchError)(e);t?this.deps.toasts.addDanger({title:t.title,text:(0,X.toMountPoint)(t.body,this.startRenderServices)}):this.deps.toasts.addError(e,{title:"Search Error"})}}const fe=p.i18n.translate("searchResponseWarnings.viewDetailsButtonLabel",{defaultMessage:"View details",description:"View warning details button label"});function me(e){const t=new Set;return e.forEach((e=>{Object.keys(e.clusters).forEach((a=>{"successful"!==e.clusters[a].status&&t.add(a)}))})),t}function ye(e){const t=me(e),a=p.i18n.translate("searchResponseWarnings.title.clustersClause",{defaultMessage:"Problem with {nonSuccessfulClustersCount} {nonSuccessfulClustersCount, plural, one {cluster} other {clusters}}",values:{nonSuccessfulClustersCount:t.size}});return e.length<=1?a:p.i18n.translate("searchResponseWarnings.title.clustersClauseAndRequestsClause",{defaultMessage:"{clustersClause} in {requestsCount} requests",values:{clustersClause:a,requestsCount:e.length}})}function be(e){return me(e).size<=1?p.i18n.translate("searchResponseWarnings.description.singleCluster",{defaultMessage:"This cluster had issues returning data and results might be incomplete."}):p.i18n.translate("searchResponseWarnings.description.multipleClusters",{defaultMessage:"These clusters had issues returning data and results might be incomplete."})}function ve({callback:e,request:t,requestId:a,requestName:s,requestAdapter:i,response:r,services:n}){const o=function(e,t,a,s,i){const r=[];var n;return(e._clusters?e._clusters.partial>0||e._clusters.skipped>0||e._clusters.running>0:"timed_out"in e&&e.timed_out||"_shards"in e&&e._shards.failed>0)&&r.push({type:"incomplete",requestName:s,clusters:e._clusters?null!==(n=e._clusters.details)&&void 0!==n?n:{}:{"(local)":{status:"partial",indices:"",took:e.took,timed_out:"timed_out"in e&&e.timed_out,..."_shards"in e?{_shards:e._shards,failures:e._shards.failures}:{}}},openInInspector:()=>{t.open({requests:a},{options:{initialRequestId:i,initialTabs:["clusters","response"]}})}}),r}(r,n.inspector,i,s,a);if(0===o.length)return;const l=e?function(e,t,a,s,i){const r=[];return e.forEach((e=>{(null==t?void 0:t(e,{requestId:i,request:a,response:s}))||r.push(e)})),r}(o,e,t,r,a):o;if(0===l.length)return;const u=l.filter((e=>"incomplete"===e.type));if(0===u.length)return;const[d]=u;n.notifications.toasts.addWarning({title:ye([d]),text:(0,X.toMountPoint)((0,oe.jsx)(re().Fragment,null,(0,oe.jsx)(ne.EuiText,{size:"s"},be([d])),(0,oe.jsx)(ne.EuiButtonEmpty,{color:"primary",flush:"left",onClick:()=>{d.openInInspector()},"data-test-subj":"viewWarningBtn"},fe)),n)})}var Se=a(8887),_e=a(4882),Te=a(6721),Ee=a(7451);class AggsService{constructor(){(0,T.default)(this,"aggsCommonService",new Ee.fXy({shouldDetectTimeZone:!0})),(0,T.default)(this,"getConfig",void 0),(0,T.default)(this,"subscriptions",[]),(0,T.default)(this,"nowProvider",void 0),(0,T.default)(this,"calculateBounds",(e=>(0,s.calculateBounds)(e,{forceNow:this.nowProvider.get()})))}setup({registerFunction:e,uiSettings:t,nowProvider:a}){return this.nowProvider=a,this.getConfig=function(e,t,a){const s={};return t.forEach((t=>{a.push(e.get$(t).subscribe((e=>{s[t]=e})))})),e=>s[e]}(t,Ee.PX$,this.subscriptions),this.aggsCommonService.setup({registerFunction:e})}start({indexPatterns:e,fieldFormats:t}){const{calculateAutoTimeExpression:a,types:s,createAggConfigs:i}=this.aggsCommonService.start({getConfig:this.getConfig,getIndexPattern:e.get,calculateBounds:this.calculateBounds,fieldFormats:t});return{calculateAutoTimeExpression:a,createAggConfigs:i,types:s}}stop(){this.subscriptions.forEach((e=>e.unsubscribe())),this.subscriptions=[]}}const Me=__kbnSharedDeps__.KbnAnalytics;let Fe=function(e){return e.QUERY_TIMED_OUT="queryTimedOut",e.SESSION_INDICATOR_TOUR_LOADING="sessionIndicatorTourLoading",e.SESSION_INDICATOR_TOUR_RESTORED="sessionIndicatorTourRestored",e.SESSION_INDICATOR_SAVE_DISABLED="sessionIndicatorSaveDisabled",e.SESSION_SENT_TO_BACKGROUND="sessionSentToBackground",e.SESSION_SAVED_RESULTS="sessionSavedResults",e.SESSION_VIEW_RESTORED="sessionViewRestored",e.SESSION_IS_RESTORED="sessionIsRestored",e.SESSION_RELOADED="sessionReloaded",e.SESSION_EXTENDED="sessionExtended",e.SESSION_CANCELLED="sessionCancelled",e.SESSION_DELETED="sessionDeleted",e.SESSION_VIEW_LIST="sessionViewList",e.SESSIONS_LIST_LOADED="sessionsListLoaded",e}({});var Ae=a(3746);class SearchService{constructor(e){(0,T.default)(this,"aggsService",new AggsService),(0,T.default)(this,"searchSourceService",new b.zA1),(0,T.default)(this,"searchInterceptor",void 0),(0,T.default)(this,"usageCollector",void 0),(0,T.default)(this,"sessionService",void 0),(0,T.default)(this,"sessionsClient",void 0),this.initializerContext=e}setup(e,{expressions:t,usageCollection:a,nowProvider:s,management:i}){const{http:r,getStartServices:n,notifications:u,uiSettings:T,executionContext:E}=e;this.usageCollector=((e,t)=>{const a=(a,s)=>async()=>{const i=await(async()=>{const[{application:t}]=await e();return t.currentAppId$.pipe((0,l.first)()).toPromise()})();return null==t?void 0:t.reportUiCounter(i,a,s)};return{trackQueryTimedOut:a(Me.METRIC_TYPE.LOADED,Fe.QUERY_TIMED_OUT),trackSessionIndicatorTourLoading:a(Me.METRIC_TYPE.LOADED,Fe.SESSION_INDICATOR_TOUR_LOADING),trackSessionIndicatorTourRestored:a(Me.METRIC_TYPE.LOADED,Fe.SESSION_INDICATOR_TOUR_RESTORED),trackSessionIndicatorSaveDisabled:a(Me.METRIC_TYPE.LOADED,Fe.SESSION_INDICATOR_SAVE_DISABLED),trackSessionSentToBackground:a(Me.METRIC_TYPE.CLICK,Fe.SESSION_SENT_TO_BACKGROUND),trackSessionSavedResults:a(Me.METRIC_TYPE.CLICK,Fe.SESSION_SAVED_RESULTS),trackSessionViewRestored:a(Me.METRIC_TYPE.CLICK,Fe.SESSION_VIEW_RESTORED),trackSessionIsRestored:a(Me.METRIC_TYPE.CLICK,Fe.SESSION_IS_RESTORED),trackSessionReloaded:a(Me.METRIC_TYPE.CLICK,Fe.SESSION_RELOADED),trackSessionExtended:a(Me.METRIC_TYPE.CLICK,Fe.SESSION_EXTENDED),trackSessionCancelled:a(Me.METRIC_TYPE.CLICK,Fe.SESSION_CANCELLED),trackSessionDeleted:a(Me.METRIC_TYPE.CLICK,Fe.SESSION_DELETED),trackViewSessionsList:a(Me.METRIC_TYPE.CLICK,Fe.SESSION_VIEW_LIST),trackSessionsListLoaded:a(Me.METRIC_TYPE.LOADED,Fe.SESSIONS_LIST_LOADED)}})(n,a),this.sessionsClient=new SessionsClient({http:r}),this.sessionService=new SessionService(this.initializerContext,n,this.sessionsClient,s,this.usageCollector),this.searchInterceptor=new SearchInterceptor({toasts:u.toasts,executionContext:E,http:r,uiSettings:T,startServices:n(),usageCollector:this.usageCollector,session:this.sessionService,searchConfig:this.initializerContext.config.get().search}),t.registerFunction(d({getStartServices:n})),t.registerFunction(b.L1),t.registerFunction(b.dtO),t.registerFunction(b.Muh),t.registerFunction(b.BUn),t.registerFunction(b.eYm),t.registerFunction(b.rDs),t.registerFunction(b.bOY),t.registerFunction(b.hnj),t.registerFunction(b.JW4),t.registerFunction(b.rgn),t.registerFunction(b.wcW),t.registerFunction(b.TU9),t.registerFunction(b.aw$),t.registerFunction(b.EM$),t.registerFunction(b.JjL),t.registerFunction(b.rk1),t.registerFunction(b.PFs),t.registerFunction(b.c$p),t.registerFunction(b.LSk),t.registerFunction(b.XIV),t.registerFunction(b.SvO),t.registerFunction(function({getStartServices:e}){return(0,c.u)({getStartDependencies:async()=>{const[t,,{search:a}]=await e();return{uiSettingsClient:t.uiSettings,search:a.search}}})}({getStartServices:n})),t.registerFunction(function({getStartServices:e}){return(({getStartDependencies:e})=>{const t={name:"essql",type:"datatable",inputTypes:["kibana_context","null"],allowCache:!0,help:p.i18n.translate("data.search.essql.help",{defaultMessage:"Queries Elasticsearch using Elasticsearch SQL."}),args:{query:{aliases:["_","q"],types:["string"],help:p.i18n.translate("data.search.essql.query.help",{defaultMessage:"An Elasticsearch SQL query."})},parameter:{aliases:["param"],types:["string","number","boolean"],multi:!0,help:p.i18n.translate("data.search.essql.parameter.help",{defaultMessage:"A parameter to be passed to the SQL query."})},count:{types:["number"],help:p.i18n.translate("data.search.essql.count.help",{defaultMessage:"The number of documents to retrieve. For better performance, use a smaller data set."}),default:1e3},timezone:{aliases:["tz"],types:["string"],default:"UTC",help:p.i18n.translate("data.search.essql.timezone.help",{defaultMessage:"The timezone to use for date operations. Valid ISO8601 formats and UTC offsets both work."})},timeField:{aliases:["timeField"],types:["string"],help:p.i18n.translate("data.search.essql.timeField.help",{defaultMessage:"The time field to use in the time range filter set in the context."})}},fn:(t,{count:a,parameter:s,query:i,timeField:r,timezone:n},{abortSignal:u,inspectorAdapters:d,getKibanaRequest:c})=>(0,l.defer)((()=>e((()=>{const e=null==c?void 0:c();if(!e)throw new Error("A KibanaRequest is required to run queries on the server. Please provide a request object to the expression execution params.");return e})))).pipe((0,l.switchMap)((({nowProvider:e,search:o,uiSettings:c})=>{const h={query:i,fetch_size:a,time_zone:n,params:s,field_multi_value_leniency:!0};if(t){var v;const a=(0,m.F)(c),s=t.timeRange&&(0,y.WB)(void 0,t.timeRange,{fieldName:r,forceNow:null==e?void 0:e.get()});h.filter=(0,g.buildEsQuery)(void 0,t.query||[],[...null!==(v=t.filters)&&void 0!==v?v:[],...s?[s]:[]],a)}let S=Date.now();const _=()=>{d.requests||(d.requests=new f.RequestAdapter);const e=d.requests.start(p.i18n.translate("data.search.dataRequest.title",{defaultMessage:"Data"}),{description:p.i18n.translate("data.search.es_search.dataRequest.description",{defaultMessage:"This request queries Elasticsearch to fetch the data for the visualization."})},S);return S=Date.now(),e};return o({params:h},{abortSignal:u,strategy:b.UNd}).pipe((0,l.catchError)((e=>{if(e.attributes){const{type:t,reason:a}=e.attributes;e.message="parsing_exception"===t?`Couldn't parse Elasticsearch SQL query. You may need to add double quotes to names containing special characters. Check your query and try again. Error: ${a}`:`Unexpected error from Elasticsearch: ${t} - ${a}`}else e.message=`Unexpected error from Elasticsearch: ${e.message}`;return(0,l.throwError)((()=>e))})),(0,l.tap)({next({rawResponse:e,requestParams:t,took:a}){_().stats({hits:{label:p.i18n.translate("data.search.es_search.hitsLabel",{defaultMessage:"Hits"}),value:`${e.rows.length}`,description:p.i18n.translate("data.search.es_search.hitsDescription",{defaultMessage:"The number of documents returned by the query."})},queryTime:{label:p.i18n.translate("data.search.es_search.queryTimeLabel",{defaultMessage:"Query time"}),value:p.i18n.translate("data.search.es_search.queryTimeValue",{defaultMessage:"{queryTime}ms",values:{queryTime:a}}),description:p.i18n.translate("data.search.es_search.queryTimeDescription",{defaultMessage:"The time it took to process the query. Does not include the time to send the request or parse it in the browser."})}}).json(h).ok({json:e,requestParams:t})},error(e){_().error({json:"attributes"in e?e.attributes:{message:e.message}})}}))})),(0,l.map)((({rawResponse:e})=>{var t,a;const s=null!==(t=null===(a=e.columns)||void 0===a?void 0:a.map((({name:e,type:t})=>({id:v(e),name:v(e),meta:{type:(0,h.s0)(t)}}))))&&void 0!==t?t:[],i=s.map((({name:e})=>e));return{type:"datatable",meta:{type:"essql"},columns:s,rows:e.rows.map((e=>(0,o.zipObject)(i,e)))}})))};return t})({async getStartDependencies(){const[{uiSettings:t},,{nowProvider:a,search:{search:s}}]=await e();return{nowProvider:a,search:s,uiSettings:t}}})}({getStartServices:n})),t.registerFunction(function({getStartServices:e}){return(0,S.y)({async getStartDependencies(){const[{uiSettings:t},,{nowProvider:a,search:{search:s}}]=await e();return{nowProvider:a,search:s,uiSettings:t}}})}({getStartServices:n})),t.registerFunction(function({getStartServices:e}){return(0,_.l)({getStartDependencies:async()=>{const[t,,{search:a,indexPatterns:s}]=await e();return{uiSettingsClient:t.uiSettings,search:a.search,dataViews:s}}})}({getStartServices:n})),t.registerType(b.uzQ),t.registerType(b.iLg);const M=this.aggsService.setup({uiSettings:T,registerFunction:t.registerFunction,nowProvider:s});this.initializerContext.config.get().search.aggs.shardDelay.enabled&&(M.types.registerBucket(_e.v,_e.V),t.registerFunction(Te.H));const F=this.initializerContext.config.get();if(F.search.sessions.enabled){const t=F.search.sessions;(0,Ae._o)(e,{management:i,searchUsageCollector:this.usageCollector,sessionsClient:this.sessionsClient},t,this.initializerContext.env.packageInfo.version)}return{aggs:M,usageCollector:this.usageCollector,session:this.sessionService,sessionsClient:this.sessionsClient}}start(e,{fieldFormats:t,indexPatterns:a,inspector:s,screenshotMode:i,scriptedFieldsEnabled:r,share:n}){const{http:o,uiSettings:u,chrome:d,application:c,notifications:g,...h}=e,f=(e,t={})=>this.searchInterceptor.search(e,t),m=new l.BehaviorSubject(0);o.addLoadingCountSource(m);const y=this.aggsService.start({fieldFormats:t,indexPatterns:a}),b={inspector:s,notifications:g,...h},v={aggs:y,getConfig:u.get.bind(u),search:f,dataViews:a,onResponse:(e,t,a)=>{if(!a.disableWarningToasts){var s,i,r,n;const{rawResponse:o}=t,l=null!==(s=a.inspector)&&void 0!==s&&s.title?a.inspector.title:p.i18n.translate("data.searchService.anonymousRequestTitle",{defaultMessage:"Request"}),u=null!==(i=a.inspector)&&void 0!==i&&i.adapter?null===(r=a.inspector)||void 0===r?void 0:r.adapter:new Se.RequestAdapter;if(null===(n=a.inspector)||void 0===n||!n.adapter){const a=u.start(l,{id:e.id});a.json(e.body),a.ok({json:t})}ve({request:e.body,requestAdapter:u,requestId:e.id,requestName:l,response:o,services:b})}return t},scriptedFieldsEnabled:r},S=this.initializerContext.config.get();return{aggs:y,search:f,showError:e=>{this.searchInterceptor.showError(e)},showSearchSessionsFlyout:(0,Ae.PI)({coreStart:e,kibanaVersion:this.initializerContext.env.packageInfo.version,usageCollector:this.usageCollector,config:S.search.sessions,sessionsClient:this.sessionsClient,share:n}),showWarnings:(e,t)=>{null==e||e.getRequests().forEach((a=>{var s,i;const r=null===(s=a.response)||void 0===s||null===(i=s.json)||void 0===i?void 0:i.rawResponse;r&&ve({callback:t,request:a.json,requestAdapter:e,requestId:a.id,requestName:a.name,response:r,services:b})}))},isBackgroundSearchEnabled:S.search.sessions.enabled,session:this.sessionService,sessionsClient:this.sessionsClient,searchSource:this.searchSourceService.start(a,v)}}stop(){this.aggsService.stop(),this.searchSourceService.stop(),this.searchInterceptor.stop()}}var Ie=a(151);class NowProvider{constructor(){(0,T.default)(this,"nowFromUrl",function(){const e=function(){const e=window.location.href.split("?");return e.length<=1?{}:(0,Ie.parse)(e[1],{sort:!1})}().forceNow;if(!e)return;const t=Date.parse(e);if(isNaN(t))throw new Error(`forceNow query parameter, ${e}, can't be parsed by Date.parse`);return new Date(t)}()),(0,T.default)(this,"now",void 0)}get(){return this.nowFromUrl?this.nowFromUrl:this.now?this.now:new Date}set(e){this.now=e}reset(){this.now=void 0}}var we=a(583),xe=a(8560);const ke=(0,ie.lazy)((()=>a.e(325).then(a.bind(a,9325)))),Re=e=>t=>(0,oe.jsx)(ke,{adapters:t.adapters,title:t.title,uiSettings:e().uiSettings,fieldFormats:e().fieldFormats,uiActions:e().uiActions,isFilterable:e().isFilterable,options:t.options});class DataPublicPlugin{constructor(e){(0,T.default)(this,"searchService",void 0),(0,T.default)(this,"queryService",void 0),(0,T.default)(this,"storage",void 0),(0,T.default)(this,"nowProvider",void 0),this.searchService=new SearchService(e),this.queryService=new i.cq(e.config.get().query.timefilter.minRefreshInterval),this.storage=new B.Storage(window.localStorage),this.nowProvider=new NowProvider}setup(e,{expressions:t,uiActions:a,usageCollection:i,inspector:r,fieldFormats:n,management:o}){const l=(0,B.createStartServicesGetter)(e.getStartServices);(0,xe.Yl)(e.theme);const u=this.searchService.setup(e,{usageCollection:i,expressions:t,management:o,nowProvider:this.nowProvider}),d=this.queryService.setup({uiSettings:e.uiSettings,storage:this.storage,nowProvider:this.nowProvider});var c;return a.registerTrigger(we.J),r.registerView((c=()=>({uiActions:l().plugins.uiActions,uiSettings:l().core.uiSettings,fieldFormats:l().self.fieldFormats,isFilterable:l().self.datatableUtilities.isFilterable}),{title:p.i18n.translate("data.inspector.table.dataTitle",{defaultMessage:"Data"}),order:10,help:p.i18n.translate("data.inspector.table..dataDescriptionTooltip",{defaultMessage:"View the data behind the visualization"}),shouldShow:e=>Boolean(e.tables),component:Re(c)})),n.register((0,s.getAggsFormats)((e=>l().plugins.fieldFormats.deserialize(e)))),e.analytics.registerEventType({eventType:te,schema:{[ae]:{type:"long",_meta:{description:"The time (in ms) before the search request was aborted due to timeout (search:timeout advanced setting)"}},[se]:{type:"pass_through",_meta:{description:"Execution context of the search request that timed out"}}}}),{search:u,query:d}}start(e,{uiActions:t,fieldFormats:i,dataViews:r,inspector:n,screenshotMode:o,share:l}){const{uiSettings:u,overlays:d}=e;(0,xe.AK)(d),(0,xe._O)(u),(0,xe.Ov)(r);const c=this.queryService.start({storage:this.storage,http:e.http,uiSettings:u}),g=this.searchService.start(e,{fieldFormats:i,indexPatterns:r,inspector:n,screenshotMode:o,share:l,scriptedFieldsEnabled:r.scriptedFieldsEnabled});return(0,xe.A4)(g),t.addTriggerActionAsync("SELECT_RANGE_TRIGGER","ACTION_SELECT_RANGE",(async()=>{const{createSelectRangeActionDefinition:e}=await a.e(690).then(a.bind(a,690));return e((()=>({uiActions:t})))})),t.addTriggerActionAsync("VALUE_CLICK_TRIGGER","ACTION_VALUE_CLICK",(async()=>{const{createValueClickActionDefinition:e}=await a.e(690).then(a.bind(a,690));return e((()=>({uiActions:t})))})),t.addTriggerActionAsync("MULTI_VALUE_CLICK_TRIGGER","ACTION_MULTI_VALUE_CLICK",(async()=>{const{createMultiValueClickActionDefinition:e}=await a.e(690).then(a.bind(a,690));return e((()=>({query:c})))})),{actions:{createFiltersFromValueClickAction:async e=>{const{createFiltersFromValueClickAction:t}=await a.e(408).then(a.bind(a,6408));return t(e)},createFiltersFromRangeSelectAction:async e=>{const{createFiltersFromRangeSelectAction:t}=await a.e(408).then(a.bind(a,6408));return t(e)},createFiltersFromMultiValueClickAction:async e=>{const{createFiltersFromMultiValueClickAction:t}=await a.e(408).then(a.bind(a,6408));return t(e)}},datatableUtilities:new s.DatatableUtilitiesService(g.aggs,r,i),fieldFormats:i,indexPatterns:r,dataViews:r,query:c,search:g,nowProvider:this.nowProvider}}stop(){this.queryService.stop(),this.searchService.stop()}}const Ne={datatableToCSV:s.datatableToCSV,CSV_MIME_TYPE:s.CSV_MIME_TYPE,cellHasFormulas:s.cellHasFormulas,tableHasFormulas:s.tableHasFormulas},Ce={ILLEGAL_CHARACTERS_KEY:n.ILLEGAL_CHARACTERS_KEY,CONTAINS_SPACES_KEY:n.CONTAINS_SPACES_KEY,ILLEGAL_CHARACTERS_VISIBLE:n.ILLEGAL_CHARACTERS_VISIBLE,ILLEGAL_CHARACTERS:n.ILLEGAL_CHARACTERS,isFilterable:s.isFilterable,isNestedField:s.isNestedField,isMultiField:s.isMultiField,getFieldSubtypeMulti:s.getFieldSubtypeMulti,getFieldSubtypeNested:s.getFieldSubtypeNested,validate:n.validateDataView},Le={aggs:{CidrMask:s.CidrMask,dateHistogramInterval:s.dateHistogramInterval,intervalOptions:s.intervalOptions,InvalidEsCalendarIntervalError:s.InvalidEsCalendarIntervalError,InvalidEsIntervalFormatError:s.InvalidEsIntervalFormatError,IpAddress:s.IpAddress,isDateHistogramBucketAggConfig:s.isDateHistogramBucketAggConfig,isNumberType:s.isNumberType,isStringType:s.isStringType,isType:s.isType,isValidEsInterval:s.isValidEsInterval,isValidInterval:s.isValidInterval,parentPipelineType:s.parentPipelineType,parseEsInterval:s.parseEsInterval,parseInterval:s.parseInterval,propFilter:s.propFilter,siblingPipelineType:s.siblingPipelineType,termsAggFilter:s.termsAggFilter,toAbsoluteDates:s.toAbsoluteDates,boundsDescendingRaw:s.boundsDescendingRaw,calcAutoIntervalLessThan:s.calcAutoIntervalLessThan},getResponseInspectorStats:s.getResponseInspectorStats,tabifyAggResponse:s.tabifyAggResponse,tabifyGetColumns:s.tabifyGetColumns};function Pe(e){return new DataPublicPlugin(e)}},3329:(e,t,a)=>{"use strict";a.d(t,{qh:()=>FilterManager,cq:()=>QueryService,gr:()=>TimeHistory,$9:()=>Z,NF:()=>$,XH:()=>x,Sy:()=>c,_b:()=>C,Ix:()=>N,FJ:()=>R,zR:()=>u,pH:()=>A,X9:()=>te,Qd:()=>ae});var s=a(8915),i=a(770),r=a.n(i),n=a(190);const o=(e,t)=>r().isEqual(e,t);class PersistedLog{constructor(e,t={},a){(0,s.default)(this,"name",void 0),(0,s.default)(this,"maxLength",void 0),(0,s.default)(this,"filterDuplicates",void 0),(0,s.default)(this,"isDuplicate",void 0),(0,s.default)(this,"storage",void 0),(0,s.default)(this,"items",void 0),(0,s.default)(this,"update$",new n.BehaviorSubject(void 0)),this.name=e,this.maxLength="string"==typeof t.maxLength?this.maxLength=parseInt(t.maxLength,10):t.maxLength,this.filterDuplicates=t.filterDuplicates||!1,this.isDuplicate=t.isDuplicate||o,this.storage=a,this.items=this.storage.get(this.name)||[],void 0===this.maxLength||isNaN(this.maxLength)||(this.items=r().take(this.items,this.maxLength))}add(e){return null==e||(this.filterDuplicates&&r().remove(this.items,(t=>this.isDuplicate(t,e))),this.items.unshift(e),this.maxLength&&!isNaN(this.maxLength)&&(this.items=r().take(this.items,this.maxLength)),this.storage.set(this.name,this.items),this.update$.next(void 0)),this.items}get(){return r().cloneDeep(this.items)}get$(){return this.update$.pipe((0,n.map)((()=>this.get())))}}var l=a(4177);function u(e,t,a,s){return new PersistedLog(`typeahead:${a}-${s}`,{maxLength:e.get(l.UI_SETTINGS.HISTORY_LIMIT),filterDuplicates:!0},t)}function d({storage:e,uiSettings:t}){return function(a,{language:s,query:i}){u(t,e,a,s).add(i)}}function c(e="kuery"){return{query:"",language:e}}var g=a(5964);const h=({$state:e},{$state:t})=>e.store===t.store?0:e.store===g.FilterStateStore.GLOBAL_STATE&&t.store!==g.FilterStateStore.GLOBAL_STATE?-1:1,p=e=>{if(!(0,g.isCombinedFilter)(e))throw e;const{type:t,key:a,params:s}=e.meta;return{type:t,key:a,params:s.map(F)}},f=e=>{var t;if((null===(t=e.meta)||void 0===t?void 0:t.type)===g.FILTERS.SPATIAL_FILTER)return{type:e.meta.type,key:void 0,value:void 0};throw e},m=e=>{if((0,g.isMatchAllFilter)(e))return{type:g.FILTERS.MATCH_ALL,key:e.meta.field,value:e.meta.formattedValue||"all"};throw e},y=e=>{if(!(e=>(0,g.isPhraseFilter)(e)||(0,g.isScriptedPhraseFilter)(e))(e))throw e;return(e=>{const t=(e=>(0,i.get)(e,["query","script","script","params","value"]))(e);return{key:Boolean(t)?e.meta.field||"":(0,g.getPhraseFilterField)(e),params:{query:t||(0,g.getPhraseFilterValue)(e)},type:g.FILTERS.PHRASE}})(e)},b=e=>{if(!(0,g.isPhrasesFilter)(e))throw e;const{type:t,key:a,params:s}=e.meta;return{type:t,key:a,value:s,params:s}};const v=e=>{if(!(e=>(0,g.isRangeFilter)(e)||(0,g.isScriptedRangeFilter)(e))(e))throw e;return function(e){const t=(0,g.isScriptedRangeFilter)(e),a=(t?e.meta.field:(e=>e.query.range&&Object.keys(e.query.range)[0])(e))||"",s=t?(0,i.get)(e.query,"script.script.params"):((e,t)=>(0,i.get)(e.query,["range",t]))(e,a);return{type:g.FILTERS.RANGE,key:a,value:s,params:s}}(e)},S=e=>{if((0,g.isExistsFilter)(e))return{type:g.FILTERS.EXISTS,value:g.FILTERS.EXISTS,key:(0,i.get)(e,"query.exists.field")};throw e},_=e=>{var t,a;if((0,g.isQueryStringFilter)(e))return{type:g.FILTERS.QUERY_STRING,key:"query",value:null===(t=e.query)||void 0===t||null===(a=t.query_string)||void 0===a?void 0:a.query};throw e},T=e=>{const t=/(^\$|meta)/,a=(0,i.find)((0,i.keys)(e),(e=>!e.match(t)));if(a)return{type:g.FILTERS.CUSTOM,key:a,value:JSON.stringify((0,i.get)(e,a,{}))};throw e},E=()=>{throw new Error("No mappings have been found for filter.")},M=(e,t=E)=>a=>{try{return e(a)}catch(e){if(e===a)return t(a);throw e}};function F(e){const t=[p,f,m,v,y,b,S,_,T],a=(0,i.reduceRight)(t,((e,t)=>M(t,e)),(()=>{throw new Error("No mappings have been found for filter.")})),s=(0,i.cloneDeep)(e),r=a(s);return s.meta=e.meta||{},s.meta.type=r.type,s.meta.key=r.key,s.meta.value=r.value,s.meta.params=r.params,s.meta.disabled=Boolean(s.meta.disabled),s.meta.negate=Boolean(s.meta.negate),s.meta.alias=s.meta.alias,s}const A=e=>(0,i.compact)((0,i.flatten)(e)).map((e=>(0,g.migrateFilter)(e))).map((e=>F(e)));var I=a(71);class FilterManager{constructor(e){(0,s.default)(this,"filters",[]),(0,s.default)(this,"updated$",new n.Subject),(0,s.default)(this,"fetch$",new n.Subject),(0,s.default)(this,"uiSettings",void 0),(0,s.default)(this,"extract",I.o6),(0,s.default)(this,"inject",I.WQ),(0,s.default)(this,"telemetry",I.Y9),(0,s.default)(this,"getAllMigrations",I.R9),this.uiSettings=e}mergeIncomingFilters(e){const t=e.globalFilters,a=e.appFilters,s=[];return r().each(a,(function(e,a){const i=r().find(t,(function(t){return(0,g.compareFilters)(t,e)}));if(!i)return s.push(e);r().assignIn(i.meta,e.meta)})),FilterManager.mergeFilters(s,t)}static mergeFilters(e,t){return(0,g.uniqFilters)(e.reverse().concat(t.reverse())).reverse()}static partitionFilters(e){const[t,a]=r().partition(e,g.isFilterPinned);return{globalFilters:t,appFilters:a}}handleStateUpdate(e){e.sort(h);const t=!(0,g.compareFilters)(this.filters,e,g.COMPARE_ALL_OPTIONS),a=(0,g.onlyDisabledFiltersChanged)(e,this.filters);this.filters=e,t&&(this.updated$.next(),a||this.fetch$.next())}getFilters(){return r().cloneDeep(this.filters)}getAppFilters(){const{appFilters:e}=this.getPartitionedFilters();return e}getGlobalFilters(){const{globalFilters:e}=this.getPartitionedFilters();return e}getPartitionedFilters(){return FilterManager.partitionFilters(this.getFilters())}getUpdates$(){return this.updated$.asObservable()}getFetches$(){return this.fetch$.asObservable()}addFilters(e,t=this.uiSettings.get(l.UI_SETTINGS.FILTERS_PINNED_BY_DEFAULT)){if(Array.isArray(e)||(e=[e]),0===e.length)return;const a=t?g.FilterStateStore.GLOBAL_STATE:g.FilterStateStore.APP_STATE;FilterManager.setFiltersStore(e,a);const s=A(e),i=FilterManager.partitionFilters(s),r=this.getPartitionedFilters();r.appFilters.push(...i.appFilters),r.globalFilters.push(...i.globalFilters);const n=this.mergeIncomingFilters(r);this.handleStateUpdate(n)}setFilters(e,t=this.uiSettings.get(l.UI_SETTINGS.FILTERS_PINNED_BY_DEFAULT)){const a=t?g.FilterStateStore.GLOBAL_STATE:g.FilterStateStore.APP_STATE;FilterManager.setFiltersStore(e,a);const s=A(e),i=FilterManager.partitionFilters(s),r=this.mergeIncomingFilters(i);this.handleStateUpdate(r)}setGlobalFilters(e){e=A(e),FilterManager.setFiltersStore(e,g.FilterStateStore.GLOBAL_STATE,!0);const{appFilters:t}=this.getPartitionedFilters(),a=this.mergeIncomingFilters({appFilters:t,globalFilters:e});this.handleStateUpdate(a)}setAppFilters(e){e=A(e),FilterManager.setFiltersStore(e,g.FilterStateStore.APP_STATE,!0);const{globalFilters:t}=this.getPartitionedFilters(),a=this.mergeIncomingFilters({globalFilters:t,appFilters:e});this.handleStateUpdate(a)}removeFilter(e){const t=r().findIndex(this.filters,(t=>r().isEqual(t.meta,e.meta)&&r().isEqual(t.query,e.query)));if(t>=0){const e=r().cloneDeep(this.filters);e.splice(t,1),this.handleStateUpdate(e)}}removeAll(){this.setFilters([])}static setFiltersStore(e,t,a=!1){r().map(e,(e=>{(a||void 0===e.$state)&&(e.$state={store:t})}))}}var w=a(3313);function x(e,t,a,s,i){a=Array.isArray(a)?r().uniq(a):[a];const n=r().isObject(t)?t:{name:t},o=n.name,l=e.getAppFilters(),u="-"===s;return r().chain(a).map((function(e){var t;return n.type===w.fM.DATE&&"string"==typeof e?{format:null!==(t=n.esTypes)&&void 0!==t&&t.includes("date_nanos")?"strict_date_optional_time_nanos":"date_time",gte:e,lte:e}:e})).map((e=>{const t=function(e,t,a){return r().find(e,(function(e){var s,i,n,o;if(e)return"_exists_"===t&&(0,g.isExistsFilter)(e)?e.query.exists.field===a:(0,g.isPhraseFilter)(e)?(0,g.getPhraseFilterField)(e)===t&&(0,g.getPhraseFilterValue)(e)===a:(0,g.isScriptedPhraseFilter)(e)?e.meta.field===t&&(null===(s=e.query)||void 0===s||null===(i=s.script)||void 0===i||null===(n=i.script)||void 0===n||null===(o=n.params)||void 0===o?void 0:o.value)===a:(0,g.isRangeFilter)(e)?(0,g.getFilterField)(e)===t&&r().isEqual(e.query.range[t],a):void 0}))}(l,o,e);return t&&function(e,t){e.meta.disabled=!1,e.meta.negate!==t&&(e.meta.negate=!e.meta.negate)}(t,u),null!=t?t:function(e){var t;if(((null===(t=n.type)||void 0===t?void 0:t.includes("range"))||n.type===w.fM.DATE)&&r().isObjectLike(e))return(0,g.buildFilter)(i,n,g.FILTERS.RANGE_FROM_VALUE,u,!1,e,null,g.FilterStateStore.APP_STATE);const a="_exists_"===o?g.FILTERS.EXISTS:g.FILTERS.PHRASE,s="_exists_"===o?{name:e}:n,l=null==e;return(0,g.buildFilter)(i,s,l?g.FILTERS.EXISTS:a,l?!u:u,!1,e,null,g.FilterStateStore.APP_STATE)}(e)})).value()}var k=a(5008);function R(e,t){return t.find((t=>t.id===e.meta.index))}function N(e,t){var a;const s=R(e,t);if(!s)return"";const i=(0,g.getFilterField)(e);if(!i)return"";const r=s.fields.find((e=>e.name===i));return r&&"customLabel"in r&&null!==(a=r.customLabel)&&void 0!==a?a:""}function C(e,t){var a;const s=R(e,t),r=(0,g.getFilterField)(e),n=null==s?void 0:s.fields.find((e=>e.name===r)),o=null==n?void 0:n.type,l=function(e,t){if(!e||!("getFormatterForField"in e)||!t)return;const a=e.fields.find((e=>e.name===t));if(!a)throw new Error(k.i18n.translate("data.filter.filterBar.fieldNotFound",{defaultMessage:"Field {key} not found in data view {dataView}",values:{key:t,dataView:e.title}}));return e.getFormatterForField(a)}(s,r);return(0,g.isPhraseFilter)(e)||(0,g.isScriptedPhraseFilter)(e)?function(e,t,a){var s,i;const r=null!==(s=e.meta.value)&&void 0!==s?s:null===(i=e.meta.params)||void 0===i?void 0:i.query,n="number"!==a||r?r:0;return null!=t&&t.convert?t.convert(n):void 0===n?"":`${n}`}(e,l,o):(0,g.isPhrasesFilter)(e)?function(e,t){return e.meta.params.map((e=>{var a;return null!==(a=null==t?void 0:t.convert(e))&&void 0!==a?a:e})).join(", ")}(e,l):(0,g.isRangeFilter)(e)||(0,g.isScriptedRangeFilter)(e)?function({meta:{params:e}},t){const a=t?t.getConverterFor("text"):i.identity,{gte:s,gt:r,lte:n,lt:o}=e||{},l=null!=s?s:r,u=null!=n?n:o;return void 0!==l&&void 0!==u?`${a(l)} to ${a(u)}`:void 0!==s?` ${a(s)}`:void 0!==r?`> ${a(r)}`:void 0!==n?` ${a(n)}`:void 0!==o?`< ${a(o)}`:"-"}(e,l):null!==(a=e.meta.value)&&void 0!==a?a:""}class TimefilterService{constructor(e){this.nowProvider=e}setup({uiSettings:e,storage:t,minRefreshInterval:a}){const s={timeDefaults:e.get(l.UI_SETTINGS.TIMEPICKER_TIME_DEFAULTS),refreshIntervalDefaults:e.get(l.UI_SETTINGS.TIMEPICKER_REFRESH_INTERVAL_DEFAULTS),minRefreshIntervalDefault:a},i=new TimeHistory(t);return{timefilter:new Timefilter(s,i,this.nowProvider),history:i}}start(){}stop(){}}var L=a(1783),P=a.n(L);const D=function(e){if(e)return e.valueOf()};function O(e,t){return r().isObject(e)&&r().isObject(t)?D(e.value)!==D(t.value)||D(e.pause)!==D(t.pause):!r().isEqual(e,t)}var B=a(7880);function q(e,t){const a=(0,l.getAbsoluteTimeRange)(e,{forceNow:t}),s=new Date(a.from),i=new Date(a.to);return{timeRange:e,start:s.getTime(),end:i.getTime(),asAbsoluteTimeRange:{...a,mode:"absolute"}}}class Timefilter{constructor(e,t,a){(0,s.default)(this,"enabledUpdated$",new n.BehaviorSubject(!1)),(0,s.default)(this,"timeUpdate$",new n.Subject),(0,s.default)(this,"refreshIntervalUpdate$",new n.Subject),(0,s.default)(this,"fetch$",new n.Subject),(0,s.default)(this,"_time",void 0),(0,s.default)(this,"_isTimeTouched",!1),(0,s.default)(this,"_refreshInterval",void 0),(0,s.default)(this,"_minRefreshInterval",void 0),(0,s.default)(this,"_isRefreshIntervalTouched",!1),(0,s.default)(this,"_history",void 0),(0,s.default)(this,"_isTimeRangeSelectorEnabled",!1),(0,s.default)(this,"_isAutoRefreshSelectorEnabled",!1),(0,s.default)(this,"timeDefaults",void 0),(0,s.default)(this,"refreshIntervalDefaults",void 0),(0,s.default)(this,"useTimefilter",void 0),(0,s.default)(this,"autoRefreshLoop",(()=>{let e=0;const t=new n.Subject;let a,s=0;function r(){if(o(),0===s)return;const i=window.setTimeout((()=>{let s=e;t.next((()=>{i===a&&(s--,0===s&&r())}))}),s);a=i}function o(){window.clearTimeout(a),a=-1}const l=(0,n.fromEvent)(document,"visibilitychange").pipe((0,n.startWith)(document.visibilityState),(0,n.map)((()=>document.visibilityState)),(0,n.shareReplay)({refCount:!0,bufferSize:1})).pipe((0,n.filter)((e=>"visible"===e))),u=t.pipe((0,n.delayWhen)((()=>l)));return{stop:()=>{s=0,o()},start:t=>{s=t,e>0&&r()},loop$:(0,n.defer)((()=>(e++,r(),u.pipe((0,n.map)((e=>(0,i.once)(e))))))).pipe((0,n.finalize)((()=>{e--,0===e?o():r()})))}})()),(0,s.default)(this,"getEnabledUpdated$",(()=>this.enabledUpdated$.asObservable())),(0,s.default)(this,"getTimeUpdate$",(()=>this.timeUpdate$.asObservable())),(0,s.default)(this,"getRefreshIntervalUpdate$",(()=>this.refreshIntervalUpdate$.asObservable())),(0,s.default)(this,"getAutoRefreshFetch$",(()=>this.autoRefreshLoop.loop$)),(0,s.default)(this,"triggerFetch",(()=>{this.fetch$.next()})),(0,s.default)(this,"getFetch$",(()=>this.fetch$.asObservable())),(0,s.default)(this,"getTime",(()=>{const{from:e,to:t}=this._time;return{...this._time,from:P().isMoment(e)?e.toISOString():e,to:P().isMoment(t)?t.toISOString():t}})),(0,s.default)(this,"setTime",(e=>{const t=Object.assign(this.getTime(),e);var a,s;s=t,((a=this.getTime())&&s&&r().isObject(a)&&r().isObject(s)?D(a.to)===D(s.to)&&D(a.from)===D(s.from):r().isEqual(a,s))||(this._time={from:t.from,to:t.to},this._isTimeTouched=!0,this._history.add(this._time),this.timeUpdate$.next(),this.fetch$.next())})),(0,s.default)(this,"getRefreshInterval",(()=>r().clone(this._refreshInterval))),(0,s.default)(this,"getMinRefreshInterval",(()=>this._minRefreshInterval)),(0,s.default)(this,"setRefreshInterval",(e=>{const t=this.getRefreshInterval(),a={...t,...e};0===a.value&&(a.pause=!0),a.value<this._minRefreshInterval&&(a.value=this._minRefreshInterval);let s=!1===a.pause&&null!=t;(null==t?void 0:t.value)>0&&a.value<=0&&(s=!1),this._isRefreshIntervalTouched=this._isRefreshIntervalTouched||O(this.refreshIntervalDefaults,a),a.value<=0&&(a.value=0,a.pause=!s),this._refreshInterval={value:a.value,pause:a.pause},t&&O(t,a)&&(this.refreshIntervalUpdate$.next(),a.pause||0===a.value||this.fetch$.next()),this.autoRefreshLoop.stop(),a.pause||0===a.value||this.autoRefreshLoop.start(a.value)})),(0,s.default)(this,"createFilter",((e,t)=>(0,l.getTime)(e,t||this._time,{forceNow:this.nowProvider.get()}))),(0,s.default)(this,"createRelativeFilter",((e,t)=>(0,l.getRelativeTime)(e,t||this._time,{forceNow:this.nowProvider.get()}))),(0,s.default)(this,"enableTimeRangeSelector",(()=>{this._isTimeRangeSelectorEnabled=!0,this.enabledUpdated$.next(!0)})),(0,s.default)(this,"disableTimeRangeSelector",(()=>{this._isTimeRangeSelectorEnabled=!1,this.enabledUpdated$.next(!1)})),(0,s.default)(this,"enableAutoRefreshSelector",(()=>{this._isAutoRefreshSelectorEnabled=!0,this.enabledUpdated$.next(!0)})),(0,s.default)(this,"disableAutoRefreshSelector",(()=>{this._isAutoRefreshSelectorEnabled=!1,this.enabledUpdated$.next(!1)})),this.nowProvider=a,this._history=t,this.timeDefaults=e.timeDefaults,this.refreshIntervalDefaults={pause:0===e.refreshIntervalDefaults.value||e.refreshIntervalDefaults.pause,value:Math.max(e.refreshIntervalDefaults.value,e.minRefreshIntervalDefault)},this._minRefreshInterval=e.minRefreshIntervalDefault,this._time=e.timeDefaults,this.setRefreshInterval(e.refreshIntervalDefaults),this.useTimefilter=function(e,t){const a=new n.Subject,s=new n.BehaviorSubject(e.getTime()),r=new n.BehaviorSubject({timeState:q(s.value,t.get()),kind:"initial"}),o=()=>{a.next()};(0,n.combineLatest)([s,a]).pipe((0,n.skip)(1),(0,n.map)((([e])=>{const a={current:r.value.timeState,next:q(e,t.get())},s=a.current.start!==a.next.start||a.current.end!==a.next.end;return{timeState:a.next,kind:s?"shift":"override"}}))).subscribe({next:e=>{r.next(e)}}),e.getFetch$().subscribe({next:()=>{s.next((0,i.cloneDeep)(e.getTime()))}});const l=r.pipe((0,n.share)());return a.next(),function(){const{timeState:e}=(0,B.A)(l,r.value);return{timeState:e,refresh:o,timeState$:l}}}(this,a)}isTimeRangeSelectorEnabled(){return this._isTimeRangeSelectorEnabled}isAutoRefreshSelectorEnabled(){return this._isAutoRefreshSelectorEnabled}isTimeTouched(){return this._isTimeTouched}isRefreshIntervalTouched(){return this._isRefreshIntervalTouched}getAbsoluteTime(){return(0,l.getAbsoluteTimeRange)(this._time,{forceNow:this.nowProvider.get()})}getBounds(){return this.calculateBounds(this._time)}calculateBounds(e){return(0,l.calculateBounds)(e,{forceNow:this.nowProvider.get()})}getActiveBounds(){if(this.isTimeRangeSelectorEnabled())return this.getBounds()}getTimeDefaults(){return r().cloneDeep(this.timeDefaults)}getRefreshIntervalDefaults(){return r().cloneDeep(this.refreshIntervalDefaults)}}class TimeHistory{constructor(e){(0,s.default)(this,"history",void 0),this.history=new PersistedLog("kibana.timepicker.timeHistory",{maxLength:10,filterDuplicates:!0,isDuplicate:(e,t)=>e.from===t.from&&e.to===t.to},e)}add(e){if(!e||!e.from||!e.to)return;const t={from:P().isMoment(e.from)?e.from.toISOString():e.from,to:P().isMoment(e.to)?e.to.toISOString():e.to};this.history.add(t)}get(){return this.history.get()}get$(){return this.history.get$()}}var j=a(6494),z=a.n(j),U=a(2787);const G="1",$=e=>({isDuplicateTitle:async(t,a)=>(await e.post(`${U.nK}/_is_duplicate_title`,{body:JSON.stringify({title:t,id:a}),version:G})).isDuplicate,createQuery:async(t,{overwrite:a=!1}={})=>await e.post(`${U.nK}/_create`,{body:JSON.stringify(t),version:G}),updateQuery:async(t,a)=>await e.put(`${U.nK}/${t}`,{body:JSON.stringify(a),version:G}),findSavedQueries:async(t="",a=50,s=1)=>{const{total:i,savedQueries:r}=await e.post(`${U.nK}/_find`,{body:JSON.stringify({page:s,perPage:a,search:t}),version:G});return{total:i,queries:r}},getSavedQuery:t=>e.get(`${U.nK}/${t}`,{version:G}),deleteSavedQuery:t=>e.delete(`${U.nK}/${t}`,{version:G}),getSavedQueryCount:async()=>e.get(`${U.nK}/_count`,{version:G})});var V=a(1215);function K({timefilter:{timefilter:e},filterManager:t,queryString:a}){return{time:e.getTime(),refreshInterval:e.getRefreshInterval(),filters:t.getFilters(),query:a.getQuery()}}class QueryStringManager{constructor(e,t){(0,s.default)(this,"query$",void 0),(0,s.default)(this,"getUpdates$",(()=>this.query$.asObservable().pipe((0,n.skip)(1)))),(0,s.default)(this,"getQuery",(()=>this.query$.getValue())),(0,s.default)(this,"setQuery",(e=>{const t=this.query$.getValue();(0,i.isEqual)(e,t)||this.query$.next(e)})),(0,s.default)(this,"clearQuery",(()=>{this.setQuery(this.getDefaultQuery())})),this.storage=e,this.uiSettings=t,this.query$=new n.BehaviorSubject(this.getDefaultQuery())}getDefaultLanguage(){return this.storage.get(l.KIBANA_USER_QUERY_LANGUAGE_KEY)||this.uiSettings.get(l.UI_SETTINGS.SEARCH_QUERY_LANGUAGE)}getDefaultQuery(){return{query:"",language:this.getDefaultLanguage()}}formatQuery(e){return e?"string"==typeof e?{query:e,language:this.getDefaultLanguage()}:e:this.getDefaultQuery()}}var H=a(8560),Y=a(1359);const W=e=>{var t;const a=[],{state:s,references:i}=I.o6(null!==(t=e.filters)&&void 0!==t?t:[]);return a.push(...i),{state:{...e,filters:s},references:a}},Q=(e,t)=>{var a;const s=I.WQ(null!==(a=e.filters)&&void 0!==a?a:[],t);return{...e,filters:s}},J=(e,t)=>{var a;return{...I.Y9(null!==(a=e.filters)&&void 0!==a?a:[],t)}},X=()=>{const e=(0,i.mapValues)(I.R9(),(e=>t=>{var a;return{...t,filters:e(null!==(a=t.filters)&&void 0!==a?a:[])}}));return(0,Y.mergeMigrationFunctionMaps)({},e)};class QueryService{constructor(e=5e3){(0,s.default)(this,"filterManager",void 0),(0,s.default)(this,"timefilter",void 0),(0,s.default)(this,"queryStringManager",void 0),(0,s.default)(this,"state$",void 0),(0,s.default)(this,"extract",W),(0,s.default)(this,"inject",Q),(0,s.default)(this,"telemetry",J),(0,s.default)(this,"getAllMigrations",X),(0,s.default)(this,"migrateToLatest",(e=>(({state:e,version:t})=>{var a;const s=I.kr({state:null!==(a=e.filters)&&void 0!==a?a:[],version:t});return{...e,filters:s}})(e))),this.minRefreshInterval=e}setup({storage:e,uiSettings:t,nowProvider:a,minRefreshInterval:s=this.minRefreshInterval}){this.filterManager=new FilterManager(t);const i=new TimefilterService(a);return this.timefilter=i.setup({uiSettings:t,storage:e,minRefreshInterval:s}),this.queryStringManager=new QueryStringManager(e,t),this.state$=function({timefilter:e,filterManager:t,queryString:a}){const s=(0,V.createStateContainer)(K({timefilter:e,filterManager:t,queryString:a}));return new n.Observable((i=>{let r={};const o=[a.getUpdates$().subscribe((()=>{r.query=!0,s.set({...s.get(),query:a.getQuery()})})),e.timefilter.getTimeUpdate$().subscribe((()=>{r.time=!0,s.set({...s.get(),time:e.timefilter.getTime()})})),e.timefilter.getRefreshIntervalUpdate$().subscribe((()=>{r.refreshInterval=!0,s.set({...s.get(),refreshInterval:e.timefilter.getRefreshInterval()})})),t.getUpdates$().subscribe((()=>{r.filters=!0;const{filters:e}=s.get(),a=null==e?void 0:e.filter((e=>(0,g.isFilterPinned)(e))),i=null==e?void 0:e.filter((e=>!(0,g.isFilterPinned)(e))),n=t.getGlobalFilters(),o=t.getAppFilters();a&&(0,g.compareFilters)(a,n,g.COMPARE_ALL_OPTIONS)||(r.globalFilters=!0),i&&(0,g.compareFilters)(i,o,g.COMPARE_ALL_OPTIONS)||(r.appFilters=!0),s.set({...s.get(),filters:t.getFilters()})})),s.state$.pipe((0,n.map)((e=>({state:e,changes:r}))),(0,n.tap)((()=>{r={}}))).subscribe(i)];return()=>{o.forEach((e=>e.unsubscribe()))}}))}({filterManager:this.filterManager,timefilter:this.timefilter,queryString:this.queryStringManager}).pipe((0,n.share)()),{filterManager:this.filterManager,timefilter:this.timefilter,queryString:this.queryStringManager,state$:this.state$,getState:()=>this.getQueryState(),...this.getPersistableStateMethods()}}start({storage:e,uiSettings:t,http:a}){return{addToQueryLog:d({storage:e,uiSettings:t}),filterManager:this.filterManager,queryString:this.queryStringManager,savedQueries:$(a),state$:this.state$,getState:()=>this.getQueryState(),timefilter:this.timefilter,getEsQuery:(e,t)=>{const a=this.timefilter.timefilter.createFilter(e,t);return(0,g.buildEsQuery)(e,this.queryStringManager.getQuery(),[...this.filterManager.getFilters(),...a?[a]:[]],(0,l.getEsQueryConfig)((0,H.C_)()))},...this.getPersistableStateMethods()}}stop(){}getQueryState(){return K({timefilter:this.timefilter,queryString:this.queryStringManager,filterManager:this.filterManager})}getPersistableStateMethods(){return{extract:this.extract.bind(this),inject:this.inject.bind(this),telemetry:this.telemetry.bind(this),migrateToLatest:this.migrateToLatest.bind(this),getAllMigrations:this.getAllMigrations.bind(this)}}}const Z=({timefilter:{timefilter:e},filterManager:t,queryString:a,state$:s},i,o)=>{const l=[];if(o.time&&l.push("time"),o.query&&l.push("query"),o.refreshInterval&&l.push("refreshInterval"),o.filters)switch(o.filters){case!0:l.push("filters");break;case g.FilterStateStore.APP_STATE:l.push("appFilters");break;case g.FilterStateStore.GLOBAL_STATE:l.push("globalFilters")}const u={...i.get()};let d=!1;o.time&&!r().isEqual(u.time,e.getTime())&&(u.time=e.getTime(),d=!0),o.refreshInterval&&!r().isEqual(u.refreshInterval,e.getRefreshInterval())&&(u.refreshInterval=e.getRefreshInterval(),d=!0),o.filters&&(!0===o.filters?u.filters&&(0,g.compareFilters)(u.filters,t.getFilters(),g.COMPARE_ALL_OPTIONS)||(u.filters=t.getFilters(),d=!0):o.filters===g.FilterStateStore.GLOBAL_STATE?u.filters&&(0,g.compareFilters)(u.filters,t.getGlobalFilters(),{...g.COMPARE_ALL_OPTIONS,state:!1})||(u.filters=t.getGlobalFilters(),d=!0):o.filters===g.FilterStateStore.APP_STATE&&(u.filters&&(0,g.compareFilters)(u.filters,t.getAppFilters(),{...g.COMPARE_ALL_OPTIONS,state:!1})||(u.filters=t.getAppFilters(),d=!0))),d&&i.set({...i.get(),...u});let c=!1;const h=[s.pipe((0,n.filter)((({changes:e,state:t})=>!c&&l.some((t=>e[t])))),(0,n.map)((({changes:s})=>{const i={};return o.time&&s.time&&(i.time=e.getTime()),o.query&&s.query&&(i.query=a.getQuery()),o.refreshInterval&&s.refreshInterval&&(i.refreshInterval=e.getRefreshInterval()),o.filters&&(!0===o.filters&&s.filters?i.filters=t.getFilters():o.filters===g.FilterStateStore.GLOBAL_STATE&&s.globalFilters?i.filters=t.getGlobalFilters():o.filters===g.FilterStateStore.APP_STATE&&s.appFilters&&(i.filters=t.getAppFilters())),i}))).subscribe((e=>{i.set({...i.get(),...e})})),i.state$.subscribe((s=>{if(c=!0,o.time){const t=function(e){if(!e)return!1;const t=z().parse(e.from),a=z().parse(e.to);return!!(t&&t.isValid()&&a&&a.isValid())}(s.time)?s.time:e.getTimeDefaults();r().isEqual(t,e.getTime())||e.setTime(r().cloneDeep(t))}if(o.refreshInterval){const t=s.refreshInterval||e.getRefreshIntervalDefaults();r().isEqual(t,e.getRefreshInterval())||e.setRefreshInterval(r().cloneDeep(t))}if(o.query){const e=s.query||a.getQuery();r().isEqual(e,a.getQuery())||a.setQuery(r().cloneDeep(e))}if(o.filters){const e=s.filters||[];!0===o.filters?(0,g.compareFilters)(e,t.getFilters(),g.COMPARE_ALL_OPTIONS)||t.setFilters(r().cloneDeep(e)):o.filters===g.FilterStateStore.APP_STATE?(0,g.compareFilters)(e,t.getAppFilters(),{...g.COMPARE_ALL_OPTIONS,state:!1})||t.setAppFilters(r().cloneDeep(e)):o.filters===g.FilterStateStore.GLOBAL_STATE&&((0,g.compareFilters)(e,t.getGlobalFilters(),{...g.COMPARE_ALL_OPTIONS,state:!1})||t.setGlobalFilters(r().cloneDeep(e)))}c=!1}))];return()=>{h.forEach((e=>e.unsubscribe()))}},ee="_g",te=(e,t)=>{const{timefilter:{timefilter:a},filterManager:s}=e,i={time:a.getTime(),refreshInterval:a.getRefreshInterval(),filters:s.getGlobalFilters()},r=t.get(ee),n=Boolean(r&&Object.keys(r).length),o={...i,...r},l=(0,V.createStateContainer)(o),u=Z(e,l,{refreshInterval:!0,time:!0,filters:g.FilterStateStore.GLOBAL_STATE});r||t.set(ee,o,{replace:!0}),l.set(o);const{start:d,stop:c}=(0,V.syncState)({stateStorage:t,stateContainer:{...l,set:e=>{e&&l.set(e)}},storageKey:ee});return d(),{stop:()=>{u(),c()},hasInheritedQueryFromUrl:n}},ae=te},1225:(e,t,a)=>{"use strict";a.d(t,{j:()=>s});const s="search_sessions"},6871:(e,t,a)=>{"use strict";a.d(t,{p:()=>oe,Y:()=>s});var s={};a.r(s),a.d(s,{actionsColumn:()=>z,appIdColumn:()=>c,nameColumn:()=>q,statusColumn:()=>W});var i=a(1319),r=a(5008),n=a(4286),o=a.n(n),l=a(770),u=a(6791);const d=e=>{if("ml"===e)return r.i18n.translate("data.mgmt.searchSessions.table.mlAppName",{defaultMessage:"Machine Learning"})},c={field:"appId",name:r.i18n.translate("data.mgmt.searchSessions.table.headerType",{defaultMessage:"App"}),sortable:!0,render:(e,{id:t})=>{var a;const s=`${(e=>"dashboards"===e?"dashboard":"ml"===e?"machineLearning":e)(e)}`;return(0,u.jsx)(i.EuiIconTip,{content:null!==(a=d(e))&&void 0!==a?a:(0,l.capitalize)(s),type:`${s}App`,iconProps:{"data-test-subj":"sessionManagementAppIcon"}})}};var g=a(5879),h=a(3185),p=a(7880);const f=o().createContext(null),m=({children:e,...t})=>{const{navigateToUrl:a,currentAppId:s}=t;return(0,u.jsx)(f.Provider,{value:{navigateToUrl:a,currentAppId:s}},e)},y=({children:e,coreStart:t})=>{const{navigateToUrl:a,currentAppId$:s}=t.application,i=(0,p.A)(s,void 0);return(0,u.jsx)(f.Provider,{value:{navigateToUrl:a,currentAppId:i}},e)},b={name:"h42ud6",styles:"display:inherit;height:inherit;width:inherit;flex:1;flex-flow:column nowrap"},v=({children:e,navigateToUrl:t,currentAppId:a,...s})=>{const i=(0,n.useRef)(null),r=(0,n.useCallback)((e=>(({event:e,container:t,navigateToUrl:a,currentAppId:s})=>{if(!t||!s)return;const i=((e,t)=>{let a=e;do{var s,i;if("a"===(null===(s=a)||void 0===s?void 0:s.tagName.toLowerCase()))return a;const e=null===(i=a)||void 0===i?void 0:i.parentElement;if(!e||e===document.body||e===t)break;a=e}while(parent||parent!==document.body||parent!==t)})(e.target,t);if(!i)return;const r=i.href,n=""===i.target||"_self"===i.target,o=0===e.button;r&&n&&o&&!e.defaultPrevented&&!(e=>e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)(e)&&(e.preventDefault(),a(i.href))})({event:e,currentAppId:a,navigateToUrl:t,container:i.current})),[a,t]);return(0,u.jsx)("div",(0,h.default)({onClick:r,ref:i,css:b,"data-test-subj":"kbnRedirectAppLink"},s),e)},S=({children:e,...t})=>(0,u.jsx)(v,(0,h.default)({},function(){const e=(0,n.useContext)(f);if(!e)throw new Error("RedirectAppLinksContext is missing.  Ensure your component or React root is wrapped with RedirectAppLinksProvider.");return e}(),t),e),_=({children:e,...t})=>{if(void 0!==t.coreStart){const{coreStart:a,...s}=t,i=(0,u.jsx)(S,s,e);return(0,u.jsx)(y,{coreStart:a},i)}const{navigateToUrl:a,currentAppId:s,...i}=t,r=(0,u.jsx)(S,i,e);return(0,u.jsx)(m,{currentAppId:s,navigateToUrl:a},r)};var T=a(4177),E=a(4041),M=a(5804);const F=e=>{const{searchSession:t,api:a,onActionDismiss:s}=e,{name:o,id:l}=t,[d,c]=(0,n.useState)(!1),g=(0,i.useGeneratedHtmlId)(),h=r.i18n.translate("data.mgmt.searchSessions.cancelModal.backgroundSearchTitle",{defaultMessage:"Delete background search"}),p=r.i18n.translate("data.mgmt.searchSessions.cancelModal.deleteButton",{defaultMessage:"Delete"}),f=r.i18n.translate("data.mgmt.searchSessions.cancelModal.cancelButton",{defaultMessage:"Cancel"}),m=r.i18n.translate("data.mgmt.searchSessions.cancelModal.backgroundSearchMessage",{defaultMessage:"Deleting the background search ''{name}'' deletes all cached results.",values:{name:o}});return(0,u.jsx)(i.EuiConfirmModal,{"aria-labelledby":g,titleProps:{id:g},title:h,onCancel:s,onConfirm:async()=>{c(!0),await a.sendDelete(l),s()},confirmButtonText:p,confirmButtonDisabled:d,cancelButtonText:f,defaultFocusedButton:"confirm",buttonColor:"danger"},m)};var A=a(1783),I=a.n(A);const w=({...e})=>{const{searchSession:t,api:a,onActionDismiss:s}=e,{id:o,name:l,expires:d}=t,[c,g]=(0,n.useState)(!1),h=I().duration(a.getExtendByDuration()),p=I()(d).add(h),f=(0,i.useGeneratedHtmlId)(),m=r.i18n.translate("data.mgmt.searchSessions.extendModal.backgroundSearchTitle",{defaultMessage:"Extend background search expiration"}),y=r.i18n.translate("data.mgmt.searchSessions.extendModal.extendButton",{defaultMessage:"Extend expiration"}),b=r.i18n.translate("data.mgmt.searchSessions.extendModal.dontExtendButton",{defaultMessage:"Cancel"}),v=r.i18n.translate("data.mgmt.searchSessions.extendModal.backgroundSearchMessage",{defaultMessage:"The background search ''{name}'' expiration would be extended until {newExpires}.",values:{name:l,newExpires:p.toLocaleString()}});return(0,u.jsx)(i.EuiConfirmModal,{"aria-labelledby":f,title:m,titleProps:{id:f},onCancel:s,onConfirm:async()=>{g(!0),await a.sendExtend(o,`${p.toISOString()}`),g(!1),s()},confirmButtonText:y,confirmButtonDisabled:c,cancelButtonText:b,defaultFocusedButton:"confirm",buttonColor:"primary"},v)};var x=a(409);const k=__kbnSharedDeps__.KbnCodeEditor,R=({searchSession:e})=>(0,u.jsx)(o().Fragment,null,(0,u.jsx)(i.EuiFlyoutHeader,{hasBorder:!0},(0,u.jsx)(i.EuiTitle,{size:"m"},(0,u.jsx)("h2",{id:"flyoutTitle"},(0,u.jsx)(g.FormattedMessage,{id:"data.sessions.management.backgroundSearchFlyoutTitle",defaultMessage:"Inspect background search"})))),(0,u.jsx)(i.EuiFlyoutBody,{css:C.flyout,"data-test-subj":"searchSessionsFlyout"},(0,u.jsx)(i.EuiText,null,(0,u.jsx)(i.EuiText,{size:"xs"},(0,u.jsx)("p",null,(0,u.jsx)(g.FormattedMessage,{id:"data.sessions.management.backgroundSearchFlyoutText",defaultMessage:"Configuration for this background search"}))),(0,u.jsx)(i.EuiSpacer,null),(0,u.jsx)(n.Fragment,null,(0,u.jsx)(k.CodeEditor,{languageId:"json",value:JSON.stringify(e,null,2),options:{readOnly:!0,lineNumbers:"off",fontSize:12,minimap:{enabled:!1},scrollBeyondLastLine:!1,wordWrap:"on",wrappingIndent:"indent",automaticLayout:!0}}))))),N=({searchSession:e,uiSettings:t,settings:a,theme:s})=>{const{Provider:i}=(0,x.createKibanaReactContext)({uiSettings:t,settings:a,theme:s});return(0,u.jsx)(i,null,(0,u.jsx)(R,{searchSession:e}))},C={flyout:{name:"1349avy",styles:".euiFlyoutBody__overflowContent{height:100%;> div{height:100%;}}"}},L=({onActionDismiss:e,...t})=>{const{api:a,searchSession:s}=t,{id:o,name:l}=s,[d,c]=(0,n.useState)(!1),[g,h]=(0,n.useState)(l),p=(0,i.useGeneratedHtmlId)(),f=r.i18n.translate("data.mgmt.searchSessions.renameModal.backgroundSearchTitle",{defaultMessage:"Edit background search name"}),m=r.i18n.translate("data.mgmt.searchSessions.renameModal.renameButton",{defaultMessage:"Save"}),y=r.i18n.translate("data.mgmt.searchSessions.renameModal.cancelButton",{defaultMessage:"Cancel"}),b=r.i18n.translate("data.mgmt.searchSessions.renameModal.backgroundSearchNameInputLabel",{defaultMessage:"Background search name"}),v=g&&l!==g;return(0,u.jsx)(i.EuiModal,{onClose:e,"aria-labelledby":p,initialFocus:"[name=newName]"},(0,u.jsx)(i.EuiModalHeader,null,(0,u.jsx)(i.EuiModalHeaderTitle,{id:p},f)),(0,u.jsx)(i.EuiModalBody,null,(0,u.jsx)(i.EuiForm,null,(0,u.jsx)(i.EuiFormRow,{label:b},(0,u.jsx)(i.EuiFieldText,{"data-test-subj":"editNameInput",name:"newName",placeholder:l,value:g,onChange:e=>h(e.target.value)})))),(0,u.jsx)(i.EuiModalFooter,null,(0,u.jsx)(i.EuiButtonEmpty,{onClick:e,"data-test-subj":"cancelEditName"},y),(0,u.jsx)(i.EuiButton,{"data-test-subj":"confirmEditName",disabled:!v,onClick:async()=>{v&&(c(!0),await a.sendRename(o,g),c(!1),e())},fill:!0,isLoading:d},m)))};var P=a(3721);const D=({api:e,onActionComplete:t,session:a,core:s,allowedActions:o})=>{var l;const[d,c]=(0,n.useState)(!1),h=()=>{c(!1)},p=(null===(l=a.actions)||void 0===l?void 0:l.filter((e=>!o||o.includes(e))))||[],f=[{id:0,items:p.reduce(((i,r)=>{const n=((e,t,a,s)=>{switch(t){case E.h.INSPECT:return((e,t,a)=>({iconType:"document",label:(0,u.jsx)(g.FormattedMessage,{id:"data.mgmt.searchSessions.flyoutTitle","aria-label":"Inspect",defaultMessage:"Inspect"}),onClick:async()=>{const e=(0,u.jsx)(N,{uiSettings:a.uiSettings,settings:a.settings,theme:a.theme,searchSession:t}),s=a.overlays.openFlyout((0,M.toMountPoint)(e,a));await s.onClose}}))(0,a,s);case E.h.DELETE:return((e,t,a)=>({iconType:"trash",label:(0,u.jsx)(g.FormattedMessage,{id:"data.mgmt.searchSessions.actionDelete",defaultMessage:"Delete"}),onClick:async()=>{const s=a.overlays.openModal((0,M.toMountPoint)((0,u.jsx)(F,{onActionDismiss:()=>null==s?void 0:s.close(),searchSession:t,api:e}),a));await s.onClose}}))(e,a,s);case E.h.EXTEND:return((e,t,a)=>({iconType:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGw9Im5vbmUiIHZpZXdCb3g9IjAgMCAxNiAxNiI+PHBhdGggZmlsbD0iIzM0Mzc0MSIgZmlsbC1ydWxlPSJldmVub2RkIiBkPSJtMTQgNS0zLTJ2MS4zMzNINHYxLjMzNGg3Vjd6TTAgMTEuNUExLjUgMS41IDAgMCAxIDEuNSAxMGgxM2ExLjUgMS41IDAgMSAxIDAgM2gtMTNBMS41IDEuNSAwIDAgMSAwIDExLjVtMTQuNS0uNUgxMXYxaDMuNWEuNS41IDAgMSAwIDAtMSIgY2xpcC1ydWxlPSJldmVub2RkIi8+PC9zdmc+",label:(0,u.jsx)(g.FormattedMessage,{id:"data.mgmt.searchSessions.actionExtend",defaultMessage:"Extend"}),onClick:async()=>{const s=a.overlays.openModal((0,M.toMountPoint)((0,u.jsx)(w,{onActionDismiss:()=>null==s?void 0:s.close(),searchSession:t,api:e}),a));await s.onClose}}))(e,a,s);case E.h.RENAME:return((e,t,a)=>({iconType:"pencil",label:(0,u.jsx)(g.FormattedMessage,{id:"data.mgmt.searchSessions.actionRename",defaultMessage:"Edit name"}),onClick:async()=>{const s=a.overlays.openModal((0,M.toMountPoint)((0,u.jsx)(L,{onActionDismiss:()=>null==s?void 0:s.close(),api:e,searchSession:t}),a));await s.onClose}}))(e,a,s);default:P.error(`Unknown action: ${t}`)}return null})(e,r,a,s);if(n){const{label:e,iconType:a,onClick:s}=n;return p.length>1&&r===E.h.DELETE&&i.push({isSeparator:!0,key:"separadorable"}),[...i,{key:`action-${r}`,name:e,icon:a,"data-test-subj":`sessionManagementPopoverAction-${r}`,onClick:async()=>{h(),await s(),t()}}]}return i}),[])}];return p.length?(0,u.jsx)(i.EuiPopover,{id:`popover-${a.id}`,button:(0,u.jsx)(i.EuiToolTip,{content:r.i18n.translate("data.mgmt.searchSessions.actions.tooltip.moreActions",{defaultMessage:"More actions"})},(0,u.jsx)(i.EuiButtonIcon,{"aria-label":r.i18n.translate("data.mgmt.searchSessions.ariaLabel.moreActions",{defaultMessage:"More actions"}),color:"text",iconType:"boxesHorizontal",onClick:()=>{c(!d)}})),isOpen:d,closePopover:h,anchorPosition:"downLeft",panelPaddingSize:"s"},(0,u.jsx)(i.EuiContextMenu,{initialPanelId:0,panels:f})):null},O=({children:e,...t})=>(0,u.jsx)(i.EuiText,(0,h.default)({size:"s"},t),e),B=({status:e,children:t,href:a,onClick:s})=>e===T.SearchSessionStatus.IN_PROGRESS?(0,u.jsx)(i.EuiText,{"data-test-subj":"sessionManagementNameText",color:"subdued"},t):(0,u.jsx)(i.EuiLink,{href:a,onClick:s,"data-test-subj":"sessionManagementNameLink"},t),q=({core:e,searchUsageCollector:t,kibanaVersion:a,onBackgroundSearchOpened:s})=>({field:"name",name:r.i18n.translate("data.mgmt.searchSessions.table.headerName",{defaultMessage:"Name"}),sortable:!0,render:(r,n)=>{const{restoreUrl:o,reloadUrl:l,status:d,version:c}=n,h=function(e){return e===T.SearchSessionStatus.IN_PROGRESS||e===T.SearchSessionStatus.COMPLETE}(d),p=h?o:l,f=h?t.trackSessionViewRestored:t.trackSessionReloaded,m=h?null:(0,u.jsx)(i.EuiIconTip,{type:"warning",content:(0,u.jsx)(g.FormattedMessage,{id:"data.mgmt.searchSessions.table.notRestorableWarning",defaultMessage:"The background search will be executed again. You can then save it for future use."})}),y=h&&c!==a?(0,u.jsx)(i.EuiIconTip,{type:"warning",iconProps:{"data-test-subj":"versionIncompatibleWarningTestSubj"},content:(0,u.jsx)(g.FormattedMessage,{id:"data.mgmt.searchSessions.table.versionIncompatibleWarning",defaultMessage:"This background search was created in a Kibana instance running a different version. It may not restore correctly."})}):null;return(0,u.jsx)(_,{coreStart:{application:e.application}},(0,u.jsx)(B,{status:d,href:p,onClick:e=>{null==f||f(),null==s||s({session:n,event:e})}},(0,u.jsx)(O,{"data-test-subj":"sessionManagementNameCol"},(0,u.jsx)(i.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},(0,u.jsx)(i.EuiFlexItem,{grow:!1},r),m&&(0,u.jsx)(i.EuiFlexItem,{css:j,grow:!1},m),y&&(0,u.jsx)(i.EuiFlexItem,{css:j,grow:!1},y)))))}}),j={name:"1xe63ku",styles:"line-height:1"},z=({api:e,core:t,onActionComplete:a,allowedActions:s})=>({field:"actions",name:r.i18n.translate("data.mgmt.searchSessions.table.headerActions",{defaultMessage:"Actions"}),sortable:!1,align:"right",render:(r,n)=>null!=r&&r.length?(0,u.jsx)(i.EuiFlexGroup,{gutterSize:"l",justifyContent:"flexEnd",alignItems:"flexEnd"},(0,u.jsx)(i.EuiFlexItem,{grow:!1,"data-test-subj":"sessionManagementActionsCol"},(0,u.jsx)(D,{api:e,key:`popkey-${n.id}`,session:n,core:t,allowedActions:s,onActionComplete:a}))):null});var U=a(2488),G=a.n(U);const $=(e,t)=>{if(null==e)throw new Error("Invalid date string!");let a;return a="Browser"===t?G().utc(e).tz(G().tz.guess()).format(E.x):G()(e).tz(t).format(E.x),a};var V=a(3721);const K=e=>{switch(e){case T.SearchSessionStatus.IN_PROGRESS:return r.i18n.translate("data.mgmt.searchSessions.status.label.inProgress",{defaultMessage:"In progress"});case T.SearchSessionStatus.EXPIRED:return r.i18n.translate("data.mgmt.searchSessions.status.label.expired",{defaultMessage:"Expired"});case T.SearchSessionStatus.CANCELLED:return r.i18n.translate("data.mgmt.searchSessions.status.label.cancelled",{defaultMessage:"Cancelled"});case T.SearchSessionStatus.COMPLETE:return r.i18n.translate("data.mgmt.searchSessions.status.label.complete",{defaultMessage:"Complete"});case T.SearchSessionStatus.ERROR:return r.i18n.translate("data.mgmt.searchSessions.status.label.error",{defaultMessage:"Error"});default:return V.error(`Unknown status ${e}`),e}},H=e=>{try{const t=(({now:e,session:t,timezone:a})=>{let s;switch(s=t.expires?$(t.expires,a):r.i18n.translate("data.mgmt.searchSessions.status.expireDateUnknown",{defaultMessage:"unknown"}),t.status){case T.SearchSessionStatus.IN_PROGRESS:try{return{textColor:"default",icon:(0,u.jsx)(i.EuiLoadingSpinner,null),label:(0,u.jsx)(O,null,K(t.status)),toolTipContent:r.i18n.translate("data.mgmt.searchSessions.status.message.createdOn",{defaultMessage:"Expires on {expireDate}",values:{expireDate:s}})}}catch(e){throw V.error(e),new Error(`Could not instantiate a createdDate object from: ${t.created}`)}case T.SearchSessionStatus.EXPIRED:try{const e=r.i18n.translate("data.mgmt.searchSessions.status.message.expiredOn",{defaultMessage:"Expired on {expireDate}",values:{expireDate:s}});return{icon:(0,u.jsx)(i.EuiIcon,{color:"#9AA",type:"clock"}),label:(0,u.jsx)(O,null,K(t.status)),toolTipContent:e}}catch(e){throw V.error(e),new Error(`Could not instantiate an expiration Date object from: ${t.expires}`)}case T.SearchSessionStatus.CANCELLED:return{icon:(0,u.jsx)(i.EuiIcon,{color:"#9AA",type:"error"}),label:(0,u.jsx)(O,null,K(t.status)),toolTipContent:r.i18n.translate("data.mgmt.searchSessions.status.message.cancelled",{defaultMessage:"Cancelled by user"})};case T.SearchSessionStatus.ERROR:return{textColor:"danger",icon:(0,u.jsx)(i.EuiIcon,{color:"danger",type:"error"}),label:(0,u.jsx)(O,null,K(t.status)),toolTipContent:t.errors&&t.errors.length>0?r.i18n.translate("data.mgmt.searchSessions.status.message.error",{defaultMessage:'One or more searches failed to complete. Use the "Inspect" action to see the underlying errors.'}):r.i18n.translate("data.mgmt.searchSessions.status.message.unknownError",{defaultMessage:"Unknown error"})};case T.SearchSessionStatus.COMPLETE:try{const e=r.i18n.translate("data.mgmt.searchSessions.status.expiresOn",{defaultMessage:"Expires on {expireDate}",values:{expireDate:s}});return{textColor:"success",icon:(0,u.jsx)(i.EuiIcon,{color:"success",type:"checkInCircleFilled"}),label:(0,u.jsx)(O,null,K(t.status)),toolTipContent:e}}catch(e){throw V.error(e),new Error(`Could not instantiate an expiration Date object for completed session from: ${t.expires}`)}return null;default:throw new Error(`Unknown status: ${t.status}`)}})(e),{session:a}=e;if(t){const{toolTipContent:e}=t;let s=t.icon,r=t.label;return s&&e&&(s=(0,u.jsx)(i.EuiToolTip,{content:e},s)),e&&(r=(0,u.jsx)(i.EuiToolTip,{content:e},(0,u.jsx)(O,{"data-test-subj":"sessionManagementStatusTooltip"},t.label))),(0,u.jsx)(i.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},(0,u.jsx)(i.EuiFlexItem,{grow:!1,css:Y},s),(0,u.jsx)(i.EuiFlexItem,{grow:!1},(0,u.jsx)(O,{color:t.textColor,"data-test-subj":"sessionManagementStatusLabel","data-test-status":a.status},r)))}}catch(e){V.error(e)}return(0,u.jsx)(O,null,e.session.status)},Y={name:"1xe63ku",styles:"line-height:1"},W=e=>({field:"status",name:r.i18n.translate("data.mgmt.searchSessions.table.headerStatus",{defaultMessage:"Status"}),sortable:!0,render:(t,a)=>(0,u.jsx)(H,{session:a,timezone:e})}),Q=__kbnSharedDeps__.ReactUse.useDebounce;var J=a.n(Q),X=a(1241),Z=a(3721);const ee=({core:e,api:t,config:a,timezone:s,onActionComplete:n,kibanaVersion:o,searchUsageCollector:l})=>[c,{...q({core:e,searchUsageCollector:l,kibanaVersion:o}),width:"20%"},{field:"numSearches",name:r.i18n.translate("data.mgmt.searchSessions.table.numSearches",{defaultMessage:"# Searches"}),sortable:!0,render:(e,t)=>(0,u.jsx)(O,{color:"subdued","data-test-subj":"sessionManagementNumSearchesCol"},e)},W(s),{field:"created",name:r.i18n.translate("data.mgmt.searchSessions.table.headerStarted",{defaultMessage:"Created"}),sortable:!0,render:(e,{id:t})=>{try{const t=$(e,s);return(0,u.jsx)(O,{color:"subdued","data-test-subj":"sessionManagementCreatedCol"},t)}catch(t){return Z.error(t),(0,u.jsx)(O,null,e)}}},{field:"expires",name:r.i18n.translate("data.mgmt.searchSessions.table.headerExpiration",{defaultMessage:"Expiration"}),sortable:!0,render:(e,{id:t,status:a})=>{if(e&&a!==T.SearchSessionStatus.EXPIRED&&a!==T.SearchSessionStatus.CANCELLED&&a!==T.SearchSessionStatus.ERROR)try{const t=$(e,s);return(0,u.jsx)(O,{color:"subdued","data-test-subj":"sessionManagementExpiresCol"},t)}catch(t){return Z.error(t),(0,u.jsx)(O,null,e)}return(0,u.jsx)(O,{color:"subdued","data-test-subj":"sessionManagementExpiresCol"},"--")}},{field:"status",name:"",sortable:!1,render:(e,{expires:t})=>{const s=((e,t)=>{const a=I().utc().valueOf(),s=I().utc(t).valueOf(),i=I().duration(s-a),n=Math.floor(i.asDays()),o=Math.ceil(I().duration(e.management.expiresSoonWarning).asDays());let l=r.i18n.translate("data.mgmt.searchSessions.status.expiresSoonInDays",{defaultMessage:"Expires in {numDays, plural, one {# day} other {# days}}",values:{numDays:n}}),u=r.i18n.translate("data.mgmt.searchSessions.status.expiresSoonInDaysTooltip",{defaultMessage:"{numDays, plural, one {# day} other {# days}}",values:{numDays:n}});if(0===n){const e=Math.floor(i.asHours());l=r.i18n.translate("data.mgmt.searchSessions.status.expiresSoonInHours",{defaultMessage:"This session expires in {numHours, plural, one {# hour} other {# hours}}",values:{numHours:e}}),u=r.i18n.translate("data.mgmt.searchSessions.status.expiresSoonInHoursTooltip",{defaultMessage:"{numHours, plural, one {# hour} other {# hours}}",values:{numHours:e}})}if(i.asMilliseconds()>0&&n<=o)return{toolTipContent:l,statusContent:u}})(a,t);if(s){const{toolTipContent:e,statusContent:t}=s;return(0,u.jsx)(i.EuiToolTip,{content:e},(0,u.jsx)(i.EuiBadge,{tabIndex:0,color:"warning","data-test-subj":"sessionManagementStatusCol"},t))}return(0,u.jsx)(O,null)}},z({api:t,core:e,onActionComplete:n})],te=e=>({type:"field_value_selection",name:r.i18n.translate("data.mgmt.searchSessions.search.filterApp",{defaultMessage:"App"}),field:"appId",multiSelect:"or",options:[...new Set(e.map((e=>{var t;return null!==(t=e.appId)&&void 0!==t?t:"unknown"})))].sort().map((e=>({value:e,view:(0,l.capitalize)(e)})))});var ae=a(1036);const se=e=>({type:"field_value_selection",name:r.i18n.translate("data.mgmt.searchSessions.search.filterStatus",{defaultMessage:"Status"}),field:"status",multiSelect:"or",options:Object.values(ae.v).sort().map((e=>({value:e,view:(0,u.jsx)(O,null,K(e))})))});var ie=a(3721);function re(e,t,a){try{const s=e.get(t);return null==s?void 0:s.getRedirectUrl(a)}catch(e){ie.error("Could not create URL from restoreState"),ie.error(e)}}const ne=({savedObject:e,locators:t,sessionStatuses:a,actions:s,enableOpeningInNewTab:i})=>{var r,n;const{name:o,appId:l,created:u,expires:d,locatorId:c,initialState:g,restoreState:h,idMapping:p,version:f}=e.attributes,m=null===(r=a[e.id])||void 0===r?void 0:r.status,y=null===(n=a[e.id])||void 0===n?void 0:n.errors,b=function(e){const t=[];return t.push(E.h.INSPECT),t.push(E.h.RENAME),e!==T.SearchSessionStatus.IN_PROGRESS&&e!==T.SearchSessionStatus.COMPLETE||t.push(E.h.EXTEND),t.push(E.h.DELETE),t}(m).filter((e=>null==s||!s.length||s.includes(e)));g&&delete g.searchSessionId;const v=re(t,c,g),S=re(t,c,i?{...h,tab:{id:"new",label:o}}:h);return{id:e.id,name:o,appId:l,created:u,expires:d,status:m,actions:b,restoreUrl:S,reloadUrl:v,initialState:g,restoreState:h,idMapping:p,numSearches:Object.keys(p).length,version:f,errors:y}};function oe({core:e,locators:t,api:a,timezone:s,config:r,kibanaVersion:o,searchUsageCollector:l,hideRefreshButton:d=!1,getColumns:c=ee,appId:p,onBackgroundSearchOpened:f,...m}){const[y,b]=(0,n.useState)([]),[v,S]=(0,n.useState)(!1),[_,E]=(0,n.useState)(!1),M=(0,n.useRef)(),F=(0,n.useRef)(null),A=(0,n.useMemo)((()=>I().duration(r.management.refreshInterval).asMilliseconds()),[r.management.refreshInterval]),w=(0,n.useMemo)((()=>e.featureFlags.getBooleanValue("discover.tabsEnabled",!0)),[e.featureFlags]),{pageSize:x,sorting:k,onTableChange:R}=(0,X.B8)({tableId:"searchSessionsMgmt",initialSort:{field:"created",direction:"desc"}});J()((()=>{E(v)}),250,[v]);const N=(0,n.useCallback)((async()=>{F.current&&(clearTimeout(F.current),F.current=null),S(!0);const e=e=>{b(e)};if(M.current=e,"hidden"!==document.visibilityState){let s=[];try{const{savedObjects:e,statuses:i}=await a.fetchTableData({appId:p});s=e.map((e=>ne({savedObject:e,locators:t,sessionStatuses:i,enableOpeningInNewTab:w})))}catch(e){}M.current===e&&(e(s),S(!1))}M.current===e&&A>0&&(F.current&&clearTimeout(F.current),F.current=window.setTimeout(N,A))}),[a,A,t,p,w]);(0,n.useEffect)((()=>(N(),l.trackSessionsListLoaded(),()=>{F.current&&clearTimeout(F.current)})),[N,l]);const C=c({core:e,api:a,config:r,timezone:s,onActionComplete:()=>{N()},kibanaVersion:o,searchUsageCollector:l,onBackgroundSearchOpened:f}),L={box:{incremental:!0},filters:(0,n.useMemo)((()=>{const e=[];return C.some((e=>"field"in e&&"appId"===e.field))&&!p&&e.push(te(y)),C.some((e=>"field"in e&&"status"===e.field))&&e.push(se(y)),e}),[C,y,p]),toolsRight:d?void 0:(0,u.jsx)(O,null,(0,u.jsx)(i.EuiButton,{fill:!0,iconType:"refresh",onClick:N,disabled:_,isLoading:_,"data-test-subj":"sessionManagementRefreshBtn"},(0,u.jsx)(g.FormattedMessage,{id:"data.mgmt.searchSessions.search.tools.refresh",defaultMessage:"Refresh"})))};return(0,u.jsx)(i.EuiInMemoryTable,(0,h.default)({},m,{id:T.SEARCH_SESSIONS_TABLE_ID,"data-test-subj":T.SEARCH_SESSIONS_TABLE_ID,rowProps:e=>({"data-test-subj":"searchSessionsRow","data-test-search-session-id":`id-${e.id}`}),columns:C,items:y,pagination:{pageSize:x},search:L,sorting:k,onTableChange:R,tableLayout:"auto"}))}},3746:(e,t,a)=>{"use strict";a.d(t,{uq:()=>y,PI:()=>m,_o:()=>b});var s=a(5008),i=a(1225),r=(a(4286),a(5804)),n=a(409),o=a(2876),l=a(1319),u=a(5879),d=a(6871),c=a(4041);const g=({core:e,kibanaVersion:t,searchUsageCollector:a,api:s,timezone:i,onActionComplete:r,onBackgroundSearchOpened:n})=>[d.Y.nameColumn({core:e,kibanaVersion:t,searchUsageCollector:a,onBackgroundSearchOpened:n}),d.Y.statusColumn(i),d.Y.actionsColumn({core:e,api:s,onActionComplete:r,allowedActions:[c.h.EXTEND,c.h.RENAME,c.h.DELETE]})],h="33vw";var p=a(6791);const f=({onClose:e,api:t,coreStart:a,usageCollector:i,config:r,kibanaVersion:n,locators:o,appId:c,onBackgroundSearchOpened:f})=>{const m=(0,l.useGeneratedHtmlId)(),y=s.i18n.translate("data.session_mgmt.technical_preview_label",{defaultMessage:"Technical preview"});return(0,p.jsx)(l.EuiFlyout,{size:h,"aria-labelledby":m,onClose:e},(0,p.jsx)(l.EuiFlyoutHeader,{hasBorder:!0},(0,p.jsx)(l.EuiFlexGroup,{alignItems:"center"},(0,p.jsx)(l.EuiTitle,{id:m,size:"m"},(0,p.jsx)("h1",null,(0,p.jsx)(u.FormattedMessage,{id:"data.session_mgmt.flyout_title",defaultMessage:"Background searches"}))),(0,p.jsx)(l.EuiBetaBadge,{label:y},y))),(0,p.jsx)(l.EuiFlyoutBody,null,(0,p.jsx)(d.p,{core:a,api:t,timezone:a.uiSettings.get("dateFormat:tz"),config:r,kibanaVersion:n,searchUsageCollector:i,locators:o,hideRefreshButton:!0,getColumns:g,appId:c,onBackgroundSearchOpened:f})),(0,p.jsx)(l.EuiFlyoutFooter,null,(0,p.jsx)(l.EuiButtonEmpty,{onClick:e},(0,p.jsx)(u.FormattedMessage,{id:"data.session_mgmt.close_flyout",defaultMessage:"Close"}))))};function m({coreStart:e,kibanaVersion:t,usageCollector:a,config:s,sessionsClient:i,share:l}){return(u={})=>{const d=new o.p(i,s,{notifications:e.notifications,application:e.application,usageCollector:a,featureFlags:e.featureFlags}),{Provider:c}=(0,n.createKibanaReactContext)(e),g=e.overlays.openFlyout((0,r.toMountPoint)(e.rendering.addContext((0,p.jsx)(c,null,(0,p.jsx)(f,{onClose:()=>g.close(),onBackgroundSearchOpened:e=>{var t;null===(t=u.onBackgroundSearchOpened)||void 0===t||t.call(u,e),g.close()},appId:u.appId,api:d,coreStart:e,usageCollector:a,config:s,kibanaVersion:t,locators:l.url.locators}))),e),{hideCloseButton:!0,size:h});return{flyout:g}}}const y={id:i.j,getI18nName:()=>s.i18n.translate("data.mgmt.backgroundSearch.appTitle",{defaultMessage:"Background Search"})};function b(e,t,s,i){return t.management.sections.section.kibana.registerApp({id:y.id,title:y.getI18nName(),order:1.75,mount:async r=>{const{SearchSessionsMgmtApp:n}=await a.e(889).then(a.bind(a,3889));return new n(e,t,s,i,r).mountManagementSection()}})}},2876:(e,t,a)=>{"use strict";a.d(t,{p:()=>SearchSessionsMgmtAPI});var s=a(5008),i=a(1783),r=a.n(i),n=a(190),o=a(3721);class SearchSessionsMgmtAPI{constructor(e,t,a){this.sessionsClient=e,this.config=t,this.deps=a}async fetchTableData({appId:e}={}){const t=this.config.management,a=r().duration(t.refreshTimeout),i=(0,n.from)(this.sessionsClient.find({page:1,perPage:t.maxSessions,sortField:"created",sortOrder:"desc"})),l=(0,n.timer)(a.asMilliseconds()).pipe((0,n.tap)((()=>{this.deps.notifications.toasts.addDanger(s.i18n.translate("data.mgmt.searchSessions.api.backgroundSearchFetchTimeout",{defaultMessage:"Fetching the Background Search info timed out after {timeout} seconds",values:{timeout:a.asSeconds()}}))})),(0,n.mapTo)(null));try{const t=await(0,n.race)(i,l).toPromise();if(t&&t.saved_objects)return{savedObjects:t.saved_objects.filter((t=>!e||t.attributes.appId===e)),statuses:t.statuses}}catch(e){o.error(e),this.deps.notifications.toasts.addError(e,{title:s.i18n.translate("data.mgmt.searchSessions.api.fetchError",{defaultMessage:"Failed to refresh the page!"})})}return{savedObjects:[],statuses:{}}}getExtendByDuration(){return this.config.defaultExpiration}async sendDelete(e){var t;null===(t=this.deps.usageCollector)||void 0===t||t.trackSessionDeleted();try{await this.sessionsClient.delete(e),this.deps.notifications.toasts.addSuccess({title:s.i18n.translate("data.mgmt.searchSessions.api.backgroundSearchDeleted",{defaultMessage:"The background search was deleted."})})}catch(e){this.deps.notifications.toasts.addError(e,{title:s.i18n.translate("data.mgmt.searchSessions.api.backgroundSearchDeletedError",{defaultMessage:"Failed to delete the background search!"})})}}async sendExtend(e,t){var a;null===(a=this.deps.usageCollector)||void 0===a||a.trackSessionExtended();try{await this.sessionsClient.extend(e,t),this.deps.notifications.toasts.addSuccess({title:s.i18n.translate("data.mgmt.searchSessions.api.backgroundSearchExtended",{defaultMessage:"The background search was extended."})})}catch(e){this.deps.notifications.toasts.addError(e,{title:s.i18n.translate("data.mgmt.searchSessions.api.backgroundSearchExtendError",{defaultMessage:"Failed to extend the background search!"})})}}async sendRename(e,t){try{await this.sessionsClient.rename(e,t),this.deps.notifications.toasts.addSuccess({title:s.i18n.translate("data.mgmt.searchSessions.api.backgroundSearchRename",{defaultMessage:"The background search was renamed"})})}catch(e){this.deps.notifications.toasts.addError(e,{title:s.i18n.translate("data.mgmt.searchSessions.api.backgroundSearchRenameError",{defaultMessage:"Failed to rename the background search"})})}}}},4041:(e,t,a)=>{"use strict";a.d(t,{h:()=>i,x:()=>s});const s="D MMM, YYYY, HH:mm:ss";let i=function(e){return e.INSPECT="inspect",e.EXTEND="extend",e.DELETE="delete",e.RENAME="rename",e}({})},8560:(e,t,a)=>{"use strict";a.d(t,{A4:()=>c,AK:()=>o,CX:()=>l,C_:()=>i,Ov:()=>u,Yl:()=>h,_O:()=>r,sI:()=>d});var s=a(1215);const[i,r]=(0,s.createGetterSetter)("UiSettings"),[n,o]=(0,s.createGetterSetter)("Overlays"),[l,u]=(0,s.createGetterSetter)("IndexPatterns"),[d,c]=(0,s.createGetterSetter)("Search"),[g,h]=(0,s.createGetterSetter)("Theme")},583:(e,t,a)=>{"use strict";a.d(t,{B:()=>i,J:()=>r});var s=a(5008);const i="FILTER_TRIGGER",r={id:i,title:s.i18n.translate("data.triggers.applyFilterTitle",{defaultMessage:"Apply filter"}),description:s.i18n.translate("data.triggers.applyFilterDescription",{defaultMessage:"When kibana filter is applied. Could be a single value or a range filter."})}},6214:e=>{"use strict";var t="%[a-f0-9]{2}",a=new RegExp("("+t+")|([^%]+?)","gi"),s=new RegExp("("+t+")+","gi");function i(e,t){try{return[decodeURIComponent(e.join(""))]}catch(e){}if(1===e.length)return e;t=t||1;var a=e.slice(0,t),s=e.slice(t);return Array.prototype.concat.call([],i(a),i(s))}function r(e){try{return decodeURIComponent(e)}catch(r){for(var t=e.match(a)||[],s=1;s<t.length;s++)t=(e=i(t,s).join("")).match(a)||[];return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"","%FF%FE":""},a=s.exec(e);a;){try{t[a[0]]=decodeURIComponent(a[0])}catch(e){var i=r(a[0]);i!==a[0]&&(t[a[0]]=i)}a=s.exec(e)}t["%C2"]="";for(var n=Object.keys(t),o=0;o<n.length;o++){var l=n[o];e=e.replace(new RegExp(l,"g"),t[l])}return e}(e)}}},4513:e=>{"use strict";e.exports=function e(t,a){if(t===a)return!0;if(t&&a&&"object"==typeof t&&"object"==typeof a){if(t.constructor!==a.constructor)return!1;var s,i,r;if(Array.isArray(t)){if((s=t.length)!=a.length)return!1;for(i=s;0!==i--;)if(!e(t[i],a[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===a.source&&t.flags===a.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===a.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===a.toString();if((s=(r=Object.keys(t)).length)!==Object.keys(a).length)return!1;for(i=s;0!==i--;)if(!Object.prototype.hasOwnProperty.call(a,r[i]))return!1;for(i=s;0!==i--;){var n=r[i];if(!e(t[n],a[n]))return!1}return!0}return t!=t&&a!=a}},6880:function(e){!function(t){"use strict";const a="(0?\\d+|0x[a-f0-9]+)",s={fourOctet:new RegExp(`^${a}\\.${a}\\.${a}\\.${a}$`,"i"),threeOctet:new RegExp(`^${a}\\.${a}\\.${a}$`,"i"),twoOctet:new RegExp(`^${a}\\.${a}$`,"i"),longValue:new RegExp(`^${a}$`,"i")},i=new RegExp("^0[0-7]+$","i"),r=new RegExp("^0x[a-f0-9]+$","i"),n="%[0-9a-z]{1,}",o="(?:[0-9a-f]+::?)+",l={zoneIndex:new RegExp(n,"i"),native:new RegExp(`^(::)?(${o})?([0-9a-f]+)?(::)?(${n})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${a}\\.${a}\\.${a}\\.${a}(${n})?)$`,"i"),transitional:new RegExp(`^((?:${o})|(?:::)(?:${o})?)${a}\\.${a}\\.${a}\\.${a}(${n})?$`,"i")};function u(e,t){if(e.indexOf("::")!==e.lastIndexOf("::"))return null;let a,s,i=0,r=-1,n=(e.match(l.zoneIndex)||[])[0];for(n&&(n=n.substring(1),e=e.replace(/%.+$/,""));(r=e.indexOf(":",r+1))>=0;)i++;if("::"===e.substr(0,2)&&i--,"::"===e.substr(-2,2)&&i--,i>t)return null;for(s=t-i,a=":";s--;)a+="0:";return":"===(e=e.replace("::",a))[0]&&(e=e.slice(1)),":"===e[e.length-1]&&(e=e.slice(0,-1)),{parts:t=function(){const t=e.split(":"),a=[];for(let e=0;e<t.length;e++)a.push(parseInt(t[e],16));return a}(),zoneId:n}}function d(e,t,a,s){if(e.length!==t.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let i,r=0;for(;s>0;){if(i=a-s,i<0&&(i=0),e[r]>>i!==t[r]>>i)return!1;s-=a,r+=1}return!0}function c(e){if(r.test(e))return parseInt(e,16);if("0"===e[0]&&!isNaN(parseInt(e[1],10))){if(i.test(e))return parseInt(e,8);throw new Error(`ipaddr: cannot parse ${e} as octal`)}return parseInt(e,10)}function g(e,t){for(;e.length<t;)e=`0${e}`;return e}const h={};h.IPv4=function(){function e(e){if(4!==e.length)throw new Error("ipaddr: ipv4 octet count should be 4");let t,a;for(t=0;t<e.length;t++)if(a=e[t],!(0<=a&&a<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=e}return e.prototype.SpecialRanges={unspecified:[[new e([0,0,0,0]),8]],broadcast:[[new e([255,255,255,255]),32]],multicast:[[new e([224,0,0,0]),4]],linkLocal:[[new e([169,254,0,0]),16]],loopback:[[new e([127,0,0,0]),8]],carrierGradeNat:[[new e([100,64,0,0]),10]],private:[[new e([10,0,0,0]),8],[new e([172,16,0,0]),12],[new e([192,168,0,0]),16]],reserved:[[new e([192,0,0,0]),24],[new e([192,0,2,0]),24],[new e([192,88,99,0]),24],[new e([198,18,0,0]),15],[new e([198,51,100,0]),24],[new e([203,0,113,0]),24],[new e([240,0,0,0]),4]],as112:[[new e([192,175,48,0]),24],[new e([192,31,196,0]),24]],amt:[[new e([192,52,193,0]),24]]},e.prototype.kind=function(){return"ipv4"},e.prototype.match=function(e,t){let a;if(void 0===t&&(a=e,e=a[0],t=a[1]),"ipv4"!==e.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return d(this.octets,e.octets,8,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const a={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let s,i,r;for(s=3;s>=0;s-=1){if(i=this.octets[s],!(i in a))return null;if(r=a[i],t&&0!==r)return null;8!==r&&(t=!0),e+=r}return 32-e},e.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){return this.octets.slice(0)},e.prototype.toIPv4MappedAddress=function(){return h.IPv6.parse(`::ffff:${this.toString()}`)},e.prototype.toNormalizedString=function(){return this.toString()},e.prototype.toString=function(){return this.octets.join(".")},e}(),h.IPv4.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),a=t[0].toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[];let r=0;for(;r<4;)i.push(parseInt(a[r],10)|255^parseInt(s[r],10)),r++;return new this(i)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.isIPv4=function(e){return null!==this.parser(e)},h.IPv4.isValid=function(e){try{return new this(this.parser(e)),!0}catch(e){return!1}},h.IPv4.isValidCIDR=function(e){try{return this.parseCIDR(e),!0}catch(e){return!1}},h.IPv4.isValidFourPartDecimal=function(e){return!(!h.IPv4.isValid(e)||!e.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},h.IPv4.networkAddressFromCIDR=function(e){let t,a,s,i,r;try{for(t=this.parseCIDR(e),s=t[0].toByteArray(),r=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[],a=0;a<4;)i.push(parseInt(s[a],10)&parseInt(r[a],10)),a++;return new this(i)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},h.IPv4.parse=function(e){const t=this.parser(e);if(null===t)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(t)},h.IPv4.parseCIDR=function(e){let t;if(t=e.match(/^(.+)\/(\d+)$/)){const e=parseInt(t[2]);if(e>=0&&e<=32){const a=[this.parse(t[1]),e];return Object.defineProperty(a,"toString",{value:function(){return this.join("/")}}),a}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},h.IPv4.parser=function(e){let t,a,i;if(t=e.match(s.fourOctet))return function(){const e=t.slice(1,6),s=[];for(let t=0;t<e.length;t++)a=e[t],s.push(c(a));return s}();if(t=e.match(s.longValue)){if(i=c(t[1]),i>4294967295||i<0)throw new Error("ipaddr: address outside defined range");return function(){const e=[];let t;for(t=0;t<=24;t+=8)e.push(i>>t&255);return e}().reverse()}return(t=e.match(s.twoOctet))?function(){const e=t.slice(1,4),a=[];if(i=c(e[1]),i>16777215||i<0)throw new Error("ipaddr: address outside defined range");return a.push(c(e[0])),a.push(i>>16&255),a.push(i>>8&255),a.push(255&i),a}():(t=e.match(s.threeOctet))?function(){const e=t.slice(1,5),a=[];if(i=c(e[2]),i>65535||i<0)throw new Error("ipaddr: address outside defined range");return a.push(c(e[0])),a.push(c(e[1])),a.push(i>>8&255),a.push(255&i),a}():null},h.IPv4.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>32)throw new Error("ipaddr: invalid IPv4 prefix length");const t=[0,0,0,0];let a=0;const s=Math.floor(e/8);for(;a<s;)t[a]=255,a++;return s<4&&(t[s]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},h.IPv6=function(){function e(e,t){let a,s;if(16===e.length)for(this.parts=[],a=0;a<=14;a+=2)this.parts.push(e[a]<<8|e[a+1]);else{if(8!==e.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=e}for(a=0;a<this.parts.length;a++)if(s=this.parts[a],!(0<=s&&s<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");t&&(this.zoneId=t)}return e.prototype.SpecialRanges={unspecified:[new e([0,0,0,0,0,0,0,0]),128],linkLocal:[new e([65152,0,0,0,0,0,0,0]),10],multicast:[new e([65280,0,0,0,0,0,0,0]),8],loopback:[new e([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new e([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new e([0,0,0,0,0,65535,0,0]),96],discard:[new e([256,0,0,0,0,0,0,0]),64],rfc6145:[new e([0,0,0,0,65535,0,0,0]),96],rfc6052:[new e([100,65435,0,0,0,0,0,0]),96],"6to4":[new e([8194,0,0,0,0,0,0,0]),16],teredo:[new e([8193,0,0,0,0,0,0,0]),32],benchmarking:[new e([8193,2,0,0,0,0,0,0]),48],amt:[new e([8193,3,0,0,0,0,0,0]),32],as112v6:[[new e([8193,4,274,0,0,0,0,0]),48],[new e([9760,79,32768,0,0,0,0,0]),48]],deprecated:[new e([8193,16,0,0,0,0,0,0]),28],orchid2:[new e([8193,32,0,0,0,0,0,0]),28],droneRemoteIdProtocolEntityTags:[new e([8193,48,0,0,0,0,0,0]),28],reserved:[[new e([8193,0,0,0,0,0,0,0]),23],[new e([8193,3512,0,0,0,0,0,0]),32]]},e.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},e.prototype.kind=function(){return"ipv6"},e.prototype.match=function(e,t){let a;if(void 0===t&&(a=e,e=a[0],t=a[1]),"ipv6"!==e.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return d(this.parts,e.parts,16,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const a={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let s,i;for(let r=7;r>=0;r-=1){if(s=this.parts[r],!(s in a))return null;if(i=a[s],t&&0!==i)return null;16!==i&&(t=!0),e+=i}return 128-e},e.prototype.range=function(){return h.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){let e;const t=[],a=this.parts;for(let s=0;s<a.length;s++)e=a[s],t.push(e>>8),t.push(255&e);return t},e.prototype.toFixedLengthString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(g(this.parts[t].toString(16),4));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const e=this.parts.slice(-2),t=e[0],a=e[1];return new h.IPv4([t>>8,255&t,a>>8,255&a])},e.prototype.toNormalizedString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(this.parts[t].toString(16));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toRFC5952String=function(){const e=/((^|:)(0(:|$)){2,})/g,t=this.toNormalizedString();let a,s=0,i=-1;for(;a=e.exec(t);)a[0].length>i&&(s=a.index,i=a[0].length);return i<0?t:`${t.substring(0,s)}::${t.substring(s+i)}`},e.prototype.toString=function(){return this.toRFC5952String()},e}(),h.IPv6.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),a=t[0].toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[];let r=0;for(;r<16;)i.push(parseInt(a[r],10)|255^parseInt(s[r],10)),r++;return new this(i)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},h.IPv6.isIPv6=function(e){return null!==this.parser(e)},h.IPv6.isValid=function(e){if("string"==typeof e&&-1===e.indexOf(":"))return!1;try{const t=this.parser(e);return new this(t.parts,t.zoneId),!0}catch(e){return!1}},h.IPv6.isValidCIDR=function(e){if("string"==typeof e&&-1===e.indexOf(":"))return!1;try{return this.parseCIDR(e),!0}catch(e){return!1}},h.IPv6.networkAddressFromCIDR=function(e){let t,a,s,i,r;try{for(t=this.parseCIDR(e),s=t[0].toByteArray(),r=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[],a=0;a<16;)i.push(parseInt(s[a],10)&parseInt(r[a],10)),a++;return new this(i)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},h.IPv6.parse=function(e){const t=this.parser(e);if(null===t.parts)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(t.parts,t.zoneId)},h.IPv6.parseCIDR=function(e){let t,a,s;if((a=e.match(/^(.+)\/(\d+)$/))&&(t=parseInt(a[2]),t>=0&&t<=128))return s=[this.parse(a[1]),t],Object.defineProperty(s,"toString",{value:function(){return this.join("/")}}),s;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},h.IPv6.parser=function(e){let t,a,s,i,r,n;if(s=e.match(l.deprecatedTransitional))return this.parser(`::ffff:${s[1]}`);if(l.native.test(e))return u(e,8);if((s=e.match(l.transitional))&&(n=s[6]||"",t=s[1],s[1].endsWith("::")||(t=t.slice(0,-1)),t=u(t+n,6),t.parts)){for(r=[parseInt(s[2]),parseInt(s[3]),parseInt(s[4]),parseInt(s[5])],a=0;a<r.length;a++)if(i=r[a],!(0<=i&&i<=255))return null;return t.parts.push(r[0]<<8|r[1]),t.parts.push(r[2]<<8|r[3]),{parts:t.parts,zoneId:t.zoneId}}return null},h.IPv6.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>128)throw new Error("ipaddr: invalid IPv6 prefix length");const t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let a=0;const s=Math.floor(e/8);for(;a<s;)t[a]=255,a++;return s<16&&(t[s]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},h.fromByteArray=function(e){const t=e.length;if(4===t)return new h.IPv4(e);if(16===t)return new h.IPv6(e);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},h.isValid=function(e){return h.IPv6.isValid(e)||h.IPv4.isValid(e)},h.isValidCIDR=function(e){return h.IPv6.isValidCIDR(e)||h.IPv4.isValidCIDR(e)},h.parse=function(e){if(h.IPv6.isValid(e))return h.IPv6.parse(e);if(h.IPv4.isValid(e))return h.IPv4.parse(e);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},h.parseCIDR=function(e){try{return h.IPv6.parseCIDR(e)}catch(t){try{return h.IPv4.parseCIDR(e)}catch(e){throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},h.process=function(e){const t=this.parse(e);return"ipv6"===t.kind()&&t.isIPv4MappedAddress()?t.toIPv4Address():t},h.subnetMatch=function(e,t,a){let s,i,r,n;for(i in null==a&&(a="unicast"),t)if(Object.prototype.hasOwnProperty.call(t,i))for(r=t[i],!r[0]||r[0]instanceof Array||(r=[r]),s=0;s<r.length;s++)if(n=r[s],e.kind()===n[0].kind()&&e.match.apply(e,n))return i;return a},e.exports?e.exports=h:t.ipaddr=h}(this)},9457:(e,t,a)=>{var s="undefined"!=typeof JSON?JSON:a(5895);e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var a=t.space||"";"number"==typeof a&&(a=Array(a+1).join(" "));var n,o="boolean"==typeof t.cycles&&t.cycles,l=t.replacer||function(e,t){return t},u=t.cmp&&(n=t.cmp,function(e){return function(t,a){var s={key:t,value:e[t]},i={key:a,value:e[a]};return n(s,i)}}),d=[];return function e(t,n,c,g){var h=a?"\n"+new Array(g+1).join(a):"",p=a?": ":":";if(c&&c.toJSON&&"function"==typeof c.toJSON&&(c=c.toJSON()),void 0!==(c=l.call(t,n,c))){if("object"!=typeof c||null===c)return s.stringify(c);if(i(c)){for(var f=[],m=0;m<c.length;m++){var y=e(c,m,c[m],g+1)||s.stringify(null);f.push(h+a+y)}return"["+f.join(",")+h+"]"}if(-1!==d.indexOf(c)){if(o)return s.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}d.push(c);var b=r(c).sort(u&&u(c));for(f=[],m=0;m<b.length;m++){var v=e(c,n=b[m],c[n],g+1);if(v){var S=s.stringify(n)+p+v;f.push(h+a+S)}}return d.splice(d.indexOf(c),1),"{"+f.join(",")+h+"}"}}({"":e},"",e,0)};var i=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},r=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},a=[];for(var s in e)t.call(e,s)&&a.push(s);return a}},5895:(e,t,a)=>{t.parse=a(6179),t.stringify=a(2734)},6179:e=>{var t,a,s,i,r={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},n=function(e){throw{name:"SyntaxError",message:e,at:t,text:s}},o=function(e){return e&&e!==a&&n("Expected '"+e+"' instead of '"+a+"'"),a=s.charAt(t),t+=1,a},l=function(){var e,t="";for("-"===a&&(t="-",o("-"));a>="0"&&a<="9";)t+=a,o();if("."===a)for(t+=".";o()&&a>="0"&&a<="9";)t+=a;if("e"===a||"E"===a)for(t+=a,o(),"-"!==a&&"+"!==a||(t+=a,o());a>="0"&&a<="9";)t+=a,o();if(e=+t,isFinite(e))return e;n("Bad number")},u=function(){var e,t,s,i="";if('"'===a)for(;o();){if('"'===a)return o(),i;if("\\"===a)if(o(),"u"===a){for(s=0,t=0;t<4&&(e=parseInt(o(),16),isFinite(e));t+=1)s=16*s+e;i+=String.fromCharCode(s)}else{if("string"!=typeof r[a])break;i+=r[a]}else i+=a}n("Bad string")},d=function(){for(;a&&a<=" ";)o()};i=function(){switch(d(),a){case"{":return function(){var e,t={};if("{"===a){if(o("{"),d(),"}"===a)return o("}"),t;for(;a;){if(e=u(),d(),o(":"),Object.hasOwnProperty.call(t,e)&&n('Duplicate key "'+e+'"'),t[e]=i(),d(),"}"===a)return o("}"),t;o(","),d()}}n("Bad object")}();case"[":return function(){var e=[];if("["===a){if(o("["),d(),"]"===a)return o("]"),e;for(;a;){if(e.push(i()),d(),"]"===a)return o("]"),e;o(","),d()}}n("Bad array")}();case'"':return u();case"-":return l();default:return a>="0"&&a<="9"?l():function(){switch(a){case"t":return o("t"),o("r"),o("u"),o("e"),!0;case"f":return o("f"),o("a"),o("l"),o("s"),o("e"),!1;case"n":return o("n"),o("u"),o("l"),o("l"),null}n("Unexpected '"+a+"'")}()}},e.exports=function(e,r){var o;return s=e,t=0,a=" ",o=i(),d(),a&&n("Syntax error"),"function"==typeof r?function e(t,a){var s,i,n=t[a];if(n&&"object"==typeof n)for(s in n)Object.prototype.hasOwnProperty.call(n,s)&&(void 0!==(i=e(n,s))?n[s]=i:delete n[s]);return r.call(t,a,n)}({"":o},""):o}},2734:e=>{var t,a,s,i=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,r={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function n(e){return i.lastIndex=0,i.test(e)?'"'+e.replace(i,(function(e){var t=r[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'}function o(e,i){var r,l,u,d,c,g=t,h=i[e];switch(h&&"object"==typeof h&&"function"==typeof h.toJSON&&(h=h.toJSON(e)),"function"==typeof s&&(h=s.call(i,e,h)),typeof h){case"string":return n(h);case"number":return isFinite(h)?String(h):"null";case"boolean":case"null":return String(h);case"object":if(!h)return"null";if(t+=a,c=[],"[object Array]"===Object.prototype.toString.apply(h)){for(d=h.length,r=0;r<d;r+=1)c[r]=o(r,h)||"null";return u=0===c.length?"[]":t?"[\n"+t+c.join(",\n"+t)+"\n"+g+"]":"["+c.join(",")+"]",t=g,u}if(s&&"object"==typeof s)for(d=s.length,r=0;r<d;r+=1)"string"==typeof(l=s[r])&&(u=o(l,h))&&c.push(n(l)+(t?": ":":")+u);else for(l in h)Object.prototype.hasOwnProperty.call(h,l)&&(u=o(l,h))&&c.push(n(l)+(t?": ":":")+u);return u=0===c.length?"{}":t?"{\n"+t+c.join(",\n"+t)+"\n"+g+"}":"{"+c.join(",")+"}",t=g,u}}e.exports=function(e,i,r){var n;if(t="",a="","number"==typeof r)for(n=0;n<r;n+=1)a+=" ";else"string"==typeof r&&(a=r);if(s=i,i&&"function"!=typeof i&&("object"!=typeof i||"number"!=typeof i.length))throw new Error("JSON.stringify");return o("",{"":e})}},151:(e,t,a)=>{"use strict";const s=a(8136),i=a(6214),r=a(1536);function n(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function o(e,t){return t.encode?t.strict?s(e):encodeURIComponent(e):e}function l(e,t){return t.decode?i(e):e}function u(e){return Array.isArray(e)?e.sort():"object"==typeof e?u(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function d(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function c(e){const t=(e=d(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function g(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function h(e,t){n((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const a=function(e){let t;switch(e.arrayFormat){case"index":return(e,a,s)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===s[e]&&(s[e]={}),s[e][t[1]]=a):s[e]=a};case"bracket":return(e,a,s)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==s[e]?s[e]=[].concat(s[e],a):s[e]=[a]:s[e]=a};case"comma":case"separator":return(t,a,s)=>{const i="string"==typeof a&&a.split("").indexOf(e.arrayFormatSeparator)>-1?a.split(e.arrayFormatSeparator).map((t=>l(t,e))):null===a?a:l(a,e);s[t]=i};default:return(e,t,a)=>{void 0!==a[e]?a[e]=[].concat(a[e],t):a[e]=t}}}(t),s=Object.create(null);if("string"!=typeof e)return s;if(!(e=e.trim().replace(/^[?#&]/,"")))return s;for(const i of e.split("&")){let[e,n]=r(t.decode?i.replace(/\+/g," "):i,"=");n=void 0===n?null:["comma","separator"].includes(t.arrayFormat)?n:l(n,t),a(l(e,t),n,s)}for(const e of Object.keys(s)){const a=s[e];if("object"==typeof a&&null!==a)for(const e of Object.keys(a))a[e]=g(a[e],t);else s[e]=g(a,t)}return!1===t.sort?s:(!0===t.sort?Object.keys(s).sort():Object.keys(s).sort(t.sort)).reduce(((e,t)=>{const a=s[t];return Boolean(a)&&"object"==typeof a&&!Array.isArray(a)?e[t]=u(a):e[t]=a,e}),Object.create(null))}t.extract=c,t.parse=h,t.stringify=(e,t)=>{if(!e)return"";n((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const a=a=>t.skipNull&&null==e[a]||t.skipEmptyString&&""===e[a],s=function(e){switch(e.arrayFormat){case"index":return t=>(a,s)=>{const i=a.length;return void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?a:null===s?[...a,[o(t,e),"[",i,"]"].join("")]:[...a,[o(t,e),"[",o(i,e),"]=",o(s,e)].join("")]};case"bracket":return t=>(a,s)=>void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?a:null===s?[...a,[o(t,e),"[]"].join("")]:[...a,[o(t,e),"[]=",o(s,e)].join("")];case"comma":case"separator":return t=>(a,s)=>null==s||0===s.length?a:0===a.length?[[o(t,e),"=",o(s,e)].join("")]:[[a,o(s,e)].join(e.arrayFormatSeparator)];default:return t=>(a,s)=>void 0===s||e.skipNull&&null===s||e.skipEmptyString&&""===s?a:null===s?[...a,o(t,e)]:[...a,[o(t,e),"=",o(s,e)].join("")]}}(t),i={};for(const t of Object.keys(e))a(t)||(i[t]=e[t]);const r=Object.keys(i);return!1!==t.sort&&r.sort(t.sort),r.map((a=>{const i=e[a];return void 0===i?"":null===i?o(a,t):Array.isArray(i)?i.reduce(s(a),[]).join("&"):o(a,t)+"="+o(i,t)})).filter((e=>e.length>0)).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[a,s]=r(e,"#");return Object.assign({url:a.split("?")[0]||"",query:h(c(e),t)},t&&t.parseFragmentIdentifier&&s?{fragmentIdentifier:l(s,t)}:{})},t.stringifyUrl=(e,a)=>{a=Object.assign({encode:!0,strict:!0},a);const s=d(e.url).split("?")[0]||"",i=t.extract(e.url),r=t.parse(i,{sort:!1}),n=Object.assign(r,e.query);let l=t.stringify(n,a);l&&(l=`?${l}`);let u=function(e){let t="";const a=e.indexOf("#");return-1!==a&&(t=e.slice(a)),t}(e.url);return e.fragmentIdentifier&&(u=`#${o(e.fragmentIdentifier,a)}`),`${s}${l}${u}`}},6563:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNavigator=t.isBrowser=t.off=t.on=t.noop=void 0,t.noop=function(){},t.on=function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];e&&e.addEventListener&&e.addEventListener.apply(e,t)},t.off=function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];e&&e.removeEventListener&&e.removeEventListener.apply(e,t)},t.isBrowser="undefined"!=typeof window,t.isNavigator="undefined"!=typeof navigator},6943:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(4286),i=a(6563).isBrowser?s.useLayoutEffect:s.useEffect;t.default=i},7880:(e,t,a)=>{"use strict";var s=a(1941),i=a(4286),r=s.__importDefault(a(6943));t.A=function(e,t){var a=i.useState(t),s=a[0],n=a[1];return r.default((function(){var t=e.subscribe(n);return function(){return t.unsubscribe()}}),[e]),s}},1536:e=>{"use strict";e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const a=e.indexOf(t);return-1===a?[e]:[e.slice(0,a),e.slice(a+t.length)]}},8136:e=>{"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))},930:(e,t,a)=>{a.p=window.__kbnPublicPath__.data},7674:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/dataViews/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},7574:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/dataViews/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},7876:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/expressions/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},904:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/expressions/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},2374:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/fieldFormats/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},8370:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/inspector/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},8887:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/inspector/common/adapters/request");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},2798:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/inspector/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},409:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},1359:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/kibanaUtils/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},1215:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},7888:(e,t,a)=>{a.r(t);var s=__kbnBundles__.get("plugin/share/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},3721:(e,t,a)=>{e.exports=a(2497)(4971)},3185:(e,t,a)=>{e.exports=a(2497)(51858)},8915:(e,t,a)=>{e.exports=a(2497)(67493)},2502:(e,t,a)=>{e.exports=a(2497)(69849)},1319:e=>{"use strict";e.exports=__kbnSharedDeps__.ElasticEui},6791:e=>{"use strict";e.exports=__kbnSharedDeps__.EmotionReact},6494:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnDatemath},5964:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnEsQuery},1991:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnEsqlAst},5008:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18n},5879:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18nReact},482:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnReactKibanaContextRender},5804:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnReactKibanaMount},770:e=>{"use strict";e.exports=__kbnSharedDeps__.Lodash},1783:e=>{"use strict";e.exports=__kbnSharedDeps__.Moment},2488:e=>{"use strict";e.exports=__kbnSharedDeps__.MomentTimezone},4286:e=>{"use strict";e.exports=__kbnSharedDeps__.React},2874:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactDom},190:e=>{"use strict";e.exports=__kbnSharedDeps__.Rxjs},1941:e=>{"use strict";e.exports=__kbnSharedDeps__.TsLib},9472:e=>{"use strict";e.exports=__kbnSharedDeps__.Uuid},2497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},a={};function s(e){var i=a[e];if(void 0!==i)return i.exports;var r=a[e]={exports:{}};return t[e].call(r.exports,r,r.exports,s),r.exports}s.m=t,s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,a)=>(s.f[a](e,t),t)),[])),s.u=e=>"data.chunk."+e+".js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},s.l=(t,a,i,r)=>{if(e[t])e[t].push(a);else{var n,o;if(void 0!==i)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var d=l[u];if(d.getAttribute("src")==t){n=d;break}}n||(o=!0,(n=document.createElement("script")).charset="utf-8",n.timeout=120,s.nc&&n.setAttribute("nonce",s.nc),n.src=t),e[t]=[a];var c=(a,s)=>{n.onerror=n.onload=null,clearTimeout(g);var i=e[t];if(delete e[t],n.parentNode&&n.parentNode.removeChild(n),i&&i.forEach((e=>e(s))),a)return a(s)},g=setTimeout(c.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=c.bind(null,n.onerror),n.onload=c.bind(null,n.onload),o&&document.head.appendChild(n)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");if(a.length)for(var i=a.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=a[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{var e={543:0};s.f.j=(t,a)=>{var i=s.o(e,t)?e[t]:void 0;if(0!==i)if(i)a.push(i[2]);else{var r=new Promise(((a,s)=>i=e[t]=[a,s]));a.push(i[2]=r);var n=s.p+s.u(t),o=new Error;s.l(n,(a=>{if(s.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var r=a&&("load"===a.type?"missing":a.type),n=a&&a.target&&a.target.src;o.message="Loading chunk "+t+" failed.\n("+r+": "+n+")",o.name="ChunkLoadError",o.type=r,o.request=n,i[1](o)}}),"chunk-"+t,t)}};var t=(t,a)=>{var i,r,[n,o,l]=a,u=0;if(n.some((t=>0!==e[t]))){for(i in o)s.o(o,i)&&(s.m[i]=o[i]);l&&l(s)}for(t&&t(a);u<n.length;u++)r=n[u],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0},a=self.data_bundle_jsonpfunction=self.data_bundle_jsonpfunction||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})(),s(930),__kbnBundles__.define("plugin/data/public",s,7611),__kbnBundles__.define("plugin/data/common",s,4177)})();