/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */(()=>{var e,t,r,s={1912:(e,t,r)=>{"use strict";r.d(t,{Ov:()=>s,T1:()=>a,L$:()=>i});const s={APM:"apm",LOGS:"logs",INFRASTRUCTURE:"infrastructure",OBSERVABILITY:"observability",STREAMS:"streams",SLO:"slo",SIEM:"siem",UPTIME:"uptime",ML:"ml",STACK_ALERTS:"stackAlerts",EXAMPLE:"AlertingExample",MONITORING:"monitoring",ALERTS:"alerts",DISCOVER:"discover"},a=[s.OBSERVABILITY],i=(Object.values(s).map((e=>e)),e=>e.startsWith("siem.")||"attack-discovery"===e)},9219:(e,t,r)=>{"use strict";r.d(t,{BI:()=>D,Cl:()=>S,DW:()=>u,Ez:()=>y,Kp:()=>f,Rn:()=>R,Ry:()=>b,S2:()=>n,SL:()=>T,Wp:()=>p,ZQ:()=>k,_9:()=>L,at:()=>g,fJ:()=>O,gH:()=>o,h:()=>E,h9:()=>d,ht:()=>s,i2:()=>c,lj:()=>h,pR:()=>m,qT:()=>x,sR:()=>M,tU:()=>v,tV:()=>C,tg:()=>_,vT:()=>a,xv:()=>l,z1:()=>A,zt:()=>i});const s="@timestamp",a="kibana",i=`${a}.alert`,o=`${i}.rule`,n=`${a}.space_ids`,l=`${a}.version`,c=`${i}.action_group`,d=`${i}.case_ids`,p=`${i}.duration.us`,u=`${i}.end`,_=`${i}.flapping`,h=`${i}.maintenance_window_ids`,m=`${i}.instance.id`,g=`${i}.reason`,f=`${i}.start`,y=`${i}.status`,b=`${i}.time_range`,E=`${i}.uuid`,T=`${i}.workflow_status`,v=`${i}.workflow_tags`,S=`${i}.workflow_assignee_ids`,D=`${o}.category`,O=`${o}.consumer`,A=`${o}.execution.uuid`,x=`${o}.name`,k=`${o}.parameters`,R=`${o}.producer`,M=`${o}.tags`,C=`${o}.rule_type_id`,L=`${o}.uuid`},9397:(e,t,r)=>{"use strict";r.d(t,{Yj:()=>n,lN:()=>l,lV:()=>u,n8:()=>c,wE:()=>s});const s="observability.rules.custom_threshold";let a=function(e){return e.ErrorCount="apm.error_rate",e.TransactionErrorRate="apm.transaction_error_rate",e.TransactionDuration="apm.transaction_duration",e.Anomaly="apm.anomaly",e}({});const i=Object.values(a),o=["xpack.synthetics.alerts.monitorStatus","xpack.synthetics.alerts.tls"],n="metrics.alert.inventory.threshold",l="metrics.alert.threshold",c="logs.alert.document.count",d=[c];let p=function(e){return e.MetricThreshold="metrics.alert.threshold",e.InventoryThreshold="metrics.alert.inventory.threshold",e}({});const u=[...i,...o,...Object.values(p),"xpack.uptime.alerts.tls","xpack.uptime.alerts.tlsCertificate","xpack.uptime.alerts.monitorStatus","xpack.uptime.alerts.durationAnomaly",...d,"slo.rules.burnRate",s]},8786:(e,t,r)=>{"use strict";r.d(t,{o:()=>s});let s=function(e){return e.GREATER_THAN=">",e.GREATER_THAN_OR_EQUALS=">=",e.BETWEEN="between",e.LESS_THAN="<",e.LESS_THAN_OR_EQUALS="<=",e.NOT_BETWEEN="notBetween",e}({})},2584:(e,t,r)=>{"use strict";r.d(t,{O5:()=>s.O5,PZ:()=>s.PZ,Xc:()=>s.Xc,_2:()=>s._2,cw:()=>s.cw,fH:()=>s.fH,jL:()=>s.jL});var s=r(8169)},8169:(e,t,r)=>{"use strict";r.d(t,{fH:()=>l,cw:()=>d,jL:()=>p,PZ:()=>n.n8,kq:()=>u,Nn:()=>m,fF:()=>L,Gj:()=>C,tx:()=>T,er:()=>q,O5:()=>R,_2:()=>M,Xc:()=>k,lX:()=>E,mq:()=>b});var s=r(5008),a=r(3782),i=r(6764);const o=a.type({_shards:a.type({total:a.number,successful:a.number,skipped:a.number,failed:a.number}),timed_out:a.boolean,took:a.number});var n=r(9397);a.keyof({count:null,ratio:null});let l=function(e){return e.GT="more than",e.GT_OR_EQ="more than or equals",e.LT="less than",e.LT_OR_EQ="less than or equals",e.EQ="equals",e.NOT_EQ="does not equal",e.MATCH="matches",e.NOT_MATCH="does not match",e.MATCH_PHRASE="matches phrase",e.NOT_MATCH_PHRASE="does not match phrase",e}({});const c=a.keyof({[l.GT]:null,[l.GT_OR_EQ]:null,[l.LT]:null,[l.LT_OR_EQ]:null,[l.EQ]:null,[l.NOT_EQ]:null,[l.MATCH]:null,[l.NOT_MATCH]:null,[l.MATCH_PHRASE]:null,[l.NOT_MATCH_PHRASE]:null}),d={[l.GT]:s.i18n.translate("xpack.infra.logs.alerting.comparator.gt",{defaultMessage:"more than"}),[l.GT_OR_EQ]:s.i18n.translate("xpack.infra.logs.alerting.comparator.gtOrEq",{defaultMessage:"more than or equals"}),[l.LT]:s.i18n.translate("xpack.infra.logs.alerting.comparator.lt",{defaultMessage:"less than"}),[l.LT_OR_EQ]:s.i18n.translate("xpack.infra.logs.alerting.comparator.ltOrEq",{defaultMessage:"less than or equals"}),[l.EQ]:s.i18n.translate("xpack.infra.logs.alerting.comparator.eq",{defaultMessage:"is"}),[l.NOT_EQ]:s.i18n.translate("xpack.infra.logs.alerting.comparator.notEq",{defaultMessage:"is not"}),[`${l.EQ}:number`]:s.i18n.translate("xpack.infra.logs.alerting.comparator.eqNumber",{defaultMessage:"equals"}),[`${l.NOT_EQ}:number`]:s.i18n.translate("xpack.infra.logs.alerting.comparator.notEqNumber",{defaultMessage:"does not equal"}),[l.MATCH]:s.i18n.translate("xpack.infra.logs.alerting.comparator.match",{defaultMessage:"matches"}),[l.NOT_MATCH]:s.i18n.translate("xpack.infra.logs.alerting.comparator.notMatch",{defaultMessage:"does not match"}),[l.MATCH_PHRASE]:s.i18n.translate("xpack.infra.logs.alerting.comparator.matchPhrase",{defaultMessage:"matches phrase"}),[l.NOT_MATCH_PHRASE]:s.i18n.translate("xpack.infra.logs.alerting.comparator.notMatchPhrase",{defaultMessage:"does not match phrase"})},p={[l.GT]:">",[l.GT_OR_EQ]:"≥",[l.LT]:"<",[l.LT_OR_EQ]:"≤",[l.EQ]:"=",[l.NOT_EQ]:"≠",[`${l.EQ}:number`]:"=",[`${l.NOT_EQ}:number`]:"≠",[l.MATCH]:s.i18n.translate("xpack.infra.logs.alerting.comparator.symbol.match",{defaultMessage:"matches"}),[l.NOT_MATCH]:s.i18n.translate("xpack.infra.logs.alerting.comparator.symbol.notMatch",{defaultMessage:"does not match"}),[l.MATCH_PHRASE]:s.i18n.translate("xpack.infra.logs.alerting.comparator.symbol.matchPhrase",{defaultMessage:"matches phrase"}),[l.NOT_MATCH_PHRASE]:s.i18n.translate("xpack.infra.logs.alerting.comparator.symbol.notMatchPhrase",{defaultMessage:"does not match phrase"})},u=a.type({comparator:c,value:a.number}),_=a.type({field:a.string,comparator:c,value:a.union([a.string,a.number])}),h=a.partial(_.props),m=a.array(_),g=a.array(h),f=a.tuple([m,m]),y=a.tuple([g,g]),b=(a.union([g,y]),a.union([a.literal("s"),a.literal("m"),a.literal("h"),a.literal("d")])),E=a.number,T=a.array(a.string),v=a.type({count:u,timeUnit:b,timeSize:E,logView:i.persistedLogViewReferenceRT}),S=(a.partial(v.props),a.partial({groupBy:T})),D=a.intersection([a.type({criteria:m,...v.props}),a.partial({...S.props})]),O=a.intersection([a.type({criteria:g,...v.props}),a.partial({...S.props})]),A=a.intersection([a.type({criteria:f,...v.props}),a.partial({...S.props})]),x=a.intersection([a.type({criteria:y,...v.props}),a.partial({...S.props})]),k=a.union([D,A]),R=(a.union([O,x]),e=>!!(e.length>0&&Array.isArray(e[0]))),M=e=>R(e.criteria),C=e=>e[0],L=e=>e[1],w=a.type({key:a.number,doc_count:a.number}),I=a.type({hits:a.type({hits:a.array(a.type({fields:a.record(a.string,a.array(a.unknown))}))})}),P=a.partial({histogramBuckets:a.type({buckets:a.array(w)})}),N=a.partial({additionalContext:I}),F=a.type({total:a.type({value:a.number})}),j=a.type({key:a.record(a.string,a.string),doc_count:a.number}),U=a.partial({after_key:a.record(a.string,a.string)}),H=(a.intersection([o,a.intersection([a.type({hits:F}),a.partial({aggregations:a.intersection([P,N])})])]),a.intersection([o,a.type({aggregations:a.type({groups:a.intersection([a.type({buckets:a.array(a.type({...j.props,filtered_results:a.intersection([a.type({doc_count:a.number}),P,N])}))}),U])}),hits:F})])),V=a.intersection([o,a.type({aggregations:a.type({groups:a.intersection([a.type({buckets:a.array(a.intersection([j,P,N]))}),U])}),hits:F})]),q=(a.union([H,V]),(e,t)=>e===l.GT||"number"==typeof t&&e===l.GT_OR_EQ&&t>0)},4332:(e,t,r)=>{"use strict";r.d(t,{J2:()=>i,Yj:()=>a,lN:()=>s,H2:()=>o});const s="metrics.alert.threshold",a="metrics.alert.inventory.threshold";let i=function(e){return e.COUNT="count",e.AVERAGE="avg",e.SUM="sum",e.MIN="min",e.MAX="max",e.RATE="rate",e.CARDINALITY="cardinality",e.P95="p95",e.P99="p99",e.CUSTOM="custom",e}({});const o=Symbol("QUERY_INVALID")},2787:(e,t,r)=>{"use strict";r.d(t,{CE:()=>u,KN:()=>p,W3:()=>n,WK:()=>c,ah:()=>o,b$:()=>h,ko:()=>l,mc:()=>a.HOST_NAME,nx:()=>d,p:()=>_,pD:()=>a.KUBERNETES_POD_UID,rc:()=>a.CONTAINER_ID,w3:()=>i});var s=r(1912),a=r(1474);const i="metrics-*,metricbeat-*",o="metrics",n="logs",l=(s.Ov.INFRASTRUCTURE,s.Ov.INFRASTRUCTURE,s.Ov.LOGS,[s.Ov.INFRASTRUCTURE,s.Ov.OBSERVABILITY,s.Ov.LOGS,s.Ov.SLO,s.Ov.APM,s.Ov.ALERTS]),c="@timestamp",d="process.command_line",p=9e5,u={name:"Metrics View",timeFieldName:c},_=20,h="https://ela.st/schema-selector-hosts"},2105:(e,t,r)=>{"use strict";r.d(t,{F:()=>y,Y:()=>_});var s=r(5008),a=r(6764),i=r(2584),o=r(2503),n=r(9219);const l=e=>({fields:t})=>{var r;const s=null!==(r=t[n.at])&&void 0!==r?r:"",a=t[n.Kp],i=null!=a?new Date(a).valueOf():void 0,o=e.getRedirectUrl({time:i});return{reason:s,link:c(o)}},c=e=>{const t=e.indexOf("/app/");return e.substring(t)};var d=r(53);const p=s.i18n.translate("xpack.infra.logs.alerting.threshold.defaultActionMessage",{defaultMessage:"'{{context.reason}}'\n\n'{{rule.name}}' is active.\n\n'{{^context.isRatio}}{{#context.group}}{{context.group}}' - '{{/context.group}}{{context.matchingDocuments}}' log entries have matched the following conditions: '{{context.conditions}}{{/context.isRatio}}'\n'{{#context.isRatio}}{{#context.group}}{{context.group}}' - '{{/context.group}}' Ratio of the count of log entries matching '{{context.numeratorConditions}}' to the count of log entries matching '{{context.denominatorConditions}}' was '{{context.ratio}}{{/context.isRatio}}'\n\n[View alert details]('{{context.alertDetailsUrl}}')\n"}),u=s.i18n.translate("xpack.infra.logs.alerting.threshold.defaultRecoveryMessage",{defaultMessage:"Recovered: '{{context.reason}}'\n    \n    '{{rule.name}}' has recovered.\n\n[View alert details]('{{context.alertDetailsUrl}}')\n"});function _(e,t){const n=(0,o.bj)(e,(()=>Promise.all([r.e(133),r.e(683)]).then(r.bind(r,1683)))),c=(0,o.bj)(e,(()=>r.e(213).then(r.bind(r,6213)))),_=(0,a.getLogsLocatorFromUrlService)(t);return{id:i.PZ,description:s.i18n.translate("xpack.infra.logs.alertFlyout.alertDescription",{defaultMessage:"Alert when the log aggregation exceeds the threshold."}),iconClass:"bell",documentationUrl:e=>`${e.links.observability.logsThreshold}`,alertDetailsAppSection:c,ruleParamsExpression:n,validate:d.P1,defaultActionMessage:p,defaultRecoveryMessage:u,requiresAppContext:!1,format:l(_),priority:30}}var h=r(4286),m=r.n(h),g=r(6791);const f=m().lazy((()=>Promise.all([r.e(404),r.e(936)]).then(r.bind(r,8434)))),y=()=>(0,g.jsx)(m().Suspense,{fallback:(0,g.jsx)("div",null)},(0,g.jsx)(f,null))},53:(e,t,r)=>{"use strict";r.d(t,{CA:()=>d,P1:()=>p});var s=r(5008),a=r(3782),i=r(770),o=r(8169);const n=a.type({field:a.array(a.string),comparator:a.array(a.string),value:a.array(a.string)}),l=a.record(a.string,n),c=a.recursion("AlertingError",(()=>a.record(a.string,a.union([a.string,a.array(a.string),c])))),d=a.type({threshold:a.type({value:a.array(a.string)}),criteria:a.record(a.string,l),timeWindowSize:a.array(a.string),timeSizeUnit:a.array(a.string)});function p({count:e,criteria:t,timeSize:r}){const a={errors:{}},n={threshold:{value:[]},criteria:{},timeSizeUnit:[],timeWindowSize:[]};if(a.errors=n,(0,i.isNumber)(null==e?void 0:e.value)||(0,i.isFinite)(null==e?void 0:e.value)||n.threshold.value.push(s.i18n.translate("xpack.infra.logs.alertFlyout.error.thresholdRequired",{defaultMessage:"Numeric threshold value is Required."})),r||n.timeWindowSize.push(s.i18n.translate("xpack.infra.logs.alertFlyout.error.timeSizeRequired",{defaultMessage:"Time size is Required."})),t&&t.length>0){const e=e=>{const t={};return e.forEach(((e,r)=>{t[r]={field:[],comparator:[],value:[]},e.field||t[r].field.push(s.i18n.translate("xpack.infra.logs.alertFlyout.error.criterionFieldRequired",{defaultMessage:"Field is required."})),e.comparator||t[r].comparator.push(s.i18n.translate("xpack.infra.logs.alertFlyout.error.criterionComparatorRequired",{defaultMessage:"Comparator is required."})),void 0!==e.value&&null!==e.value||t[r].value.push(s.i18n.translate("xpack.infra.logs.alertFlyout.error.criterionValueRequired",{defaultMessage:"Value is required."}))})),t};if((0,o.O5)(t)){const r=e((0,o.Gj)(t));n.criteria[0]=r;const s=e((0,o.fF)(t));n.criteria[1]=s}else{const r=e(t);n.criteria[0]=r}}return a}},2503:(e,t,r)=>{"use strict";r.d(t,{Q7:()=>d,bZ:()=>l,bj:()=>_,ei:()=>u,fJ:()=>c,vH:()=>p});var s=r(4286),a=r.n(s),i=r(409),o=r(6791);const n=(e,t,r)=>(0,i.createKibanaReactContext)({...e,...t,...r}),l=(0,s.createContext)({}),c=i.useKibana,d=(e,t,r)=>{const{Provider:a}=(0,s.useMemo)((()=>n(e,t,r)),[e,r,t]);return a},p=e=>{const t=(0,s.useMemo)((()=>({kibanaVersion:null==e?void 0:e.kibanaVersion,isCloudEnv:null==e?void 0:e.isCloudEnv,isServerlessEnv:null==e?void 0:e.isServerlessEnv})),[e]);return({kibanaEnv:e={},children:r})=>(0,s.createElement)(l.Provider,{value:{...e,...t},children:r})};function u(){return(0,s.useContext)(l)}const _=(e,t)=>a().lazy((()=>Promise.all([t(),e.getStartServices()]).then((([{default:e},[t,r,s]])=>{const{Provider:a}=n(t,r,s);return{default:t=>(0,o.jsx)(a,null,(0,o.jsx)(e,t))}}))))},948:(e,t,r)=>{"use strict";r.r(t),r.d(t,{plugin:()=>ne});var s=r(8915),a=r(4390),i=r(5008),o=r(3780),n=r(190),l=r(4286),c=r.n(l),d=r(4332),p=r(8786);function u({criteria:e,filterQuery:t}){const r={errors:{}},s={};return r.errors=s,t===d.H2&&(s.filterQuery=[i.i18n.translate("xpack.infra.metrics.alertFlyout.error.invalidFilterQuery",{defaultMessage:"Filter query is invalid."})]),e&&e.length?(e.forEach(((e,t)=>{var r;const a=t.toString();s[a]=s[a]||{timeSizeUnit:[],timeWindowSize:[],critical:{threshold0:[],threshold1:[]},warning:{threshold0:[],threshold1:[]},metric:[]},e.threshold&&e.threshold.length||s[a].critical.threshold0.push(i.i18n.translate("xpack.infra.metrics.alertFlyout.error.thresholdRequired",{defaultMessage:"Threshold is required."})),e.warningThreshold&&!e.warningThreshold.length&&s[a].warning.threshold0.push(i.i18n.translate("xpack.infra.metrics.alertFlyout.error.thresholdRequired",{defaultMessage:"Threshold is required."}));for(const t of[{comparator:e.comparator,threshold:e.threshold,type:"critical"},{comparator:e.warningComparator,threshold:e.warningThreshold,type:"warning"}]){const{comparator:e,threshold:r,type:o}=t;r&&r.length&&![...r].every(_)&&[...r].forEach(((e,t)=>{if(!_(e)){const e=0===t?"threshold0":"threshold1";s[a][o][e].push(i.i18n.translate("xpack.infra.metrics.alertFlyout.error.thresholdTypeRequired",{defaultMessage:"Thresholds must contain a valid number."}))}})),e===p.o.BETWEEN&&(!r||r.length<2)&&s[a][o].threshold1.push(i.i18n.translate("xpack.infra.metrics.alertFlyout.error.thresholdRequired",{defaultMessage:"Threshold is required."}))}e.timeSize||s[a].timeWindowSize.push(i.i18n.translate("xpack.infra.metrics.alertFlyout.error.timeRequred",{defaultMessage:"Time size is Required."})),e.metric||s[a].metric.push(i.i18n.translate("xpack.infra.metrics.alertFlyout.error.metricRequired",{defaultMessage:"Metric is required."})),"custom"!==e.metric||null!==(r=e.customMetric)&&void 0!==r&&r.field||s[a].metric.push(i.i18n.translate("xpack.infra.metrics.alertFlyout.error.customMetricFieldRequired",{defaultMessage:"Field is required."}))})),r):r}const _=e=>"number"==typeof e;var h=r(9219),m=r(1783),g=r.n(m),f=r(5995),y=r(1474),b=r(770),E=r(2787);const T=`${h.ZQ}.criteria.metric`,v=`${h.ZQ}.nodeType`,S=`${h.ZQ}.schema`,D="custom",O=(e,t="")=>Object.entries(e).reduce(((e,[r,s])=>{const a=t.length?`${t}.${r}`:r;return"object"==typeof s&&null!=s?Array.isArray(s)&&s.length>0?Object.assign(e,O(s[0],a)):Object.assign(e,O(s,a)):(e[a]=Array.isArray(s)?s:[s],e)}),{}),A=({fields:e,assetDetailsLocator:t,inventoryLocator:r})=>{if(!t||!r)throw new Error("Locators for Asset Details and Inventory are required");const s=e[h.ZQ]?{...e,...O(e[h.ZQ],h.ZQ)}:e,a=(0,b.castArray)(s[v])[0],i=(0,b.castArray)(s[S])[0];if(!a)return"";const n=s[(0,y.findInventoryModel)(a).fields.id],l=Object.values(o.SupportedEntityTypes).includes(a),c=s[T][0];if(n&&l)return x({entityId:n,entityType:a,timestamp:s[h.ht],alertMetric:c,assetDetailsLocator:t,preferredSchema:i});const d={nodeType:a,timestamp:Date.parse(s[h.ht]),customMetric:"",metric:"",preferredSchema:i};if(c===D){const e=s[`${h.ZQ}.criteria.customMetric.id`][0],t=s[`${h.ZQ}.criteria.customMetric.aggregation`][0],r=s[`${h.ZQ}.criteria.customMetric.field`][0],a=(0,f.encode)({id:e,type:D,field:r,aggregation:t});d.customMetric=a,d.metric=a}else d.metric=(0,f.encode)({type:c});return r.getRedirectUrl({...d})};function x({entityId:e,entityType:t,timestamp:r,alertMetric:s,assetDetailsLocator:a,preferredSchema:i}){return a.getRedirectUrl({entityId:e,entityType:t,assetDetails:{dateRange:{from:r,to:g()(r).add(E.KN,"ms").toISOString()},...s&&s!==D?{alertMetric:s}:void 0,preferredSchema:i}})}var k=r(6791);const R=i.i18n.translate("xpack.infra.metrics.alerting.inventory.threshold.defaultActionMessage",{defaultMessage:"'{{context.reason}}'\n\n'{{rule.name}}' is active with the following conditions:\n\n- Affected: '{{context.group}}'\n- Metric: '{{context.metric}}'\n- Observed value: '{{context.value}}'\n- Threshold: '{{context.threshold}}'\n\n[View alert details]('{{context.alertDetailsUrl}}')\n"}),M=i.i18n.translate("xpack.infra.metrics.alerting.inventory.threshold.defaultRecoveryMessage",{defaultMessage:"Recovered '{{context.reason}}'\n\n    '{{rule.name}}' has recovered.\n\n- Affected: '{{context.group}}'\n- Metric: '{{context.metric}}'\n- Threshold: '{{context.threshold}}'\n\n[View alert details]('{{context.alertDetailsUrl}}')\n"}),C=c().lazy((()=>Promise.all([r.e(133),r.e(261),r.e(162),r.e(264),r.e(13)]).then(r.bind(r,4986))));var L=r(2105),w=r(5964);const I=/[^A-Z|+|\-|\s|\d+|\.|\(|\)|\/|\*|>|<|=|\?|\:|&|\!|\|]+/g;function P({criteria:e,filterQuery:t}){const r={errors:{}},s={};return r.errors=s,t===d.H2&&(s.filterQuery=[i.i18n.translate("xpack.infra.metrics.alertFlyout.error.invalidFilterQuery",{defaultMessage:"Filter query is invalid."})]),e&&e.length?(e.forEach(((e,t)=>{const r=t.toString();s[r]=s[r]||{aggField:[],timeSizeUnit:[],timeWindowSize:[],critical:{threshold0:[],threshold1:[]},warning:{threshold0:[],threshold1:[]},metric:[],filterQuery:[],customMetrics:{}},e.aggType||s[r].aggField.push(i.i18n.translate("xpack.infra.metrics.alertFlyout.error.aggregationRequired",{defaultMessage:"Aggregation is required."})),e.threshold&&e.threshold.length||s[r].critical.threshold0.push(i.i18n.translate("xpack.infra.metrics.alertFlyout.error.thresholdRequired",{defaultMessage:"Threshold is required."})),e.warningThreshold&&!e.warningThreshold.length&&s[r].warning.threshold0.push(i.i18n.translate("xpack.infra.metrics.alertFlyout.error.thresholdRequired",{defaultMessage:"Threshold is required."}));for(const t of[{comparator:e.comparator,threshold:e.threshold,type:"critical"},{comparator:e.warningComparator,threshold:e.warningThreshold,type:"warning"}]){const{comparator:e,threshold:a,type:o}=t;a&&a.length&&![...a].every(N)&&[...a].forEach(((e,t)=>{if(!N(e)){const e=0===t?"threshold0":"threshold1";s[r][o][e].push(i.i18n.translate("xpack.infra.metrics.alertFlyout.error.thresholdTypeRequired",{defaultMessage:"Thresholds must contain a valid number."}))}})),e===p.o.BETWEEN&&(!a||a.length<2)&&s[r][o].threshold1.push(i.i18n.translate("xpack.infra.metrics.alertFlyout.error.thresholdRequired",{defaultMessage:"Threshold is required."}))}e.timeSize||s[r].timeWindowSize.push(i.i18n.translate("xpack.infra.metrics.alertFlyout.error.timeRequred",{defaultMessage:"Time size is Required."})),"count"===e.aggType||"custom"===e.aggType||e.metric||s[r].metric.push(i.i18n.translate("xpack.infra.metrics.alertFlyout.error.metricRequired",{defaultMessage:"Metric is required."})),e.aggType===d.J2.CUSTOM&&(!e.customMetrics||e.customMetrics&&e.customMetrics.length<1?s[r].customMetricsError=i.i18n.translate("xpack.infra.metrics.alertFlyout.error.customMetricsError",{defaultMessage:"You must define at least 1 custom metric"}):e.customMetrics.forEach((e=>{const t={};if(e.aggType||(t.aggType=i.i18n.translate("xpack.infra.metrics.alertFlyout.error.customMetrics.aggTypeRequired",{defaultMessage:"Aggregation is required"})),"count"===e.aggType||e.field||(t.field=i.i18n.translate("xpack.infra.metrics.alertFlyout.error.customMetrics.fieldRequired",{defaultMessage:"Field is required"})),"count"===e.aggType&&e.filter)try{(0,w.fromKueryExpression)(e.filter)}catch(e){t.filter=e.message}(0,b.isEmpty)(t)||(s[r].customMetrics[e.name]=t)})),e.equation&&e.equation.match(I)&&(s[r].equation=i.i18n.translate("xpack.infra.metrics.alertFlyout.error.equation.invalidCharacters",{defaultMessage:"The equation field only supports the following characters: A-Z, +, -, /, *, (, ), ?, !, &, :, |, >, <, ="})))})),r):r}const N=e=>"number"==typeof e,F=({assetDetailsLocator:e,metricsExplorerLocator:t})=>({fields:r})=>{var s;const a=null!==(s=r[h.at])&&void 0!==s?s:"-",i=r[h.ZQ],n=(({fields:e,groupBy:t,assetDetailsLocator:r,metricsExplorerLocator:s})=>{if(!r||!s)throw new Error("Locators for Asset Details and Metrics Explorer are required");if(!t)return s.getRedirectUrl({});const a=Object.values(o.SupportedEntityTypes).reduce(((e,t)=>(e[(0,y.findInventoryModel)(t).fields.id]=t,e)),{}),i=t.find((e=>!!a[e])),n=i?a[i]:void 0;if(n){const t=e[(0,y.findInventoryModel)(n).fields.id];return t?x({entityId:t,entityType:n,timestamp:e[h.ht],assetDetailsLocator:r}):s.getRedirectUrl({})}return s.getRedirectUrl({})})({fields:r,groupBy:(0,b.castArray)(null==i?void 0:i.groupBy),assetDetailsLocator:e,metricsExplorerLocator:t});return{reason:a,link:n,hasBasePath:!0}},j=i.i18n.translate("xpack.infra.metrics.alerting.metric.threshold.defaultActionMessage",{defaultMessage:"'{{context.reason}}'\n\n'{{rule.name}}' is active with the following conditions:\n\n- Affected: '{{context.group}}'\n- Metric: '{{context.metric}}'\n- Observed value: '{{context.value}}'\n- Threshold: '{{context.threshold}}'\n\n[View alert details]('{{context.alertDetailsUrl}}')\n"}),U=i.i18n.translate("xpack.infra.metrics.alerting.metric.threshold.defaultRecoveryMessage",{defaultMessage:"Recovered: '{{context.reason}}'\n    \n  '{{rule.name}}' has recovered.\n\n- Affected: '{{context.group}}'\n- Metric: '{{context.metric}}'\n- Threshold: '{{context.threshold}}'\n\n[View alert details]('{{context.alertDetailsUrl}}')\n"}),H=e=>async()=>{const[t]=await e(),{http:r}=t,s=await r.get("/api/metrics/source/default/hasData");return{hasData:s.hasData,indices:s.configuration.metricAlias}},V=e=>async({absoluteTime:t,intervalString:r})=>{const[s]=await e(),{http:a}=s,i=async(e={})=>{const{start:s,end:o}=t,n={sourceId:"default",bucketSize:r,size:5,timerange:{from:s,to:o},...e};return{appLink:`/app/metrics/inventory?waffleTime=(currentTime:${o},isAutoReloading:!f)`,series:(await a.post("/api/metrics/overview/top",{body:JSON.stringify(n)})).series,sort:async(e,t)=>i({sort:e,sortDirection:t})}};return await i()};class InventoryViewsService{constructor(){(0,s.default)(this,"client",void 0)}setup(){return{}}start({http:e}){return{getClient:()=>this.getClient({http:e})}}async getClient({http:e}){if(!this.client){const{InventoryViewsClient:t}=await Promise.all([r.e(133),r.e(108)]).then(r.bind(r,5108)),s=new t(e);this.client=s}return this.client}}class MetricsExplorerViewsService{constructor(){(0,s.default)(this,"client",void 0)}setup(){return{}}start({http:e}){return{getClient:()=>this.getClient({http:e})}}async getClient({http:e}){if(!this.client){const{MetricsExplorerViewsClient:t}=await Promise.all([r.e(133),r.e(502)]).then(r.bind(r,5502)),s=new t(e);this.client=s}return this.client}}var q=r(1192);let B=function(e){return e.HOSTS_VIEW_QUERY_SUBMITTED="Hosts View Query Submitted",e.HOSTS_ENTRY_CLICKED="Host Entry Clicked",e.HOST_FLYOUT_FILTER_REMOVED="Host Flyout Filter Removed",e.HOST_FLYOUT_FILTER_ADDED="Host Flyout Filter Added",e.HOST_VIEW_TOTAL_HOST_COUNT_RETRIEVED="Host View Total Host Count Retrieved",e.ASSET_DETAILS_FLYOUT_VIEWED="Asset Details Flyout Viewed",e.ASSET_DETAILS_PAGE_VIEWED="Asset Details Page Viewed",e.ASSET_DASHBOARD_LOADED="Asset Dashboard Loaded",e.ADD_METRICS_CALLOUT_ADD_METRICS_CLICKED="Add Metrics Callout Add Metrics Clicked",e.ADD_METRICS_CALLOUT_TRY_IT_CLICKED="Add Metrics Callout Try It Clicked",e.ADD_METRICS_CALLOUT_LEARN_MORE_CLICKED="Add Metrics Callout Learn More Clicked",e.ADD_METRICS_CALLOUT_DISMISSED="Add Metrics Callout Dismissed",e.ANOMALY_DETECTION_SETUP="Infra Anomaly Detection Job Setup",e.ANOMALY_DETECTION_DATE_FIELD_CHANGE="Infra Anomaly Detection Job Date Field Change",e.ANOMALY_DETECTION_PARTITION_FIELD_CHANGE="Infra Anomaly Detection Job Partition Field Change",e.ANOMALY_DETECTION_FILTER_FIELD_CHANGE="Infra Anomaly Detection Job Filter Field Change",e.SCHEMA_SELECTOR_INTERACTION="Schema Selector Interaction",e.METRICS_EXPLORER_CALLOUT_VIEW_IN_DISCOVER_CLICKED="Metrics Explorer Callout View In Discover Clicked",e}({});class TelemetryClient{constructor(e){(0,s.default)(this,"reportHostEntryClicked",(({hostname:e,cloud_provider:t})=>{this.analytics.reportEvent(B.HOSTS_ENTRY_CLICKED,{hostname:e,cloud_provider:null!=t?t:"unknown"})})),(0,s.default)(this,"reportHostFlyoutFilterRemoved",(({field_name:e})=>{this.analytics.reportEvent(B.HOST_FLYOUT_FILTER_REMOVED,{field_name:e})})),(0,s.default)(this,"reportHostFlyoutFilterAdded",(({field_name:e})=>{this.analytics.reportEvent(B.HOST_FLYOUT_FILTER_ADDED,{field_name:e})})),(0,s.default)(this,"reportHostsViewQuerySubmitted",(e=>{this.analytics.reportEvent(B.HOSTS_VIEW_QUERY_SUBMITTED,e)})),(0,s.default)(this,"reportAssetDetailsFlyoutViewed",(e=>{this.analytics.reportEvent(B.ASSET_DETAILS_FLYOUT_VIEWED,e)})),(0,s.default)(this,"reportAssetDetailsPageViewed",(e=>{this.analytics.reportEvent(B.ASSET_DETAILS_PAGE_VIEWED,e)})),(0,s.default)(this,"reportAssetDashboardLoaded",(e=>{this.analytics.reportEvent(B.ASSET_DASHBOARD_LOADED,e)})),(0,s.default)(this,"reportPerformanceMetricEvent",((e,t,r={},s={})=>{(0,q.reportPerformanceMetricEvent)(this.analytics,{eventName:e,duration:t,meta:s,...r})})),(0,s.default)(this,"reportAddMetricsCalloutAddMetricsClicked",(e=>{this.analytics.reportEvent(B.ADD_METRICS_CALLOUT_ADD_METRICS_CLICKED,e)})),(0,s.default)(this,"reportAddMetricsCalloutTryItClicked",(e=>{this.analytics.reportEvent(B.ADD_METRICS_CALLOUT_TRY_IT_CLICKED,e)})),(0,s.default)(this,"reportAddMetricsCalloutLearnMoreClicked",(e=>{this.analytics.reportEvent(B.ADD_METRICS_CALLOUT_LEARN_MORE_CLICKED,e)})),(0,s.default)(this,"reportAddMetricsCalloutDismissed",(e=>{this.analytics.reportEvent(B.ADD_METRICS_CALLOUT_DISMISSED,e)})),(0,s.default)(this,"reportAnomalyDetectionSetup",(e=>{this.analytics.reportEvent(B.ANOMALY_DETECTION_SETUP,e)})),(0,s.default)(this,"reportAnomalyDetectionDateFieldChange",(e=>{this.analytics.reportEvent(B.ANOMALY_DETECTION_DATE_FIELD_CHANGE,e)})),(0,s.default)(this,"reportAnomalyDetectionPartitionFieldChange",(e=>{this.analytics.reportEvent(B.ANOMALY_DETECTION_PARTITION_FIELD_CHANGE,e)})),(0,s.default)(this,"reportAnomalyDetectionFilterFieldChange",(e=>{this.analytics.reportEvent(B.ANOMALY_DETECTION_FILTER_FIELD_CHANGE,e)})),(0,s.default)(this,"reportSchemaSelectorInteraction",(e=>{this.analytics.reportEvent(B.SCHEMA_SELECTOR_INTERACTION,e)})),(0,s.default)(this,"reportMetricsExplorerCalloutViewInDiscoverClicked",(e=>{this.analytics.reportEvent(B.METRICS_EXPLORER_CALLOUT_VIEW_IN_DISCOVER_CLICKED,e)})),this.analytics=e}reportHostsViewTotalHostCountRetrieved(e){this.analytics.reportEvent(B.HOST_VIEW_TOTAL_HOST_COUNT_RETRIEVED,e)}}const $={eventType:B.HOSTS_VIEW_QUERY_SUBMITTED,schema:{control_filter_fields:{type:"array",items:{type:"text",_meta:{description:"Selected host control filter.",optional:!1}}},filter_fields:{type:"array",items:{type:"text",_meta:{description:"Applied host search filter.",optional:!1}}},interval:{type:"text",_meta:{description:"Time interval for the performed search.",optional:!1}},with_query:{type:"boolean",_meta:{description:"KQL query search for hosts",optional:!1}},limit:{type:"integer",_meta:{description:"Selected host limit",optional:!1}},schema_selected:{type:"text",_meta:{description:"Preferred schema for the performed search.",optional:!0}}}},Q={eventType:B.HOSTS_ENTRY_CLICKED,schema:{hostname:{type:"keyword",_meta:{description:"Hostname for the clicked host.",optional:!1}},cloud_provider:{type:"keyword",_meta:{description:"Cloud provider for the clicked host.",optional:!0}}}},K={eventType:B.HOST_FLYOUT_FILTER_REMOVED,schema:{field_name:{type:"keyword",_meta:{description:"Removed filter field name for the selected host.",optional:!1}}}},Y={eventType:B.HOST_FLYOUT_FILTER_ADDED,schema:{field_name:{type:"keyword",_meta:{description:"Added filter field name for the selected host.",optional:!1}}}},W={eventType:B.HOST_VIEW_TOTAL_HOST_COUNT_RETRIEVED,schema:{total:{type:"integer",_meta:{description:"Total number of hosts retrieved.",optional:!1}},with_query:{type:"boolean",_meta:{description:"Has KQL query",optional:!1}},with_filters:{type:"boolean",_meta:{description:"Has filters",optional:!1}},schema_selected:{type:"text",_meta:{description:"Preferred schema for the performed search.",optional:!0}},schemas_available:{type:"array",items:{type:"text",_meta:{description:"Available schemas for the performed search."}}},schema_error:{type:"boolean",_meta:{description:"Indicates if there was an error with the selected schema.",optional:!0}}}},G=[{eventType:B.ASSET_DETAILS_FLYOUT_VIEWED,schema:{componentName:{type:"keyword",_meta:{description:"Name of the parent react component for the clicked asset.",optional:!1}},assetType:{type:"keyword",_meta:{description:"Asset type for the clicked asset.",optional:!1}},tabId:{type:"keyword",_meta:{description:"Tab id for the clicked asset.",optional:!0}},schema_selected:{type:"text",_meta:{description:"Preferred schema for the displayed asset.",optional:!0}}}},{eventType:B.ASSET_DETAILS_PAGE_VIEWED,schema:{componentName:{type:"keyword",_meta:{description:"Name of the parent react component for the clicked asset.",optional:!1}},assetType:{type:"keyword",_meta:{description:"Asset type for the clicked asset.",optional:!1}},tabId:{type:"keyword",_meta:{description:"Tab id for the clicked asset.",optional:!0}},integrations:{type:"pass_through",_meta:{description:"Integrations enabled for the displayed asset.",optional:!0}},schema_selected:{type:"text",_meta:{description:"Preferred schema for the displayed asset.",optional:!0}}}},$,Q,K,Y,W,{eventType:B.ASSET_DASHBOARD_LOADED,schema:{assetType:{type:"keyword",_meta:{description:"Asset type for the selected asset.",optional:!1}},state:{type:"boolean",_meta:{description:"If the dashboard is filtered or now",optional:!1}},filtered_by:{type:"array",items:{type:"text",_meta:{description:"Filters enabled for the dashboard added for an asset"}}}}},{eventType:B.ADD_METRICS_CALLOUT_ADD_METRICS_CLICKED,schema:{view:{type:"keyword",_meta:{description:"Where the action was initiated (add_metrics_cta)"}}}},{eventType:B.ADD_METRICS_CALLOUT_TRY_IT_CLICKED,schema:{view:{type:"keyword",_meta:{description:"Where the action was initiated (add_metrics_cta)"}}}},{eventType:B.ADD_METRICS_CALLOUT_LEARN_MORE_CLICKED,schema:{view:{type:"keyword",_meta:{description:"Where the action was initiated (add_metrics_cta)"}}}},{eventType:B.ADD_METRICS_CALLOUT_DISMISSED,schema:{view:{type:"keyword",_meta:{description:"Where the action was initiated (add_metrics_cta)"}}}},{eventType:B.ANOMALY_DETECTION_SETUP,schema:{job_type:{type:"text",_meta:{description:"Type of job for the anomaly detection"}},configured_fields:{properties:{start_date:{type:"text",_meta:{description:"Start date for the anomaly detection job"}},partition_field:{type:"text",_meta:{description:"Partition field for the anomaly detection job",optional:!0}},filter_field:{type:"text",_meta:{description:"Filter field for the anomaly detection job",optional:!0}}}}}},{eventType:B.ANOMALY_DETECTION_DATE_FIELD_CHANGE,schema:{job_type:{type:"text",_meta:{description:"Type of job for the anomaly detection"}},start_date:{type:"text",_meta:{description:"Start date for the anomaly detection job"}}}},{eventType:B.ANOMALY_DETECTION_PARTITION_FIELD_CHANGE,schema:{job_type:{type:"text",_meta:{description:"Type of job for the anomaly detection"}},partition_field:{type:"text",_meta:{description:"Partition field for the anomaly detection job",optional:!0}}}},{eventType:B.ANOMALY_DETECTION_FILTER_FIELD_CHANGE,schema:{job_type:{type:"text",_meta:{description:"Type of job for the anomaly detection"}},filter_field:{type:"text",_meta:{description:"Filter field for the anomaly detection job",optional:!0}}}},{eventType:B.SCHEMA_SELECTOR_INTERACTION,schema:{interaction:{type:"keyword",_meta:{description:"Type of interaction with the schema selector"}},schema_selected:{type:"keyword",_meta:{description:"The schema that was selected",optional:!0}},schemas_available:{type:"array",items:{type:"text",_meta:{description:"Available schemas for the performed search."}}}}},{eventType:B.METRICS_EXPLORER_CALLOUT_VIEW_IN_DISCOVER_CLICKED,schema:{view:{type:"keyword",_meta:{description:"Where the action was initiated (view in discover cta)",optional:!1}}}}];class TelemetryService{constructor(e=null){this.analytics=e}setup({analytics:e}){this.analytics=e,G.forEach((t=>e.registerEventType(t)))}start(){if(!this.analytics)throw new Error("The TelemetryService.setup() method has not been invoked, be sure to call it during the plugin setup.");return new TelemetryClient(this.analytics)}}var z=r(6764);function Z(e){return async t=>{const[r,{data:s,logsShared:a,share:i}]=await e(),o=await a.logViews.client.getResolvedLogView(z.DEFAULT_LOG_VIEW),{stats:n,series:l}=await async function(e,t,r,s){var a;const i=null!==(a=null==s?void 0:s.get("observability:searchExcludedDataTiers"))&&void 0!==a?a:[];return new Promise(((s,a)=>{let o;r.search.search({params:{index:e.index,body:{size:0,query:J(t,i),aggs:X(0,t)}}}).subscribe((e=>o=e.rawResponse),(e=>a(e)),(()=>{var e;null!==(e=o)&&void 0!==e&&e.aggregations?s(function(e){const t={},r={};return e.stats.buckets.forEach((e=>{const s=e.key;t[e.key]={type:"number",label:s,value:e.doc_count},e.series.buckets.forEach((e=>{r[s]=r[s]||{label:s,coordinates:[]},r[s].coordinates.push({x:e.key,y:e.doc_count})}))})),{stats:t,series:r}}(o.aggregations)):s({stats:{},series:{}})}))}))}({index:o.indices},t,s,r.uiSettings),c=(0,z.getLogsLocatorFromUrlService)(i.url),d=(t.absoluteTime.end-t.absoluteTime.start)/6e4;return{appLink:c.getRedirectUrl({timeRange:{from:g()(t.absoluteTime.start).toISOString(),to:g()(t.absoluteTime.end).toISOString()}}),stats:ee(n,d),series:te(l)}}}function J(e,t){return{bool:{must:[{range:{[E.WK]:{gt:new Date(e.absoluteTime.start).toISOString(),lte:new Date(e.absoluteTime.end).toISOString(),format:"strict_date_optional_time"}}}],must_not:t.length?[{terms:{_tier:t}}]:void 0}}}function X(e,t){return{stats:{terms:{field:"event.dataset",size:4,missing:"unknown"},aggs:{series:{date_histogram:{field:E.WK,fixed_interval:t.intervalString}}}}}}function ee(e,t){return Object.keys(e).reduce(((r,s)=>(r[s]={...e[s],value:e[s].value/t},r)),{})}function te(e){const t=Object.keys(e),r=t.flatMap((t=>e[t].coordinates.map((e=>e.x)))),[s,a]=[...new Set(r)].sort(),i=(a-s)/6e4;return t.reduce(((t,r)=>(t[r]={...e[r],coordinates:e[r].coordinates.map((e=>e.y?{...e,y:e.y/i}:e))},t)),{})}var re=r(7808),se=r(6899);class Plugin{constructor(e){(0,s.default)(this,"config",void 0),(0,s.default)(this,"inventoryViews",void 0),(0,s.default)(this,"metricsExplorerViews",void 0),(0,s.default)(this,"telemetry",void 0),(0,s.default)(this,"kibanaVersion",void 0),(0,s.default)(this,"isServerlessEnv",void 0),(0,s.default)(this,"appUpdater$",new n.BehaviorSubject((()=>({})))),this.config=e.config.get(),this.inventoryViews=new InventoryViewsService,this.metricsExplorerViews=this.config.featureFlags.metricsExplorerEnabled?new MetricsExplorerViewsService:void 0,this.telemetry=new TelemetryService,this.kibanaVersion=e.env.packageInfo.version,this.isServerlessEnv="serverless"===e.env.packageInfo.buildFlavor}setup(e,t){var s,p,_;t.home&&t.home.featureCatalogue.register({id:"metrics",title:i.i18n.translate("xpack.infra.registerFeatures.infraOpsTitle",{defaultMessage:"Metrics"}),description:i.i18n.translate("xpack.infra.registerFeatures.infraOpsDescription",{defaultMessage:"Explore infrastructure metrics and logs for common servers, containers, and services."}),icon:"metricsApp",path:"/app/metrics",showOnHomePage:!1,category:"data"});const m=t.share.url.locators.get(o.ASSET_DETAILS_LOCATOR_ID),g=t.share.url.locators.get(o.INVENTORY_LOCATOR_ID),f=t.share.url.locators.get(o.METRICS_EXPLORER_LOCATOR_ID);var y;t.observability.observabilityRuleTypeRegistry.register(function({assetDetailsLocator:e,inventoryLocator:t}){const r=(({assetDetailsLocator:e,inventoryLocator:t})=>({fields:r})=>{var s;return{reason:null!==(s=r[h.at])&&void 0!==s?s:"-",link:A({fields:r,assetDetailsLocator:e,inventoryLocator:t}),hasBasePath:!0}})({assetDetailsLocator:e,inventoryLocator:t});return{id:d.Yj,description:i.i18n.translate("xpack.infra.metrics.inventory.alertFlyout.alertDescription",{defaultMessage:"Alert when the inventory exceeds a defined threshold."}),iconClass:"bell",documentationUrl:e=>`${e.links.observability.infrastructureThreshold}`,ruleParamsExpression:e=>(0,k.jsx)(c().Suspense,{fallback:null},(0,k.jsx)(C,e)),validate:u,defaultActionMessage:R,defaultRecoveryMessage:M,requiresAppContext:!1,format:r,priority:20}}({assetDetailsLocator:m,inventoryLocator:g})),t.observability.observabilityRuleTypeRegistry.register(function({assetDetailsLocator:e,metricsExplorerLocator:t}){return{id:d.lN,description:i.i18n.translate("xpack.infra.metrics.alertFlyout.alertDescription",{defaultMessage:"Alert when the metrics aggregation exceeds the threshold."}),iconClass:"bell",documentationUrl:e=>`${e.links.observability.metricsThreshold}`,ruleParamsExpression:(0,l.lazy)((()=>Promise.all([r.e(133),r.e(264),r.e(974)]).then(r.bind(r,974)))),validate:P,defaultActionMessage:j,defaultRecoveryMessage:U,requiresAppContext:!1,format:F({assetDetailsLocator:e,metricsExplorerLocator:t}),alertDetailsAppSection:(0,l.lazy)((()=>r.e(249).then(r.bind(r,6249)))),priority:10}}({assetDetailsLocator:m,metricsExplorerLocator:f})),t.observability.dashboard.register({appName:"infra_logs",hasData:(y=e.getStartServices,async()=>{const[e,{logsShared:t}]=await y(),r=await t.logViews.client.getResolvedLogView(z.DEFAULT_LOG_VIEW);return{hasData:"available"===(await t.logViews.client.getResolvedLogViewStatus(r,e.uiSettings)).index,indices:r.indices}}),fetchData:Z(e.getStartServices)}),t.observability.dashboard.register({appName:"infra_metrics",hasData:H(e.getStartServices),fetchData:V(e.getStartServices)}),t.logsShared.logViews.setLogViewsStaticConfig({messageFields:null===(s=this.config.sources)||void 0===s||null===(p=s.default)||void 0===p||null===(_=p.fields)||void 0===_?void 0:_.message});const b=(0,n.from)(e.getStartServices()).pipe((0,n.switchMap)((([{application:e}])=>(0,n.combineLatest)([(0,n.of)(e),ie(e)])))),E=(0,se.V)();t.observabilityShared.navigation.registerSections(b.pipe((0,n.map)((([e,t])=>{const{infrastructure:r,logs:s}=e.capabilities;return[...s.show?[{label:re.U7,sortKey:200,entries:ae({isLogsExplorerAccessible:t,config:this.config,routes:E})}]:[],...r.show?[{label:re.c1,sortKey:300,entries:[{label:re.dd,app:"metrics",path:"/inventory"},...this.config.featureFlags.metricsExplorerEnabled?[{label:re.jv,app:"metrics",path:"/explorer"}]:[],{label:re.S$,app:"metrics",path:"/hosts"}]}]:[]]})))),t.observability.observabilityRuleTypeRegistry.register((0,L.Y)(e,t.share.url)),e.application.register({id:"logs",title:i.i18n.translate("xpack.infra.logs.pluginTitle",{defaultMessage:"Logs"}),euiIconType:"logoObservability",order:8100,appRoute:"/app/logs",deepLinks:Object.values(E),category:a.DEFAULT_APP_CATEGORIES.observability,mount:async t=>{const[s,a,i]=await e.getStartServices(),o=await(0,n.firstValueFrom)(ie(s.application)),{renderApp:l}=await Promise.all([r.e(133),r.e(498),r.e(799)]).then(r.bind(r,5440));return l(s,a,i,o,t)}});const T=({metricsExplorerEnabled:e})=>{const t=["globalSearch"];return[{id:"inventory",title:re.dd,path:"/inventory",visibleIn:t},{id:"hosts",title:i.i18n.translate("xpack.infra.homePage.metricsHostsTabTitle",{defaultMessage:"Hosts"}),path:"/hosts",visibleIn:t},...e?[{id:"metrics-explorer",title:i.i18n.translate("xpack.infra.homePage.metricsExplorerTabTitle",{defaultMessage:"Metrics Explorer"}),path:"/explorer"}]:[],{id:"settings",title:i.i18n.translate("xpack.infra.homePage.settingsTabTitle",{defaultMessage:"Settings"}),path:"/settings"},{id:"assetDetails",title:"",path:"/detail",visibleIn:[]}]};return e.application.register({id:"metrics",title:i.i18n.translate("xpack.infra.metrics.pluginTitle",{defaultMessage:"Infrastructure"}),euiIconType:"logoObservability",order:8200,appRoute:"/app/metrics",category:a.DEFAULT_APP_CATEGORIES.observability,updater$:this.appUpdater$,deepLinks:T({metricsExplorerEnabled:this.config.featureFlags.metricsExplorerEnabled}),mount:async s=>{var a,i;const[o,n,l]=await e.getStartServices(),{renderApp:c}=await Promise.all([r.e(133),r.e(1),r.e(264),r.e(404),r.e(498),r.e(973),r.e(656)]).then(r.bind(r,5656)),d=!(null===(a=t.cloud)||void 0===a||!a.isCloudEnabled),p=(null===(i=t.cloud)||void 0===i?void 0:i.isServerlessEnabled)||this.isServerlessEnv;return c(o,{...n,licenseManagement:t.licenseManagement},l,this.config,s,{kibanaVersion:this.kibanaVersion,isCloudEnv:d,isServerlessEnv:p})}}),b.subscribe((([e,t])=>{this.appUpdater$.next((()=>({deepLinks:T({metricsExplorerEnabled:this.config.featureFlags.metricsExplorerEnabled})})))})),this.telemetry.setup({analytics:e.analytics}),{}}start(e,t){var r;const{http:s}=e;return{inventoryViews:this.inventoryViews.start({http:s}),metricsExplorerViews:null===(r=this.metricsExplorerViews)||void 0===r?void 0:r.start({http:s}),telemetry:this.telemetry.start()}}stop(){}}const ae=({isLogsExplorerAccessible:e,config:t,routes:r})=>{const s=[];return e&&s.push({label:"Discover",app:"observability-logs-explorer",path:"/"}),s.push(oe(r.logsAnomalies)),s.push(oe(r.logsCategories)),s},ie=e=>{const{applications$:t}=e;return t.pipe((0,n.map)((e=>{var t,r;return(null!==(t=null===(r=e.get("observability-logs-explorer"))||void 0===r?void 0:r.status)&&void 0!==t?t:a.AppStatus.inaccessible)===a.AppStatus.accessible})),(0,n.distinctUntilChanged)())},oe=({path:e,title:t})=>({app:"logs",label:t,path:e}),ne=e=>new Plugin(e)},6899:(e,t,r)=>{"use strict";r.d(t,{V:()=>a});var s=r(7808);const a=()=>({logsAnomalies:{id:"anomalies",title:s.$s,path:"/anomalies"},logsCategories:{id:"log-categories",title:s.LJ,path:"/log-categories"}})},7808:(e,t,r)=>{"use strict";r.d(t,{$s:()=>o,JU:()=>_,LJ:()=>n,S$:()=>u,U7:()=>i,c1:()=>c,dd:()=>d,jv:()=>p,m_:()=>a,uj:()=>l});var s=r(5008);const a=s.i18n.translate("xpack.infra.header.observabilityTitle",{defaultMessage:"Observability"}),i=s.i18n.translate("xpack.infra.header.logsTitle",{defaultMessage:"Logs"}),o=s.i18n.translate("xpack.infra.logs.index.anomaliesTabTitle",{defaultMessage:"Logs Anomalies"}),n=s.i18n.translate("xpack.infra.logs.index.logCategoriesBetaBadgeTitle",{defaultMessage:"Logs Categories"}),l=s.i18n.translate("xpack.infra.logs.index.settingsTabTitle",{defaultMessage:"Settings"}),c=s.i18n.translate("xpack.infra.header.infrastructureTitle",{defaultMessage:"Infrastructure"}),d=s.i18n.translate("xpack.infra.metrics.infrastructureInventoryTitle",{defaultMessage:"Infrastructure inventory"}),p=s.i18n.translate("xpack.infra.metrics.metricsExplorerTitle",{defaultMessage:"Metrics Explorer"}),u=s.i18n.translate("xpack.infra.metrics.hostsTitle",{defaultMessage:"Hosts"}),_=s.i18n.translate("xpack.infra.metricDetailPage.documentTitleError",{defaultMessage:"Uh oh"})},9209:(e,t,r)=>{r.p=window.__kbnPublicPath__.infra},511:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/aiops/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},5240:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/charts/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},2677:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/controls/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},4390:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("entry/core/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},7195:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/data/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},4627:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/data/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},7546:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/embeddable/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},5245:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/fleet/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},2137:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/kibanaReact/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},409:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},1359:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/kibanaUtils/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},1215:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},2298:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/licenseManagement/common/constants");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},9414:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/logsDataAccess/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},6764:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/logsShared/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},1952:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/logsShared/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},1474:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/metricsDataAccess/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},5902:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/metricsDataAccess/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},636:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/ml/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},5170:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/observability/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},3838:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/observability/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},3780:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/observabilityShared/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},6808:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/observabilityShared/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},2713:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/savedSearch/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},3073:(e,t,r)=>{r.r(t);var s=__kbnBundles__.get("plugin/triggersActionsUi/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(s))},8915:(e,t,r)=>{e.exports=r(2497)(67493)},9494:e=>{"use strict";e.exports=__kbnSharedDeps__.ChromaJs},5927:e=>{"use strict";e.exports=__kbnSharedDeps__.Classnames},3059:e=>{"use strict";e.exports=__kbnSharedDeps__.ElasticCharts},1319:e=>{"use strict";e.exports=__kbnSharedDeps__.ElasticEui},6752:e=>{"use strict";e.exports=__kbnSharedDeps__.ElasticNumeral},6791:e=>{"use strict";e.exports=__kbnSharedDeps__.EmotionReact},1639:e=>{"use strict";e.exports=__kbnSharedDeps__.FpTs.either},166:e=>{"use strict";e.exports=__kbnSharedDeps__.FpTs.function},1455:e=>{"use strict";e.exports=__kbnSharedDeps__.FpTs.option},6730:e=>{"use strict";e.exports=__kbnSharedDeps__.FpTs.pipeable},3782:e=>{"use strict";e.exports=__kbnSharedDeps__.IoTs},6688:e=>{"use strict";e.exports=__kbnSharedDeps__.IoTsThrowReporter},6494:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnDatemath},1192:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnEbtTools},5964:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnEsQuery},1991:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnEsqlAst},5008:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18n},5879:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18nReact},482:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnReactKibanaContextRender},5804:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnReactKibanaMount},5995:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnRison},1728:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnSharedUxErrorBoundary},193:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnSharedUxRouter},3803:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnUiTheme},770:e=>{"use strict";e.exports=__kbnSharedDeps__.Lodash},1060:e=>{"use strict";e.exports=__kbnSharedDeps__.LodashFp},1783:e=>{"use strict";e.exports=__kbnSharedDeps__.Moment},2488:e=>{"use strict";e.exports=__kbnSharedDeps__.MomentTimezone},4286:e=>{"use strict";e.exports=__kbnSharedDeps__.React},2874:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactDom},3530:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactQuery},5692:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactQueryDevtools},1493:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactRouterDom},4143:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactUse.useAsync},4048:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactUse.useAsyncFn},7583:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactUse.useDebounce},1904:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactUse.useDeepCompareEffect},8672:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactUse.useEffectOnce},7064:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactUse.useLocalStorage},9985:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactUse.useMount},7157:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactUse.useMountedState},693:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactUse.usePrevious},288:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactUse.useToggle},5668:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactUse.useUpdateEffect},190:e=>{"use strict";e.exports=__kbnSharedDeps__.Rxjs},5079:e=>{"use strict";e.exports=__kbnSharedDeps__.SaferLodashSet},1941:e=>{"use strict";e.exports=__kbnSharedDeps__.TsLib},9472:e=>{"use strict";e.exports=__kbnSharedDeps__.Uuid},2497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},a={};function i(e){var t=a[e];if(void 0!==t)return t.exports;var r=a[e]={exports:{}};return s[e](r,r.exports,i),r.exports}i.m=s,i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(r,s){if(1&s&&(r=this(r)),8&s)return r;if("object"==typeof r&&r){if(4&s&&r.__esModule)return r;if(16&s&&"function"==typeof r.then)return r}var a=Object.create(null);i.r(a);var o={};e=e||[null,t({}),t([]),t(t)];for(var n=2&s&&r;"object"==typeof n&&!~e.indexOf(n);n=t(n))Object.getOwnPropertyNames(n).forEach((e=>o[e]=()=>r[e]));return o.default=()=>r,i.d(a,o),a},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,r)=>(i.f[r](e,t),t)),[])),i.u=e=>"infra.chunk."+e+".js",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},i.l=(e,t,s,a)=>{if(r[e])r[e].push(t);else{var o,n;if(void 0!==s)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var d=l[c];if(d.getAttribute("src")==e){o=d;break}}o||(n=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.src=e),r[e]=[t];var p=(t,s)=>{o.onerror=o.onload=null,clearTimeout(u);var a=r[e];if(delete r[e],o.parentNode&&o.parentNode.removeChild(o),a&&a.forEach((e=>e(s))),t)return t(s)},u=setTimeout(p.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=p.bind(null,o.onerror),o.onload=p.bind(null,o.onload),n&&document.head.appendChild(o)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var s=r.length-1;s>-1&&(!e||!/^http(s?):/.test(e));)e=r[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e={895:0};i.f.j=(t,r)=>{var s=i.o(e,t)?e[t]:void 0;if(0!==s)if(s)r.push(s[2]);else{var a=new Promise(((r,a)=>s=e[t]=[r,a]));r.push(s[2]=a);var o=i.p+i.u(t),n=new Error;i.l(o,(r=>{if(i.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var a=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;n.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",n.name="ChunkLoadError",n.type=a,n.request=o,s[1](n)}}),"chunk-"+t,t)}};var t=(t,r)=>{var s,a,[o,n,l]=r,c=0;if(o.some((t=>0!==e[t]))){for(s in n)i.o(n,s)&&(i.m[s]=n[s]);l&&l(i)}for(t&&t(r);c<o.length;c++)a=o[c],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0},r=self.infra_bundle_jsonpfunction=self.infra_bundle_jsonpfunction||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),i(9209),__kbnBundles__.define("plugin/infra/public",i,948)})();