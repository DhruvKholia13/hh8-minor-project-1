(()=>{var e,t,r,o={854:function(e,t,r){var o,s=s||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,r=function(){return e.URL||e.webkitURL||e},o=t.createElementNS("http://www.w3.org/1999/xhtml","a"),s="download"in o,n=e.webkitRequestFileSystem,a=e.requestFileSystem||n||e.mozRequestFileSystem,i=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},l="application/octet-stream",c=0,u=function(t){var o=function(){"string"==typeof t?r().revokeObjectURL(t):t.remove()};e.chrome?o():setTimeout(o,500)},d=function(e,t,r){for(var o=(t=[].concat(t)).length;o--;){var s=e["on"+t[o]];if("function"==typeof s)try{s.call(e,r||e)}catch(e){i(e)}}},p=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e},h=function(t,i,h){h||(t=p(t));var f,g,m,b=this,v=t.type,y=!1,x=function(){d(b,"writestart progress write writeend".split(" "))},w=function(){!y&&f||(f=r().createObjectURL(t)),g?g.location.href=f:null==e.open(f,"_blank")&&"undefined"!=typeof safari&&(e.location.href=f),b.readyState=b.DONE,x(),u(f)},S=function(e){return function(){if(b.readyState!==b.DONE)return e.apply(this,arguments)}},j={create:!0,exclusive:!1};if(b.readyState=b.INIT,i||(i="download"),s)return f=r().createObjectURL(t),o.href=f,o.download=i,void setTimeout((function(){var e,t;e=o,t=new MouseEvent("click"),e.dispatchEvent(t),x(),u(f),b.readyState=b.DONE}));e.chrome&&v&&v!==l&&(m=t.slice||t.webkitSlice,t=m.call(t,0,t.size,l),y=!0),n&&"download"!==i&&(i+=".download"),(v===l||n)&&(g=e),a?(c+=t.size,a(e.TEMPORARY,c,S((function(e){e.root.getDirectory("saved",j,S((function(e){var r=function(){e.getFile(i,j,S((function(e){e.createWriter(S((function(r){r.onwriteend=function(t){g.location.href=e.toURL(),b.readyState=b.DONE,d(b,"writeend",t),u(e)},r.onerror=function(){var e=r.error;e.code!==e.ABORT_ERR&&w()},"writestart progress write abort".split(" ").forEach((function(e){r["on"+e]=b["on"+e]})),r.write(t),b.abort=function(){r.abort(),b.readyState=b.DONE},b.readyState=b.WRITING})),w)})),w)};e.getFile(i,{create:!1},S((function(e){e.remove(),r()})),S((function(e){e.code===e.NOT_FOUND_ERR?r():w()})))})),w)})),w)):w()},f=h.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,r){return r||(e=p(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(f.abort=function(){var e=this;e.readyState=e.DONE,d(e,"abort")},f.readyState=f.INIT=0,f.WRITING=1,f.DONE=2,f.error=f.onwritestart=f.onprogress=f.onwrite=f.onabort=f.onerror=f.onwriteend=null,function(e,t,r){return new h(e,t,r)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */e.exports?e.exports.saveAs=s:null!==r.amdD&&null!=r.amdO&&(void 0===(o=function(){return s}.apply(t,[]))||(e.exports=o))},603:(e,t,r)=>{"use strict";const o=r(575),s=r(719);class AggregateError extends Error{constructor(e){if(!Array.isArray(e))throw new TypeError("Expected input to be an Array, got "+typeof e);let t=(e=[...e].map((e=>e instanceof Error?e:null!==e&&"object"==typeof e?Object.assign(new Error(e.message),e):new Error(e)))).map((e=>"string"==typeof e.stack?s(e.stack).replace(/\s+at .*aggregate-error\/index.js:\d+:\d+\)?/g,""):String(e))).join("\n");t="\n"+o(t,4),super(t),this.name="AggregateError",Object.defineProperty(this,"_errors",{value:e})}*[Symbol.iterator](){for(const e of this._errors)yield e}}e.exports=AggregateError},893:(e,t,r)=>{"use strict";r.r(t),r.d(t,{CSV_QUOTE_VALUES_SETTING:()=>s,CSV_SEPARATOR_SETTING:()=>o,downloadFileAs:()=>he,downloadMultipleAs:()=>fe,plugin:()=>ge,useLocatorUrl:()=>u,useShareTypeContext:()=>T});const o="csv:separator",s="csv:quoteValues";var n=r(286),a=r.n(n);const i=__kbnSharedDeps__.ReactUse.useMountedState;var l=r.n(i),c=r(721);const u=(e,t,r,o=[])=>{const[s,a]=(0,n.useState)(""),i=l()();return(0,n.useEffect)((()=>{e?e.getUrl(t,r).then((e=>{i()&&a(e)})).catch((e=>{i()&&(c.error("useLocatorUrl",e),a(""))})):a("")}),[e,...o]),s};var d=r(915);class ShareRegistry{constructor(){(0,d.default)(this,"urlService",void 0),(0,d.default)(this,"anonymousAccessServiceProvider",void 0),(0,d.default)(this,"capabilities",void 0),(0,d.default)(this,"getLicense",void 0),(0,d.default)(this,"globalMarker","*"),(0,d.default)(this,"shareOptionsStore",{[this.globalMarker]:new Map}),this.registerLinkShareAction(),this.registerEmbedShareAction()}setup(){return{register:this.register.bind(this),registerShareIntegration:this.registerShareIntegration.bind(this)}}start({urlService:e,anonymousAccessServiceProvider:t,capabilities:r,getLicense:o}){return this.urlService=e,this.anonymousAccessServiceProvider=t,this.capabilities=r,this.getLicense=o,{availableIntegrations:this.availableIntegrations.bind(this),resolveShareItemsForShareContext:this.resolveShareItemsForShareContext.bind(this)}}registerShareIntentAction(e,t){this.shareOptionsStore[e]||(this.shareOptionsStore[e]=new Map);const r=this.shareOptionsStore[e],o="integration"===t.shareType?`integration-${t.groupId||"unknown"}-${t.id}`:t.shareType;if(r.has(o))throw new Error(`Share action with type [${t.shareType}] for app [${e}] has already been registered.`);r.set(o,t)}registerLinkShareAction(){this.registerShareIntentAction(this.globalMarker,{shareType:"link",config:({urlService:e})=>({shortUrlService:null==e?void 0:e.shortUrls.get(null)})})}registerEmbedShareAction(){this.registerShareIntentAction(this.globalMarker,{shareType:"embed",config:({urlService:e,anonymousAccessServiceProvider:t})=>({anonymousAccess:t(),shortUrlService:e.shortUrls.get(null)})})}register(e){this.registerShareIntentAction(this.globalMarker,{shareType:"legacy",id:e.id,config:e.getShareMenuItemsLegacy})}registerShareIntegration(...e){const[t,r]=1===e.length?[this.globalMarker,e[0]]:e;this.registerShareIntentAction(t,{shareType:"integration",id:r.id,groupId:r.groupId,config:r.getShareIntegrationConfig,prerequisiteCheck:r.prerequisiteCheck})}getShareConfigOptionsForObject(e){const t=this.shareOptionsStore[e],r=Array.from(this.shareOptionsStore[this.globalMarker].values());return t?r.concat(Array.from(t.values())):r}availableIntegrations(e,t){if(!this.capabilities||!this.getLicense)throw new Error("ShareOptionsManager#start was not invoked");return this.getShareConfigOptionsForObject(e).filter((r=>(!t||"integration"===r.shareType&&((null==r?void 0:r.groupId)===t||"integration"!==r.shareType))&&("integration"!==r.shareType||!r.prerequisiteCheck||r.prerequisiteCheck({capabilities:this.capabilities,license:this.getLicense(),objectType:e}))))}async resolveShareItemsForShareContext({objectType:e,isServerless:t,...r}){if(!this.urlService||!this.anonymousAccessServiceProvider)throw new Error("ShareOptionsManager#start was not invoked");return(await Promise.all(this.availableIntegrations(e).map((async t=>{let o;return o="legacy"===t.shareType?t.config.call(null,{objectType:e,...r}):"integration"===t.shareType?await t.config.call(null,{urlService:this.urlService,anonymousAccessServiceProvider:this.anonymousAccessServiceProvider,objectType:e,...r}):t.config.call(null,{urlService:this.urlService,anonymousAccessServiceProvider:this.anonymousAccessServiceProvider,objectType:e,...r}),{...t,config:o}})))).filter((e=>t?"embed"!==e.shareType&&e.config:e.config))}}var p=r(874),h=r.n(p);const f=__kbnSharedDeps__.KbnReactKibanaMount;var g=r(791),m=r(319);const b=(0,__kbnSharedDeps__.Lodash.once)((()=>(0,n.createContext)({tabs:[],state:{meta:{defaultSelectedTabId:"",selectedTabId:""}},dispatch:()=>{}})));function v({tabs:e,defaultSelectedTabId:t,children:r}){const o=b(),s=(0,n.useRef)([]),a=(0,n.useRef)({meta:{defaultSelectedTabId:t,selectedTabId:t}}),i=(0,n.useMemo)((()=>e.reduce(((e,{reducer:t,initialState:r,...o})=>(a.current[o.id]=null!=r?r:{},s.current.push({...o}),e[o.id]=t,e)),{})),[e]),l=(0,n.useCallback)((function(e){return(t,r)=>{const o={...t};if(/^meta_/i.test(r.type))o.meta=((e,t)=>"META_selectedTabId"===t.type?{...e,selectedTabId:t.payload}:e)(o.meta,r);else{const s=t.meta.selectedTabId,n=e[s];n&&(o[s]=n(o[s],r))}return o}}),[]),c=(0,n.useCallback)((e=>e),[]),[u,d]=(0,n.useReducer)(l(i),a.current,c);return(0,g.jsx)(o.Provider,{value:{tabs:s.current,state:u,dispatch:d}},r)}var y={name:"49aokf",styles:"display:contents"};const x=({onClose:e,modalTitle:t,modalWidth:r,anchorElement:o,...s})=>{const{tabs:a,state:i,dispatch:l}=(0,n.useContext)(b()),{selectedTabId:c}=i.meta,u=(0,m.useGeneratedHtmlId)({prefix:"tabbedModal"}),d=(0,m.useGeneratedHtmlId)({prefix:"tabbedModalHeading"}),p=(0,n.useMemo)((()=>c?i[c]:{}),[c,i]),{content:h,modalActionBtn:f}=(0,n.useMemo)((()=>a.find((e=>e.id===c))),[c,a]),v=(0,n.useCallback)((e=>{l({type:"META_selectedTabId",payload:e})}),[l]),x=(0,n.useCallback)((()=>1===a.length?null:(0,g.jsx)(m.EuiTabs,null,a.map(((e,t)=>(0,g.jsx)(m.EuiTab,{key:t,onClick:()=>v(e.id),isSelected:e.id===c,disabled:e.disabled,prepend:e.prepend,append:e.append,"data-test-subj":e.id},e.name))))),[v,c,a]);return(0,g.jsx)(m.EuiModal,{id:u,onClose:()=>{e(),setTimeout((()=>null==o?void 0:o.focus()),1)},maxWidth:!0,"data-test-subj":s["data-test-subj"],css:(0,g.css)({...r?{width:r}:{}},"",""),"aria-labelledby":d},(0,g.jsx)(g.Global,{styles:(0,g.css)({[`.euiOverlayMask:has([id="${u}"])`]:{alignItems:"flex-start",paddingBlockStart:"20vh"}},"","")}),(0,g.jsx)(m.EuiModalHeader,null,(0,g.jsx)(m.EuiModalHeaderTitle,{id:d},t)),(0,g.jsx)(m.EuiModalBody,null,(0,g.jsx)(n.Fragment,null,x()),(0,g.jsx)(m.EuiSpacer,{size:"m"}),(0,g.jsx)("div",{css:y,"data-test-subj":`tabbedModal-${c}-content`},(0,g.jsx)(h,{state:p,dispatch:l}))),void 0!==(null==f?void 0:f.id)&&p&&(0,g.jsx)(m.EuiModalFooter,null,(0,g.jsx)(m.EuiButton,{fill:!0,"data-test-subj":f.dataTestSubj,"data-share-url":i.url,onClick:()=>{f.handler({state:p})}},f.label)))};function w({tabs:e,defaultSelectedTabId:t,...r}){return(0,g.jsx)(v,{tabs:e,defaultSelectedTabId:t},(0,g.jsx)(x,r))}const S=(0,n.createContext)(null),j=({shareContext:e,children:t})=>(0,g.jsx)(S.Provider,{value:e},t),E=()=>{const e=(0,n.useContext)(S);if(!e)throw new Error("Failed to call `useShareContext` because the context from ShareMenuProvider is missing. Ensure the component or React root is wrapped with ShareMenuProvider");return e},T=(e,t)=>{var r,o,s;const n=E(),{shareMenuItems:a,objectTypeMeta:i,...l}=n,c=("integration"===e?Array.prototype.filter:Array.prototype.find).call(a,(r=>r.shareType===e&&(null==r?void 0:r.groupId)===(null!=t?t:null==r?void 0:r.groupId)));return{...l,objectTypeMeta:{...i,config:"integration"===e?t?null===(r=i.config)||void 0===r||null===(o=r.integration)||void 0===o?void 0:o[t]:{}:null===(s=i.config)||void 0===s?void 0:s[e]},shareMenuItems:c}};var C=r(8);const M=__kbnSharedDeps__.KbnI18nReact,U=__kbnSharedDeps__.KbnDatemath;var _=r.n(U);const I=new Map([["s","second"],["m","minute"],["h","hour"],["d","day"],["w","week"],["M","month"],["y","year"]]),k=e=>{if(!e)return;const t=e.split("/")[0],r=e.includes("/")?e.split("/")[1]:void 0;if("now"===t)return{value:0,unit:"second",roundingUnit:void 0};const o=t.match(/^now([+-]\d+)([smhdwMy])$/);if(!o)return;const[,s,n]=o;return{value:Number(s),unit:I.get(n),roundingUnit:r?I.get(r):void 0}},A=e=>{if(!e)return e;const t=_().parse(e);return t&&t.isValid()?t.toISOString():e},F=({children:e})=>{const{euiTheme:t}=(0,m.useEuiTheme)(),r=(0,g.css)("font-weight:",t.font.weight.bold,";","");return(0,g.jsx)(m.EuiText,{css:r,component:"span",size:"s"},e)},R=({date:e})=>{const t=(e=>{if(!e)return;const t=_().parse(e);return null!=t&&t.isValid()?t.toDate():void 0})(e);return(0,g.jsx)(F,null,(0,g.jsx)(M.FormattedDate,{value:t,year:"numeric",month:"long",day:"2-digit",hour:"numeric",minute:"numeric",hour12:!0}))},O=({value:e,unit:t,roundingUnit:r})=>0!==e||"second"!==t||r?(0,g.jsx)(F,null,(0,g.jsx)(M.FormattedRelativeTime,{value:e,unit:t}),r&&(0,g.jsx)(M.FormattedMessage,{id:"share.link.timeRange.relativeTimeInfoText.roundingUnit",defaultMessage:" rounded to the {roundingUnit}",values:{roundingUnit:r}})):(0,g.jsx)(M.FormattedMessage,{id:"share.link.timeRange.now",defaultMessage:"<bold>now</bold>",values:{bold:e=>(0,g.jsx)(F,null,e)}}),L=({timeRange:e,onTimeTypeChange:t,isAbsoluteTimeByDefault:r})=>{const[o,s]=(0,n.useState)(r);return e?(0,g.jsx)(a().Fragment,null,!r&&(0,g.jsx)(a().Fragment,null,(0,g.jsx)(m.EuiSwitch,{label:C.i18n.translate("share.link.timeRange.switchLabel",{defaultMessage:"Use absolute time range"}),checked:o,onChange:e=>{const r=e.target.checked;s(r),null==t||t(r)}}),(0,g.jsx)(m.EuiSpacer,{size:"m"})),(0,g.jsx)(m.EuiText,{size:"s"},o?(0,g.jsx)("div",{"data-test-subj":"absoluteTimeInfoText"},(0,g.jsx)(M.FormattedMessage,{id:"share.link.timeRange.absoluteTimeInfoText",defaultMessage:"The users will see all data from {from} to {to}.",values:{from:(0,g.jsx)(R,{date:null==e?void 0:e.from}),to:(0,g.jsx)(R,{date:null==e?void 0:e.to})}})):(e=>{const t=e.from.includes("now"),r=e.to.includes("now"),o=k(e.from),s=k(e.to),n=t?(0,g.jsx)(O,{value:null==o?void 0:o.value,unit:null==o?void 0:o.unit,roundingUnit:null==o?void 0:o.roundingUnit}):(0,g.jsx)(R,{date:e.from}),a=r?(0,g.jsx)(O,{value:null==s?void 0:s.value,unit:null==s?void 0:s.unit,roundingUnit:null==s?void 0:s.roundingUnit}):(0,g.jsx)(R,{date:e.to});return(0,g.jsx)(M.FormattedMessage,{id:"share.link.timeRange.relativeTimeInfoText",defaultMessage:"The users will see all data from {from} to {to}, based on when they view it.",values:{from:n,to:a}})})(e)),(0,g.jsx)(m.EuiSpacer,{size:"m"}),r&&(0,g.jsx)(m.EuiCallOut,{size:"s",title:C.i18n.translate("share.link.timeRange.relativeTimeCallout",{defaultMessage:"To use a relative time range, select it in the time picker first."})})):null},P=({isDirty:e,objectType:t,objectConfig:r={},shareableUrl:o,shortUrlService:s,shareableUrlLocatorParams:i,allowShortUrl:l})=>{var c;const[u,d]=(0,n.useState)(""),[p,h]=(0,n.useState)(!1),[f,b]=(0,n.useState)(!1),[v,y]=(0,n.useState)(!0),x=(0,n.useRef)(void 0),w=(0,n.useRef)(void 0),S=(0,n.useRef)(),j=null==i||null===(c=i.params)||void 0===c?void 0:c.timeRange,{delegatedShareUrlHandler:E,draftModeCallOut:T}=r,U=(0,n.useCallback)((e=>x.current?Object.keys(x.current).reduce(((e,t)=>{var r;const o=null===(r=x.current)||void 0===r?void 0:r[t];return o?Object.keys(o).reduce(((e,t)=>o[t]?e+`&${t}=true`:e),e):e}),e):e),[]);(0,n.useEffect)((()=>{d(U(o||window.location.href))}),[U,o]);const _=(0,n.useCallback)((async()=>{if(i){const e=await s.createWithLocator(i,v);return e.locator.getUrl(e.params,{absolute:!0})}return(await s.createFromLongUrl(u,v)).url}),[i,s,u,v]),I=(0,n.useCallback)((async()=>{b(!0),w.current||(w.current=E?await E():l?await _():u),(0,m.copyToClipboard)(w.current),h((()=>(S.current&&clearTimeout(S.current),S.current=setTimeout((()=>h(!1)),1e3),!0))),b(!1)}),[u,E,l,_]),k=(0,n.useCallback)((e=>{null!=w&&w.current&&e!==v&&(w.current=void 0),y(e)}),[v]);return(0,g.jsx)(a().Fragment,null,(0,g.jsx)(m.EuiForm,null,(0,g.jsx)(L,{timeRange:j,onTimeTypeChange:k,isAbsoluteTimeByDefault:v}),e&&T&&(0,g.jsx)(a().Fragment,null,(0,g.jsx)(m.EuiSpacer,{size:"m"}),T),(0,g.jsx)(m.EuiSpacer,{size:"l"})),(0,g.jsx)(m.EuiFlexGroup,{justifyContent:"flexEnd",responsive:!1},(0,g.jsx)(m.EuiFlexItem,{grow:!1},(0,g.jsx)(m.EuiToolTip,{content:p?C.i18n.translate("share.link.copied",{defaultMessage:"Link copied"}):null},(0,g.jsx)(m.EuiButton,{fill:!0,"data-test-subj":"copyShareUrlButton","data-share-url":w.current,onBlur:()=>"lens"===t&&e?null:h(!1),onClick:I,color:"lens"===t&&e?"warning":"primary",isLoading:f},(0,g.jsx)(M.FormattedMessage,{id:"share.link.copyLinkButton",defaultMessage:"Copy link"}))))))},D="SET_DASHBOARD_URL",B="SET_IS_NOT_SAVED",z={id:"link",name:C.i18n.translate("share.contextMenu.permalinksTab",{defaultMessage:"Link"}),description:C.i18n.translate("share.dashboard.link.description",{defaultMessage:"Share a direct link to this search."}),content:({state:e,dispatch:t})=>{const{objectType:r,objectTypeMeta:o,objectId:s,isDirty:a,shareableUrl:i,shareableUrlLocatorParams:l,allowShortUrl:c,shareMenuItems:u}=T("link"),d=(0,n.useCallback)((e=>{t({type:D,payload:e})}),[t]),p=(0,n.useCallback)((()=>{t({type:B,payload:("lens"===r||"dashboard"===r&&!c)&&a})}),[t,r,a,c]),h=(0,n.useCallback)((()=>{t({type:B,payload:h})}),[t]);return(0,g.jsx)(P,{objectType:r,objectConfig:null==o?void 0:o.config,objectId:s,isDirty:a,shareableUrl:i,shortUrlService:u.config.shortUrlService,shareableUrlLocatorParams:l,dashboardLink:null==e?void 0:e.dashboardUrl,setDashboardLink:d,isNotSaved:null==e?void 0:e.isNotSaved,setIsNotSaved:p,allowShortUrl:c,setIsClicked:null==e?void 0:e.setIsClicked})},reducer:(e={dashboardUrl:"",isNotSaved:!1,setIsClicked:!1},t)=>{switch(t.type){case D:return{...e,dashboardUrl:t.payload};case B:return{...e,isNotSaved:t.payload};default:return e}}};var $=r(328);const N=({shareableUrlForSavedObject:e,shareableUrl:t,shareableUrlLocatorParams:r,objectType:o,objectConfig:s={},isDirty:i,allowShortUrl:l,shortUrlService:c,anonymousAccess:u})=>{const d=(0,n.useRef)(void 0),[p,h]=(0,n.useState)(!1),[f,b]=(0,n.useState)(""),[v,y]=(0,n.useState)(!1),x=(0,n.useRef)(void 0),[w,S]=(0,n.useState)(null),[j,E]=(0,n.useState)(!1),[T,U]=(0,n.useState)(!1),_=(0,n.useRef)(),{draftModeCallOut:I,computeAnonymousCapabilities:k,embedUrlParamExtensions:A}=s;(0,n.useEffect)((()=>{k&&u&&(async()=>{try{const[e,t]=await Promise.all([u.getState(),u.getCapabilities()]);null!=e&&e.isEnabled&&(S(null==e?void 0:e.accessURLParameters),t&&U(null==k?void 0:k(t)))}catch{}})()}),[u,k]);const F=(0,n.useCallback)((e=>{const t="?embed=true";return-1!==e.indexOf("?")?e.replace("?",`${t}&`):`${e}${t}`}),[]),R=(0,n.useCallback)((e=>d.current?Object.keys(d.current).reduce(((e,t)=>{var r;const o=null===(r=d.current)||void 0===r?void 0:r[t];return o?Object.keys(o).reduce(((e,t)=>o[t]?e+`&${t}=true`:e),e):e}),e):e),[]),O=(0,n.useCallback)((e=>R(F(e))),[F,R]);(0,n.useEffect)((()=>b(O(t||window.location.href))),[t,O]);const L=(0,n.useCallback)((()=>{const t=e?O(e):f,r=(0,$.parse)(t);if(!r||!r.hash)return t;const o=(0,$.parse)(r.hash.slice(1),!0),s=(0,$.format)({protocol:r.protocol,auth:r.auth,host:r.host,pathname:r.pathname,hash:(0,$.format)({pathname:o.pathname,query:{_g:o.query._g}})});return O(s)}),[e,f,O]),P=(0,n.useCallback)((async()=>{if(r){const e=await c.createWithLocator(r);return e.locator.getUrl(e.params,{absolute:!0})}return(await c.createFromLongUrl(f)).url}),[r,f,c]),D=(0,n.useCallback)((e=>{if(!w||!j)return e;const t=new URL(e);for(const[e,r]of Object.entries(w))t.searchParams.set(e,r);return t.toString()}),[w,j]),B=(0,n.useCallback)((async()=>`<iframe src="${D(i?l?await P():f:L())}" height="600" width="800"></iframe>`),[D,l,P,L,i,f]),z=(0,n.useCallback)((async()=>{h(!0),x.current=await B(),(0,m.copyToClipboard)(x.current),y((()=>(_.current&&clearTimeout(_.current),_.current=setTimeout((()=>y(!1)),1e3),!0))),h(!1)}),[B]),N="dashboard"===o?(0,g.jsx)(M.FormattedMessage,{id:"share.embed.dashboard.helpText",defaultMessage:"Embed this dashboard into another webpage. Select which items to include in the embeddable view."}):(0,g.jsx)(M.FormattedMessage,{id:"share.embed.helpText",defaultMessage:"Embed this {objectType} into another webpage.",values:{objectType:o}});return(0,g.jsx)(a().Fragment,null,(0,g.jsx)(m.EuiForm,null,(0,g.jsx)(m.EuiText,{size:"s"},N),(0,g.jsx)(m.EuiSpacer,null),(()=>{if(!A)return null;const e=e=>(t={})=>{d.current={...d.current,[e]:{...t}}};return(0,g.jsx)(a().Fragment,null,A.map((({paramName:t,component:r})=>(0,g.jsx)(m.EuiFormRow,{key:t},(0,g.jsx)(r,{setParamValue:e(t)})))))})(),i&&I&&(0,g.jsx)(a().Fragment,null,(0,g.jsx)(m.EuiSpacer,{size:"m"}),I),(0,g.jsx)(m.EuiSpacer,null)),(0,g.jsx)(m.EuiFlexGroup,{justifyContent:"flexEnd",responsive:!1},(0,g.jsx)(a().Fragment,null,T?(0,g.jsx)(m.EuiFlexGroup,{alignItems:"center",gutterSize:"xs",responsive:!1},(0,g.jsx)(m.EuiFlexItem,{grow:!1},(0,g.jsx)(m.EuiSwitch,{label:(0,g.jsx)(M.FormattedMessage,{id:"share.embed.publicUrlOptionsSwitch.label",defaultMessage:"Allow public access"}),checked:j,onChange:e=>E(e.target.checked),"data-test-subj":"embedPublicUrlOptionsSwitch"})),(0,g.jsx)(m.EuiFlexItem,{grow:!1},(0,g.jsx)(m.EuiIconTip,{content:(0,g.jsx)(M.FormattedMessage,{id:"share.embed.publicUrlOptionsSwitch.tooltip",defaultMessage:"Enabling public access generates a sharable URL that allows anonymous access without a login prompt."}),type:"question"}))):null),(0,g.jsx)(m.EuiFlexItem,{grow:!1},(0,g.jsx)(m.EuiToolTip,{content:v?C.i18n.translate("share.embed.copied",{defaultMessage:"Link copied"}):null},(0,g.jsx)(m.EuiButton,{fill:!0,"data-test-subj":"copyEmbedUrlButton",onClick:z,"data-share-url":x.current,isLoading:p},(0,g.jsx)(M.FormattedMessage,{id:"share.embed.copyEmbedCodeButton",defaultMessage:"Copy embed code"}))))))},G={id:"embed",name:C.i18n.translate("share.contextMenu.embedCodeTab",{defaultMessage:"Embed"}),content:({state:e,dispatch:t})=>{const{shareableUrlForSavedObject:r,shareableUrl:o,objectType:s,objectTypeMeta:n,isDirty:a,allowShortUrl:i,shareableUrlLocatorParams:l,shareMenuItems:c}=T("embed");return(0,g.jsx)(N,{shareableUrlForSavedObject:r,shareableUrl:o,objectType:s,objectConfig:null==n?void 0:n.config,isDirty:a,allowShortUrl:i,anonymousAccess:c.config.anonymousAccess,shortUrlService:c.config.shortUrlService,shareableUrlLocatorParams:l})}},W=({shareContext:e})=>(0,g.jsx)(j,{shareContext:e},(0,g.jsx)(H,null)),H=()=>{var e,t,r;const o=E(),{objectTypeMeta:s,onClose:n,shareMenuItems:a,anchorElement:i}=o,l=[];return null!=s&&null!==(e=s.config.link)&&void 0!==e&&e.disabled||l.push(z),!a.some((({shareType:e})=>"embed"===e))||null!=s&&null!==(t=s.config)&&void 0!==t&&null!==(r=t.embed)&&void 0!==r&&r.disabled||l.push(G),Boolean(l.length)?(0,g.jsx)(w,{tabs:l,modalWidth:498,onClose:n,modalTitle:s.title,defaultSelectedTabId:l[0].id,anchorElement:i,"data-test-subj":"shareContextModal"}):null};var q=r(185);const V=({shareContext:e})=>(0,g.jsx)(j,{shareContext:e},(0,g.jsx)(n.Fragment,null,a().createElement((0,M.injectI18n)(Z))));function K({usePrintLayout:e,printLayoutChange:t}){return(0,g.jsx)(m.EuiFlexGroup,{direction:"column",gutterSize:"xs",responsive:!1},(0,g.jsx)(m.EuiFlexItem,{grow:!1},(0,g.jsx)(m.EuiFormRow,{label:(0,g.jsx)(m.EuiText,{size:"s"},(0,g.jsx)("h4",null,(0,g.jsx)(M.FormattedMessage,{id:"share.exportFlyoutContent.optimizeForPrinting.label",defaultMessage:"Print format"}))),helpText:(0,g.jsx)(m.EuiText,{size:"s",color:"subdued"},(0,g.jsx)(M.FormattedMessage,{id:"share.exportFlyoutContent.optimizeForPrinting.helpText",defaultMessage:"Uses multiple pages, showing at most 2 visualizations per page "})),fullWidth:!0},(0,g.jsx)(m.EuiSwitch,{label:(0,g.jsx)(m.EuiText,{size:"s"},e?(0,g.jsx)(M.FormattedMessage,{id:"share.exportFlyoutContent.optimizeForPrinting.selection.on",defaultMessage:"On"}):(0,g.jsx)(M.FormattedMessage,{id:"share.exportFlyoutContent.optimizeForPrinting.selection.off",defaultMessage:"Off"})),checked:e,onChange:t,"data-test-subj":"usePrintLayout"}))))}var J={name:"1yc9uo8",styles:"overflow-wrap:break-word"};function Y({exportIntegration:e,intl:t,isDirty:r,onCloseFlyout:o,publicAPIEnabled:s,shareObjectTypeMeta:i,shareObjectType:l,shareObjectTypeAlias:c}){var u,d,p;const[h,f]=(0,n.useState)(!1),[b,v]=(0,n.useState)(!1),y=(0,n.useCallback)((async()=>{try{v(!0),await e.config.generateAssetExport({intl:t,optimizedForPrinting:h})}finally{v(!1),o()}}),[e.config,t,o,h]),x=null===(u=i.config)||void 0===u||null===(d=u[e.id])||void 0===d?void 0:d.draftModeCallOut;return(0,g.jsx)(a().Fragment,null,(0,g.jsx)(m.EuiFlyoutHeader,{hasBorder:!0},(0,g.jsx)(m.EuiTitle,null,(0,g.jsx)("h2",null,(0,g.jsx)(M.FormattedMessage,{id:"share.export.flyoutTitle",defaultMessage:"Export {objectType} as {type}",values:{objectType:null!=c?c:l.toLocaleLowerCase(),type:e.config.label}})))),(0,g.jsx)(m.EuiFlyoutBody,null,(0,g.jsx)(m.EuiFlexGroup,{direction:"column"},(0,g.jsx)(n.Fragment,null,e.config.renderLayoutOptionSwitch&&(0,g.jsx)(m.EuiFlexItem,null,(0,g.jsx)(K,{usePrintLayout:h,printLayoutChange:e=>f(e.target.checked)}))),(0,g.jsx)(n.Fragment,null,(null==e?void 0:e.config.copyAssetURIConfig)&&s&&(0,g.jsx)(m.EuiFlexItem,null,(0,g.jsx)(m.EuiFormRow,{label:(0,g.jsx)(m.EuiText,{size:"s"},(0,g.jsx)("h4",null,e.config.copyAssetURIConfig.headingText)),fullWidth:!0},(0,g.jsx)(m.EuiFlexGroup,{direction:"column"},(0,g.jsx)(m.EuiFlexItem,null,(0,g.jsx)(m.EuiText,{size:"s",color:"subdued"},e.config.copyAssetURIConfig.helpText)),(0,g.jsx)(m.EuiFlexItem,null,(0,g.jsx)(m.EuiCodeBlock,{"data-test-subj":"exportAssetValue",css:J,overflowHeight:360,language:e.config.copyAssetURIConfig.contentType,isCopyable:!0,copyAriaLabel:C.i18n.translate("share.export.copyPostURLAriaLabel",{defaultMessage:"Copy export asset value"})},e.config.copyAssetURIConfig.generateAssetURIValue({intl:t,optimizedForPrinting:h}))))))),(0,g.jsx)(n.Fragment,null,e.config.generateAssetComponent),(0,g.jsx)(n.Fragment,null,s&&r&&x&&(0,g.jsx)(m.EuiFlexItem,null,x)))),(0,g.jsx)(m.EuiFlyoutFooter,null,(0,g.jsx)(m.EuiFlexGroup,{justifyContent:"spaceBetween"},(0,g.jsx)(m.EuiFlexItem,{grow:!1},(0,g.jsx)(m.EuiButtonEmpty,{"data-test-subj":"exportFlyoutCloseButton",onClick:o},(0,g.jsx)(M.FormattedMessage,{id:"share.export.closeFlyoutButtonLabel",defaultMessage:"Close"}))),(0,g.jsx)(m.EuiFlexItem,{grow:!1},(0,g.jsx)(m.EuiButton,{fill:!0,onClick:y,"data-test-subj":"generateReportButton",isLoading:b},null!==(p=e.config.generateExportButtonLabel)&&void 0!==p?p:(0,g.jsx)(M.FormattedMessage,{id:"share.export.generateButtonLabel",defaultMessage:"Export {type}",values:{type:e.config.label}}))))))}var Q={name:"di73wv",styles:'.euiPopover__panel[data-popover-open="true"]{z-index:7000 !important;}'};function Z({intl:e}){const{onClose:t,anchorElement:r,shareMenuItems:o,isDirty:s,publicAPIEnabled:i,objectType:l,objectTypeAlias:c,objectTypeMeta:u}=T("integration","export"),{shareMenuItems:d}=T("integration","exportDerivatives"),p=(0,n.useMemo)((()=>d.filter((e=>e.config.shouldRender({availableExportItems:o})))),[d,o]),[h,f]=(0,n.useState)(!1),b=(0,n.useRef)({export:o,exportDerivatives:d}),[v,y]=(0,n.useState)(),x=(0,n.useMemo)((()=>{let e=null;return v?(b.current[v.group].forEach((t=>{t.id===v.id&&(e=t)})),e):e}),[v]),w=(0,n.useCallback)((e=>{y({id:e.id,group:e.groupId}),f(!0)}),[]),S=(0,n.useCallback)((async r=>{r.config.copyAssetURIConfig||r.config.generateAssetComponent||!r.config.generateAssetExport?w(r):await r.config.generateAssetExport({intl:e,optimizedForPrinting:!1}).finally((()=>{t()}))}),[e,t,w]),j=(0,n.useRef)(null),E=(0,n.useMemo)((()=>1===o.length&&!d.length),[o,d]),C=(0,n.useCallback)((()=>{f(!1),E&&t()}),[t,E]);return(0,n.useEffect)((()=>{E&&!v&&S(o[0])}),[S,o,t,v,E]),(0,g.jsx)(n.Fragment,null,(0,g.jsx)(m.EuiWrappingPopover,{isOpen:!h&&!E,button:r,closePopover:t,panelPaddingSize:"s",panelProps:{"data-test-subj":"exportPopoverPanel"}},(0,g.jsx)(m.EuiListGroup,{flush:!0},o.map((e=>(0,g.jsx)(m.EuiToolTip,{position:"left",content:null==x?void 0:x.config.toolTipContent,key:e.id},(0,g.jsx)(m.EuiListGroupItem,{iconType:e.config.icon,key:e.id,label:e.config.label,"data-test-subj":`exportMenuItem-${e.config.label}`,isDisabled:e.config.disabled,onClick:S.bind(null,e)}))))),Boolean(p.length)&&(0,g.jsx)(a().Fragment,null,(0,g.jsx)(m.EuiHorizontalRule,{margin:"xs"}),(0,g.jsx)(m.EuiFlexGroup,{direction:"column",gutterSize:"s"},p.map((e=>(0,g.jsx)(m.EuiFlexItem,{key:e.id},e.config.label({openFlyout:w.bind(null,e)}))))))),h&&(0,g.jsx)(m.EuiFlyout,(0,q.default)({"data-test-subj":"exportItemDetailsFlyout",size:"s",onClose:C,css:()=>({"--euiFixedHeadersOffset":0,isolation:"isolate"}),ownFocus:!0,maskProps:{headerZindexLocation:"above"},ref:j},"exportDerivatives"===(null==x?void 0:x.groupId)&&x.config.flyoutSizing||{}),(0,g.jsx)(g.Global,{styles:Q}),"export"===v.group?(0,g.jsx)(Y,{exportIntegration:x,shareObjectType:l,shareObjectTypeAlias:c,shareObjectTypeMeta:u,isDirty:s,publicAPIEnabled:i,intl:e,onCloseFlyout:C}):null==x?void 0:x.config.flyoutContent({flyoutRef:j,closeFlyout:C})))}class ShareMenuManager{constructor(){(0,d.default)(this,"isOpen",!1),(0,d.default)(this,"container",document.createElement("div")),(0,d.default)(this,"onClose",(()=>{h().unmountComponentAtNode(this.container),this.isOpen=!1}))}start({core:e,resolveShareItemsForShareContext:t,isServerless:r}){return{toggleShareContextMenu:async o=>{const s=()=>{var e;this.onClose(),null===(e=o.onClose)||void 0===e||e.call(o)},n=await t({...o,isServerless:r,onClose:s});this.toggleShareContextMenu({...o,onClose:s,menuItems:n,publicAPIEnabled:!r},e.rendering)}}}toggleShareContextMenu({anchorElement:e,allowShortUrl:t,objectId:r,objectType:o,objectTypeAlias:s,objectTypeMeta:n,sharingData:i,menuItems:l,shareableUrl:c,shareableUrlLocatorParams:u,onClose:d,isDirty:p,asExport:h,publicAPIEnabled:g},m){if(this.isOpen)return void d();let b;document.body.appendChild(this.container);const v=(0,f.toMountPoint)(a().createElement(h?V:W,{shareContext:{objectId:r,objectType:o,objectTypeAlias:s,objectTypeMeta:n,anchorElement:e,publicAPIEnabled:g,allowShortUrl:t,sharingData:i,shareableUrl:c,shareableUrlLocatorParams:u,isDirty:p,shareMenuItems:l,onClose:()=>{d(),b()}}}),m);e.onclick((()=>{b=v(this.container),this.isOpen=!0})())}}var X=r(512),ee=r(721);class Locator{constructor(e,t){(0,d.default)(this,"id",void 0),(0,d.default)(this,"migrations",void 0),(0,d.default)(this,"telemetry",((e,t)=>this.definition.telemetry?this.definition.telemetry(e,t):t)),(0,d.default)(this,"inject",((e,t)=>this.definition.inject?this.definition.inject(e,t):e)),(0,d.default)(this,"extract",(e=>this.definition.extract?this.definition.extract(e):{state:e,references:[]})),(0,d.default)(this,"useUrl",((e,t,r=[])=>u(this,e,t,r))),this.definition=e,this.deps=t,this.id=e.id,this.migrations=e.migrations||{}}async getLocation(e){return await this.definition.getLocation(e)}async getUrl(e,{absolute:t=!1}={}){const r=await this.getLocation(e);return this.deps.getUrl(r,{absolute:t})}getRedirectUrl(e,t={}){var r;const{baseUrl:o="",version:s="0.0.0"}=this.deps,n="/app/r?"+function(e,{lzCompress:t}={}){const r=new URLSearchParams;r.set("l",e.id),r.set("v",e.version);const o=JSON.stringify(e.params);if(t){const e=(0,X.compressToBase64)(o);r.set("lz",e)}else r.set("p",JSON.stringify(e.params));return r}({id:this.definition.id,version:s,params:e},{lzCompress:null===(r=t.lzCompress)||void 0===r||r}).toString();return t.spaceId?function(e="/",t="",r=""){if(r&&!r.startsWith("/"))throw new Error("path must start with a /");e.includes("/s/")&&(e=e.replace(/\/s\/[^/]+/,""));const o=e.endsWith("/")?e.slice(0,-1):e;return t&&"default"!==t?`${o}/s/${t}${r}`:`${o}${r}`||"/"}(o,t.spaceId,n):o+n}async navigate(e,{replace:t=!1}={}){const r=await this.getLocation(e);await this.deps.navigate(r,{replace:t})}navigateSync(e,t={}){this.navigate(e,t).catch((r=>{ee.log(`Failed to navigate [locator = ${this.id}].`,e,t),ee.error(r)}))}}class LocatorClient{constructor(e){(0,d.default)(this,"locators",new Map),(0,d.default)(this,"useUrl",((e,t,r)=>{const{id:o,params:s}=e(),n=this.get(o);return u(n,s,r,t)||void 0})),(0,d.default)(this,"getAllMigrations",(()=>{const e=this.migrations(),t={},r=new Set;for(const t of Object.values(e))for(const e of Object.keys(t))r.add(e);for(const o of r.values()){const r=t=>{const r=e[t.id];if(!r)return t;const s=r[o];return s?{...t,version:o,state:s(t.state)}:t};t[o]=r}return t})),this.deps=e}create(e){const t=new Locator(e,this.deps);return this.locators.set(e.id,t),t}get(e){return this.locators.get(e)}getOrThrow(e){const t=this.locators.get(e);if(!t)throw new Error(`Locator [ID = "${e}"] is not registered.`);return t}migrations(){const e={};for(const t of this.locators.values())e[t.id]="function"==typeof t.migrations?t.migrations():t.migrations;return e}telemetry(e,t){for(const r of this.locators.values())t=r.telemetry(e.state,t);return t}inject(e,t){const r=this.getOrThrow(e.id),o=t.filter((e=>e.name.startsWith("params:"))).map((e=>({...e,name:e.name.substr(7)})));return{...e,state:r.inject(e.state,o)}}extract(e){const t=this.getOrThrow(e.id).extract(e.state);return{state:{...e,state:t.state},references:t.references.map((e=>({...e,name:"params:"+e.name})))}}}class UrlService{constructor(e){(0,d.default)(this,"locators",void 0),(0,d.default)(this,"shortUrls",void 0),this.deps=e,this.locators=new LocatorClient(e),this.shortUrls=e.shortUrls({locators:this.locators})}}var te=r(359);const re=__kbnSharedDeps__.Rxjs,oe=/^\/app\/[^/]+.+$/,se="LEGACY_SHORT_URL_LOCATOR";class LegacyShortUrlLocatorDefinition{constructor(){(0,d.default)(this,"id",se)}async getLocation(e){const{url:t}=e;!function(e){if(!oe.test(e)||e.includes("/../"))throw new Error(`Invalid short URL: ${e}`)}(t);const r=t.match(/^.*\/app\/([^\/#]+)(.+)$/);if(!r)throw new Error("Unexpected URL path.");const[,o,s]=r;if(!o||!s)throw new Error("Could not parse URL path.");return{app:o,path:s,state:{}}}}function ne(e,t){return e.basePath.prepend(t.get("defaultRoute"))}var ae=r(721);class RedirectManager{constructor(e){(0,d.default)(this,"error$",new re.BehaviorSubject(null)),this.deps=e}registerLocatorRedirectApp(e){const{application:t,customBranding:o,http:s,theme:n}=e;t.register({id:"r",title:"Redirect endpoint",visibleIn:[],mount:async t=>{const a=new AbortController;this.onMount(t.history.location,a.signal);const{render:i}=await r.e(697).then(r.bind(r,697)),[l]=await e.getStartServices(),{chrome:c,uiSettings:u,userProfile:d}=l,p=i(t.element,{manager:this,customBranding:o,docTitle:c.docTitle,theme:n,userProfile:d,homeHref:ne(s,u)});return()=>{a.abort(),p()}}})}registerLegacyShortUrlRedirectApp(e){e.application.register({id:"short_url_redirect",appRoute:"/goto",title:"Short URL Redirect",chromeless:!0,mount:async()=>{var t;const o=null===(t=location.pathname.match(new RegExp("/goto/(.*)$")))||void 0===t?void 0:t[1];if(!o)throw new Error("Url id not present in path");const s=this.deps.url,n=s.shortUrls.get(null),a=await n.get(o),i=a.data.locator.id,l=s.locators.get(i);if(!l)throw new Error(`Locator [id = ${i}] not found.`);const c=a.data.locator.state;if(a.data.locator.id!==se)return await l.navigate(c,{replace:!0}),()=>{};let u=c.url;if(e.uiSettings.get("state:storeInSessionStorage")){const{hashUrl:e}=await Promise.resolve().then(r.t.bind(r,215,23));u=e(u)}const d=e.http.basePath.prepend(u);if(!e.http.externalUrl.isInternalUrl(d))throw new Error(`Can not redirect to external URL: ${d}`);return location.href=d,()=>{}}})}onMount(e,t){const r=e.pathname;if(r.startsWith("/s/"))return void this.navigateToShortUrlBySlug(r.substring(3),t);const o=e.search,s=this.parseSearchParams(o);this.navigate(s)}navigateToShortUrlBySlug(e,t){(async()=>{const r=this.deps.url,o=r.shortUrls.get(null),s=await o.resolve(e);if(null!=t&&t.aborted)return;const n=s.data.locator.id,a=r.locators.get(n);if(!a)throw new Error(`Locator "${n}" not found.`);const i=s.data.locator.state;await a.navigate(i,{replace:!0})})().catch((e=>{null!=t&&t.aborted||(this.error$.next(e),ae.error(e))}))}navigate(e){const t=this.deps.url.locators.get(e.id);if(!t){const t=C.i18n.translate("share.urlService.redirect.RedirectManager.locatorNotFound",{defaultMessage:"Locator [ID = {id}] does not exist.",values:{id:e.id},description:"Error displayed to user in redirect endpoint when redirection cannot be performed successfully, because locator does not exist."}),r=new Error(t);throw this.error$.next(r),r}const r="function"==typeof t.migrations?t.migrations():t.migrations,o=(0,te.migrateToLatest)(r,{state:e.params,version:e.version});t.navigate(o,{replace:!0}).then().catch((e=>{ae.log("Redirect endpoint failed to execute locator redirect."),ae.error(e)}))}parseSearchParams(e){try{return function(e){const t=new URLSearchParams(e),r=t.get("l"),o=t.get("v"),s=t.get("lz"),n=s?(0,X.decompressFromBase64)(s):t.get("p");if(!r){const e=C.i18n.translate("share.urlService.redirect.RedirectManager.missingParamLocator",{defaultMessage:'Locator ID not specified. Specify "l" search parameter in the URL, which should be an existing locator ID.',description:"Error displayed to user in redirect endpoint when redirection cannot be performed successfully, because of missing locator ID."});throw new Error(e)}if(!o){const e=C.i18n.translate("share.urlService.redirect.RedirectManager.missingParamVersion",{defaultMessage:'Locator params version not specified. Specify "v" search parameter in the URL, which should be the release version of Kibana when locator params were generated.',description:"Error displayed to user in redirect endpoint when redirection cannot be performed successfully, because of missing version parameter."});throw new Error(e)}if(!n){const e=C.i18n.translate("share.urlService.redirect.RedirectManager.missingParamParams",{defaultMessage:'Locator params not specified. Specify "p" search parameter in the URL, which should be JSON serialized object of locator params.',description:"Error displayed to user in redirect endpoint when redirection cannot be performed successfully, because of missing params parameter."});throw new Error(e)}let a;try{a=JSON.parse(n)}catch{const e=C.i18n.translate("share.urlService.redirect.RedirectManager.invalidParamParams",{defaultMessage:'Could not parse locator params. Locator params must be serialized as JSON and set at "p" URL search parameter.',description:"Error displayed to user in redirect endpoint when redirection cannot be performed successfully, because locator parameters could not be parsed as JSON."});throw new Error(e)}return{id:r,version:o,params:a}}(e)}catch(e){throw this.error$.next(e),e}}}const ie="SHORT_URL_REDIRECT_LOCATOR";class ShortUrlRedirectLocatorDefinition{constructor(){(0,d.default)(this,"id",ie)}async getLocation(e){const{slug:t}=e;return{app:"r",path:"s/"+t,state:{}}}}class BrowserShortUrlClient{constructor(e){this.dependencies=e}async create({locator:e,params:t,slug:r}){const{http:o}=this.dependencies;return{data:await o.fetch("/api/short_url",{method:"POST",body:JSON.stringify({locatorId:e.id,slug:r,params:t})})}}async createWithLocator(e,t){const r=await this.create((e=>{var r;const o=null===(r=e.params)||void 0===r?void 0:r.timeRange;return t&&null!=o&&o.from&&null!=o&&o.to?{...e,params:{...e.params,timeRange:{from:A(o.from),to:A(o.to)}}}:e})(e)),o=this.dependencies.locators.get(ie),s={slug:r.data.slug};return{...r,locator:o,params:s}}async createFromLongUrl(e,t){const r=(0,$.parse)(e);if(!r||!r.path)throw new Error(`Invalid URL: ${e}`);const o=r.path.replace(this.dependencies.http.basePath.get(),"")+(r.hash?r.hash:""),s=this.dependencies.locators.get(se);if(!s)throw new Error(`Locator "${se}" not found`);const n=await this.createWithLocator({locator:s,params:{url:o}},t),a=await n.locator.getUrl(n.params,{absolute:!0});return{...n,url:a}}async get(e){const{http:t}=this.dependencies;return{data:await t.fetch("/api/short_url/"+e,{method:"GET"})}}async resolve(e){const{http:t}=this.dependencies;return{data:await t.fetch("/api/short_url/_slug/"+e,{method:"GET"})}}async delete(e){const{http:t}=this.dependencies;await t.fetch("/api/short_url/"+e,{method:"DELETE"})}}class BrowserShortUrlClientFactory{constructor(e){this.dependencies=e}get(e){return new BrowserShortUrlClient(this.dependencies)}}const le=__kbnSharedDeps__.KbnSharedUxErrorBoundary,ce={setup(e){e.analytics.registerEventType({eventType:le.REACT_FATAL_ERROR_EVENT_TYPE,schema:le.reactFatalErrorSchema})}};class SharePlugin{constructor(e){(0,d.default)(this,"shareRegistry",new ShareRegistry),(0,d.default)(this,"shareContextMenu",new ShareMenuManager),(0,d.default)(this,"redirectManager",void 0),(0,d.default)(this,"url",void 0),(0,d.default)(this,"anonymousAccessServiceProvider",void 0),(0,d.default)(this,"licenseSubscription",void 0),this.initializerContext=e}setup(e){const{analytics:t,http:r}=e,{basePath:o}=r;return this.url=new UrlService({baseUrl:o.get(),version:this.initializerContext.env.packageInfo.version,navigate:async({app:t,path:r,state:o},{replace:s=!1}={})=>{const[n]=await e.getStartServices();await n.application.navigateToApp(t,{path:r,state:o,replace:s})},getUrl:async({app:t,path:r},{absolute:o})=>(await e.getStartServices())[0].application.getUrlForApp(t,{path:r,absolute:o}),shortUrls:({locators:e})=>new BrowserShortUrlClientFactory({http:r,locators:e})}),this.url.locators.create(new LegacyShortUrlLocatorDefinition),this.url.locators.create(new ShortUrlRedirectLocatorDefinition),this.redirectManager=new RedirectManager({url:this.url}),this.redirectManager.registerLocatorRedirectApp(e),this.redirectManager.registerLegacyShortUrlRedirectApp(e),ce.setup({analytics:t}),{...this.shareRegistry.setup(),url:this.url,navigate:e=>this.redirectManager.navigate(e),setAnonymousAccessServiceProvider:e=>{if(this.anonymousAccessServiceProvider)throw new Error("Anonymous Access service provider is already set.");this.anonymousAccessServiceProvider=e}}}start(e,{licensing:t}){var r;const o="serverless"===this.initializerContext.env.packageInfo.buildFlavor;let s;this.licenseSubscription=null==t||null===(r=t.license$)||void 0===r?void 0:r.subscribe((e=>{s=e}));const{resolveShareItemsForShareContext:n,availableIntegrations:a}=this.shareRegistry.start({urlService:this.url,anonymousAccessServiceProvider:()=>this.anonymousAccessServiceProvider(),capabilities:e.application.capabilities,getLicense:()=>s});return{...this.shareContextMenu.start({core:e,isServerless:o,resolveShareItemsForShareContext:n}),url:this.url,navigate:e=>this.redirectManager.navigate(e),availableIntegrations:a}}stop(){var e;null===(e=this.licenseSubscription)||void 0===e||e.unsubscribe()}}var ue=r(854),de=r(488),pe=r.n(de);function he(e,t){return fe({[e]:t})}async function fe(e){const t=Object.keys(e).map(((t,r)=>{const o=e[t],s=o instanceof Blob?o:new Blob([o.content],{type:o.type});return()=>Promise.resolve().then((()=>(0,ue.saveAs)(s,t)))}));await pe()(t,(e=>Promise.all([e(),new Promise((e=>setTimeout(e,50)))])),{concurrency:1})}function ge(e){return new SharePlugin(e)}},719:(e,t,r)=>{"use strict";const o=r(155),s=/\s+at.*(?:\(|\s)(.*)\)?/,n=/^(?:(?:(?:node|(?:internal\/[\w/]*|.*node_modules\/(?:babel-polyfill|pirates)\/.*)?\w+)\.js:\d+:\d+)|native)/,a=void 0===o.homedir?"":o.homedir();e.exports=(e,t)=>(t=Object.assign({pretty:!1},t),e.replace(/\\/g,"/").split("\n").filter((e=>{const t=e.match(s);if(null===t||!t[1])return!0;const r=t[1];return!r.includes(".app/Contents/Resources/electron.asar")&&!r.includes(".app/Contents/Resources/default_app.asar")&&!n.test(r)})).filter((e=>""!==e.trim())).map((e=>t.pretty?e.replace(s,((e,t)=>e.replace(t,t.replace(a,"~")))):e)).join("\n"))},575:e=>{"use strict";e.exports=(e,t=1,r)=>{if(r={indent:" ",includeEmptyLines:!1,...r},"string"!=typeof e)throw new TypeError(`Expected \`input\` to be a \`string\`, got \`${typeof e}\``);if("number"!=typeof t)throw new TypeError(`Expected \`count\` to be a \`number\`, got \`${typeof t}\``);if("string"!=typeof r.indent)throw new TypeError(`Expected \`options.indent\` to be a \`string\`, got \`${typeof r.indent}\``);if(0===t)return e;const o=r.includeEmptyLines?/^/gm:/^(?!\s*$)/gm;return e.replace(o,r.indent.repeat(t))}},512:(e,t,r)=>{var o,s=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function s(e,t){if(!o[e]){o[e]={};for(var r=0;r<e.length;r++)o[e][e.charAt(r)]=r}return o[e][t]}var n={compressToBase64:function(e){if(null==e)return"";var r=n._compress(e,6,(function(e){return t.charAt(e)}));switch(r.length%4){default:case 0:return r;case 1:return r+"===";case 2:return r+"==";case 3:return r+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:n._decompress(e.length,32,(function(r){return s(t,e.charAt(r))}))},compressToUTF16:function(t){return null==t?"":n._compress(t,15,(function(t){return e(t+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:n._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){for(var t=n.compress(e),r=new Uint8Array(2*t.length),o=0,s=t.length;o<s;o++){var a=t.charCodeAt(o);r[2*o]=a>>>8,r[2*o+1]=a%256}return r},decompressFromUint8Array:function(t){if(null==t)return n.decompress(t);for(var r=new Array(t.length/2),o=0,s=r.length;o<s;o++)r[o]=256*t[2*o]+t[2*o+1];var a=[];return r.forEach((function(t){a.push(e(t))})),n.decompress(a.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":n._compress(e,6,(function(e){return r.charAt(e)}))},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),n._decompress(e.length,32,(function(t){return s(r,e.charAt(t))})))},compress:function(t){return n._compress(t,16,(function(t){return e(t)}))},_compress:function(e,t,r){if(null==e)return"";var o,s,n,a={},i={},l="",c="",u="",d=2,p=3,h=2,f=[],g=0,m=0;for(n=0;n<e.length;n+=1)if(l=e.charAt(n),Object.prototype.hasOwnProperty.call(a,l)||(a[l]=p++,i[l]=!0),c=u+l,Object.prototype.hasOwnProperty.call(a,c))u=c;else{if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(o=0;o<h;o++)g<<=1,m==t-1?(m=0,f.push(r(g)),g=0):m++;for(s=u.charCodeAt(0),o=0;o<8;o++)g=g<<1|1&s,m==t-1?(m=0,f.push(r(g)),g=0):m++,s>>=1}else{for(s=1,o=0;o<h;o++)g=g<<1|s,m==t-1?(m=0,f.push(r(g)),g=0):m++,s=0;for(s=u.charCodeAt(0),o=0;o<16;o++)g=g<<1|1&s,m==t-1?(m=0,f.push(r(g)),g=0):m++,s>>=1}0==--d&&(d=Math.pow(2,h),h++),delete i[u]}else for(s=a[u],o=0;o<h;o++)g=g<<1|1&s,m==t-1?(m=0,f.push(r(g)),g=0):m++,s>>=1;0==--d&&(d=Math.pow(2,h),h++),a[c]=p++,u=String(l)}if(""!==u){if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(o=0;o<h;o++)g<<=1,m==t-1?(m=0,f.push(r(g)),g=0):m++;for(s=u.charCodeAt(0),o=0;o<8;o++)g=g<<1|1&s,m==t-1?(m=0,f.push(r(g)),g=0):m++,s>>=1}else{for(s=1,o=0;o<h;o++)g=g<<1|s,m==t-1?(m=0,f.push(r(g)),g=0):m++,s=0;for(s=u.charCodeAt(0),o=0;o<16;o++)g=g<<1|1&s,m==t-1?(m=0,f.push(r(g)),g=0):m++,s>>=1}0==--d&&(d=Math.pow(2,h),h++),delete i[u]}else for(s=a[u],o=0;o<h;o++)g=g<<1|1&s,m==t-1?(m=0,f.push(r(g)),g=0):m++,s>>=1;0==--d&&(d=Math.pow(2,h),h++)}for(s=2,o=0;o<h;o++)g=g<<1|1&s,m==t-1?(m=0,f.push(r(g)),g=0):m++,s>>=1;for(;;){if(g<<=1,m==t-1){f.push(r(g));break}m++}return f.join("")},decompress:function(e){return null==e?"":""==e?null:n._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(t,r,o){var s,n,a,i,l,c,u,d=[],p=4,h=4,f=3,g="",m=[],b={val:o(0),position:r,index:1};for(s=0;s<3;s+=1)d[s]=s;for(a=0,l=Math.pow(2,2),c=1;c!=l;)i=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=o(b.index++)),a|=(i>0?1:0)*c,c<<=1;switch(a){case 0:for(a=0,l=Math.pow(2,8),c=1;c!=l;)i=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=o(b.index++)),a|=(i>0?1:0)*c,c<<=1;u=e(a);break;case 1:for(a=0,l=Math.pow(2,16),c=1;c!=l;)i=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=o(b.index++)),a|=(i>0?1:0)*c,c<<=1;u=e(a);break;case 2:return""}for(d[3]=u,n=u,m.push(u);;){if(b.index>t)return"";for(a=0,l=Math.pow(2,f),c=1;c!=l;)i=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=o(b.index++)),a|=(i>0?1:0)*c,c<<=1;switch(u=a){case 0:for(a=0,l=Math.pow(2,8),c=1;c!=l;)i=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=o(b.index++)),a|=(i>0?1:0)*c,c<<=1;d[h++]=e(a),u=h-1,p--;break;case 1:for(a=0,l=Math.pow(2,16),c=1;c!=l;)i=b.val&b.position,b.position>>=1,0==b.position&&(b.position=r,b.val=o(b.index++)),a|=(i>0?1:0)*c,c<<=1;d[h++]=e(a),u=h-1,p--;break;case 2:return m.join("")}if(0==p&&(p=Math.pow(2,f),f++),d[u])g=d[u];else{if(u!==h)return null;g=n+n.charAt(0)}m.push(g),d[h++]=n+g.charAt(0),n=g,0==--p&&(p=Math.pow(2,f),f++)}}};return n}();void 0===(o=function(){return s}.call(t,r,t,e))||(e.exports=o)},488:(e,t,r)=>{"use strict";const o=r(603);e.exports=async(e,t,{concurrency:r=1/0,stopOnError:s=!0}={})=>new Promise(((n,a)=>{if("function"!=typeof t)throw new TypeError("Mapper function is required");if(!Number.isSafeInteger(r)&&r!==1/0||!(r>=1))throw new TypeError(`Expected \`concurrency\` to be an integer from 1 and up or \`Infinity\`, got \`${r}\` (${typeof r})`);const i=[],l=[],c=e[Symbol.iterator]();let u=!1,d=!1,p=0,h=0;const f=()=>{if(u)return;const e=c.next(),r=h;if(h++,e.done)return d=!0,void(0===p&&(s||0===l.length?n(i):a(new o(l))));p++,(async()=>{try{const o=await e.value;i[r]=await t(o,r),p--,f()}catch(e){s?(u=!0,a(e)):(l.push(e),p--,f())}})()};for(let e=0;e<r&&(f(),!d);e++);}))},727:(e,t,r)=>{r.p=window.__kbnPublicPath__.share},359:(e,t,r)=>{r.r(t);var o=__kbnBundles__.get("plugin/kibanaUtils/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(o))},215:(e,t,r)=>{r.r(t);var o=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(o))},721:(e,t,r)=>{e.exports=r(497)(4971)},185:(e,t,r)=>{e.exports=r(497)(51858)},915:(e,t,r)=>{e.exports=r(497)(67493)},328:(e,t,r)=>{e.exports=r(497)(74867)},319:e=>{"use strict";e.exports=__kbnSharedDeps__.ElasticEui},791:e=>{"use strict";e.exports=__kbnSharedDeps__.EmotionReact},8:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnI18n},999:e=>{"use strict";e.exports=__kbnSharedDeps__.KbnReactKibanaContextTheme},286:e=>{"use strict";e.exports=__kbnSharedDeps__.React},874:e=>{"use strict";e.exports=__kbnSharedDeps__.ReactDom},941:e=>{"use strict";e.exports=__kbnSharedDeps__.TsLib},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__},155:()=>{}},s={};function n(e){var t=s[e];if(void 0!==t)return t.exports;var r=s[e]={exports:{}};return o[e].call(r.exports,r,r.exports,n),r.exports}n.m=o,n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,n.t=function(r,o){if(1&o&&(r=this(r)),8&o)return r;if("object"==typeof r&&r){if(4&o&&r.__esModule)return r;if(16&o&&"function"==typeof r.then)return r}var s=Object.create(null);n.r(s);var a={};e=e||[null,t({}),t([]),t(t)];for(var i=2&o&&r;"object"==typeof i&&!~e.indexOf(i);i=t(i))Object.getOwnPropertyNames(i).forEach((e=>a[e]=()=>r[e]));return a.default=()=>r,n.d(s,a),s},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[])),n.u=e=>"share.chunk."+e+".js",n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},n.l=(e,t,o,s)=>{if(r[e])r[e].push(t);else{var a,i;if(void 0!==o)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var u=l[c];if(u.getAttribute("src")==e){a=u;break}}a||(i=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.src=e),r[e]=[t];var d=(t,o)=>{a.onerror=a.onload=null,clearTimeout(p);var s=r[e];if(delete r[e],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach((e=>e(o))),t)return t(o)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),i&&document.head.appendChild(a)}},n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=r[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{var e={976:0};n.f.j=(t,r)=>{var o=n.o(e,t)?e[t]:void 0;if(0!==o)if(o)r.push(o[2]);else{var s=new Promise(((r,s)=>o=e[t]=[r,s]));r.push(o[2]=s);var a=n.p+n.u(t),i=new Error;n.l(a,(r=>{if(n.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var s=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;i.message="Loading chunk "+t+" failed.\n("+s+": "+a+")",i.name="ChunkLoadError",i.type=s,i.request=a,o[1](i)}}),"chunk-"+t,t)}};var t=(t,r)=>{var o,s,[a,i,l]=r,c=0;if(a.some((t=>0!==e[t]))){for(o in i)n.o(i,o)&&(n.m[o]=i[o]);l&&l(n)}for(t&&t(r);c<a.length;c++)s=a[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0},r=self.share_bundle_jsonpfunction=self.share_bundle_jsonpfunction||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),n(727),__kbnBundles__.define("plugin/share/public",n,893)})();