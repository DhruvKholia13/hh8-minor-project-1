/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */(()=>{var e={787:(e,t,r)=>{"use strict";r.d(t,{Mo:()=>s,Ot:()=>n,QB:()=>c,j:()=>o,s9:()=>i,sr:()=>a});const n={read:"read_stream",manage:"manage_stream"},s={manage:"manage",show:"show"},o={id:"streams:ml-features",description:"Enable ML features for streams",products:[{name:"observability",tier:"complete"}]},i={id:"streams:ai-features",description:"Enable AI features for streams",products:[{name:"observability",tier:"complete"}]},a={id:"streams:significant-events",description:"Enable significant events feature for streams",products:[{name:"observability",tier:"complete"}]},c=[o,i,a]},850:(e,t,r)=>{"use strict";r.r(t),r.d(t,{STREAMS_TIERED_AI_FEATURE:()=>n.s9,STREAMS_TIERED_FEATURES:()=>n.QB,STREAMS_TIERED_ML_FEATURE:()=>n.j,STREAMS_TIERED_SIGNIFICANT_EVENT_FEATURE:()=>n.sr});var n=r(787)},910:(e,t,r)=>{"use strict";r.r(t),r.d(t,{STREAMS_API_PRIVILEGES:()=>f.Ot,STREAMS_UI_PRIVILEGES:()=>f.Mo,plugin:()=>m});var n=r(915);const s=["delete","get","patch","post","put"];const o=__kbnSharedDeps__.Rxjs;class ParseError extends Error{constructor(e,t){super(e),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}}function i(e){}const a=__kbnSharedDeps__.KbnI18n;let c=function(e){return e.error="error",e.data="data",e}({}),l=function(e){return e.internalError="internalError",e.requestError="requestError",e}({});class ServerSentEventError extends Error{constructor(e,t,r){super(t),this.code=e,this.meta=r}get status(){if("object"==typeof this.meta&&this.meta.status)return this.meta.status}toJSON(){return{type:c.error,error:{code:this.code,message:this.message,meta:this.meta}}}}function u(e=a.i18n.translate("sse.internalError",{defaultMessage:"An internal error occurred"})){return new ServerSentEventError(l.internalError,e,{})}function d(){return(0,o.switchMap)((e=>function(e){const t=e.response,r=null==t?void 0:t.body;return r?new o.Observable((e=>{const t=function(e){if("function"==typeof e)throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:t=i,onError:r=i,onRetry:n=i,onComment:s}=e;let o,a="",c=!0,l="",u="";function d(e){if(""===e)return l.length>0&&t({id:o,event:u||void 0,data:l.endsWith("\n")?l.slice(0,-1):l}),o=void 0,l="",void(u="");if(e.startsWith(":"))return void(s&&s(e.slice(e.startsWith(": ")?2:1)));const r=e.indexOf(":");if(-1===r)p(e,"",e);else{const t=e.slice(0,r),n=" "===e[r+1]?2:1;p(t,e.slice(r+n),e)}}function p(e,t,s){switch(e){case"event":u=t;break;case"data":l=`${l}${t}\n`;break;case"id":o=t.includes("\0")?void 0:t;break;case"retry":/^\d+$/.test(t)?n(parseInt(t,10)):r(new ParseError(`Invalid \`retry\` value: "${t}"`,{type:"invalid-retry",value:t,line:s}));break;default:r(new ParseError(`Unknown field "${e.length>20?`${e.slice(0,20)}â€¦`:e}"`,{type:"unknown-field",field:e,value:t,line:s}))}}return{feed:function(e){const t=c?e.replace(/^\xEF\xBB\xBF/,""):e,[r,n]=function(e){const t=[];let r="",n=0;for(;n<e.length;){const s=e.indexOf("\r",n),o=e.indexOf("\n",n);let i=-1;if(-1!==s&&-1!==o?i=Math.min(s,o):-1!==s?i=s===e.length-1?-1:s:-1!==o&&(i=o),-1===i){r=e.slice(n);break}{const r=e.slice(n,i);t.push(r),n=i+1,"\r"===e[n-1]&&"\n"===e[n]&&n++}}return[t,r]}(`${a}${t}`);for(const e of r)d(e);a=n,c=!1},reset:function(e={}){a&&e.consume&&d(a),c=!0,o=void 0,l="",u="",a=""}}}({onEvent:t=>{try{const r=JSON.parse(t.data);if("error"===t.event){const t=r;e.error(new ServerSentEventError(t.error.code,t.error.message,t.error.meta))}else e.next({type:t.event||"event",...r})}catch(t){e.error(u("Failed to parse JSON"))}}});(async()=>{const e=r.getReader(),n=new TextDecoder,s=({done:r,value:o})=>r?Promise.resolve():(t.feed(n.decode(o,{stream:!0})),e.read().then(s));return e.read().then(s)})().then((()=>{e.complete()})).catch((t=>{e.error(t)}))})):(0,o.throwError)((()=>{throw u("No readable stream found in response")}))}(e)))}const p=__kbnSharedDeps__.Lodash;class Plugin{constructor(e){(0,n.default)(this,"config",void 0),(0,n.default)(this,"logger",void 0),(0,n.default)(this,"repositoryClient",void 0),(0,n.default)(this,"isServerless",void 0),(0,n.default)(this,"wiredStatusSubject",new o.BehaviorSubject(h)),this.config=e.config.get(),this.isServerless="serverless"===e.env.packageInfo.buildFlavor,this.logger=e.logger.get()}setup(e,t){return this.repositoryClient=function(e){const t=(t,r,n)=>{const{method:o,pathname:i,version:a}=function(e,t={}){var r,n,o;const{method:i,pathname:a,version:c}=function(e){var t;const r=e.split(" "),n=r[0].trim().toLowerCase(),o=r[1].trim(),i=null===(t=r[2])||void 0===t?void 0:t.trim();if(!s.includes(n))throw new Error(`Endpoint ${e} was not prefixed with a valid HTTP method`);return{method:n,pathname:o,version:i}}(e),l=/(\/\{\w+\?\})/g,u=/(\/{)((.+?))(\})/g;if(0===(null===(r=Object.keys(t))||void 0===r?void 0:r.length))return{method:i,pathname:a.replace(u,""),version:c};const d=Object.keys(t).reduce(((e,r)=>e.replace(`{${r}}`,encodeURIComponent(t[r])).replace(`{${r}?}`,encodeURIComponent(t[r]))),a);if((null===(n=null!==(o=d.match(l))&&void 0!==o?o:[])||void 0===n?void 0:n.length)>0)throw new Error(`Missing parameters: ${d.match(l)}`);return{method:i,pathname:d,version:c}}(t,null==r?void 0:r.path);return e.http.fetch(i,{method:o.toUpperCase(),...n,body:r&&r.body?JSON.stringify(r.body):void 0,query:null==r?void 0:r.query,version:a})};return{fetch:(e,...r)=>{var n;const s=null!==(n=r[0])&&void 0!==n?n:{},o="params"in s?s.params:{},i=(0,p.omit)(s,"params");return t(e,o,i)},stream:(e,...r)=>{var n;const s=null!==(n=r[0])&&void 0!==n?n:{},i="params"in s?s.params:{},a=(0,p.omit)(s,"params");return(0,o.from)(t(e,i,{...a,asResponse:!0,rawResponse:!0})).pipe(d())}}}(e),{}}start(e,t){return this.refreshWiredStatus(),{streamsRepositoryClient:this.repositoryClient,navigationStatus$:v(t,e.application,this.isServerless),wiredStatus$:this.wiredStatusSubject.asObservable(),enableWiredMode:async e=>{const t=await this.repositoryClient.fetch("POST /api/streams/_enable 2023-10-31",{signal:e});return this.wiredStatusSubject.next({...this.wiredStatusSubject.value,enabled:!0}),t},disableWiredMode:async e=>{const t=await this.repositoryClient.fetch("POST /api/streams/_disable 2023-10-31",{signal:e});return this.wiredStatusSubject.next({...this.wiredStatusSubject.value,enabled:!1}),t},config$:(0,o.of)(this.config)}}async refreshWiredStatus(){try{const e=await this.repositoryClient.fetch("GET /api/streams/_status",{signal:(new AbortController).signal});this.wiredStatusSubject.next(e)}catch(e){this.logger.error(e),this.wiredStatusSubject.next(h)}}stop(){}}const h={enabled:"unknown",can_manage:!1},v=(0,p.once)(((e,t,r)=>{var n,s,i,a,c;const l=null===(n=t.capabilities)||void 0===n||null===(s=n.streams)||void 0===s?void 0:s.show,u="observability"===(null===(i=e.cloud)||void 0===i?void 0:i.serverless.projectType),d="security"===(null===(a=e.cloud)||void 0===a?void 0:a.serverless.projectType);return l?r?(0,o.of)({status:u||d?"enabled":"disabled"}):null!==(c=e.spaces)&&void 0!==c&&c.getActiveSpace?(0,o.from)(e.spaces.getActiveSpace()).pipe((0,o.map)((e=>{const t=null==e?void 0:e.solution;return{status:t&&"classic"!==t&&"oblt"!==t&&"security"!==t?"disabled":"enabled"}})),(0,o.catchError)((()=>(0,o.of)({status:"enabled"})))):(0,o.of)({status:"enabled"}):(0,o.of)({status:"disabled"})}));var f=r(787);const m=e=>new Plugin(e)},194:(e,t,r)=>{r.p=window.__kbnPublicPath__.streams},915:(e,t,r)=>{e.exports=r(497)(67493)},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var s=n.length-1;s>-1&&(!e||!/^http(s?):/.test(e));)e=n[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),r(194),__kbnBundles__.define("plugin/streams/public",r,910),__kbnBundles__.define("plugin/streams/common",r,850)})();