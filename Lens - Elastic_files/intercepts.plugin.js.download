/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */(()=>{var t={119:(t,e,r)=>{"use strict";r.r(e),r.d(e,{plugin:()=>S});var i=r(915);const n=__kbnSharedDeps__.Rxjs,s=__kbnSharedDeps__.ElasticApmRumCore;var o=function(){function t(t,e){this._disable=e,this.serviceFactory=t,this._initialized=!1}var e=t.prototype;return e.isEnabled=function(){return!this._disable},e.isActive=function(){var t=this.serviceFactory.getService(s.CONFIG_SERVICE);return this.isEnabled()&&this._initialized&&t.get("active")},e.init=function(t){var e=this;if(this.isEnabled()&&!this._initialized){this._initialized=!0;var r=this.serviceFactory.getService([s.CONFIG_SERVICE,s.LOGGING_SERVICE,s.TRANSACTION_SERVICE]),i=r[0],n=r[1],o=r[2];i.setVersion("5.17.0"),this.config(t);var a=i.get("logLevel");if(n.setLevel(a),i.get("active")){this.serviceFactory.init();var c=(0,s.getInstrumentationFlags)(i.get("instrument"),i.get("disableInstrumentations"));if(this.serviceFactory.getService(s.PERFORMANCE_MONITORING).init(c),c[s.ERROR]&&this.serviceFactory.getService(s.ERROR_LOGGING).registerListeners(),i.get("session")){var l=i.getLocalConfig();l&&l.session&&i.setConfig({session:l.session})}var p=function(){return c[s.PAGE_LOAD]&&e._sendPageLoadMetrics()};i.get("centralConfig")?this.fetchCentralConfig().then(p):p(),(0,s.observePageVisibility)(i,o),c[s.EVENT_TARGET]&&c[s.CLICK]&&(0,s.observePageClicks)(o),(0,s.observeUserInteractions)()}else this._disable=!0,n.warn("RUM agent is inactive")}return this},e.fetchCentralConfig=function(){var t=this.serviceFactory.getService([s.APM_SERVER,s.LOGGING_SERVICE,s.CONFIG_SERVICE]),e=t[0],r=t[1],i=t[2];return e.fetchConfig(i.get("serviceName"),i.get("environment")).then((function(t){var e=t.transaction_sample_rate;if(e){var n={transactionSampleRate:e=Number(e)},s=i.validate(n).invalid;if(0===s.length)i.setConfig(n);else{var o=s[0],a=o.key,c=o.value,l=o.allowed;r.warn('invalid value "'+c+'" for '+a+". Allowed: "+l+".")}}return t})).catch((function(t){r.warn("failed fetching config:",t)}))},e._sendPageLoadMetrics=function(){var t=this.startTransaction(void 0,s.PAGE_LOAD,{managed:!0,canReuse:!0});if(t){t.addTask(s.PAGE_LOAD);var e=function(){setTimeout((function(){return t.removeTask(s.PAGE_LOAD)}),s.PAGE_LOAD_DELAY)};"complete"===document.readyState?e():window.addEventListener("load",e)}},e.observe=function(t,e){this.serviceFactory.getService(s.CONFIG_SERVICE).events.observe(t,e)},e.config=function(t){var e=this.serviceFactory.getService([s.CONFIG_SERVICE,s.LOGGING_SERVICE]),r=e[0],i=e[1],n=r.validate(t),o=n.missing,a=n.invalid,c=n.unknown;if(c.length>0){var l="Unknown config options are specified for RUM agent: "+c.join(", ");i.warn(l)}if(0===o.length&&0===a.length)r.setConfig(t);else{var p=", ",u="RUM agent isn't correctly configured. ";o.length>0&&(u+=o.join(p)+" is missing",a.length>0&&(u+=p)),a.forEach((function(t,e){var r=t.key,i=t.value,n=t.allowed;u+=r+' "'+i+'" contains invalid characters! (allowed: '+n+")"+(e!==a.length-1?p:"")})),i.error(u),r.setConfig({active:!1})}},e.setUserContext=function(t){this.serviceFactory.getService(s.CONFIG_SERVICE).setUserContext(t)},e.setCustomContext=function(t){this.serviceFactory.getService(s.CONFIG_SERVICE).setCustomContext(t)},e.addLabels=function(t){this.serviceFactory.getService(s.CONFIG_SERVICE).addLabels(t)},e.setInitialPageLoadName=function(t){this.serviceFactory.getService(s.CONFIG_SERVICE).setConfig({pageLoadTransactionName:t})},e.startTransaction=function(t,e,r){if(this.isEnabled())return this.serviceFactory.getService(s.TRANSACTION_SERVICE).startTransaction(t,e,r)},e.startSpan=function(t,e,r){if(this.isEnabled())return this.serviceFactory.getService(s.TRANSACTION_SERVICE).startSpan(t,e,r)},e.getCurrentTransaction=function(){if(this.isEnabled())return this.serviceFactory.getService(s.TRANSACTION_SERVICE).getCurrentTransaction()},e.captureError=function(t,e){if(this.isEnabled())return this.serviceFactory.getService(s.ERROR_LOGGING).logError(t,e)},e.addFilter=function(t){this.serviceFactory.getService(s.CONFIG_SERVICE).addFilter(t)},t}(),a=function(){if(s.isBrowser&&window.elasticApm)return window.elasticApm;var t=(0,s.bootstrap)(),e=(0,s.createServiceFactory)(),r=new o(e,!t);return s.isBrowser&&(window.elasticApm=r),r}();a.init.bind(a);const c=__kbnSharedDeps__.React;var l=r.n(c);const p=__kbnSharedDeps__.ReactDom;let u=function(t){return t.INTERCEPT_TERMINATION_INTERACTION="intercept_termination_interaction",t.INTERCEPT_REGISTRATION="intercept_registration",t.INTERCEPT_OVERLOAD="intercept_overload",t}({}),d=function(t){return t.INTERACTION_TYPE="interaction_type",t.INTERCEPT_ID="intercept_id",t.INTERACTION_DURATION="interaction_duration",t}({});const I={[d.INTERACTION_TYPE]:{[d.INTERACTION_TYPE]:{type:"keyword",_meta:{description:"The type of interaction that occurred with the intercept",optional:!1}}},[d.INTERCEPT_ID]:{[d.INTERCEPT_ID]:{type:"keyword",_meta:{description:"ID of the intercept",optional:!1}}},[d.INTERACTION_DURATION]:{[d.INTERACTION_DURATION]:{type:"long",_meta:{description:"Duration of the interaction in milliseconds",optional:!1}}}},g=[{eventType:u.INTERCEPT_TERMINATION_INTERACTION,schema:{...I[d.INTERACTION_TYPE],...I[d.INTERCEPT_ID],...I[d.INTERACTION_DURATION]}},{eventType:u.INTERCEPT_REGISTRATION,schema:{...I[d.INTERCEPT_ID]}},{eventType:u.INTERCEPT_OVERLOAD,schema:{...I[d.INTERCEPT_ID]}}];class InterceptTelemetry{constructor(){(0,i.default)(this,"reportEvent",void 0)}setup({analytics:t}){return g.forEach((e=>{t.registerEventType(e)})),{}}start({analytics:t}){return this.reportEvent=t.reportEvent,{reportInterceptRegistration:this.reportInterceptRegistration.bind(this),reportInterceptOverload:this.reportInterceptOverload.bind(this),reportInterceptInteraction:this.reportInterceptInteraction.bind(this)}}reportInterceptRegistration({interceptId:t}){var e;null===(e=this.reportEvent)||void 0===e||e.call(this,u.INTERCEPT_REGISTRATION,{[d.INTERCEPT_ID]:t})}reportInterceptOverload({interceptId:t}){var e;null===(e=this.reportEvent)||void 0===e||e.call(this,u.INTERCEPT_OVERLOAD,{[d.INTERCEPT_ID]:t})}reportInterceptInteraction({interactionDuration:t,interactionType:e,interceptId:r}){var i;null===(i=this.reportEvent)||void 0===i||i.call(this,u.INTERCEPT_TERMINATION_INTERACTION,{[d.INTERACTION_TYPE]:e,[d.INTERCEPT_ID]:r,[d.INTERACTION_DURATION]:t})}}class InterceptDialogApi{constructor(){(0,i.default)(this,"telemetry",new InterceptTelemetry),(0,i.default)(this,"productIntercepts$",new n.BehaviorSubject([])),(0,i.default)(this,"eventReporter",void 0)}setup({analytics:t}){return this.telemetry.setup({analytics:t}),{}}start({analytics:t}){return this.eventReporter=this.telemetry.start({analytics:t}),{add:this.add.bind(this),ack:this.ack.bind(this),get$:this.get$.bind(this)}}get$(){return this.productIntercepts$.asObservable()}add(t){const e=this.productIntercepts$.getValue();var r,i;return e.some((e=>e.id===t.id))?null===(r=this.eventReporter)||void 0===r||r.reportInterceptOverload({interceptId:t.id}):(this.productIntercepts$.next([t,...e]),null===(i=this.eventReporter)||void 0===i||i.reportInterceptRegistration({interceptId:t.id})),t.id}ack({interactionDuration:t,interceptId:e,ackType:r}){var i;this.productIntercepts$.next(this.productIntercepts$.getValue().filter((t=>t.id!==e))),null===(i=this.eventReporter)||void 0===i||i.reportInterceptInteraction({interactionType:r,interactionDuration:t,interceptId:e})}}const h=__kbnSharedDeps__.KbnI18n,E=__kbnSharedDeps__.EmotionReact,m=__kbnSharedDeps__.ElasticEui;var v={name:"19irgwh",styles:"min-height:112px;position:relative"};const f=l().memo((({stepsTotal:t,currentStep:e})=>t?(0,E.jsx)(m.EuiFlexItem,{grow:!1},(0,E.jsx)("ul",{className:"euiTourFooter__stepList"},[...Array(t).keys()].map(((t,r)=>{let i="complete";return e===r?i="active":e<=r&&(i="incomplete"),(0,E.jsx)(m.EuiTourStepIndicator,{key:r,number:r+1,status:i})})))):null));function T({ackIntercept:t,intercept$:e,staticAssetsHelper:r}){const{euiTheme:i}=(0,m.useEuiTheme)(),[n,s]=(0,c.useState)(0),[o,a]=(0,c.useState)(null),p=(0,c.useRef)({}),u=(0,c.useRef)(),d=(0,c.useMemo)((()=>((t,e)=>({wrapper:(0,E.css)("position:fixed;inline-size:400px;max-block-size:auto;z-index:",t.levels.toast,";inset-inline-end:",t.size.l,";inset-block-end:",t.size.xxl,";",m.euiCanAnimate,"{animation:",m.euiFlyoutSlideInRight," ",t.animation.normal," ",t.animation.resistance,";}",""),stepContentBox:v,startIllustration:(0,E.css)("background:var(\n      --intercept-background,\n      url(",e.getPluginAssetHref("communication.svg"),")\n    );background-size:",89,"px 64px;background-repeat:no-repeat;background-position:top ",t.size.base," right ",t.size.base,";",""),startContentBox:(0,E.css)({width:`calc(100% - 89px - ${t.size.base})`},"",""),stepFooterBox:(0,E.css)("border-top:",t.border.thin,";","")}))(i,r)),[i,r]);(0,c.useEffect)((()=>{const t=e.subscribe((t=>{a(t),s(0),p.current={},u.current=performance.mark(`intercept-${t.id}-RenderMark`)}));return()=>{t.unsubscribe()}}),[e]);const I=(0,c.useCallback)((e=>{if(!o)return null;switch(a(null),s(0),p.current={},e){case"dismissed":var r;null===(r=o.onDismiss)||void 0===r||r.call(o,{runId:o.runId,stepId:o.steps[0].id});break;case"completed":var i;null===(i=o.onFinish)||void 0===i||i.call(o,{response:p.current,runId:o.runId});break;default:throw new Error(`Invalid termination type: ${e}`)}t({runId:o.runId,interceptId:o.id,ackType:e,interactionDuration:performance.measure("interceptCompleteMark",{start:u.current.startTime,end:performance.now()}).duration})}),[t,o]),g=(0,c.useCallback)((t=>{if(t)return I("completed");s((t=>Math.min(t+1,o.steps.length)))}),[I,o]),T=(0,c.useCallback)((()=>I("dismissed")),[I]),R=(0,c.useCallback)((function(t){var e,r;p.current[this.id]=t,null===(e=(r=o).onProgress)||void 0===e||e.call(r,{stepId:this.id,stepResponse:t,runId:o.runId}),g()}),[o,g]),_=(0,c.useMemo)((()=>{var t;return null==o||null===(t=o.steps)||void 0===t?void 0:t[null!=n?n:0]}),[o,n]),C=(0,c.useMemo)((()=>!!o&&n===o.steps.length-1),[o,n]),S=0===n;return(0,E.jsx)(l().Fragment,null,o&&_?(0,E.jsx)(m.EuiPortal,null,(0,E.jsx)(m.EuiSplitPanel.Outer,{grow:!0,role:"dialog",css:d.wrapper,"data-test-subj":`intercept-${o.id}`},(0,E.jsx)(m.EuiSplitPanel.Inner,{css:(0,E.css)([d.stepContentBox,S&&d.startIllustration],"",""),"data-test-subj":`interceptStep-${_.id}`},(0,E.jsx)(m.EuiFlexGroup,{gutterSize:"s",direction:"column",css:(0,E.css)({...S?d.startContentBox:{}},"","")},(0,E.jsx)(m.EuiFlexItem,null,(0,E.jsx)(m.EuiFlexGroup,null,(0,E.jsx)(m.EuiFlexItem,null,(0,E.jsx)(m.EuiTitle,{size:"xs"},(0,E.jsx)("h2",null,_.title))),n>0&&!C&&(0,E.jsx)(m.EuiFlexItem,{grow:!1},(0,E.jsx)(m.EuiButtonIcon,{iconType:"cross","aria-label":"Close dialog",onClick:T,color:"text"})))),(0,E.jsx)(m.EuiFlexItem,null,(0,E.jsx)(m.EuiForm,{fullWidth:!0},l().createElement(_.content,{onValue:R.bind(_)}))))),(0,E.jsx)(m.EuiSplitPanel.Inner,{grow:!1,color:"subdued",css:d.stepFooterBox},(0,E.jsx)(m.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},(0,E.jsx)(m.EuiFlexItem,{grow:!1},(0,E.jsx)(f,{stepsTotal:o.steps.length,currentStep:n})),(S||C)&&(0,E.jsx)(m.EuiFlexItem,{grow:!1},(0,E.jsx)(m.EuiFlexGroup,{gutterSize:"xs"},S&&(0,E.jsx)(m.EuiFlexItem,null,(0,E.jsx)(m.EuiButtonEmpty,{size:"s","data-test-subj":"productInterceptDismissButton",onClick:T,color:"text"},h.i18n.translate("core.notifications.productIntercept.dismiss",{defaultMessage:"Not now"}))),(0,E.jsx)(m.EuiFlexItem,null,(0,E.jsx)(m.EuiButton,{size:"s","data-test-subj":"productInterceptProgressionButton",onClick:()=>g(C)},C?h.i18n.translate("core.notifications.productIntercept.nextStep",{defaultMessage:"Close"}):h.i18n.translate("core.notifications.productIntercept.nextStep",{defaultMessage:"Next"}))))))))):null)}const R=l().memo(T);class InterceptDialogService{constructor(){(0,i.default)(this,"api",new InterceptDialogApi),(0,i.default)(this,"targetDomElement",void 0),(0,i.default)(this,"notificationsCoordinator",void 0),(0,i.default)(this,"interceptsStream$",void 0)}setup({analytics:t,notifications:e}){return this.api.setup({analytics:t}),this.notificationsCoordinator=e.coordinator(InterceptDialogService.name),{}}start({targetDomElement:t,rendering:e,analytics:r,staticAssetsHelper:i,persistInterceptRunId:s,resetInterceptTimingRecord:o}){const{ack:a,add:c,get$:l}=this.api.start({analytics:r});if(this.targetDomElement=t,!this.notificationsCoordinator)throw new Error("Notifications coordinator is not initialized");return this.interceptsStream$=this.notificationsCoordinator.optInToCoordination(l(),(({locked:t})=>!t)).pipe(n.scan(((t,e)=>{const r=t.map((t=>t.id));return e.filter((t=>!r.includes(t.id)))}),[]),n.filter((t=>Boolean(t.length))),n.concatMap((t=>n.from(t).pipe(n.concatMap((t=>this.notificationsCoordinator.lock$.pipe(n.filter((t=>!t.locked||t.controller===InterceptDialogService.name)),n.take(1),n.tap((t=>{t.locked||this.notificationsCoordinator.acquireLock()})),n.map((()=>t))))))))),(0,p.render)(e.addContext((0,E.jsx)(R,{intercept$:this.interceptsStream$,ackIntercept:(...t)=>{var e;const[{runId:r,...i}]=t;a(i),o(i.interceptId),s(i.interceptId,r),null===(e=this.notificationsCoordinator)||void 0===e||e.releaseLock()},staticAssetsHelper:i})),this.targetDomElement),{add:c}}stop(){this.targetDomElement&&(0,p.unmountComponentAtNode)(this.targetDomElement)}}const _="/internal/api/intercepts/user_interaction/{triggerId}",C="intercepts.prompter.clientCache";class UserInterceptRunPersistenceService{start(t){return{getUserTriggerData$:this.userInterceptRunId.bind(this,t),updateUserTriggerData:this.persistInterceptRunInteraction.bind(this,t)}}userInterceptRunId(t,e){return n.from(t.get(_.replace("{triggerId}",e))).pipe(n.catchError((t=>(a.captureError(t,{labels:{triggerId:e,errorContext:"userInterceptRunId"}}),n.of({lastInteractedInterceptId:null})))))}persistInterceptRunInteraction(t,e,r){return n.from(t.post(_.replace("{triggerId}",e),{body:JSON.stringify({lastInteractedInterceptId:r})})).pipe(n.catchError((t=>(a.captureError(t,{labels:{triggerId:e,runId:String(r),errorContext:"persistInterceptRunInteraction"}}),n.EMPTY))))}}class InterceptPrompter{constructor(){(0,i.default)(this,"userInterceptRunPersistenceService",new UserInterceptRunPersistenceService),(0,i.default)(this,"interceptDialogService",new InterceptDialogService),(0,i.default)(this,"queueIntercept",void 0),(0,i.default)(this,"pageHidden$",void 0),(0,i.default)(this,"interceptTimerRegistry",new Proxy({},{get:(t,e)=>{if("symbol"!=typeof e)return JSON.parse(localStorage.getItem(C)||"{}")[e]},set:(t,e,r)=>{if("symbol"==typeof e)return!1;const i=JSON.parse(localStorage.getItem(C)||"{}");return i[e]=r,localStorage.setItem(C,JSON.stringify(i)),!0},deleteProperty:(t,e)=>{if("symbol"==typeof e)return!1;const r=JSON.parse(localStorage.getItem(C)||"{}");return delete r[e],localStorage.setItem(C,JSON.stringify(r)),!0}}))}setup({analytics:t,notifications:e}){return this.interceptDialogService.setup({analytics:t,notifications:e}),{}}start({http:t,...e}){const{getUserTriggerData$:r,updateUserTriggerData:i}=this.userInterceptRunPersistenceService.start(t);return({add:this.queueIntercept}=this.interceptDialogService.start({...e,persistInterceptRunId:i,staticAssetsHelper:t.staticAssets,resetInterceptTimingRecord:this.clearInterceptTimerStartRecord.bind(this)})),this.pageHidden$=n.fromEvent(document,"visibilitychange").pipe(n.map((()=>document.hidden)),n.startWith(document.hidden)),{registerIntercept:this.registerIntercept.bind(this,t,r)}}registerIntercept(t,e,r){return n.from(t.post("/internal/api/intercepts/trigger_info",{body:JSON.stringify({triggerId:r.id})})).pipe(n.filter((t=>!!t))).pipe(n.combineLatestWith(e(r.id)),n.switchMap((([t,i])=>{if(!t.recurrent&&i&&i.lastInteractedInterceptId)return n.EMPTY;let s;return this.pageHidden$.pipe(n.switchMap((i=>{if(i)return n.EMPTY;const o=this.calculateTimeTillTrigger(t.registeredAt,t.triggerIntervalInMs);return s=o.nextRunId,Date.now()-this.interceptTimerStartRecord(r.id).getTime()>=t.triggerIntervalInMs?e(r.id):n.EMPTY}))).pipe(n.tap((async t=>{if(s!==t.lastInteractedInterceptId)try{var e;const t=await r.config();null===(e=this.queueIntercept)||void 0===e||e.call(this,{id:r.id,runId:s,...t}),s++}catch(t){a.captureError(t,{labels:{interceptId:r.id}})}})),n.catchError((t=>(a.captureError(t,{labels:{interceptId:r.id,errorContext:"registerIntercept"}}),n.EMPTY))))})))}calculateTimeTillTrigger(t,e){const r=Date.now()-Date.parse(t),i=Math.floor(r/e),n=i+1,s=n*e-r;return{runs:i,shouldTriggerImmediately:s<=0,timeTillNextRun:s,nextRunId:n}}markInterceptTimerStart(t){this.interceptTimerRegistry[t]={timerStart:new Date}}interceptTimerStartRecord(t){return this.interceptTimerRegistry[t]||this.markInterceptTimerStart(t),new Date(this.interceptTimerRegistry[t].timerStart)}clearInterceptTimerStartRecord(t){delete this.interceptTimerRegistry[t]}}class InterceptPublicPlugin{constructor(t){(0,i.default)(this,"prompter",void 0),(0,i.default)(this,"interceptsTargetDomElement",void 0);const{enabled:e}=t.config.get();e&&(this.prompter=new InterceptPrompter)}setup(t){var e;return null===(e=this.prompter)||void 0===e||e.setup({analytics:t.analytics,notifications:t.notifications}),{}}start(t){var e;this.interceptsTargetDomElement=document.createElement("div");const r=null===(e=this.prompter)||void 0===e?void 0:e.start({http:t.http,analytics:t.analytics,rendering:t.rendering,targetDomElement:this.interceptsTargetDomElement});return{registerIntercept:null==r?void 0:r.registerIntercept.bind(r)}}stop(){var t;null===(t=this.interceptsTargetDomElement)||void 0===t||t.remove()}}function S(t){return new InterceptPublicPlugin(t)}},392:(t,e,r)=>{r.p=window.__kbnPublicPath__.intercepts},915:(t,e,r)=>{t.exports=r(497)(67493)},497:t=>{"use strict";t.exports=__kbnSharedDeps_npm__}},e={};function r(i){var n=e[i];if(void 0!==n)return n.exports;var s=e[i]={exports:{}};return t[i](s,s.exports,r),s.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;r.g.importScripts&&(t=r.g.location+"");var e=r.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=i[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=t})(),r(392),__kbnBundles__.define("plugin/intercepts/public",r,119)})();