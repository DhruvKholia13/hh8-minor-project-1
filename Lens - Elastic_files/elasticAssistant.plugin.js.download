/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */(()=>{var e={134:(e,t,s)=>{"use strict";s.r(t),s.d(t,{plugin:()=>Su});var n=s(915);const a=__kbnSharedDeps__.ReactDom;var i=s.n(a),o=s(286),r=s.n(o);const l=__kbnSharedDeps__.KbnI18nReact,d=__kbnSharedDeps__.StyledComponents;var c=s.n(d);const u=__kbnSharedDeps__.ElasticEui,p=__kbnSharedDeps__.ReactUse.useEvent;var m=s.n(p);const g=__kbnSharedDeps__.EmotionReact,h=__kbnSharedDeps__.LodashFp,v=__kbnSharedDeps__.ReactUse.useLocalStorage;var f=s.n(v);const y=__kbnSharedDeps__.ReactUse.useSessionStorage;var x=s.n(y);const b=Object.freeze({assistantModelEvaluation:!1,defendInsightsPolicyResponseFailure:!0}),C=__kbnSharedDeps__.ReactQuery,k=__kbnSharedDeps__.Uuid,S=__kbnSharedDeps__.KbnI18n,E=S.i18n.translate("xpack.elasticAssistant.assistant.defaultAssistantTitle",{defaultMessage:"Elastic AI Assistant"}),w=S.i18n.translate("xpack.elasticAssistant.assistant.submitMessage",{defaultMessage:"Submit message"}),A=S.i18n.translate("xpack.elasticAssistant.assistant.apiErrorTitle",{defaultMessage:"An error occurred sending your message."}),j=(S.i18n.translate("xpack.elasticAssistant.documentationLinks.documentation",{defaultMessage:"documentation"}),S.i18n.translate("xpack.elasticAssistant.assistant.emptyScreen.title",{defaultMessage:"How I can help you?"})),_=S.i18n.translate("xpack.elasticAssistant.assistant.emptyScreen.descriptionV2",{defaultMessage:"Ask me anything in the chat box, or choose one of the prompts below to jump right in."}),P=S.i18n.translate("xpack.elasticAssistant.assistant.welcomeScreen.title",{defaultMessage:"Welcome to Security AI Assistant!"}),T=S.i18n.translate("xpack.elasticAssistant.assistant.welcomeScreen.description",{defaultMessage:"First things first, we'll need to set up a Generative AI Connector to get this chat experience going!"}),I=S.i18n.translate("xpack.elasticAssistant.assistant.disclaimer",{defaultMessage:"Responses from Al systems may not always be entirely accurate, although they can seem convincing. For more information on the assistant feature and its usage, please reference the documentation."}),M="elasticAssistantDefault",z="sharedConversationCallout",F={latestAlerts:100};var O,R;!function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const s of e)t[s]=s;return t},e.getValidEnumValues=t=>{const s=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),n={};for(const e of s)n[e]=t[e];return e.objectValues(n)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.push(s);return t},e.find=(e,t)=>{for(const s of e)if(t(s))return s},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(O||(O={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(R||(R={}));const L=O.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),D=e=>{switch(typeof e){case"undefined":return L.undefined;case"string":return L.string;case"number":return Number.isNaN(e)?L.nan:L.number;case"boolean":return L.boolean;case"function":return L.function;case"bigint":return L.bigint;case"symbol":return L.symbol;case"object":return Array.isArray(e)?L.array:null===e?L.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?L.promise:"undefined"!=typeof Map&&e instanceof Map?L.map:"undefined"!=typeof Set&&e instanceof Set?L.set:"undefined"!=typeof Date&&e instanceof Date?L.date:L.object;default:return L.unknown}},N=O.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class ZodError extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},s={_errors:[]},n=e=>{for(const a of e.issues)if("invalid_union"===a.code)a.unionErrors.map(n);else if("invalid_return_type"===a.code)n(a.returnTypeError);else if("invalid_arguments"===a.code)n(a.argumentsError);else if(0===a.path.length)s._errors.push(t(a));else{let e=s,n=0;for(;n<a.path.length;){const s=a.path[n];n===a.path.length-1?(e[s]=e[s]||{_errors:[]},e[s]._errors.push(t(a))):e[s]=e[s]||{_errors:[]},e=e[s],n++}}};return n(this),s}static assert(e){if(!(e instanceof ZodError))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,O.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},s=[];for(const n of this.issues)if(n.path.length>0){const s=n.path[0];t[s]=t[s]||[],t[s].push(e(n))}else s.push(e(n));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}ZodError.create=e=>new ZodError(e);const Z=(e,t)=>{let s;switch(e.code){case N.invalid_type:s=e.received===L.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case N.invalid_literal:s=`Invalid literal value, expected ${JSON.stringify(e.expected,O.jsonStringifyReplacer)}`;break;case N.unrecognized_keys:s=`Unrecognized key(s) in object: ${O.joinValues(e.keys,", ")}`;break;case N.invalid_union:s="Invalid input";break;case N.invalid_union_discriminator:s=`Invalid discriminator value. Expected ${O.joinValues(e.options)}`;break;case N.invalid_enum_value:s=`Invalid enum value. Expected ${O.joinValues(e.options)}, received '${e.received}'`;break;case N.invalid_arguments:s="Invalid function arguments";break;case N.invalid_return_type:s="Invalid function return type";break;case N.invalid_date:s="Invalid date";break;case N.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(s=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(s=`${s} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?s=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?s=`Invalid input: must end with "${e.validation.endsWith}"`:O.assertNever(e.validation):s="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case N.too_small:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case N.too_big:s="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case N.custom:s="Invalid input";break;case N.invalid_intersection_types:s="Intersection results could not be merged";break;case N.not_multiple_of:s=`Number must be a multiple of ${e.multipleOf}`;break;case N.not_finite:s="Number must be finite";break;default:s=t.defaultError,O.assertNever(e)}return{message:s}};let B=Z;var U;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(U||(U={}));function $(e,t){const s=B,n=(e=>{const{data:t,path:s,errorMaps:n,issueData:a}=e,i=[...s,...a.path||[]],o={...a,path:i};if(void 0!==a.message)return{...a,path:i,message:a.message};let r="";const l=n.filter((e=>!!e)).slice().reverse();for(const e of l)r=e(o,{data:t,defaultError:r}).message;return{...a,path:i,message:r}})({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,s,s===Z?void 0:Z].filter((e=>!!e))});e.common.issues.push(n)}class ParseStatus{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const n of t){if("aborted"===n.status)return V;"dirty"===n.status&&e.dirty(),s.push(n.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const e of t){const t=await e.key,n=await e.value;s.push({key:t,value:n})}return ParseStatus.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const n of t){const{key:t,value:a}=n;if("aborted"===t.status)return V;if("aborted"===a.status)return V;"dirty"===t.status&&e.dirty(),"dirty"===a.status&&e.dirty(),"__proto__"===t.value||void 0===a.value&&!n.alwaysSet||(s[t.value]=a.value)}return{status:e.value,value:s}}}const V=Object.freeze({status:"aborted"}),G=e=>({status:"dirty",value:e}),K=e=>({status:"valid",value:e}),q=e=>"aborted"===e.status,H=e=>"dirty"===e.status,Q=e=>"valid"===e.status,W=e=>"undefined"!=typeof Promise&&e instanceof Promise;class ParseInputLazyPath{constructor(e,t,s,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Y=(e,t)=>{if(Q(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ZodError(e.common.issues);return this._error=t,this._error}}};function J(e){if(!e)return{};const{errorMap:t,invalid_type_error:s,required_error:n,description:a}=e;if(t&&(s||n))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:a}:{errorMap:(t,a)=>{const{message:i}=e;return"invalid_enum_value"===t.code?{message:i??a.defaultError}:void 0===a.data?{message:i??n??a.defaultError}:"invalid_type"!==t.code?{message:a.defaultError}:{message:i??s??a.defaultError}},description:a}}class ZodType{get description(){return this._def.description}_getType(e){return D(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:D(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:D(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(W(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){const s={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:D(e)},n=this._parseSync({data:e,path:s.path,parent:s});return Y(s,n)}"~validate"(e){const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:D(e)};if(!this["~standard"].async)try{const s=this._parseSync({data:e,path:[],parent:t});return Q(s)?{value:s.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then((e=>Q(e)?{value:e.value}:{issues:t.common.issues}))}async parseAsync(e,t){const s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){const s={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:D(e)},n=this._parse({data:e,path:s.path,parent:s}),a=await(W(n)?n:Promise.resolve(n));return Y(s,a)}refine(e,t){const s=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,n)=>{const a=e(t),i=()=>n.addIssue({code:N.custom,...s(t)});return"undefined"!=typeof Promise&&a instanceof Promise?a.then((e=>!!e||(i(),!1))):!!a||(i(),!1)}))}refinement(e,t){return this._refinement(((s,n)=>!!e(s)||(n.addIssue("function"==typeof t?t(s,n):t),!1)))}_refinement(e){return new ZodEffects({schema:this,typeName:Ee.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return ZodOptional.create(this,this._def)}nullable(){return ZodNullable.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ZodArray.create(this)}promise(){return ZodPromise.create(this,this._def)}or(e){return ZodUnion.create([this,e],this._def)}and(e){return ZodIntersection.create(this,e,this._def)}transform(e){return new ZodEffects({...J(this._def),schema:this,typeName:Ee.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new ZodDefault({...J(this._def),innerType:this,defaultValue:t,typeName:Ee.ZodDefault})}brand(){return new ZodBranded({typeName:Ee.ZodBranded,type:this,...J(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new ZodCatch({...J(this._def),innerType:this,catchValue:t,typeName:Ee.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return ZodPipeline.create(this,e)}readonly(){return ZodReadonly.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const X=/^c[^\s-]{8,}$/i,ee=/^[0-9a-z]+$/,te=/^[0-9A-HJKMNP-TV-Z]{26}$/i,se=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ne=/^[a-z0-9_-]{21}$/i,ae=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ie=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,oe=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let re;const le=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,de=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ce=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ue=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,pe=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,me=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ge="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",he=new RegExp(`^${ge}$`);function ve(e){let t="[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),`([01]\\d|2[0-3]):[0-5]\\d(:${t})${e.precision?"+":"?"}`}function fe(e){let t=`${ge}T${ve(e)}`;const s=[];return s.push(e.local?"Z?":"Z"),e.offset&&s.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${s.join("|")})`,new RegExp(`^${t}$`)}function ye(e,t){if(!ae.test(e))return!1;try{const[s]=e.split(".");if(!s)return!1;const n=s.replace(/-/g,"+").replace(/_/g,"/").padEnd(s.length+(4-s.length%4)%4,"="),a=JSON.parse(atob(n));return!("object"!=typeof a||null===a||"typ"in a&&"JWT"!==a?.typ||!a.alg||t&&a.alg!==t)}catch{return!1}}function xe(e,t){return!("v4"!==t&&t||!de.test(e))||!("v6"!==t&&t||!ue.test(e))}class ZodString extends ZodType{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==L.string){const t=this._getOrReturnCtx(e);return $(t,{code:N.invalid_type,expected:L.string,received:t.parsedType}),V}const t=new ParseStatus;let s;for(const i of this._def.checks)if("min"===i.kind)e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),$(s,{code:N.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),t.dirty());else if("max"===i.kind)e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),$(s,{code:N.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),t.dirty());else if("length"===i.kind){const n=e.data.length>i.value,a=e.data.length<i.value;(n||a)&&(s=this._getOrReturnCtx(e,s),n?$(s,{code:N.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&$(s,{code:N.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),t.dirty())}else if("email"===i.kind)oe.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"email",code:N.invalid_string,message:i.message}),t.dirty());else if("emoji"===i.kind)re||(re=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),re.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"emoji",code:N.invalid_string,message:i.message}),t.dirty());else if("uuid"===i.kind)se.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"uuid",code:N.invalid_string,message:i.message}),t.dirty());else if("nanoid"===i.kind)ne.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"nanoid",code:N.invalid_string,message:i.message}),t.dirty());else if("cuid"===i.kind)X.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"cuid",code:N.invalid_string,message:i.message}),t.dirty());else if("cuid2"===i.kind)ee.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"cuid2",code:N.invalid_string,message:i.message}),t.dirty());else if("ulid"===i.kind)te.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"ulid",code:N.invalid_string,message:i.message}),t.dirty());else if("url"===i.kind)try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),$(s,{validation:"url",code:N.invalid_string,message:i.message}),t.dirty()}else"regex"===i.kind?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"regex",code:N.invalid_string,message:i.message}),t.dirty())):"trim"===i.kind?e.data=e.data.trim():"includes"===i.kind?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),$(s,{code:N.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),t.dirty()):"toLowerCase"===i.kind?e.data=e.data.toLowerCase():"toUpperCase"===i.kind?e.data=e.data.toUpperCase():"startsWith"===i.kind?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),$(s,{code:N.invalid_string,validation:{startsWith:i.value},message:i.message}),t.dirty()):"endsWith"===i.kind?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),$(s,{code:N.invalid_string,validation:{endsWith:i.value},message:i.message}),t.dirty()):"datetime"===i.kind?fe(i).test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{code:N.invalid_string,validation:"datetime",message:i.message}),t.dirty()):"date"===i.kind?he.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{code:N.invalid_string,validation:"date",message:i.message}),t.dirty()):"time"===i.kind?new RegExp(`^${ve(i)}$`).test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{code:N.invalid_string,validation:"time",message:i.message}),t.dirty()):"duration"===i.kind?ie.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"duration",code:N.invalid_string,message:i.message}),t.dirty()):"ip"===i.kind?(n=e.data,("v4"!==(a=i.version)&&a||!le.test(n))&&("v6"!==a&&a||!ce.test(n))&&(s=this._getOrReturnCtx(e,s),$(s,{validation:"ip",code:N.invalid_string,message:i.message}),t.dirty())):"jwt"===i.kind?ye(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"jwt",code:N.invalid_string,message:i.message}),t.dirty()):"cidr"===i.kind?xe(e.data,i.version)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"cidr",code:N.invalid_string,message:i.message}),t.dirty()):"base64"===i.kind?pe.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"base64",code:N.invalid_string,message:i.message}),t.dirty()):"base64url"===i.kind?me.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"base64url",code:N.invalid_string,message:i.message}),t.dirty()):O.assertNever(i);var n,a;return{status:t.value,value:e.data}}_regex(e,t,s){return this.refinement((t=>e.test(t)),{validation:t,code:N.invalid_string,...U.errToObj(s)})}_addCheck(e){return new ZodString({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...U.errToObj(e)})}url(e){return this._addCheck({kind:"url",...U.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...U.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...U.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...U.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...U.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...U.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...U.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...U.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...U.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...U.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...U.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...U.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...U.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...U.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...U.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...U.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...U.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...U.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...U.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...U.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...U.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...U.errToObj(t)})}nonempty(e){return this.min(1,U.errToObj(e))}trim(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isDate(){return!!this._def.checks.find((e=>"date"===e.kind))}get isTime(){return!!this._def.checks.find((e=>"time"===e.kind))}get isDuration(){return!!this._def.checks.find((e=>"duration"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isNANOID(){return!!this._def.checks.find((e=>"nanoid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get isCIDR(){return!!this._def.checks.find((e=>"cidr"===e.kind))}get isBase64(){return!!this._def.checks.find((e=>"base64"===e.kind))}get isBase64url(){return!!this._def.checks.find((e=>"base64url"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function be(e,t){const s=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,a=s>n?s:n;return Number.parseInt(e.toFixed(a).replace(".",""))%Number.parseInt(t.toFixed(a).replace(".",""))/10**a}ZodString.create=e=>new ZodString({checks:[],typeName:Ee.ZodString,coerce:e?.coerce??!1,...J(e)});class ZodNumber extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==L.number){const t=this._getOrReturnCtx(e);return $(t,{code:N.invalid_type,expected:L.number,received:t.parsedType}),V}let t;const s=new ParseStatus;for(const n of this._def.checks)"int"===n.kind?O.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),$(t,{code:N.invalid_type,expected:"integer",received:"float",message:n.message}),s.dirty()):"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),$(t,{code:N.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),s.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),$(t,{code:N.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),s.dirty()):"multipleOf"===n.kind?0!==be(e.data,n.value)&&(t=this._getOrReturnCtx(e,t),$(t,{code:N.not_multiple_of,multipleOf:n.value,message:n.message}),s.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),$(t,{code:N.not_finite,message:n.message}),s.dirty()):O.assertNever(n);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,U.toString(t))}gt(e,t){return this.setLimit("min",e,!1,U.toString(t))}lte(e,t){return this.setLimit("max",e,!0,U.toString(t))}lt(e,t){return this.setLimit("max",e,!1,U.toString(t))}setLimit(e,t,s,n){return new ZodNumber({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:U.toString(n)}]})}_addCheck(e){return new ZodNumber({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:U.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:U.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:U.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:U.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:U.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:U.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:U.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:U.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:U.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&O.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if("finite"===s.kind||"int"===s.kind||"multipleOf"===s.kind)return!0;"min"===s.kind?(null===t||s.value>t)&&(t=s.value):"max"===s.kind&&(null===e||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ZodNumber.create=e=>new ZodNumber({checks:[],typeName:Ee.ZodNumber,coerce:e?.coerce||!1,...J(e)});class ZodBigInt extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==L.bigint)return this._getInvalidInput(e);let t;const s=new ParseStatus;for(const n of this._def.checks)"min"===n.kind?(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),$(t,{code:N.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),s.dirty()):"max"===n.kind?(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),$(t,{code:N.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),s.dirty()):"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),$(t,{code:N.not_multiple_of,multipleOf:n.value,message:n.message}),s.dirty()):O.assertNever(n);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return $(t,{code:N.invalid_type,expected:L.bigint,received:t.parsedType}),V}gte(e,t){return this.setLimit("min",e,!0,U.toString(t))}gt(e,t){return this.setLimit("min",e,!1,U.toString(t))}lte(e,t){return this.setLimit("max",e,!0,U.toString(t))}lt(e,t){return this.setLimit("max",e,!1,U.toString(t))}setLimit(e,t,s,n){return new ZodBigInt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:U.toString(n)}]})}_addCheck(e){return new ZodBigInt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:U.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:U.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:U.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:U.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:U.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}ZodBigInt.create=e=>new ZodBigInt({checks:[],typeName:Ee.ZodBigInt,coerce:e?.coerce??!1,...J(e)});class ZodBoolean extends ZodType{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==L.boolean){const t=this._getOrReturnCtx(e);return $(t,{code:N.invalid_type,expected:L.boolean,received:t.parsedType}),V}return K(e.data)}}ZodBoolean.create=e=>new ZodBoolean({typeName:Ee.ZodBoolean,coerce:e?.coerce||!1,...J(e)});class ZodDate extends ZodType{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==L.date){const t=this._getOrReturnCtx(e);return $(t,{code:N.invalid_type,expected:L.date,received:t.parsedType}),V}if(Number.isNaN(e.data.getTime()))return $(this._getOrReturnCtx(e),{code:N.invalid_date}),V;const t=new ParseStatus;let s;for(const n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(s=this._getOrReturnCtx(e,s),$(s,{code:N.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),t.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(s=this._getOrReturnCtx(e,s),$(s,{code:N.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),t.dirty()):O.assertNever(n);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ZodDate({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:U.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:U.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}ZodDate.create=e=>new ZodDate({checks:[],coerce:e?.coerce||!1,typeName:Ee.ZodDate,...J(e)});class ZodSymbol extends ZodType{_parse(e){if(this._getType(e)!==L.symbol){const t=this._getOrReturnCtx(e);return $(t,{code:N.invalid_type,expected:L.symbol,received:t.parsedType}),V}return K(e.data)}}ZodSymbol.create=e=>new ZodSymbol({typeName:Ee.ZodSymbol,...J(e)});class ZodUndefined extends ZodType{_parse(e){if(this._getType(e)!==L.undefined){const t=this._getOrReturnCtx(e);return $(t,{code:N.invalid_type,expected:L.undefined,received:t.parsedType}),V}return K(e.data)}}ZodUndefined.create=e=>new ZodUndefined({typeName:Ee.ZodUndefined,...J(e)});class ZodNull extends ZodType{_parse(e){if(this._getType(e)!==L.null){const t=this._getOrReturnCtx(e);return $(t,{code:N.invalid_type,expected:L.null,received:t.parsedType}),V}return K(e.data)}}ZodNull.create=e=>new ZodNull({typeName:Ee.ZodNull,...J(e)});class ZodAny extends ZodType{constructor(){super(...arguments),this._any=!0}_parse(e){return K(e.data)}}ZodAny.create=e=>new ZodAny({typeName:Ee.ZodAny,...J(e)});class ZodUnknown extends ZodType{constructor(){super(...arguments),this._unknown=!0}_parse(e){return K(e.data)}}ZodUnknown.create=e=>new ZodUnknown({typeName:Ee.ZodUnknown,...J(e)});class ZodNever extends ZodType{_parse(e){const t=this._getOrReturnCtx(e);return $(t,{code:N.invalid_type,expected:L.never,received:t.parsedType}),V}}ZodNever.create=e=>new ZodNever({typeName:Ee.ZodNever,...J(e)});class ZodVoid extends ZodType{_parse(e){if(this._getType(e)!==L.undefined){const t=this._getOrReturnCtx(e);return $(t,{code:N.invalid_type,expected:L.void,received:t.parsedType}),V}return K(e.data)}}ZodVoid.create=e=>new ZodVoid({typeName:Ee.ZodVoid,...J(e)});class ZodArray extends ZodType{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),n=this._def;if(t.parsedType!==L.array)return $(t,{code:N.invalid_type,expected:L.array,received:t.parsedType}),V;if(null!==n.exactLength){const e=t.data.length>n.exactLength.value,a=t.data.length<n.exactLength.value;(e||a)&&($(t,{code:e?N.too_big:N.too_small,minimum:a?n.exactLength.value:void 0,maximum:e?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),s.dirty())}if(null!==n.minLength&&t.data.length<n.minLength.value&&($(t,{code:N.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),s.dirty()),null!==n.maxLength&&t.data.length>n.maxLength.value&&($(t,{code:N.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map(((e,s)=>n.type._parseAsync(new ParseInputLazyPath(t,e,t.path,s))))).then((e=>ParseStatus.mergeArray(s,e)));const a=[...t.data].map(((e,s)=>n.type._parseSync(new ParseInputLazyPath(t,e,t.path,s))));return ParseStatus.mergeArray(s,a)}get element(){return this._def.type}min(e,t){return new ZodArray({...this._def,minLength:{value:e,message:U.toString(t)}})}max(e,t){return new ZodArray({...this._def,maxLength:{value:e,message:U.toString(t)}})}length(e,t){return new ZodArray({...this._def,exactLength:{value:e,message:U.toString(t)}})}nonempty(e){return this.min(1,e)}}function Ce(e){if(e instanceof ZodObject){const t={};for(const s in e.shape){const n=e.shape[s];t[s]=ZodOptional.create(Ce(n))}return new ZodObject({...e._def,shape:()=>t})}return e instanceof ZodArray?new ZodArray({...e._def,type:Ce(e.element)}):e instanceof ZodOptional?ZodOptional.create(Ce(e.unwrap())):e instanceof ZodNullable?ZodNullable.create(Ce(e.unwrap())):e instanceof ZodTuple?ZodTuple.create(e.items.map((e=>Ce(e)))):e}ZodArray.create=(e,t)=>new ZodArray({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Ee.ZodArray,...J(t)});class ZodObject extends ZodType{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=O.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==L.object){const t=this._getOrReturnCtx(e);return $(t,{code:N.invalid_type,expected:L.object,received:t.parsedType}),V}const{status:t,ctx:s}=this._processInputParams(e),{shape:n,keys:a}=this._getCached(),i=[];if(!(this._def.catchall instanceof ZodNever&&"strip"===this._def.unknownKeys))for(const e in s.data)a.includes(e)||i.push(e);const o=[];for(const e of a){const t=n[e],a=s.data[e];o.push({key:{status:"valid",value:e},value:t._parse(new ParseInputLazyPath(s,a,s.path,e)),alwaysSet:e in s.data})}if(this._def.catchall instanceof ZodNever){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of i)o.push({key:{status:"valid",value:e},value:{status:"valid",value:s.data[e]}});else if("strict"===e)i.length>0&&($(s,{code:N.unrecognized_keys,keys:i}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of i){const n=s.data[t];o.push({key:{status:"valid",value:t},value:e._parse(new ParseInputLazyPath(s,n,s.path,t)),alwaysSet:t in s.data})}}return s.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of o){const s=await t.key,n=await t.value;e.push({key:s,value:n,alwaysSet:t.alwaysSet})}return e})).then((e=>ParseStatus.mergeObjectSync(t,e))):ParseStatus.mergeObjectSync(t,o)}get shape(){return this._def.shape()}strict(e){return U.errToObj,new ZodObject({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,s)=>{const n=this._def.errorMap?.(t,s).message??s.defaultError;return"unrecognized_keys"===t.code?{message:U.errToObj(e).message??n}:{message:n}}}:{}})}strip(){return new ZodObject({...this._def,unknownKeys:"strip"})}passthrough(){return new ZodObject({...this._def,unknownKeys:"passthrough"})}extend(e){return new ZodObject({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ZodObject({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Ee.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ZodObject({...this._def,catchall:e})}pick(e){const t={};for(const s of O.objectKeys(e))e[s]&&this.shape[s]&&(t[s]=this.shape[s]);return new ZodObject({...this._def,shape:()=>t})}omit(e){const t={};for(const s of O.objectKeys(this.shape))e[s]||(t[s]=this.shape[s]);return new ZodObject({...this._def,shape:()=>t})}deepPartial(){return Ce(this)}partial(e){const t={};for(const s of O.objectKeys(this.shape)){const n=this.shape[s];e&&!e[s]?t[s]=n:t[s]=n.optional()}return new ZodObject({...this._def,shape:()=>t})}required(e){const t={};for(const s of O.objectKeys(this.shape))if(e&&!e[s])t[s]=this.shape[s];else{let e=this.shape[s];for(;e instanceof ZodOptional;)e=e._def.innerType;t[s]=e}return new ZodObject({...this._def,shape:()=>t})}keyof(){return Se(O.objectKeys(this.shape))}}ZodObject.create=(e,t)=>new ZodObject({shape:()=>e,unknownKeys:"strip",catchall:ZodNever.create(),typeName:Ee.ZodObject,...J(t)}),ZodObject.strictCreate=(e,t)=>new ZodObject({shape:()=>e,unknownKeys:"strict",catchall:ZodNever.create(),typeName:Ee.ZodObject,...J(t)}),ZodObject.lazycreate=(e,t)=>new ZodObject({shape:e,unknownKeys:"strip",catchall:ZodNever.create(),typeName:Ee.ZodObject,...J(t)});class ZodUnion extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e),s=this._def.options;if(t.common.async)return Promise.all(s.map((async e=>{const s={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const s of e)if("dirty"===s.result.status)return t.common.issues.push(...s.ctx.common.issues),s.result;const s=e.map((e=>new ZodError(e.ctx.common.issues)));return $(t,{code:N.invalid_union,unionErrors:s}),V}));{let e;const n=[];for(const a of s){const s={...t,common:{...t.common,issues:[]},parent:null},i=a._parseSync({data:t.data,path:t.path,parent:s});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:s}),s.common.issues.length&&n.push(s.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const a=n.map((e=>new ZodError(e)));return $(t,{code:N.invalid_union,unionErrors:a}),V}}get options(){return this._def.options}}function ke(e,t){const s=D(e),n=D(t);if(e===t)return{valid:!0,data:e};if(s===L.object&&n===L.object){const s=O.objectKeys(t),n=O.objectKeys(e).filter((e=>-1!==s.indexOf(e))),a={...e,...t};for(const s of n){const n=ke(e[s],t[s]);if(!n.valid)return{valid:!1};a[s]=n.data}return{valid:!0,data:a}}if(s===L.array&&n===L.array){if(e.length!==t.length)return{valid:!1};const s=[];for(let n=0;n<e.length;n++){const a=ke(e[n],t[n]);if(!a.valid)return{valid:!1};s.push(a.data)}return{valid:!0,data:s}}return s===L.date&&n===L.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}ZodUnion.create=(e,t)=>new ZodUnion({options:e,typeName:Ee.ZodUnion,...J(t)});class ZodIntersection extends ZodType{_parse(e){const{status:t,ctx:s}=this._processInputParams(e),n=(e,n)=>{if(q(e)||q(n))return V;const a=ke(e.value,n.value);return a.valid?((H(e)||H(n))&&t.dirty(),{status:t.value,value:a.data}):($(s,{code:N.invalid_intersection_types}),V)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then((([e,t])=>n(e,t))):n(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}ZodIntersection.create=(e,t,s)=>new ZodIntersection({left:e,right:t,typeName:Ee.ZodIntersection,...J(s)});class ZodTuple extends ZodType{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==L.array)return $(s,{code:N.invalid_type,expected:L.array,received:s.parsedType}),V;if(s.data.length<this._def.items.length)return $(s,{code:N.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),V;!this._def.rest&&s.data.length>this._def.items.length&&($(s,{code:N.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const n=[...s.data].map(((e,t)=>{const n=this._def.items[t]||this._def.rest;return n?n._parse(new ParseInputLazyPath(s,e,s.path,t)):null})).filter((e=>!!e));return s.common.async?Promise.all(n).then((e=>ParseStatus.mergeArray(t,e))):ParseStatus.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new ZodTuple({...this._def,rest:e})}}ZodTuple.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ZodTuple({items:e,typeName:Ee.ZodTuple,rest:null,...J(t)})};class ZodMap extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==L.map)return $(s,{code:N.invalid_type,expected:L.map,received:s.parsedType}),V;const n=this._def.keyType,a=this._def.valueType,i=[...s.data.entries()].map((([e,t],i)=>({key:n._parse(new ParseInputLazyPath(s,e,s.path,[i,"key"])),value:a._parse(new ParseInputLazyPath(s,t,s.path,[i,"value"]))})));if(s.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const s of i){const n=await s.key,a=await s.value;if("aborted"===n.status||"aborted"===a.status)return V;"dirty"!==n.status&&"dirty"!==a.status||t.dirty(),e.set(n.value,a.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const s of i){const n=s.key,a=s.value;if("aborted"===n.status||"aborted"===a.status)return V;"dirty"!==n.status&&"dirty"!==a.status||t.dirty(),e.set(n.value,a.value)}return{status:t.value,value:e}}}}ZodMap.create=(e,t,s)=>new ZodMap({valueType:t,keyType:e,typeName:Ee.ZodMap,...J(s)});class ZodSet extends ZodType{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==L.set)return $(s,{code:N.invalid_type,expected:L.set,received:s.parsedType}),V;const n=this._def;null!==n.minSize&&s.data.size<n.minSize.value&&($(s,{code:N.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),null!==n.maxSize&&s.data.size>n.maxSize.value&&($(s,{code:N.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());const a=this._def.valueType;function i(e){const s=new Set;for(const n of e){if("aborted"===n.status)return V;"dirty"===n.status&&t.dirty(),s.add(n.value)}return{status:t.value,value:s}}const o=[...s.data.values()].map(((e,t)=>a._parse(new ParseInputLazyPath(s,e,s.path,t))));return s.common.async?Promise.all(o).then((e=>i(e))):i(o)}min(e,t){return new ZodSet({...this._def,minSize:{value:e,message:U.toString(t)}})}max(e,t){return new ZodSet({...this._def,maxSize:{value:e,message:U.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}ZodSet.create=(e,t)=>new ZodSet({valueType:e,minSize:null,maxSize:null,typeName:Ee.ZodSet,...J(t)});class ZodLazy extends ZodType{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ZodLazy.create=(e,t)=>new ZodLazy({getter:e,typeName:Ee.ZodLazy,...J(t)});class ZodLiteral extends ZodType{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return $(t,{received:t.data,code:N.invalid_literal,expected:this._def.value}),V}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Se(e,t){return new ZodEnum({values:e,typeName:Ee.ZodEnum,...J(t)})}ZodLiteral.create=(e,t)=>new ZodLiteral({value:e,typeName:Ee.ZodLiteral,...J(t)});class ZodEnum extends ZodType{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),s=this._def.values;return $(t,{expected:O.joinValues(s),received:t.parsedType,code:N.invalid_type}),V}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),s=this._def.values;return $(t,{received:t.data,code:N.invalid_enum_value,options:s}),V}return K(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return ZodEnum.create(e,{...this._def,...t})}exclude(e,t=this._def){return ZodEnum.create(this.options.filter((t=>!e.includes(t))),{...this._def,...t})}}ZodEnum.create=Se;class ZodNativeEnum extends ZodType{_parse(e){const t=O.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==L.string&&s.parsedType!==L.number){const e=O.objectValues(t);return $(s,{expected:O.joinValues(e),received:s.parsedType,code:N.invalid_type}),V}if(this._cache||(this._cache=new Set(O.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const e=O.objectValues(t);return $(s,{received:s.data,code:N.invalid_enum_value,options:e}),V}return K(e.data)}get enum(){return this._def.values}}ZodNativeEnum.create=(e,t)=>new ZodNativeEnum({values:e,typeName:Ee.ZodNativeEnum,...J(t)});class ZodPromise extends ZodType{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==L.promise&&!1===t.common.async)return $(t,{code:N.invalid_type,expected:L.promise,received:t.parsedType}),V;const s=t.parsedType===L.promise?t.data:Promise.resolve(t.data);return K(s.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}ZodPromise.create=(e,t)=>new ZodPromise({type:e,typeName:Ee.ZodPromise,...J(t)});class ZodEffects extends ZodType{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Ee.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:s}=this._processInputParams(e),n=this._def.effect||null,a={addIssue:e=>{$(s,e),e.fatal?t.abort():t.dirty()},get path(){return s.path}};if(a.addIssue=a.addIssue.bind(a),"preprocess"===n.type){const e=n.transform(s.data,a);if(s.common.async)return Promise.resolve(e).then((async e=>{if("aborted"===t.value)return V;const n=await this._def.schema._parseAsync({data:e,path:s.path,parent:s});return"aborted"===n.status?V:"dirty"===n.status||"dirty"===t.value?G(n.value):n}));{if("aborted"===t.value)return V;const n=this._def.schema._parseSync({data:e,path:s.path,parent:s});return"aborted"===n.status?V:"dirty"===n.status||"dirty"===t.value?G(n.value):n}}if("refinement"===n.type){const e=e=>{const t=n.refinement(e,a);if(s.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===s.common.async){const n=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===n.status?V:("dirty"===n.status&&t.dirty(),e(n.value),{status:t.value,value:n.value})}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then((s=>"aborted"===s.status?V:("dirty"===s.status&&t.dirty(),e(s.value).then((()=>({status:t.value,value:s.value}))))))}if("transform"===n.type){if(!1===s.common.async){const e=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Q(e))return V;const i=n.transform(e.value,a);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then((e=>Q(e)?Promise.resolve(n.transform(e.value,a)).then((e=>({status:t.value,value:e}))):V))}O.assertNever(n)}}ZodEffects.create=(e,t,s)=>new ZodEffects({schema:e,typeName:Ee.ZodEffects,effect:t,...J(s)}),ZodEffects.createWithPreprocess=(e,t,s)=>new ZodEffects({schema:t,effect:{type:"preprocess",transform:e},typeName:Ee.ZodEffects,...J(s)});class ZodOptional extends ZodType{_parse(e){return this._getType(e)===L.undefined?K(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ZodOptional.create=(e,t)=>new ZodOptional({innerType:e,typeName:Ee.ZodOptional,...J(t)});class ZodNullable extends ZodType{_parse(e){return this._getType(e)===L.null?K(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ZodNullable.create=(e,t)=>new ZodNullable({innerType:e,typeName:Ee.ZodNullable,...J(t)});class ZodDefault extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e);let s=t.data;return t.parsedType===L.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}ZodDefault.create=(e,t)=>new ZodDefault({innerType:e,typeName:Ee.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...J(t)});class ZodCatch extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return W(n)?n.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new ZodError(s.common.issues)},input:s.data})}))):{status:"valid",value:"valid"===n.status?n.value:this._def.catchValue({get error(){return new ZodError(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}ZodCatch.create=(e,t)=>new ZodCatch({innerType:e,typeName:Ee.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...J(t)});class ZodNaN extends ZodType{_parse(e){if(this._getType(e)!==L.nan){const t=this._getOrReturnCtx(e);return $(t,{code:N.invalid_type,expected:L.nan,received:t.parsedType}),V}return{status:"valid",value:e.data}}}ZodNaN.create=e=>new ZodNaN({typeName:Ee.ZodNaN,...J(e)}),Symbol("zod_brand");class ZodBranded extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class ZodPipeline extends ZodType{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?V:"dirty"===e.status?(t.dirty(),G(e.value)):this._def.out._parseAsync({data:e.value,path:s.path,parent:s})})();{const e=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===e.status?V:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:s.path,parent:s})}}static create(e,t){return new ZodPipeline({in:e,out:t,typeName:Ee.ZodPipeline})}}class ZodReadonly extends ZodType{_parse(e){const t=this._def.innerType._parse(e),s=e=>(Q(e)&&(e.value=Object.freeze(e.value)),e);return W(t)?t.then((e=>s(e))):s(t)}unwrap(){return this._def.innerType}}var Ee;ZodReadonly.create=(e,t)=>new ZodReadonly({innerType:e,typeName:Ee.ZodReadonly,...J(t)}),ZodObject.lazycreate,function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(Ee||(Ee={}));const we=ZodString.create,Ae=ZodNumber.create,je=(ZodNaN.create,ZodBigInt.create,ZodBoolean.create),_e=(ZodDate.create,ZodSymbol.create,ZodUndefined.create,ZodNull.create,ZodAny.create,ZodUnknown.create,ZodNever.create,ZodVoid.create,ZodArray.create),Pe=ZodObject.create,Te=(ZodObject.strictCreate,ZodUnion.create,ZodIntersection.create,ZodTuple.create,ZodMap.create,ZodSet.create,ZodLazy.create,ZodLiteral.create),Ie=ZodEnum.create;ZodNativeEnum.create,ZodPromise.create,ZodEffects.create,ZodOptional.create,ZodNullable.create,ZodEffects.createWithPreprocess,ZodPipeline.create;let Me=function(e){return e.BooleanFromString="BooleanFromString",e.PassThroughAny="PassThroughAny",e}({});class KbnZodBooleanFromString extends ZodUnion{constructor(...e){super(...e),(0,n.default)(this,"kbnTypeName",Me.BooleanFromString)}static create(){return new KbnZodBooleanFromString({typeName:Ee.ZodUnion,options:[Ie(["true","false"]),je()]}).describe("A boolean value, which can be 'true' or 'false' as string or a native boolean.")}_parse(e){const t=super._parse(e);if(Q(t)){const e=t.value;return{status:"valid",value:"true"===e||"false"!==e&&e}}return t}}const ze=KbnZodBooleanFromString.create(),Fe=(Pe({success:je().optional()}),Pe({statusCode:Ae().optional(),error:we().optional(),message:we().optional()}),Pe({elser_exists:je().optional(),is_setup_available:je().optional(),is_setup_in_progress:je().optional(),security_labs_exists:je().optional(),defend_insights_exists:je().optional(),user_data_exists:je().optional(),product_documentation_status:we().optional()}),Pe({modelId:we().optional(),ignoreSecurityLabs:ze.optional().default(!1)}),Pe({resource:we()})),Oe=(Pe({modelId:we().optional(),ignoreSecurityLabs:ze.optional().default(!1)}),Pe({resource:we()})),Re="2023-10-31",Le="1",De=(Fe.extend({resource:Fe.shape.resource.optional()}),Oe.extend({resource:Oe.shape.resource.optional()}),["elastic-assistant","capabilities"]),Ne=r().createContext(void 0),Ze=()=>{const e=r().useContext(Ne);if(null==e)throw new Error("useAssistantContext must be used within a AssistantProvider");return e},Be=({children:e,value:t})=>(0,g.jsx)(Ne.Provider,{value:t},e);var Ue=s(185),$e=s(59),Ve=s(519),Ge=s(718),Ke=s(557),qe=$e.default,He=function(e){return"theme"!==e},Qe=function(e){return"string"==typeof e&&e.charCodeAt(0)>96?qe:He},We=function(e,t,s){var n;if(t){var a=t.shouldForwardProp;n=e.__emotion_forwardProp&&a?function(t){return e.__emotion_forwardProp(t)&&a(t)}:a}return"function"!=typeof n&&s&&(n=e.__emotion_forwardProp),n},Ye=function(e){var t=e.cache,s=e.serialized,n=e.isStringTag;return(0,Ve.registerStyles)(t,s,n),(0,Ke.useInsertionEffectAlwaysWithSyncFallback)((function(){return(0,Ve.insertStyles)(t,s,n)})),null},Je=function e(t,s){var n,a,i=t.__emotion_real===t,r=i&&t.__emotion_base||t;void 0!==s&&(n=s.label,a=s.target);var l=We(t,s,i),d=l||Qe(r),c=!d("as");return function(){var u=arguments,p=i&&void 0!==t.__emotion_styles?t.__emotion_styles.slice(0):[];if(void 0!==n&&p.push("label:"+n+";"),null==u[0]||void 0===u[0].raw)p.push.apply(p,u);else{p.push(u[0][0]);for(var m=u.length,h=1;h<m;h++)p.push(u[h],u[0][h])}var v=(0,g.withEmotionCache)((function(e,t,s){var n=c&&e.as||r,i="",u=[],m=e;if(null==e.theme){for(var h in m={},e)m[h]=e[h];m.theme=o.useContext(g.ThemeContext)}"string"==typeof e.className?i=(0,Ve.getRegisteredStyles)(t.registered,u,e.className):null!=e.className&&(i=e.className+" ");var v=(0,Ge.serializeStyles)(p.concat(u),t.registered,m);i+=t.key+"-"+v.name,void 0!==a&&(i+=" "+a);var f=c&&void 0===l?Qe(n):d,y={};for(var x in e)c&&"as"===x||f(x)&&(y[x]=e[x]);return y.className=i,y.ref=s,o.createElement(o.Fragment,null,o.createElement(Ye,{cache:t,serialized:v,isStringTag:"string"==typeof n}),o.createElement(n,y))}));return v.displayName=void 0!==n?n:"Styled("+("string"==typeof r?r:r.displayName||r.name||"Component")+")",v.defaultProps=t.defaultProps,v.__emotion_real=v,v.__emotion_base=r,v.__emotion_styles=p,v.__emotion_forwardProp=l,Object.defineProperty(v,"toString",{value:function(){return"."+a}}),v.withComponent=function(t,n){return e(t,(0,Ue.default)({},s,n,{shouldForwardProp:We(v,n,!0)})).apply(void 0,p)},v}};let Xe=function(e){return e.SHARED="shared",e.RESTRICTED="restricted",e.PRIVATE="private",e}({});const et=e=>{var t;if(!e||""===(null==e?void 0:e.id))return Xe.PRIVATE;switch(null!==(t=null==e?void 0:e.users.length)&&void 0!==t?t:1){case 0:return Xe.SHARED;case 1:return Xe.PRIVATE;default:return Xe.RESTRICTED}},tt=e=>{var t;return null!==(t=null==e?void 0:e.createdBy)&&void 0!==t?t:1===(null==e?void 0:e.users.length)?null==e?void 0:e.users[0]:{}},st=(e,t)=>{if(void 0===t||0===Object.keys(t).length||void 0===e||""===(null==e?void 0:e.id))return!0;const s=tt(e),n=!(null==s||!s.id||null==t||!t.id||(null==s?void 0:s.id)!==(null==t?void 0:t.id)),a=!(null==s||!s.name||null==t||!t.name||(null==s?void 0:s.name)!==(null==t?void 0:t.name));return n||a},nt=e=>{switch(e){case Xe.SHARED:return"users";case Xe.RESTRICTED:return"readOnly";case Xe.PRIVATE:default:return"lock"}},at=S.i18n.translate("xpack.elasticAssistant.assistant.useConversation.welcomeConversationTitle",{defaultMessage:"Welcome"}),it=S.i18n.translate("xpack.elasticAssistant.assistant.settings.conversation.duplicate",{defaultMessage:"Duplicate"}),ot=S.i18n.translate("xpack.elasticAssistant.assistant.settings.conversation.duplicateError",{defaultMessage:"Could not duplicate conversation"}),rt=S.i18n.translate("xpack.elasticAssistant.assistant.settings.conversation.copySuccess",{defaultMessage:"Conversation URL copied to clipboard"}),lt=S.i18n.translate("xpack.elasticAssistant.assistant.settings.conversation.copyError",{defaultMessage:"Could not copy conversation URL"}),dt=S.i18n.translate("xpack.elasticAssistant.assistant.settings.conversation.copyUrl",{defaultMessage:"Copy URL"}),ct=S.i18n.translate("xpack.elasticAssistant.assistant.ownership.title",{defaultMessage:"This conversation is shared with your team."}),ut=S.i18n.translate("xpack.elasticAssistant.assistant.ownership.titleSelected",{defaultMessage:"This conversation is shared with selected team members."}),pt=S.i18n.translate("xpack.elasticAssistant.assistant.ownership.disabled",{defaultMessage:"You can't edit or continue this conversation, but you can duplicate it into a new private conversation. The original conversation will remain unchanged."}),mt=S.i18n.translate("xpack.elasticAssistant.assistant.ownership.callout",{defaultMessage:"Any further edits you do to this conversation will be shared with the rest of the team."}),gt=S.i18n.translate("xpack.elasticAssistant.assistant.ownership.calloutSelected",{defaultMessage:"Any further edits you do to this conversation will be shared with the selected team members."});let ht=function(e){return e.OpenAi="OpenAI",e.AzureAi="Azure OpenAI",e.Other="Other",e}({});const vt=e=>{var t,s;const n=null==e?void 0:e.config,{apiProvider:a,apiUrl:i,defaultModel:o,providerConfig:r,model_id:l,url:d}=null!=n?n:{};return{apiProvider:a,apiUrl:null!=i?i:d,defaultModel:null!==(t=null!==(s=a===ht.AzureAi?ft(null!=i?i:""):o)&&void 0!==s?s:null==r?void 0:r.model_id)&&void 0!==t?t:l}},ft=e=>{var t;return null!==(t=new URLSearchParams(new URL(e).search).get("api-version"))&&void 0!==t?t:void 0},yt=e=>".inference"===(null==e?void 0:e.actionTypeId)&&(null==e?void 0:e.isPreconfigured),xt=({allSystemPrompts:e,conversation:t})=>e.find((e=>{var s;return e.id===(null==t||null===(s=t.apiConfig)||void 0===s?void 0:s.defaultSystemPromptId)})),bt=({allSystemPrompts:e,conversation:t,connectors:s,defaultConnector:n})=>{var a,i,o,r;const l=null!==(a=null==s?void 0:s.find((e=>{var s;return e.id===(null===(s=t.apiConfig)||void 0===s?void 0:s.connectorId)})))&&void 0!==a?a:n,{apiProvider:d,defaultModel:c}=null!==(i=vt(l))&&void 0!==i?i:{},u=xt({allSystemPrompts:e,conversation:t});return l?{apiConfig:{connectorId:l.id,actionTypeId:l.actionTypeId,provider:null!==(o=l.apiProvider)&&void 0!==o?o:d,defaultSystemPromptId:null==u?void 0:u.id,model:null!=c?c:null==t||null===(r=t.apiConfig)||void 0===r?void 0:r.model}}:{apiConfig:{defaultSystemPromptId:null==u?void 0:u.id}}},Ct="/api/security_ai_assistant",kt="/internal/elastic_assistant",St=`${Ct}/current_user/conversations`,Et=`${`${kt}/current_user/conversations`}/_bulk_action`,wt=`${St}/_find`,At=`${Ct}/prompts`,jt=`${At}/_bulk_action`,_t=`${At}/_find`,Pt=`${Ct}/anonymization_fields`,Tt=`${Pt}/_bulk_action`,It=`${Pt}/_find`,Mt=`${Ct}/knowledge_base/{resource?}`,zt=`${`${Ct}/knowledge_base/entries`}/_find`,Ft=`${Ct}/security_ai_prompts/_find`,Ot=`${kt}/users/_suggest`,Rt=async({http:e,id:t,signal:s,toasts:n})=>{try{return await e.fetch(`${St}/${t}`,{method:"GET",version:Re,signal:s})}catch(e){var a;throw 403===(null===(a=e.response)||void 0===a?void 0:a.status)?null==n||n.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:S.i18n.translate("xpack.elasticAssistant.conversations.accessDeniedError",{defaultMessage:"Access denied to conversation"})}):null==n||n.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:S.i18n.translate("xpack.elasticAssistant.conversations.getConversationError",{defaultMessage:"Error fetching conversation by id {id}",values:{id:t}})}),e}},Lt=async({http:e,toasts:t,title:s,users:n,conversationId:a,messages:i,apiConfig:o,replacements:r,excludeFromLastConversationStorage:l,signal:d})=>{try{return await e.fetch(`${St}/${a}`,{method:"PUT",body:JSON.stringify({id:a,title:s,users:n,messages:i,replacements:r,apiConfig:o,excludeFromLastConversationStorage:l}),headers:{"Content-Type":"application/json"},version:Re,signal:d})}catch(e){throw null==t||t.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:S.i18n.translate("xpack.elasticAssistant.conversations.updateConversationError",{defaultMessage:"Error updating conversation by id {conversationId}",values:{conversationId:a}})}),e}},Dt=e=>{var t;const{assistantAvailability:{isAssistantEnabled:s},http:n}=Ze(),a={page:1,per_page:1e3,filter:`consumer:${null!==(t=null==e?void 0:e.consumer)&&void 0!==t?t:"*"}`},i=[_t,a.page,a.per_page,a.filter,Re];return(0,C.useQuery)(i,(async()=>n.fetch(_t,{method:"GET",version:Re,query:a,signal:null==e?void 0:e.signal})),{initialData:{data:[],page:1,perPage:5,total:0},placeholderData:{data:[],page:1,perPage:5,total:0},keepPreviousData:!0,enabled:s})},Nt=()=>{const{http:e,toasts:t}=Ze(),{data:{data:s}}=Dt(),n=(0,o.useCallback)((async(s,n)=>Rt({http:e,id:s,toasts:n?void 0:t})),[e,t]),a=(0,o.useCallback)((async s=>{let n=[];const a=await Rt({http:e,id:s,toasts:t});return null!=a&&(n=a.messages.slice(0,a.messages.length-1),await Lt({http:e,conversationId:s,messages:n,toasts:t})),n}),[e,t]),i=(0,o.useCallback)((async n=>{if(n.apiConfig){var a;const i=null===(a=xt({allSystemPrompts:s,conversation:n}))||void 0===a?void 0:a.id;return Lt({http:e,toasts:t,conversationId:n.id,apiConfig:{...n.apiConfig,defaultSystemPromptId:i},messages:[],replacements:{}})}}),[s,e,t]),r=(0,o.useCallback)((async s=>(async({http:e,conversation:t,signal:s,toasts:n})=>{try{return await e.post(St,{body:JSON.stringify(t),version:Re,signal:s})}catch(e){throw null==n||n.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:S.i18n.translate("xpack.elasticAssistant.conversations.createConversationError",{defaultMessage:"Error creating conversation with title {title}",values:{title:t.title}})}),e}})({http:e,conversation:s,toasts:t})),[e,t]),l=(0,o.useCallback)((async s=>{await(async({http:e,id:t,signal:s,toasts:n})=>{try{return await e.fetch(`${St}/${t}`,{method:"DELETE",version:Re,signal:s})}catch(e){throw null==n||n.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:S.i18n.translate("xpack.elasticAssistant.conversations.deleteConversationError",{defaultMessage:"Error deleting conversation by id {id}",values:{id:t}})}),e}})({http:e,id:s,toasts:t})}),[e,t]),d=(0,o.useCallback)((async({conversation:s,apiConfig:n})=>""===s.id?{...s,apiConfig:n}:Lt({http:e,conversationId:s.id,apiConfig:n,toasts:t})),[e,t]),c=(0,o.useCallback)((({conversationId:t,updatedTitle:s})=>Lt({http:e,conversationId:t,title:s})),[e]),u=(0,o.useCallback)((({conversationId:t,updatedUsers:s})=>Lt({http:e,conversationId:t,users:s})),[e]),p=(0,o.useCallback)((async({refetchCurrentUserConversations:e,selectedConversation:s,setCurrentConversation:a})=>{try{var i;if(!s||""===s.id)throw new Error("No conversation available to duplicate");let l=s;if(0===(null!==(i=s.messages)&&void 0!==i?i:[]).length){const e=await n(s.id,!0);e&&(l=e)}const d=await r({title:`[${it}] ${l.title}`,apiConfig:l.apiConfig,messages:l.messages,replacements:l.replacements});if(!d)throw new Error("Failed to duplicate conversation");await e(),a(d),null==t||t.addSuccess({title:(o=d.title,S.i18n.translate("xpack.elasticAssistant.assistant.settings.conversation.duplicateSuccess",{defaultMessage:"{title} created successfully",values:{title:o}}))})}catch(e){null==t||t.addError(e,{title:ot})}var o}),[r,n,t]),m=(0,o.useCallback)((async s=>{try{var n;if(!s)throw new Error("No conversation id available to copy");const a=null==e?void 0:e.basePath.prepend(`/app/security/get_started?assistant=${s.id}`);if(!a)throw new Error("Conversation URL does not exist");const i=new URL(a,window.location.origin).toString();null===(n=navigator.clipboard)||void 0===n||n.writeText(i),null==t||t.addSuccess({title:rt})}catch(e){null==t||t.addError(e,{title:lt})}}),[null==e?void 0:e.basePath,t]);return{clearConversation:i,deleteConversation:l,removeLastMessage:a,setApiConfig:d,updateConversationTitle:c,createConversation:r,getConversation:n,updateConversationUsers:u,copyConversationUrl:m,duplicateConversation:p}},Zt=({refetchCurrentUserConversations:e,selectedConversation:t,setCurrentConversation:s})=>{const{euiTheme:n}=(0,u.useEuiTheme)(),a=`${M}.${z}.${null==t?void 0:t.id}`,[i,r]=f()(a,!0),l=(0,o.useCallback)((()=>{r(!1)}),[r]),{duplicateConversation:d}=Nt(),c=(0,o.useCallback)((()=>d({refetchCurrentUserConversations:e,selectedConversation:t,setCurrentConversation:s})),[d,e,t,s]),p=(0,o.useMemo)((()=>nt(et(t))),[t]);return i&&t?(0,g.jsx)(u.EuiCallOut,{"data-test-subj":"sharedConversationCallout",css:(0,g.css)("margin:",n.size.m,";padding:",n.size.m,";",""),size:"s",title:ct,iconType:p,onDismiss:l},pt,(0,g.jsx)("br",null),(0,g.jsx)("br",null),(0,g.jsx)(u.EuiButton,{"data-test-subj":"duplicateConversation",onClick:c,iconType:"copy",color:"primary",fill:!0,size:"s"},it)):null};Zt.displayName="SharedConversationCalloutComponent";const Bt=r().memo(Zt),Ut=e=>(0,g.jsx)("svg",(0,Ue.default)({xmlns:"http://www.w3.org/2000/svg",height:"100%",width:"100%",viewBox:"0 0 64 64",fill:"none"},e),(0,g.jsx)("path",{fill:"#F04E98",d:"M36 28h24v36H36V28Z"}),(0,g.jsx)("path",{fill:"#02BCB7",d:"M4 46c0-9.941 8.059-18 18-18h6v36h-6c-9.941 0-18-8.059-18-18Z"}),(0,g.jsx)("path",{fill:"#0B64DD",d:"M60 12c0 6.627-5.373 12-12 12s-12-5.373-12-12S41.373 0 48 0s12 5.373 12 12Z"}),(0,g.jsx)("path",{fill:"#FEC514",d:"M6 23C6 10.85 15.85 1 28 1v22H6Z"})),$t=({size:e="m",...t})=>(0,g.jsx)(u.EuiIcon,(0,Ue.default)({type:Ut,size:e},t)),Vt=S.i18n.translate("xpack.aiAssistant.avatar.aiAssistantLabel",{defaultMessage:"AI Assistant"}),Gt=({color:e="plain",size:t="m",...s})=>(0,g.jsx)(u.EuiAvatar,(0,Ue.default)({},s,{color:e,size:t,name:Vt,iconType:$t})),Kt=({backgroundColor:e,size:t="xxl",ringsColor:s})=>{const{root:n,rings:a}=(({backgroundColor:e="body",size:t="xxl",ringsColor:s})=>{const{euiTheme:{colors:n}}=(0,u.useEuiTheme)(),{maskPoint:a,ringSize:i,rootSize:o}=((e="xxl")=>{const{euiTheme:{size:t}}=(0,u.useEuiTheme)(),s=parseInt(t[e],10),n=s+Math.max(s/2,parseInt(t.m,10));return{rootSize:2*n,ringSize:n,maskPoint:n+1}})(t),r=n[e];return{root:(0,g.css)("background-color:",r,";display:flex;justify-content:center;align-items:center;position:relative;width:",o,"px;height:",o,"px;&:after{content:'';position:absolute;height:",a,"px;width:",a,"px;z-index:2;border:2px solid ",r,";border-radius:50%;}",""),rings:(0,g.css)("display:inline-block;position:absolute;height:",i,"px;width:",i,"px;@keyframes outer{0%{opacity:1;transform:scaleY(1) scaleX(1);}20%{opacity:0.5;}70%{opacity:0.2;transform:scaleY(2) scaleX(2);}80%{opacity:0;transform:scaleY(2) scaleX(2);}90%{opacity:0;transform:scaleY(1) scaleX(1);}}@keyframes inner{0%{opacity:1;transform:scaleY(1) scaleX(1);}15%{opacity:1;transform:scaleY(1) scaleX(1);}40%{opacity:0.5;}70%{opacity:0.2;transform:scaleY(1.5) scaleX(1.5);}80%{opacity:0;transform:scaleY(1.5) scaleX(1.5);}90%{opacity:0;transform:scaleY(1) scaleX(1);}}&:before,&:after{content:'';position:absolute;width:",i,"px;height:",i,"px;top:0;left:0;z-index:0;border:1px solid ",null!=s?s:n.primary,";border-radius:50%;animation:4s cubic-bezier(0.42, 0, 0.37, 1) 0.5s infinite normal none running;}&:before{animation-name:inner;}&:after{animation-name:outer;}","")}})({backgroundColor:e,size:t,ringsColor:s});return(0,g.jsx)("div",{css:n},(0,g.jsx)($t,{size:t}),(0,g.jsx)("span",{css:a}))},qt=({id:e,isGloballyShared:t})=>{const{euiTheme:s}=(0,u.useEuiTheme)(),n=`${M}.${z}.owner.${e}`,[a,i]=f()(n,!0),r=(0,o.useCallback)((()=>{i(!1)}),[i]),{icon:l,description:d,title:c}=(0,o.useMemo)((()=>t?{icon:nt(Xe.SHARED),title:ct,description:mt}:{icon:nt(Xe.RESTRICTED),title:ut,description:gt}),[t]);return a?(0,g.jsx)(u.EuiCallOut,{"data-test-subj":"ownerSharedConversationCallout",css:(0,g.css)("margin:",s.size.m,";padding:",s.size.m,";",""),size:"s",title:c,iconType:l,onDismiss:r},d):null};qt.displayName="SharedConversationOwnerCalloutComponent";const Ht=r().memo(qt);var Qt=s(375),Wt=s(81);const Yt=__kbnSharedDeps__.Lodash,Jt=(0,Wt.css)({name:"1hve94u",styles:"max-width:50%;min-width:calc(50% - 8px)"}),Xt=(0,Wt.css)({name:"1fso55n",styles:"text-align:center!important"}),es=[{title:"starterPromptTitle1",description:"starterPromptDescription1",icon:"starterPromptIcon1",prompt:"starterPromptPrompt1"},{description:"starterPromptDescription2",title:"starterPromptTitle2",icon:"starterPromptIcon2",prompt:"starterPromptPrompt2"},{description:"starterPromptDescription3",title:"starterPromptTitle3",icon:"starterPromptIcon3",prompt:"starterPromptPrompt3"},{description:"starterPromptDescription4",title:"starterPromptTitle4",icon:"starterPromptIcon4",prompt:"starterPromptPrompt4"}],ts=({compressed:e=!1,connectorId:t,setUserPrompt:s})=>{const{assistantAvailability:{isAssistantEnabled:n},assistantTelemetry:a,http:i,toasts:r}=Ze(),{data:{prompts:l}}=(e=>{const{isAssistantEnabled:t,httpFetch:s,toasts:n}=e.context,a={...e.params.connector_id?{connector_id:e.params.connector_id}:{},prompt_ids:e.params.prompt_ids,prompt_group_id:e.params.prompt_group_id},i=[Ft,a.connector_id,a.prompt_ids,a.prompt_group_id,Re];return(0,C.useQuery)(i,(async()=>(async({httpFetch:e,signal:t,toasts:s,query:n})=>{try{return await e(Ft,{method:"GET",version:Re,signal:t,query:n})}catch(e){throw null==s||s.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:S.i18n.translate("xpack.elasticAssistant.securityAiPrompts.getPromptsError",{defaultMessage:"Error fetching Security AI Prompts"})}),e}})({httpFetch:s,signal:e.signal,toasts:n,query:a})),{initialData:{prompts:[]},placeholderData:{prompts:[]},keepPreviousData:!0,refetchOnWindowFocus:!1,enabled:t})})({context:{isAssistantEnabled:n,httpFetch:i.fetch,toasts:r},params:{connector_id:t,prompt_group_id:"aiAssistant",prompt_ids:ss(es)}}),d=(0,o.useMemo)((()=>l.length?ns(l):[]),[l]),c=(0,o.useCallback)((e=>{null==a||a.reportAssistantStarterPrompt({promptTitle:e})}),[a]),p=(0,o.useCallback)(((e,t)=>{s(e),c(t)}),[s,c]);return(0,g.jsx)(u.EuiFlexGroup,{direction:"row",gutterSize:"m",wrap:!0},d.map((({description:t,title:s,icon:n,prompt:a})=>(0,g.jsx)(u.EuiFlexItem,{key:a,className:Jt},(0,g.jsx)(u.EuiPanel,{paddingSize:e?"s":"m",hasShadow:!1,hasBorder:!0,"data-test-subj":`starter-prompt-${(0,Yt.kebabCase)(s)}`,onClick:()=>p(a,s),className:Xt},(0,g.jsx)(u.EuiSpacer,{size:"s"}),(0,g.jsx)(u.EuiIcon,{type:n,size:e?"m":"xl"}),(0,g.jsx)(u.EuiSpacer,{size:"s"}),(0,g.jsx)(u.EuiText,{size:e?"xs":"s"},(0,g.jsx)("h3",null,s),(0,g.jsx)("p",null,t)))))))},ss=e=>e.map((e=>[...Object.values(e)])).flat(),ns=e=>es.reduce(((t,s)=>{const n=t=>{var n;return null===(n=e.find((e=>e.promptId===s[t])))||void 0===n?void 0:n.prompt},a={prompt:n("prompt"),icon:n("icon"),title:n("title"),description:n("description")};return a.prompt&&a.icon&&a.title&&a.description&&t.push(a),t}),[]);function as(e,t){""===e.trim()&&t.addIssue({code:N.custom,message:"No empty strings allowed"})}we().min(1).superRefine(as);const is=we().min(1).superRefine(as),os=we().min(1).superRefine(as),rs=(we().uuid(),Pe({id:we().optional(),name:we().optional()})),ls=(Ie(["asc","desc"]).enum,Pe({timeZone:we().optional()}),Pe({failed:Ae().int(),skipped:Ae().int(),succeeded:Ae().int(),total:Ae().int()})),ds=Pe({query:we().optional(),ids:_e(we()).min(1).optional()}),cs=(Pe({promptId:we(),promptGroupId:we()}),Te("PROMPT_FIELD_NOT_MODIFIED")),us=Pe({id:we(),name:we().optional(),skip_reason:cs}),ps=Pe({id:we(),name:we().optional()}),ms=Ie(["system","quick"]),gs=ms.enum,hs=Pe({message:we(),status_code:Ae().int(),err_code:we().optional(),prompts:_e(ps)}),vs=Pe({id:is,timestamp:os.optional(),name:we(),promptType:ms,content:we(),categories:_e(we()).optional(),color:we().optional(),isNewConversationDefault:je().optional(),isDefault:je().optional(),consumer:we().optional(),updatedAt:we().optional(),updatedBy:we().optional(),createdAt:we().optional(),createdBy:we().optional(),users:_e(rs).optional(),namespace:we().optional()}),fs=Pe({updated:_e(vs),created:_e(vs),deleted:_e(we()),skipped:_e(us)}),ys=(Pe({success:je().optional(),status_code:Ae().int().optional(),message:we().optional(),prompts_count:Ae().int().optional(),attributes:Pe({results:fs,summary:ls,errors:_e(hs).optional()})}),Pe({name:we(),promptType:ms,content:we(),color:we().optional(),categories:_e(we()).optional(),isNewConversationDefault:je().optional(),isDefault:je().optional(),consumer:we().optional()})),xs=Pe({id:we(),content:we().optional(),color:we().optional(),categories:_e(we()).optional(),isNewConversationDefault:je().optional(),isDefault:je().optional(),consumer:we().optional()}),bs=(Pe({delete:ds.optional(),create:_e(ys).optional(),update:_e(xs).optional()}),S.i18n.translate("xpack.elasticAssistant.assistant.firstPromptEditor.clearSystemPrompt",{defaultMessage:"Clear system prompt"})),Cs=S.i18n.translate("xpack.elasticAssistant.assistant.firstPromptEditor.selectASystemPromptPlaceholder",{defaultMessage:"Select a system prompt"}),ks=S.i18n.translate("xpack.elasticAssistant.assistant.firstPromptEditor.addNewSystemPrompt",{defaultMessage:"Add new system prompt..."}),Ss=S.i18n.translate("xpack.elasticAssistant.assistant.firstPromptEditor.emptyPrompt",{defaultMessage:"(empty prompt)"}),Es=Je("strong",{target:"eqnkmgl0"})("margin-right:",(e=>e.theme.euiTheme.size.s),";"),ws=({name:e})=>{const{euiTheme:t}=(0,u.useEuiTheme)();return(0,g.jsx)("span",{"data-test-subj":"systemPromptText",css:(0,g.css)("color:",t.colors.darkestShade,";","")},e)},As="systemPromptSelector",js="systemPromptModalPromptText",_s="systemPromptModalToggleDefaultConversations",Ps=S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.promptContextSelector.ariaLabel",{defaultMessage:"Select Prompt Context categories this Quick Prompt will be available for."}),Ts=S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.promptContextSelector.prefixLabel",{defaultMessage:"Select Prompt"}),Is=S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.promptContextSelector.placeholderLabel",{defaultMessage:"(Quick Prompt will always be visible)."}),Ms="quick_prompts",zs="system_prompts",Fs="knowledge_base",Os="ADD_NEW_SYSTEM_PROMPT";var Rs={name:"pozf4a",styles:"position:absolute;right:36px"},Ls={name:"1bxycju",styles:"min-width:100%"},Ds={name:"qhxz92",styles:"max-width:100%"},Ns={name:"bjn8wh",styles:"position:relative"};const Zs=({allPrompts:e,compressed:t=!1,clearSelectedSystemPrompt:s,isClearable:n=!1,isDisabled:a=!1,isOpen:i=!1,isSettingsModalVisible:l,onSystemPromptSelectionChange:d,selectedPrompt:c,setIsSettingsModalVisible:p})=>{const{euiTheme:m}=(0,u.useEuiTheme)(),{setSelectedSettingsTab:v}=Ze(),f=(0,o.useMemo)((()=>e.filter((e=>e.promptType===gs.system))),[e]),[y,x]=(0,o.useState)(i),b=(0,o.useCallback)((()=>x(!1)),[]),C=(0,o.useMemo)((()=>null==c?void 0:c.id),[null==c?void 0:c.id]),k=(0,o.useMemo)((()=>({value:Os,inputDisplay:ks,dropdownDisplay:(0,g.jsx)(u.EuiFlexGroup,{gutterSize:"none",key:Os},(0,g.jsx)(u.EuiFlexItem,{grow:!0},(0,g.jsx)(u.EuiButtonEmpty,{href:"#",iconType:"plus",size:"xs","data-test-subj":"addSystemPrompt"},ks)),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)("div",{style:{width:"24px"}})))})),[]),S=(0,o.useMemo)((()=>{return null!==(t=null==(e=f)?void 0:e.map((e=>(({content:e,id:t,name:s})=>({value:t,inputDisplay:(0,g.jsx)(ws,{name:s}),dropdownDisplay:(0,g.jsx)(r().Fragment,null,(0,g.jsx)(Es,{"data-test-subj":`systemPrompt-${s}`},s),(0,g.jsx)(u.EuiToolTip,{content:void 0},(0,g.jsx)(u.EuiText,{tabIndex:0,color:"subdued","data-test-subj":"content",size:"s"},(0,h.isEmpty)(e)?(0,g.jsx)("p",null,Ss):(0,g.jsx)("p",null,e))))}))(e))))&&void 0!==t?t:[];var e,t}),[f]),E=(0,o.useCallback)((async e=>{if(e===Os)return null==p||p(!0),void v(zs);d(e)}),[d,p,v]),w=(0,o.useCallback)((()=>{null==s||s()}),[s]);return(0,g.jsx)(u.EuiFlexGroup,{"data-test-subj":"selectSystemPrompt",gutterSize:"none",alignItems:"center",css:Ns},(0,g.jsx)(u.EuiFlexItem,{css:Ds},(0,g.jsx)(u.EuiFormRow,{css:Ls},(0,g.jsx)(u.EuiSuperSelect,{popoverProps:{zIndex:m.levels.modal},compressed:t,"data-test-subj":"promptSuperSelect",fullWidth:!0,hasDividers:!0,itemLayoutAlign:"top",disabled:a,isOpen:y&&!l,onChange:E,onBlur:b,options:[...S,k],placeholder:Cs,valueOfSelected:C,prepend:l?void 0:Ts,css:(0,g.css)("padding-right:56px!important;",t?"font-size: 0.9rem;":"",";","")}))),(0,g.jsx)(u.EuiFlexItem,{grow:!1,css:Rs},n&&c&&(0,g.jsx)(u.EuiToolTip,{content:bs,disableScreenReaderOutput:!0},(0,g.jsx)(u.EuiButtonIcon,{"aria-label":bs,"data-test-subj":"clearSystemPrompt",iconType:"cross",onClick:w,css:(0,g.css)("inline-size:16px;block-size:16px;border-radius:16px;background:",m.colors.backgroundBaseSubdued,";:hover:not(:disabled){background:",m.colors.backgroundBaseSubdued,";transform:none;}>svg{width:8px;height:8px;stroke-width:2px;fill:#fff;stroke:#fff;}","")}))))};Zs.displayName="SelectSystemPromptComponent";const Bs=r().memo(Zs),Us=({allSystemPrompts:e,currentSystemPromptId:t,isSettingsModalVisible:s,compressed:n=!1,onSystemPromptSelectionChange:a,setIsSettingsModalVisible:i})=>{const r=(0,o.useMemo)((()=>void 0!==t?e.find((e=>e.id===t)):void 0),[e,t]),l=(0,o.useCallback)((()=>{a(void 0)}),[a]);return(0,g.jsx)(Bs,{allPrompts:e,clearSelectedSystemPrompt:l,"data-test-subj":"systemPrompt",isClearable:!0,isSettingsModalVisible:s,compressed:n,onSystemPromptSelectionChange:a,selectedPrompt:r,setIsSettingsModalVisible:i})};Us.displayName="SystemPromptComponent";const $s=r().memo(Us),Vs=["elastic-assistant","knowledge-base-status"],Gs=({http:e,resource:t,toasts:s,enabled:n})=>(0,C.useQuery)(Vs,(async({signal:s})=>(async({http:e,resource:t,signal:s})=>{try{const n=Mt.replace("{resource?}",t||"");return await e.fetch(n,{method:"GET",signal:s,version:Re})}catch(e){return e}})({http:e,resource:t,signal:s})),{enabled:n,retry:!1,keepPreviousData:!0,refetchInterval:e=>!!(null!=e&&e.is_setup_in_progress||"installing"===(null==e?void 0:e.product_documentation_status))&&3e4,onError:e=>{"AbortError"!==e.name&&(null==s||s.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:S.i18n.translate("xpack.elasticAssistant.knowledgeBase.statusError",{defaultMessage:"Error fetching Knowledge Base Status"})}))}}),Ks=[zt,1,100,Re],qs=["elastic-assistant","post-knowledge-base"];var Hs={name:"1q4vxyr",styles:"margin-left:8px"};const Qs=r().memo((({display:e,fill:t})=>{const{http:s,toasts:n,assistantAvailability:{isAssistantEnabled:a}}=Ze(),{data:i}=Gs({http:s,enabled:a}),{mutate:r,isLoading:l}=(({http:e,toasts:t})=>{const s=(()=>{const e=(0,C.useQueryClient)();return(0,o.useCallback)((()=>{e.invalidateQueries(Vs,{refetchType:"all"})}),[e])})(),n=(()=>{const e=(0,C.useQueryClient)();return(0,o.useCallback)((()=>{e.invalidateQueries(Ks,{refetchType:"active"})}),[e])})();return(0,C.useMutation)(qs,(t=>(async({http:e,resource:t,signal:s})=>{const n=Mt.replace("{resource?}",t||"");return await e.fetch(n,{method:"POST",signal:s,version:Re})})({http:e,resource:null!=t?t:void 0})),{onError:e=>{"AbortError"!==e.name&&(null==t||t.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:S.i18n.translate("xpack.elasticAssistant.knowledgeBase.setupError",{defaultMessage:"Error setting up Knowledge Base"})}))},onSettled:()=>{s(),n()}})})({http:s,toasts:n}),d=(null==i?void 0:i.is_setup_in_progress)||l,c=(null==i?void 0:i.elser_exists)&&(null==i?void 0:i.security_labs_exists),p=(0,o.useCallback)((()=>{r()}),[r]);if(c)return null;const m=null!=i&&i.is_setup_available?void 0:S.i18n.translate("xpack.elasticAssistant.knowledgeBase.installKnowledgeBaseButtonToolTip",{defaultMessage:"Knowledge Base unavailable, please see documentation for more details."});return"refresh"===e?(0,g.jsx)(u.EuiButtonIcon,{color:"primary","data-test-subj":"setup-knowledge-base-button",disabled:!(null!=i&&i.is_setup_available),isLoading:d,iconType:"refresh",onClick:p,size:"xs","aria-label":S.i18n.translate("xpack.elasticAssistant.knowledgeBase.installKnowledgeBaseButton",{defaultMessage:"Setup Knowledge Base"}),css:Hs}):(0,g.jsx)(u.EuiToolTip,{position:"bottom",content:m},"mini"===e?(0,g.jsx)(u.EuiButtonEmpty,{color:"primary","data-test-subj":"setup-knowledge-base-button",disabled:!(null!=i&&i.is_setup_available),isLoading:d,iconType:"importAction",onClick:p,size:"xs"},S.i18n.translate("xpack.elasticAssistant.knowledgeBase.installKnowledgeBaseButton",{defaultMessage:"Setup Knowledge Base"})):(0,g.jsx)(u.EuiButton,{color:"primary","data-test-subj":"setup-knowledge-base-button",fill:null==t||t,disabled:!(null!=i&&i.is_setup_available),isLoading:d,iconType:"importAction",onClick:p},S.i18n.translate("xpack.elasticAssistant.knowledgeBase.installKnowledgeBaseButton",{defaultMessage:"Setup Knowledge Base"})))}));Qs.displayName="SetupKnowledgeBaseButton";const Ws={name:"ejw6tk",styles:"max-width:95%"};var Ys={name:"b60aq9",styles:"max-width:400px;text-align:center"};const Js=({allSystemPrompts:e,connectorId:t,currentSystemPromptId:s,isSettingsModalVisible:n,setCurrentSystemPromptId:a,setIsSettingsModalVisible:i,setUserPrompt:r})=>{const l=function(){const[e,t]=(0,Qt.A)((()=>window.innerHeight));return(0,o.useEffect)((()=>{const e=()=>{const e=window.innerHeight;t((t=>t!==e?e:t))};return window.addEventListener("resize",e,{passive:!0}),()=>{window.removeEventListener("resize",e)}}),[t]),e<600?"short":e<1100?"medium":"tall"}(),d=(0,o.useMemo)((()=>"tall"!==l),[l]);return(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween","data-test-subj":"emptyConvo",direction:"column",gutterSize:d?"m":"l"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiPanel,{hasShadow:!1,css:Ys},(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center",justifyContent:"center",direction:"column",gutterSize:d?"m":"l"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(Kt,{backgroundColor:"emptyShade",size:d?"m":"xl"})),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiText,{size:d?"xs":"relative"},(0,g.jsx)("h3",null,j),(0,g.jsx)("p",null,_))),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)($s,{allSystemPrompts:e,currentSystemPromptId:s,isSettingsModalVisible:n,onSystemPromptSelectionChange:a,setIsSettingsModalVisible:i,compressed:d})),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(Qs,d?{display:"mini"}:{}))))),(0,g.jsx)(u.EuiFlexItem,{grow:!1,css:Ws},(0,g.jsx)(ts,{compressed:d,connectorId:t,setUserPrompt:r})))};var Xs=s(701);const en=S.i18n.translate("xpack.elasticAssistant.connectors.useLoadActionTypes.errorMessage",{defaultMessage:"An error occurred loading the Kibana Actions. "}),tn=S.i18n.translate("xpack.elasticAssistant.connectors.useLoadConnectors.errorMessage",{defaultMessage:"An error occurred loading the Kibana Connectors. "}),sn=(S.i18n.translate("xpack.elasticAssistant.assistant.connectors.preconfiguredTitle",{defaultMessage:"Preconfigured"}),S.i18n.translate("xpack.elasticAssistant.assistant.connectors.connectorSelector.ariaLabel",{defaultMessage:"Connector Selector"}),S.i18n.translate("xpack.elasticAssistant.assistant.connectors.connectorSelector.newConnectorOptions",{defaultMessage:"Add new Connector..."}),S.i18n.translate("xpack.elasticAssistant.assistant.connectors.connectorSelector.addConnectorButtonLabel",{defaultMessage:"Add connector"})),nn=S.i18n.translate("xpack.elasticAssistant.assistant.connectors.connectorSelectorInline.connectorPlaceholder",{defaultMessage:"Select a connector"}),an=S.i18n.translate("xpack.elasticAssistant.assistant.connectors.addConnectorButton.title",{defaultMessage:"Add Generative AI Connector"}),on=S.i18n.translate("xpack.elasticAssistant.assistant.connectors.addConnectorButton.description",{defaultMessage:"Configure a connector to continue the conversation"}),rn=S.i18n.translate("xpack.elasticAssistant.assistant.connectors.addConnectorButton.missingPrivilegesTitle",{defaultMessage:"Generative AI Connector Required"}),ln=S.i18n.translate("xpack.elasticAssistant.assistant.connectors.addConnectorButton.missingPrivilegesDescription",{defaultMessage:"Please contact your administrator to enable a Generative AI Connector."}),dn=S.i18n.translate("xpack.elasticAssistant.assistant.connectors.connectorMissingCallout.calloutTitle",{defaultMessage:"The current conversation is missing a connector configuration"}),cn=(0,Wt.css)({name:"3yy737",styles:"inline-size:150px;.euiKeyPadMenuItem__label{white-space:nowrap;overflow:hidden;}"}),un=r().memo((({actionTypes:e,actionTypeRegistry:t,onClose:s,onSelect:n,actionTypeSelectorInline:a})=>{const i=(0,u.useGeneratedHtmlId)(),l=(0,o.useMemo)((()=>(0,g.jsx)(u.EuiFlexGroup,{justifyContent:"center",responsive:!1,wrap:!0},null==e?void 0:e.map((e=>{const s=t.get(e.id);return(0,g.jsx)(u.EuiFlexItem,{"data-test-subj":"action-option",key:e.id,grow:!1},(0,g.jsx)(u.EuiKeyPadMenuItem,{className:cn,key:e.id,isDisabled:!e.enabled,label:e.name,"data-test-subj":`action-option-${e.name}`,onClick:()=>n(e)},(0,g.jsx)(u.EuiIcon,{size:"xl",type:s.iconClass})))})))),[t,e,n]);return null!=e&&e.length?a?(0,g.jsx)(r().Fragment,null,l):(0,g.jsx)(u.EuiModal,{onClose:s,"data-test-subj":"action-type-selector-modal","aria-labelledby":i},(0,g.jsx)(u.EuiModalHeader,null,(0,g.jsx)(u.EuiModalHeaderTitle,{id:i},nn)),(0,g.jsx)(u.EuiModalBody,null,l)):null}));un.displayName="ActionTypeSelectorModal";const pn=r().memo((({actionTypeRegistry:e,actionTypes:t,onClose:s,onSaveConnector:n,onSelectActionType:a,selectedActionType:i,actionTypeSelectorInline:l=!1})=>(0,g.jsx)(r().Fragment,null,(0,g.jsx)(o.Suspense,{fallback:null},(0,g.jsx)(un,{actionTypes:t,actionTypeRegistry:e,onClose:s,onSelect:a,actionTypeSelectorInline:l})),i&&(0,g.jsx)(Xs.ConnectorAddModal,{actionType:i,actionTypeRegistry:e,onClose:s,postSaveEventHandler:n}))));pn.displayName="AddConnectorModal";const mn={id:"123",name:"elastic"},gn={id:"",title:at,category:"assistant",messages:[],replacements:{},excludeFromLastConversationStorage:!0,createdBy:mn,users:[mn],createdAt:"2025-08-06T17:33:12.110Z"};var hn=s(728);const vn=["elastic-assistant, load-action-types"],fn=({http:e,toasts:t})=>(0,C.useQuery)(vn,(async()=>{const t=await(0,Xs.loadActionTypes)({http:e,featureId:hn.GenerativeAIForSecurityConnectorFeatureId}),s=[".bedrock",".gen-ai",".gemini"];return t.filter((e=>s.includes(e.id))).sort(((e,t)=>e.name.localeCompare(t.name)))}),{retry:!1,keepPreviousData:!0,staleTime:6e4,onError:e=>{"AbortError"!==e.name&&(null==t||t.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:en}))}}),yn="genAiSettings:defaultAIConnector",xn=["elastic-assistant, load-connectors"],bn=[".bedrock",".gen-ai",".gemini"],Cn=({http:e,toasts:t,inferenceEnabled:s=!1,settings:n})=>((0,o.useEffect)((()=>{s&&!bn.includes(".inference")&&bn.push(".inference")}),[s]),(0,C.useQuery)(xn,(async()=>(({allAiConnectors:e,settings:t})=>{const s=t.client.get(yn),n=t.client.get("genAiSettings:defaultAIConnectorOnly",!1),a=e.filter((e=>!n||e.id===s));return a.length>0?a:e})({allAiConnectors:(await(0,Xs.loadAllActions)({http:e})).flatMap((e=>{var t,s;return!e.isMissingSecrets&&bn.includes(e.actionTypeId)?[{...e,apiProvider:e.isPreconfigured||e.isSystemAction||null==e||null===(t=e.config)||void 0===t||!t.apiProvider||null==e||null===(s=e.config)||void 0===s?void 0:s.apiProvider}]:[]})),settings:n})),{retry:!1,keepPreviousData:!0,onError:e=>{"AbortError"!==e.name&&(null==t||t.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:tn}))}})),kn=({conversation:e,onConversationUpdate:t,updateConversationsOnSaveConnector:s=!0})=>{const n=(0,o.useMemo)((()=>e||gn),[e]),{setApiConfig:a}=Nt(),{actionTypeRegistry:i,http:r,inferenceEnabled:l,settings:d}=Ze(),{refetch:c}=Cn({http:r,inferenceEnabled:l,settings:d}),{data:u}=fn({http:r}),[p,m]=(0,o.useState)(null),h=(0,o.useCallback)((async e=>{if(s&&""!==n.id){const s=vt(e),i=await a({conversation:n,apiConfig:{...n.apiConfig,connectorId:e.id,actionTypeId:e.actionTypeId,provider:null==s?void 0:s.apiProvider,model:null==s?void 0:s.defaultModel}});i&&(null==t||t({cId:i.id}))}null==c||c()}),[n,t,c,a,s]),v=(0,o.useCallback)((()=>{m(null)}),[]);return(0,g.jsx)(pn,{actionTypeRegistry:i,actionTypes:u,onClose:v,onSaveConnector:h,onSelectActionType:m,selectedActionType:p,actionTypeSelectorInline:!0})};var Sn={name:"1y0ex1",styles:"max-width:400px"},En={name:"1azakc",styles:"text-align:center"};const wn=({handleOnConversationSelected:e,currentConversation:t})=>(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center",justifyContent:"center"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiPanel,{hasShadow:!1,css:En},(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center",justifyContent:"center",direction:"column","data-test-subj":"welcome-setup"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(Kt,{backgroundColor:"emptyShade"})),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiText,null,(0,g.jsx)("h3",null,P))),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiText,{color:"subdued",css:Sn},(0,g.jsx)("p",null,T))),(0,g.jsx)(u.EuiFlexItem,{grow:!1,"data-test-subj":"connector-prompt"},(0,g.jsx)(kn,{conversation:t,onConversationUpdate:e})))))),An=S.i18n.translate("xpack.elasticAssistant.securityAssistant.content.prompts.welcome.enterprisePrompt",{defaultMessage:"Elastic AI Assistant is available to Enterprise users only. Please upgrade your license to use this feature."}),jn=S.i18n.translate("xpack.elasticAssistant.components.upgrade.upgradeTitle",{defaultMessage:"Manage license"}),_n=S.i18n.translate("xpack.elasticAssistant.components.upgrade.upgradeButtonLabel",{defaultMessage:"Subscription plans"}),Pn=({basePath:e})=>(0,g.jsx)(u.EuiFlexGroup,{gutterSize:"s",wrap:!0,"data-test-subj":"upgrade-buttons",justifyContent:"spaceAround"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiButton,{href:"https://www.elastic.co/subscriptions",iconType:"popout",iconSide:"right",target:"_blank"},_n)),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiButton,{href:`${e}/app/management/stack/license_management`,iconType:"gear",target:"_blank"},jn))),Tn=r().memo(Pn);Tn.displayName="UpgradeButtons";var In={name:"3s4yqf",styles:"width:400px"},Mn={name:"1d3w5wq",styles:"width:100%"};const zn=({http:e})=>{const t=e.basePath.get();return(0,g.jsx)(u.EuiFlexGroup,{"data-test-subj":"upgradeLicenseCallToAction",justifyContent:"center",direction:"column",alignItems:"center",gutterSize:"l",css:Mn},(0,g.jsx)(u.EuiFlexItem,{grow:!1,css:In},(0,g.jsx)(u.EuiText,null,(0,g.jsx)("p",null,An))),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(Tn,{basePath:t})))},Fn=({allSystemPrompts:e,comments:t,conversationSharedState:s,currentConversation:n,currentSystemPromptId:a,handleOnConversationSelected:i,setCurrentSystemPromptId:r,http:l,isAssistantEnabled:d,isConversationOwner:c,isLoading:p,isSettingsModalVisible:m,isWelcomeSetup:h,setIsSettingsModalVisible:v,setUserPrompt:f})=>{var y,x;const{euiTheme:b}=(0,u.useEuiTheme)(),C=(0,o.useMemo)((()=>0===(null==n?void 0:n.messages.length)),[null==n?void 0:n.messages.length]),k=(0,o.useMemo)((()=>C&&(0,g.jsx)(u.EuiText,{"data-test-subj":"assistant-disclaimer",textAlign:"center",color:b.colors.textDisabled,size:"xs",css:(0,g.css)("margin:0 ",b.size.l," ",b.size.m," ",b.size.l,";","")},I)),[b,C]),S=(0,o.useRef)(null);return(0,o.useEffect)((()=>{var e,t,s;const n=null===(e=S.current)||void 0===e?void 0:e.parentElement;n&&(n.scrollTop=n.scrollHeight,null===(t=(null===(s=S.current)||void 0===s?void 0:s.childNodes[0].childNodes[0]).lastElementChild)||void 0===t||t.scrollIntoView())}),[n]),d?(0,g.jsx)(u.EuiFlexGroup,{direction:"column",justifyContent:"spaceBetween"},(0,g.jsx)(u.EuiFlexItem,null,p?(0,g.jsx)(u.EuiEmptyPrompt,{"data-test-subj":"animatedLogo",icon:(0,g.jsx)(Kt,{backgroundColor:"emptyShade"})}):h?(0,g.jsx)(wn,{currentConversation:n,handleOnConversationSelected:i}):C?(0,g.jsx)(Js,{allSystemPrompts:e,currentSystemPromptId:a,isSettingsModalVisible:m,setCurrentSystemPromptId:r,setIsSettingsModalVisible:v,setUserPrompt:f,connectorId:null==n||null===(y=n.apiConfig)||void 0===y?void 0:y.connectorId}):(0,g.jsx)(u.EuiPanel,{hasShadow:!1,panelRef:e=>{S.current=(null==e?void 0:e.parentElement)||null}},t)),(0,g.jsx)(u.EuiFlexItem,{grow:!1},c&&s!==Xe.PRIVATE&&(0,g.jsx)(Ht,{id:null!==(x=null==n?void 0:n.id)&&void 0!==x?x:"",isGloballyShared:s===Xe.SHARED})),(0,g.jsx)(u.EuiFlexItem,{grow:!1},k)):(0,g.jsx)(zn,{http:l})},On=e=>{const{response:t,isStream:s,isError:n}=e,a=(new Date).toISOString();return e?{role:"assistant",...s?{reader:t}:{content:t},timestamp:a,isError:n,traceData:e.traceData,metadata:e.metadata}:{role:"assistant",content:"Error: Response from LLM API is empty or undefined.",timestamp:a,isError:!0}},Rn=e=>new Promise((t=>setTimeout(t,e))),Ln={page:0,perPage:1e3,sortField:"field",sortOrder:"asc"},Dn=e=>{const{all:t,page:s=Ln.page,perPage:n=Ln.perPage,sortField:a=Ln.sortField,sortOrder:i=Ln.sortOrder,signal:r,filter:l}=e||{},{http:d,assistantAvailability:{isAssistantEnabled:c}}=Ze(),u=(0,o.useCallback)((async({pageParam:e={page:s,perPage:n,sortField:a,sortOrder:i,filter:l,all:t}})=>{const{page:o=s,perPage:c=n,sortField:u=a,sortOrder:p=i,filter:m="",all:g}=e,h=(e=>e&&0!==e.length?e.split(" ").map((e=>"is:allowed"===e?"allowed: true":"is:anonymized"===e?"anonymized: true":`field: ${e}*`)).join(" AND "):null)(m);return d.fetch(It,{method:"GET",version:Re,query:{page:o+1,per_page:c,sort_field:u,sort_order:p,...h?{filter:h}:{},all_data:g},signal:r})}),[s,n,a,i,l,t,d,r]),p=(0,o.useCallback)((e=>{const t=Math.ceil(e.total/e.perPage);if(e.page<t)return{page:e.page+1,sortField:a,sortOrder:i}}),[a,i]),m=[a,i,n,Re,It,s,l,t],{refetch:g,data:h,isFetched:v,isFetching:f,isError:y,isLoading:x}=(0,C.useInfiniteQuery)(m,u,{getNextPageParam:p,enabled:c,refetchOnWindowFocus:!0});return{refetch:g,data:(0,o.useMemo)((()=>{var e;return null!==(e=null==h?void 0:h.pages.at(-1))&&void 0!==e?e:{page:s,perPage:n,total:0,data:[],aggregations:{},...t?{all:[]}:{}}}),[h,s,n,t]),isFetched:v,isFetching:f,isError:y,isLoading:x}},Nn=["id","title","apiConfig","updatedAt"],Zn=({currentUser:e,http:t,fields:s=Nn,filter:n,page:a=1,perPage:i=28,signal:r,sortField:l="updated_at",sortOrder:d="desc",refetchOnWindowFocus:c=!0,isAssistantEnabled:u,isConversationOwner:p=!1,setTotalItemCount:m})=>{const g=(0,o.useCallback)((async({pageParam:e})=>{var o,c;return t.fetch(wt,{method:"GET",version:Re,query:{fields:s,filter:n,page:null!==(o=null==e?void 0:e.page)&&void 0!==o?o:a,per_page:null!==(c=null==e?void 0:e.perPage)&&void 0!==c?c:i,sort_field:l,sort_order:d,is_owner:p},signal:r})}),[s,n,t,p,a,i,r,l,d]),h=(0,o.useCallback)((e=>{if(Math.max(1,Math.ceil(e.total/e.perPage))!==e.page)return{...e,page:e.page+1}}),[]),{data:v,fetchNextPage:f,hasNextPage:y,isFetched:x,isFetching:b,isLoading:k,refetch:S}=(0,C.useInfiniteQuery)([wt,a,i,Re,n,l,d],g,{enabled:u,getNextPageParam:h,refetchOnWindowFocus:c,select:t=>({...t,pages:t.pages.map((t=>({...t,data:t.data.map((t=>({...t,isConversationOwner:!!p||st(t,e)})))})))})});(0,o.useEffect)((()=>{var e,t;m&&null!=v&&null!==(e=v.pages)&&void 0!==e&&e.length&&m(null!==(t=null==v?void 0:v.pages[0].total)&&void 0!==t?t:0)}),[null==v?void 0:v.pages,m]);const E=(0,o.useMemo)((()=>(e=>null==e?void 0:e.pages.reduce(((e,t)=>({...e,...t.data.reduce(((e,t)=>({...e,[t.id]:t})),{})})),{}))(v)),[v]),w=(0,o.useRef)(),A=(0,o.useCallback)((async([{isIntersecting:e}])=>{var t;e&&y&&!k&&!b&&(await f(),null===(t=w.current)||void 0===t||t.disconnect())}),[f,y,b,k]);(0,o.useEffect)((()=>()=>{var e;return null===(e=w.current)||void 0===e?void 0:e.disconnect()}),[]);const j=(0,o.useCallback)((e=>{var t,s;null===(t=w.current)||void 0===t||t.disconnect(),w.current=new IntersectionObserver(A,{root:null,rootMargin:"0px",threshold:.1}),null===(s=w.current)||void 0===s||s.observe(e)}),[A]);return{data:null!=E?E:{},isLoading:k,refetch:S,isFetched:x,isFetching:b,setPaginationObserver:j}},Bn=__kbnSharedDeps__.Moment;var Un=s.n(Bn);const $n=({anonymizationFields:e,field:t})=>{var s,n;return null!==(s=null===(n=e.find((e=>e.field===t)))||void 0===n?void 0:n.allowed)&&void 0!==s&&s},Vn=({anonymizationFields:e,field:t})=>{var s,n;return!(null!==(s=null===(n=e.find((e=>e.field===t)))||void 0===n?void 0:n.allowed)&&void 0!==s&&s)},Gn=({anonymizationFields:e,field:t})=>{var s,n;return null!==(s=null===(n=e.find((e=>e.field===t)))||void 0===n?void 0:n.anonymized)&&void 0!==s&&s},Kn=({messageContent:e,replacements:t})=>null!=t?Object.keys(t).reduce(((e,s)=>{const n=t[s];return e.replaceAll(s,n)}),e):e,qn=({anonymizationFields:e,currentReplacements:t,getAnonymizedValue:s,getAnonymizedValues:n,rawData:a})=>Object.keys(a).reduce(((i,o)=>{if($n({anonymizationFields:null!=e?e:[],field:o})){const{anonymizedValues:r,replacements:l}=n({anonymizationFields:e,currentReplacements:t,field:o,getAnonymizedValue:s,rawData:a});return{anonymizedData:{...i.anonymizedData,[o]:r},replacements:{...i.replacements,...l}}}return i}),{anonymizedData:{},replacements:{}}),Hn=({anonymizationFields:e=[],currentReplacements:t,field:s,getAnonymizedValue:n,rawData:a})=>{var i;return(null!==(i=a[s])&&void 0!==i?i:[]).reduce(((a,i)=>{const o=`${i}`;if($n({anonymizationFields:e,field:s})&&Gn({anonymizationFields:e,field:s})){const e=`${n({currentReplacements:t,rawValue:o})}`;return{anonymizedValues:[...a.anonymizedValues,e],replacements:{...a.replacements,[e]:o}}}return $n({anonymizationFields:e,field:s})?{anonymizedValues:[...a.anonymizedValues,o],replacements:{...a.replacements}}:a}),{anonymizedValues:[],replacements:{}})},Qn=({currentReplacements:e,rawValue:t})=>{if(null!=e){const s=(0,h.invert)(e)[t];return null!=s?s:(0,k.v4)()}return(0,k.v4)()},Wn=e=>`CONTEXT:\n"""\n${e}\n"""`,Yn=r().createContext(void 0),Jn=({children:e,spaceId:t})=>(0,g.jsx)(Yn.Provider,{value:{spaceId:t}},e),Xn=()=>{const e=r().useContext(Yn);if(void 0===e)throw new Error("useSpaceId must be used within a AssistantSpaceIdProvider");return e.spaceId},ea=__kbnSharedDeps__.Rxjs,ta=new ea.BehaviorSubject(null),sa=new ea.BehaviorSubject(null),na=({nameSpace:e=M,spaceId:t})=>{const[s]=f()(`${e}.lastConversationId.${t}`),[n,a]=f()(`${e}.lastSelectedConversation.${t}`);(0,o.useEffect)((()=>{ta.getValue()!==n&&ta.next(n||null),sa.getValue()!==s&&sa.next(s||null)}),[n,s]);const i=(0,o.useCallback)((e=>{let t={id:""};const s=ta.getValue(),n=sa.getValue();return e&&"title"in e?(t={id:"",title:e.title},t):e&&"id"in e?(t={id:e.id},t):s&&"title"in s?(t={id:"",title:s.title},t):s&&"id"in s?(t=s,t):n?(t={id:n},t):t}),[]),r=(0,o.useCallback)((e=>{a(e),ta.next(e)}),[a]);return(0,o.useMemo)((()=>({getLastConversation:i,setLastConversation:r})),[i,r])},aa=({currentConversation:e,http:t,refetchCurrentUserConversations:s,selectedPromptContexts:n,setSelectedPromptContexts:a,setCurrentConversation:i})=>{const{assistantTelemetry:r,toasts:l,assistantAvailability:{isAssistantEnabled:d},currentUser:c}=Ze(),u=Xn(),{setLastConversation:p}=na({spaceId:u}),[m,g]=(0,o.useState)(null),{sendMessage:h,abortStream:v}=(()=>{const{alertsIndexPattern:e,assistantStreamingEnabled:t,knowledgeBase:s,traceOptions:n,toasts:a}=Ze(),[i,r]=(0,o.useState)(!1),l=(0,o.useRef)(new AbortController),d=(0,o.useCallback)((async({apiConfig:i,http:o,message:d,conversationId:c,replacements:u})=>{r(!0);try{return await(async({conversationId:e,alertsIndexPattern:t,assistantStreamingEnabled:s,http:n,message:a,replacements:i,apiConfig:o,signal:r,size:l,toasts:d,traceOptions:c,screenContext:u})=>{const p=s,m=(({alertsIndexPattern:e,size:t})=>({...e?{alertsIndexPattern:e}:void 0,...t?{size:t}:void 0}))({alertsIndexPattern:t,size:l}),g={message:a,subAction:p?"invokeStream":"invokeAI",conversationId:e,actionTypeId:o.actionTypeId,replacements:i,langSmithProject:""===(null==c?void 0:c.langSmithProject)||null==c?void 0:c.langSmithProject,langSmithApiKey:""===(null==c?void 0:c.langSmithApiKey)||null==c?void 0:c.langSmithApiKey,screenContext:u,...m};try{var h,v,f,y;if(p){var x,b;const e=await n.fetch(`/internal/elastic_assistant/actions/connector/${null==o?void 0:o.connectorId}/_execute`,{method:"POST",body:JSON.stringify(g),signal:r,asResponse:!0,rawResponse:!0,version:Le}),t=null==e||null===(x=e.response)||void 0===x||null===(b=x.body)||void 0===b?void 0:b.getReader();return t?{response:t,isStream:!0,isError:!1}:{response:`${A}\n\nCould not get reader from response`,isError:!0,isStream:!1}}const e=await n.fetch(`/internal/elastic_assistant/actions/connector/${null==o?void 0:o.connectorId}/_execute`,{method:"POST",body:JSON.stringify(g),headers:{"Content-Type":"application/json"},signal:r,version:Le});if("ok"!==e.status||!e.data)return e.service_message?{response:`${A}\n\n${e.service_message}`,isError:!0,isStream:!1}:{response:A,isError:!0,isStream:!1};const t=null!=(null===(h=e.trace_data)||void 0===h?void 0:h.trace_id)&&null!=(null===(v=e.trace_data)||void 0===v?void 0:v.transaction_id)?{traceId:null===(f=e.trace_data)||void 0===f?void 0:f.trace_id,transactionId:null===(y=e.trace_data)||void 0===y?void 0:y.transaction_id}:void 0;return{response:e.data,metadata:e.metadata,isError:!1,isStream:!1,traceData:t}}catch(e){var C,k;const t=null==e||null===(C=e.response)||void 0===C||null===(k=C.body)||void 0===k?void 0:k.getReader,s=p&&"function"==typeof t?t.call(e.response.body):null,n=S.i18n.translate("xpack.elasticAssistant.messageError.title",{defaultMessage:"An error occurred while sending the message"});if(403===(null==e?void 0:e.response.status)&&s){var E,w;let t=null!==(E=null==e||null===(w=e.body)||void 0===w?void 0:w.message)&&void 0!==E?E:null==e?void 0:e.message;if(s)try{const{value:e}=await s.read();if(e){const s=(new TextDecoder).decode(e),n=JSON.parse(s);t=n.message||n.body||t}}catch(e){t=n}const a=new Error(t);a.name=(null==e?void 0:e.name)||"Error",null==d||d.addError(a,{title:n})}var j,_;return s?{response:s,isStream:!0,isError:!0}:{response:`${A}\n\n${null!==(j=null==e||null===(_=e.body)||void 0===_?void 0:_.message)&&void 0!==j?j:null==e?void 0:e.message}`,isError:!0,isStream:!1}}})({conversationId:c,alertsIndexPattern:e,apiConfig:i,assistantStreamingEnabled:t,http:o,message:d,replacements:u,signal:l.current.signal,size:s.latestAlerts,traceOptions:n,screenContext:{timeZone:Un().tz.guess()},toasts:a})}finally{r(!1)}}),[e,t,s.latestAlerts,a,n]);return{isLoading:i,sendMessage:d,abortStream:(0,o.useCallback)((()=>{l.current.abort(),l.current=new AbortController}),[])}})(),{clearConversation:f,createConversation:y,getConversation:x,removeLastMessage:b}=Nt(),{data:C}=Gs({http:t,enabled:d}),k=(null==C?void 0:C.elser_exists)&&(null==C?void 0:C.security_labs_exists),[E,w]=(0,o.useState)(!1),j=(0,o.useCallback)((async s=>{if(null!=e&&e.apiConfig){w(!0);try{var o,d,u;const l=e.apiConfig;let v;var m;""===e.id&&(v=await y(e),null!==(m=v)&&void 0!==m&&m.id&&p({id:v.id}));const f={...e,...null!==(o=v)&&void 0!==o?o:{}},b=function({currentReplacements:e,getAnonymizedValue:t=Qn,promptText:s,selectedPromptContexts:n,user:a}){let i=null!=e?e:{};const o=e=>{i={...i,...e}},r=Object.keys(n).sort().map((s=>{var a,i;const r=(({anonymizationFields:e,currentReplacements:t,getAnonymizedValue:s,onNewReplacements:n,rawData:a})=>{if("string"==typeof a)return a;const i=qn({anonymizationFields:e,currentReplacements:t,rawData:a,getAnonymizedValue:s,getAnonymizedValues:Hn});return null!=n&&n(i.replacements),o=i.anonymizedData,Object.keys(o).sort().map((e=>`${e},${o[e].join(",")}`)).join("\n");var o})({anonymizationFields:null!==(a=null===(i=n[s].contextAnonymizationFields)||void 0===i?void 0:i.data)&&void 0!==a?a:[],currentReplacements:{...e,...n[s].replacements},getAnonymizedValue:t,onNewReplacements:o,rawData:n[s].rawData});return`${Wn(r)}\n`}));return{content:`${r.length>0?`${r}\n`:""}${s}`.trim(),role:"user",timestamp:(new Date).toISOString(),replacements:i,user:a}}({currentReplacements:f.replacements,promptText:s,selectedPromptContexts:n,user:c}),C=null!==(d=b.replacements)&&void 0!==d?d:f.replacements,S=Object.values(n).reduce(((e,t)=>({...e,...t.replacements})),{}),E={...C,...S},w=[...f.messages,b].map((e=>{var t;return{...e,content:null!==(t=e.content)&&void 0!==t?t:""}}));i({...f,replacements:E,messages:w}),a({});const A=await h({apiConfig:l,http:t,message:null!==(u=b.content)&&void 0!==u?u:"",conversationId:f.id,replacements:E});null==r||r.reportAssistantMessageSent({role:b.role,actionTypeId:l.actionTypeId,model:l.model,provider:l.provider,isEnabledKnowledgeBase:null!=k&&k});const j=On(A);if(""===f.title){let e=0;const t=5;for(;e<t;){var g;const s=await x(f.id);if(f.title=null!==(g=null==s?void 0:s.title)&&void 0!==g?g:"",""!==f.title)break;e++,e<t&&await new Promise((e=>setTimeout(e,1e3)))}}i({...f,replacements:E,messages:[...w,j]}),null==r||r.reportAssistantMessageSent({role:j.role,actionTypeId:l.actionTypeId,model:l.model,provider:l.provider,isEnabledKnowledgeBase:null!=k&&k})}finally{w(!1)}}else null==l||l.addError(new Error("The conversation needs a connector configured in order to send a message."),{title:S.i18n.translate("xpack.elasticAssistant.conversationConfig.setupError",{defaultMessage:"Error with conversation configuration"})})}),[r,y,e,c,x,t,k,n,h,i,p,a,l]),_=(0,o.useCallback)((async()=>{var s;if(null==e||!e.apiConfig)return void(null==l||l.addError(new Error("The conversation needs a connector configured in order to send a message."),{title:S.i18n.translate("xpack.elasticAssistant.knowledgeBase.setupError",{defaultMessage:"Error setting up Knowledge Base"})}));i({...e,messages:e.messages.slice(0,-1)});const n=null!==(s=await b(e.id))&&void 0!==s?s:[],a=await h({apiConfig:e.apiConfig,http:t,conversationId:e.id,replacements:e.replacements}),o=On(a);i({...e,messages:[...n,o]})}),[e,t,b,h,i,l]),P=(0,o.useCallback)((async()=>{if(g(""),a({}),e){const t=await f(e);t&&i(t)}}),[f,e,i,a,g]);return{handleOnChatCleared:(0,o.useCallback)((async()=>{await P(),await s()}),[P,s]),handleChatSend:(0,o.useCallback)((async e=>{await j(e),await s()}),[j,s]),abortStream:v,handleRegenerateResponse:_,isLoading:E,userPrompt:m,setUserPrompt:g}},ia=({isDisabled:e,isLoading:t,onSendMessage:s,promptValue:n})=>{const a=(0,o.useRef)(null),i=(0,o.useCallback)((()=>{var e;null==a||null===(e=a.current)||void 0===e||e.hideToolTip()}),[]);return(0,g.jsx)(u.EuiFlexGroup,{direction:"column",gutterSize:"xs"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiToolTip,{ref:a,position:"right",content:w,display:"block",onMouseOut:i,disableScreenReaderOutput:!0},(0,g.jsx)(u.EuiButtonIcon,{"aria-label":w,"data-test-subj":"submit-chat",color:"primary",display:null!=n&&n.length?"fill":"base",size:"m",iconType:"kqlFunction",isDisabled:e||!(null!=n&&n.length),isLoading:t,onClick:s}))))},oa=S.i18n.translate("xpack.elasticAssistant.assistant.promptPlaceholder",{defaultMessage:"Ask me anything from 'summarize this alert' to 'help me build a query...'"});var ra={name:"6c60ce",styles:"padding-right:64px!important;min-height:64px;max-height:350px"};const la=(0,o.forwardRef)((({isDisabled:e=!1,value:t,onPromptSubmit:s,setUserPrompt:n},a)=>{const i=(0,o.useCallback)((e=>{n(e.target.value)}),[n]),r=(0,o.useCallback)((e=>{var a;13!==e.keyCode||e.shiftKey||(e.preventDefault(),t.trim().length?(s(null===(a=e.currentTarget.value)||void 0===a?void 0:a.trim()),n("")):e.stopPropagation())}),[t,s,n]);return(0,g.jsx)(u.EuiTextArea,{css:ra,className:"eui-scrollBar",inputRef:a,id:"prompt-textarea","data-test-subj":"prompt-textarea",fullWidth:!0,autoFocus:!0,resize:"none",disabled:e,placeholder:oa,value:t,onChange:i,onKeyDown:r,rows:1})}));la.displayName="PromptTextArea";var da={name:"1d3w5wq",styles:"width:100%"},ca={name:"bjn8wh",styles:"position:relative"};const ua=({setUserPrompt:e,handleChatSend:t,isDisabled:s,isLoading:n,shouldRefocusPrompt:a,userPrompt:i})=>{const{euiTheme:r}=(0,u.useEuiTheme)(),l=(0,o.useRef)(null);(0,o.useEffect)((()=>{a&&l.current&&(null==l||l.current.focus())}),[a]);const d=(0,o.useMemo)((()=>s?"":null!=i?i:""),[s,i]),c=(0,o.useCallback)((()=>{var s,n,a;t(null!==(s=null===(n=l.current)||void 0===n||null===(a=n.value)||void 0===a?void 0:a.trim())&&void 0!==s?s:""),e("")}),[t,l,e]);var p,m;return p=null==l?void 0:l.current,m=d,(0,o.useEffect)((()=>{if(p){p.style.height="0px";const e=p.scrollHeight;p.style.height=`${e}px`}}),[p,m]),(0,g.jsx)(u.EuiFlexGroup,{gutterSize:"none",alignItems:"flexEnd",css:ca},(0,g.jsx)(u.EuiFlexItem,{css:da},(0,g.jsx)(la,{onPromptSubmit:t,ref:l,setUserPrompt:e,value:d,isDisabled:s})),(0,g.jsx)(u.EuiFlexItem,{css:(0,g.css)("right:0;position:absolute;margin-right:",r.size.s,";margin-bottom:",r.size.s,";",""),grow:!1},(0,g.jsx)(ia,{isDisabled:s,isLoading:n,onSendMessage:c,promptValue:d})))};async function pa({anonymizationFields:e,promptContext:t}){const s=await t.getPromptContext();if("string"==typeof s)return{contextAnonymizationFields:void 0,promptContextId:t.id,rawData:s,replacements:t.replacements};{const n=Object.keys(s).reduce(((t,s)=>{var n,a;return[...t,{id:s,field:s,allowed:$n({anonymizationFields:null!==(n=null==e?void 0:e.data)&&void 0!==n?n:[],field:s}),anonymized:Gn({anonymizationFields:null!==(a=null==e?void 0:e.data)&&void 0!==a?a:[],field:s})}]}),[]);return{contextAnonymizationFields:{page:1,perPage:1e3,total:n.length,data:n},promptContextId:t.id,rawData:s,replacements:t.replacements}}}const ma=({anonymizationFields:e,promptContexts:t,selectedPromptContexts:s,setSelectedPromptContexts:n})=>{const a=(0,o.useMemo)((()=>(0,h.sortBy)("description",Object.values(t))),[t]),i=(0,o.useCallback)((async a=>{if(null==s[a]&&null!=t[a]&&e){const s=await pa({anonymizationFields:e,promptContext:t[a]});n((e=>({...e,[a]:s})))}}),[e,t,s,n]);return(0,g.jsx)(u.EuiFlexGroup,{gutterSize:"none",wrap:!0},a.map((({description:e,id:t,tooltip:n})=>{const a=(0,g.jsx)(u.EuiButtonEmpty,{"data-test-subj":`pillButton-${t}`,disabled:null!=s[t],iconSide:"left",iconType:"plusInCircle",size:"s",onClick:()=>i(t)},e);return e.length>0?(0,g.jsx)(u.EuiFlexItem,{grow:!1,key:t},null!=s[t]?a:(0,g.jsx)(u.EuiToolTip,{content:n},a)):null})))},ga=r().memo(ma);var ha=s(145);const va=S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.addQuickPromptTitle",{defaultMessage:"Add quick prompt..."}),fa=S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.overflowAriaTitle",{defaultMessage:"Show overflow Quick Prompts"});S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.modalCancelButtonTitle",{defaultMessage:"Cancel"}),S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.modalSaveButtonTitle",{defaultMessage:"Save"});var ya={name:"d3v9zr",styles:"overflow:hidden"},xa={name:"d3v9zr",styles:"overflow:hidden"};const ba=r().memo((({setInput:e,setIsSettingsModalVisible:t,trackPrompt:s,allPrompts:n})=>{const[a,{width:i}]=(0,ha.A)(),{promptContexts:r,setSelectedSettingsTab:l}=Ze(),d=(0,o.useMemo)((()=>{const e=Object.values(r).map((e=>e.category));return e.push("knowledge-base"),n.filter((t=>{return t.promptType===gs.quick&&(!t.categories||0===t.categories.length||(null===(s=t.categories)||void 0===s?void 0:s.some((t=>e.includes(t)))));var s}))}),[n,r]),[c,p]=(0,o.useState)(!1),m=(0,o.useCallback)((()=>p(!c)),[c]),h=(0,o.useCallback)((()=>p(!1)),[]),v=(0,o.useCallback)((t=>{e(t.content),t.isDefault?s(t.name):s("Custom")}),[e,s]),f=(0,o.useCallback)((e=>{v(e),h()}),[h,v]),y=(0,o.useCallback)((()=>{t(!0),l(Ms)}),[t,l]),x=(0,o.useMemo)((()=>{const e=Math.floor(i/120);return{visible:d.slice(0,e),overflow:d.slice(e)}}),[d,i]);return(0,g.jsx)(u.EuiFlexGroup,{gutterSize:"s",alignItems:"center",justifyContent:"spaceBetween"},(0,g.jsx)(u.EuiFlexItem,{css:xa},(0,g.jsx)(u.EuiFlexGroup,{ref:a,gutterSize:"s",alignItems:"center",wrap:!1},x.visible.map(((e,t)=>(0,g.jsx)(u.EuiFlexItem,{grow:!1,key:t,css:ya},(0,g.jsx)(u.EuiBadge,{color:e.color,"data-test-subj":`quickPrompt-${e.name}`,onClick:()=>v(e),onClickAriaLabel:e.name},e.name)))),x.overflow.length>0&&(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiPopover,{button:(0,g.jsx)(u.EuiButtonIcon,{color:"primary",iconType:"boxesHorizontal",onClick:m,"aria-label":fa}),isOpen:c,closePopover:h,anchorPosition:"rightUp"},(0,g.jsx)(u.EuiFlexGroup,{direction:"column",gutterSize:"s"},x.overflow.map(((e,t)=>(0,g.jsx)(u.EuiFlexItem,{key:t,grow:!1},(0,g.jsx)(u.EuiBadge,{color:e.color,onClick:()=>f(e),onClickAriaLabel:e.name},e.name))))))))),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiButtonEmpty,{"data-test-subj":"addQuickPrompt",onClick:y,iconType:"plus",size:"xs"},va)))}));ba.displayName="QuickPrompts";const Ca=S.i18n.translate("xpack.elasticAssistant.assistant.sidePanel.contextMenuLabel",{defaultMessage:"Conversation options"}),ka=S.i18n.translate("xpack.elasticAssistant.assistant.sidePanel.deleteConversation",{defaultMessage:"Delete"}),Sa=S.i18n.translate("xpack.elasticAssistant.assistant.sidePanel.sharedByYou",{defaultMessage:"Shared by you"}),Ea=S.i18n.translate("xpack.elasticAssistant.assistant.sidePanel.sharedWithYou",{defaultMessage:"Shared with you"}),wa=S.i18n.translate("xpack.elasticAssistant.assistant.conversations.sidePanel.newChatButtonLabel",{defaultMessage:"New chat"}),Aa=S.i18n.translate("xpack.elasticAssistant.assistant.deleteConversationModal.deleteConversationTitle",{defaultMessage:"Delete this conversation"}),ja=S.i18n.translate("xpack.elasticAssistant.assistant.deleteConversationModal.cancelButtonText",{defaultMessage:"Cancel"}),_a=S.i18n.translate("xpack.elasticAssistant.assistant.deleteConversationModal.deleteButtonText",{defaultMessage:"Delete"}),Pa={TODAY:S.i18n.translate("xpack.elasticAssistant.conversationList.dateGroupTitle.today",{defaultMessage:"Today"}),YESTERDAY:S.i18n.translate("xpack.elasticAssistant.conversationList.dateGroupTitle.yesterday",{defaultMessage:"Yesterday"}),THIS_WEEK:S.i18n.translate("xpack.elasticAssistant.conversationList.dateGroupTitle.thisWeek",{defaultMessage:"This Week"}),LAST_WEEK:S.i18n.translate("xpack.elasticAssistant.conversationList.dateGroupTitle.lastWeek",{defaultMessage:"Last Week"}),THIS_MONTH:S.i18n.translate("xpack.elasticAssistant.conversationList.dateGroupTitle.thisMonth",{defaultMessage:"This Month"}),LAST_MONTH:S.i18n.translate("xpack.elasticAssistant.conversationList.dateGroupTitle.lastMonth",{defaultMessage:"Last Month"}),THIS_YEAR:S.i18n.translate("xpack.elasticAssistant.conversationList.dateGroupTitle.thisYear",{defaultMessage:"This Year"}),OLDER:S.i18n.translate("xpack.elasticAssistant.conversationList.dateGroupTitle.older",{defaultMessage:"Older"})},Ta=({conversationList:e,currentConversationId:t,deleteConversationItem:s,onConversationDeleted:n,onConversationSelected:a,setDeleteConversationItem:i})=>{const r=(0,u.useGeneratedHtmlId)(),l=(0,o.useCallback)((s=>{if(t===s.id){const t=((e,t)=>{const s=t?((e,t)=>(0,Yt.findIndex)(e,(e=>(0,Yt.isEmpty)(e.id)?e.title===(null==t?void 0:t.title):e.id===(null==t?void 0:t.id))))(e,t):0;return s>=e.length-1?e[0]:e[s+1]})(e,s);a({cId:t.id})}n(s.id)}),[t,n,e,a]),d=(0,o.useCallback)((()=>{i(null)}),[i]),c=(0,o.useCallback)((()=>{s&&(i(null),l(s))}),[s,l,i]);return s&&(0,g.jsx)(u.EuiConfirmModal,{"aria-labelledby":r,title:Aa,titleProps:{id:r},onCancel:d,onConfirm:c,cancelButtonText:ja,confirmButtonText:_a,buttonColor:"danger",defaultFocusedButton:"confirm"})},Ia=({actions:e})=>{const[t,s]=(0,o.useState)(!1),n=(0,u.useGeneratedHtmlId)({prefix:"listGroupItemActionsButton"}),a=(0,u.useGeneratedHtmlId)({prefix:"listGroupItemActionsMenu"}),i=()=>s(!1),r=e.map((({key:e,children:t,icon:s,onClick:n})=>(0,g.jsx)(u.EuiContextMenuItem,{key:e,"data-test-subj":`convo-context-menu-item-${e}`,icon:s,onClick:e=>{null==n||n(e),i()}},t)));return(0,g.jsx)(u.EuiPopover,{panelPaddingSize:"none",button:(0,g.jsx)(u.EuiButtonIcon,{"data-test-subj":"convo-context-menu-button",size:"xs",iconType:"boxesVertical",iconSize:"s","aria-label":Ca,"aria-haspopup":"true","aria-controls":a,"aria-expanded":t,color:"text",id:n,onClick:()=>s(!t)}),isOpen:t,closePopover:i,anchorPosition:"rightUp",panelProps:{id:a,"aria-labelledby":n}},(0,g.jsx)(u.EuiContextMenuPanel,{"data-test-subj":"convo-context-menu",size:"s",items:r}))};var Ma={name:"dwujfk",styles:"height:1px"},za={name:"4gse7o",styles:"margin-inline-start:12px;margin-inline-end:0px"};const Fa=({conversation:e,currentUser:t,handleCopyUrl:s,handleDuplicateConversation:n,isActiveConversation:a,lastConversationId:i,onConversationSelected:r,setDeleteConversationItem:l,setPaginationObserver:d})=>{const c=(0,o.useCallback)((t=>{e.id===i&&t&&d(t)}),[e.id,i,d]),p=(0,o.useCallback)((()=>r({cId:e.id})),[e.id,r]),m=(0,o.useMemo)((()=>et(e)),[e]),h=(0,o.useMemo)((()=>m!==Xe.PRIVATE&&!!t),[m,t]),{iconType:v,iconTitle:f}=(0,o.useMemo)((()=>e.isConversationOwner?{iconType:h?nt(m):void 0,iconTitle:Sa}:{iconType:h?nt(m):void 0,iconTitle:Ea}),[e.isConversationOwner,h,m]),y=(0,o.useMemo)((()=>[{key:"copy",children:dt,onClick:()=>s(e),icon:"link"},{key:"duplicate",children:it,onClick:()=>n(e),icon:"copy"},...e.isConversationOwner?[{key:"delete",children:ka,onClick:()=>l(e),icon:"trash"}]:[]]),[s,n,l,e]);return(0,g.jsx)("span",{key:e.id+e.title},(0,g.jsx)(u.EuiFlexGroup,{gutterSize:"xs"},(0,g.jsx)(u.EuiListGroupItem,{size:"xs",onClick:p,className:"eui-textTruncate",css:(0,g.css)("flex:1;.euiListGroupItem__button{flex-direction:",h?"row-reverse":"row",";justify-content:space-between;}",""),label:e.title,iconType:v,iconProps:{"data-test-subj":`conversation-icon-${e.title}`,size:"s",title:f,css:za},"data-test-subj":`conversation-select-${e.title}`,isActive:a}),(0,g.jsx)(Ia,{actions:y})),e.id===i&&(0,g.jsx)("div",{ref:c,css:Ma}))},Oa=__kbnSharedDeps__.KbnDatemath;var Ra=s.n(Oa);const La=(e,t={})=>{const s=Ra().parse(e,t);if(s&&s.isValid())return s.valueOf()};const Da=navigator.platform.toLowerCase().indexOf("mac")>=0,Na=(e,t)=>(0,Yt.findIndex)(e,(e=>(0,Yt.isEmpty)(e.id)?e.title===(null==t?void 0:t.title):e.id===(null==t?void 0:t.id)));var Za={name:"3vw822",styles:"border-left:0;border-right:0;border-bottom:0;padding-top:12px;padding-bottom:12px"},Ba={name:"12byf7z",styles:"display:block;margin:0 auto"},Ua={name:"1qmr6ab",styles:"overflow:auto"},$a={name:"d3v9zr",styles:"overflow:hidden"},Va={name:"1hcx8jb",styles:"padding:0"};const Ga=r().memo((({currentConversation:e,currentUser:t,onConversationSelected:s,shouldDisableKeyboardShortcut:n=()=>!1,isDisabled:a=!1,isFetchingCurrentUserConversations:i,conversations:l,onConversationDeleted:d,onConversationCreate:c,refetchCurrentUserConversations:p,setCurrentConversation:h,setPaginationObserver:v})=>{var f;const y=(0,u.useEuiTheme)(),x=(0,g.css)("text-transform:uppercase;font-weight:",y.euiTheme.font.weight.bold,";",""),[b,C]=(0,o.useState)(null),{copyConversationUrl:k,duplicateConversation:S}=Nt(),E=function(e=[]){return(0,o.useMemo)((()=>{var t,s,n,a,i,o,r;const l=new Date,d=null!==(t=La("now/d",{forceNow:l}))&&void 0!==t?t:0,c=null!==(s=La("now-1d/d",{forceNow:l}))&&void 0!==s?s:0,u=null!==(n=La("now/w",{forceNow:l}))&&void 0!==n?n:0,p=null!==(a=La("now-1w/w",{forceNow:l}))&&void 0!==a?a:0,m=null!==(i=La("now/M",{forceNow:l}))&&void 0!==i?i:0,g=null!==(o=La("now-1M/M",{forceNow:l}))&&void 0!==o?o:0,h=null!==(r=La("now/y",{forceNow:l}))&&void 0!==r?r:0,v={TODAY:[],YESTERDAY:[],THIS_WEEK:[],LAST_WEEK:[],THIS_MONTH:[],LAST_MONTH:[],THIS_YEAR:[],OLDER:[]};return(0,Yt.orderBy)(e,"updatedAt","desc").forEach((e=>{if(!e.updatedAt)return;if(!(e=>{const t=Ra().parse(e);return!(!t||!t.isValid())})(e.updatedAt))return;const t=new Date(e.updatedAt).getTime(),s=e;t>=d?v.TODAY.push(s):t>=c?v.YESTERDAY.push(s):t>=u?v.THIS_WEEK.push(s):t>=p?v.LAST_WEEK.push(s):t>=m?v.THIS_MONTH.push(s):t>=g?v.LAST_MONTH.push(s):t>=h?v.THIS_YEAR.push(s):v.OLDER.push(s)})),v}),[e])}(Object.values(l)),w=(0,o.useMemo)((()=>Object.values(E).flatMap((e=>e))),[E]),A=null===(f=w[w.length-1])||void 0===f?void 0:f.id,j=(0,o.useMemo)((()=>Object.keys(l)),[l]),_=(0,o.useCallback)((()=>{const t=((e,t)=>{const s=t?Na(e,t):0;return s?e[s-1]:e[e.length-1]})(w,e);s({cId:t.id})}),[w,e,s]),P=(0,o.useCallback)((()=>{const t=((e,t)=>{const s=t?Na(e,t):0;return s>=e.length-1?e[0]:e[s+1]})(w,e);s({cId:t.id})}),[w,e,s]),T=(0,o.useCallback)((e=>{a||j.length<=1||("ArrowUp"===e.key&&(Da?e.metaKey:e.ctrlKey)&&!n()&&(e.preventDefault(),_()),"ArrowDown"===e.key&&(Da?e.metaKey:e.ctrlKey)&&!n()&&(e.preventDefault(),P()))}),[j.length,a,_,P,n]),I=(0,o.useCallback)((e=>S({refetchCurrentUserConversations:p,selectedConversation:e,setCurrentConversation:h})),[S,p,h]),M=(0,o.useCallback)((e=>k(e)),[k]),z=(0,o.useMemo)((()=>Object.entries(E).map((([n,a])=>a.length?(0,g.jsx)(u.EuiFlexItem,{grow:!1,key:n},(0,g.jsx)(u.EuiPanel,{hasBorder:!1,hasShadow:!1,paddingSize:"s"},(0,g.jsx)(u.EuiText,{css:x,size:"s"},Pa[n])),(0,g.jsx)(u.EuiListGroup,{size:"xs",css:Va},a.map((n=>(0,g.jsx)(Fa,{conversation:n,currentUser:t,isActiveConversation:(0,Yt.isEmpty)(n.id)?n.title===(null==e?void 0:e.title):n.id===(null==e?void 0:e.id),key:n.id,handleDuplicateConversation:I,handleCopyUrl:M,lastConversationId:A,onConversationSelected:s,setDeleteConversationItem:C,setPaginationObserver:v})))),(0,g.jsx)(u.EuiSpacer,{size:"s"})):null))),[E,null==e?void 0:e.id,null==e?void 0:e.title,t,M,I,A,s,v,x]);return m()("keydown",T),(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiFlexGroup,{direction:"column",justifyContent:"spaceBetween",gutterSize:"none",css:$a},(0,g.jsx)(u.EuiFlexItem,{css:Ua},(0,g.jsx)(u.EuiPanel,{hasShadow:!1,borderRadius:"none","data-test-subj":"conversationSidePanel"},z,i&&(0,g.jsx)(u.EuiLoadingSpinner,{size:"m",css:Ba}))),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiPanel,{hasShadow:!1,hasBorder:!0,borderRadius:"none",paddingSize:"m",css:Za},(0,g.jsx)(u.EuiButton,{color:"primary",fill:!0,iconType:"discuss",onClick:c,fullWidth:!0,size:"s"},wa)))),(0,g.jsx)(Ta,{conversationList:w,currentConversationId:null==e?void 0:e.id,deleteConversationItem:b,onConversationDeleted:d,onConversationSelected:s,setDeleteConversationItem:C}))}));Ga.displayName="ConversationSidePanel";const Ka=e=>"string"!=typeof e,qa=({field:e,operation:t,selectedPromptContext:s,update:n})=>{const{contextAnonymizationFields:a}=s;if(!a)return s;switch(n){case"allow":return{...s,contextAnonymizationFields:{...a,data:a.data.reduce(((s,n)=>n.field===e?[...s,{...n,allowed:"add"===t}]:[...s,n]),[])}};case"allowReplacement":return{...s,contextAnonymizationFields:{...a,data:a.data.reduce(((s,n)=>n.field===e?[...s,{...n,anonymized:"add"===t}]:[...s,n]),[])}};default:return s}},Ha=({rawData:e})=>(0,g.jsx)(u.EuiCodeBlock,{"data-test-subj":"readOnlyContextViewer",isCopyable:!0},Wn(e));Ha.displayName="ReadOnlyContextViewerComponent";const Qa=r().memo(Ha),Wa="xs",Ya=S.i18n.translate("xpack.elasticAssistant.dataAnonymizationEditor.stats.allowedStat.allowedDescription",{defaultMessage:"Allowed"}),Ja=({allowed:e,total:t,inline:s,titleSize:n=Wa,gap:a})=>{const{euiTheme:i}=(0,u.useEuiTheme)(),r=(0,o.useMemo)((()=>(({allowed:e,total:t})=>S.i18n.translate("xpack.elasticAssistant.dataAnonymizationEditor.stats.allowedStat.allowedTooltip",{values:{allowed:e,total:t},defaultMessage:"{allowed} of {total} fields in this context are allowed to be included in the conversation"}))({allowed:e,total:t})),[e,t]);return(0,g.jsx)(u.EuiToolTip,{content:r},(0,g.jsx)(u.EuiStat,{css:s?(0,g.css)("display:flex;align-items:center;gap:",a||i.size.xs,";",""):null,"data-test-subj":"allowedStat",description:Ya,reverse:!0,title:e,titleSize:n}))};Ja.displayName="AllowedStatComponent";const Xa=r().memo(Ja),ei=S.i18n.translate("xpack.elasticAssistant.dataAnonymizationEditor.stats.anonymizedStat.anonymizeFieldsdDescription",{defaultMessage:"Anonymized"}),ti=({anonymized:e,isDataAnonymizable:t,inline:s,titleSize:n=Wa,gap:a})=>{const{euiTheme:i}=(0,u.useEuiTheme)(),r=(0,o.useMemo)((()=>(e=>e?"default":"subdued")(t)),[t]),l=(0,o.useMemo)((()=>(({anonymized:e,isDataAnonymizable:t})=>t&&0!==e?(e=>S.i18n.translate("xpack.elasticAssistant.dataAnonymizationEditor.stats.anonymizedStat.fieldsWillBeAnonymizedTooltip",{values:{anonymized:e},defaultMessage:"{anonymized} {anonymized, plural, =1 {field} other {fields}} in this context will be replaced with random values. Responses are automatically translated back to the original values."}))(e):(e=>S.i18n.translate("xpack.elasticAssistant.dataAnonymizationEditor.stats.anonymizedStat.noneOfTheDataWillBeAnonymizedTooltip",{values:{isDataAnonymizable:e},defaultMessage:"{isDataAnonymizable, select, true {Select fields to be replaced with random values. Responses are automatically translated back to the original values.} other {This context cannot be anonymized}}"}))(t))({anonymized:e,isDataAnonymizable:t})),[e,t]),d=(0,o.useMemo)((()=>(0,g.jsx)(u.EuiText,{color:r,"data-test-subj":"description",size:"s"},ei)),[r]);return(0,g.jsx)(u.EuiToolTip,{content:l},(0,g.jsx)(u.EuiStat,{css:s?(0,g.css)("display:flex;align-items:center;gap:",a||i.size.xs,";",""):null,"data-test-subj":"anonymizedFieldsStat",description:d,reverse:!0,titleColor:r,title:e,titleSize:n}))};ti.displayName="AnonymizedStatComponent";const si=r().memo(ti),ni=({anonymizationFieldsStatus:e,anonymizationFields:t=[],rawData:s,replacements:n})=>{const a={allowed:0,anonymized:0,denied:0,total:0};return e||s?!s&&e?{allowed:null!==(i=null===(o=e.allowed)||void 0===o?void 0:o.doc_count)&&void 0!==i?i:0,anonymized:null!==(r=null===(l=e.anonymized)||void 0===l?void 0:l.doc_count)&&void 0!==r?r:0,denied:null!==(d=null===(c=e.denied)||void 0===c?void 0:c.doc_count)&&void 0!==d?d:0,total:t.length}:"string"==typeof s?null==n?a:{...a,anonymized:Object.keys(n).length}:Object.keys(null!=s?s:{}).reduce(((e,s)=>({allowed:e.allowed+($n({anonymizationFields:t,field:s})?1:0),anonymized:e.anonymized+($n({anonymizationFields:t,field:s})&&Gn({anonymizationFields:t,field:s})?1:0),denied:e.denied+(Vn({anonymizationFields:t,field:s})?1:0),total:e.total+1})),a):a;var i,o,r,l,d,c},ai=S.i18n.translate("xpack.elasticAssistant.dataAnonymizationEditor.stats.availableStat.availableDescription",{defaultMessage:"Available"}),ii=({total:e,inline:t,titleSize:s=Wa,gap:n})=>{const{euiTheme:a}=(0,u.useEuiTheme)(),i=(0,o.useMemo)((()=>(e=>S.i18n.translate("xpack.elasticAssistant.dataAnonymizationEditor.stats.availableStat.availableTooltip",{values:{total:e},defaultMessage:"{total} fields in this context are available to be included in the conversation"}))(e)),[e]);return(0,g.jsx)(u.EuiToolTip,{content:i},(0,g.jsx)(u.EuiStat,{css:t?(0,g.css)("display:flex;align-items:center;gap:",n||a.size.xs,";",""):null,"data-test-subj":"availableStat",description:ai,reverse:!0,title:e,titleSize:s}))};ii.displayName="AvailableStatComponent";const oi=r().memo(ii),ri=Je(u.EuiFlexItem,{target:"e161g1py0"})("margin-right:",(({theme:e})=>e.euiTheme.size.l),";"),li=({anonymizationFieldsStatus:e,isDataAnonymizable:t,anonymizationFields:s,rawData:n,inline:a,replacements:i,titleSize:r,gap:l})=>{const{allowed:d,anonymized:c,total:p}=(0,o.useMemo)((()=>ni({anonymizationFieldsStatus:e,anonymizationFields:s,rawData:n,replacements:i})),[e,s,n,i]);return(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center","data-test-subj":"stats",gutterSize:"none"},t&&(0,g.jsx)(ri,{grow:!1},(0,g.jsx)(Xa,{allowed:d,gap:l,total:p,inline:a,titleSize:r})),(0,g.jsx)(ri,{grow:!1},(0,g.jsx)(si,{anonymized:c,isDataAnonymizable:t||c>0,inline:a,titleSize:r,gap:l})),t&&(0,g.jsx)(ri,{grow:!1},(0,g.jsx)(oi,{total:p,inline:a,titleSize:r,gap:l})))};li.displayName="StatsComponent";const di=r().memo(li),ci=S.i18n.translate("xpack.elasticAssistant.dataAnonymization.settings.anonymizationSettings.settingsTitle",{defaultMessage:"Anonymization"}),ui=S.i18n.translate("xpack.elasticAssistant.dataAnonymization.settings.anonymizationSettings.settingsDescription",{defaultMessage:"Define privacy settings for event data sent to third-party LLM providers. You can choose which fields to include, and which to anonymize by replacing their values with random strings. Helpful defaults are provided below."}),pi=async(e,t,s)=>{try{const s=await e.fetch(Tt,{method:"POST",version:Re,body:JSON.stringify(t)});if(!s.success){var n;const e=null===(n=s.attributes.errors)||void 0===n?void 0:n.map((e=>`${e.status_code?`Error code: ${e.status_code}. `:""}Error message: ${e.message} for anonymization field ${e.anonymization_fields.map((e=>e.name)).join(",")}`)).join(",\n");throw new Error(e)}return s}catch(e){var a;null==s||s.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:S.i18n.translate("xpack.elasticAssistant.anonymizationFields.bulkActionsAnonymizationFieldsError",{defaultMessage:"Error updating anonymization fields {error}",values:{error:(null===(a=e.body)||void 0===a?void 0:a.message)||JSON.stringify(e)}})})}},mi="allowed",gi="anonymized",hi="field",vi=S.i18n.translate("xpack.elasticAssistant.assistant.dataAnonymizationEditor.contextEditor.allActionsTooltip",{defaultMessage:"All actions"}),fi=S.i18n.translate("xpack.elasticAssistant.assistant.dataAnonymizationEditor.contextEditor.allowAction",{defaultMessage:"Allow"}),yi=S.i18n.translate("xpack.elasticAssistant.assistant.dataAnonymizationEditor.contextEditor.allowedColumnTitle",{defaultMessage:"Allowed"}),xi=(S.i18n.translate("xpack.elasticAssistant.assistant.dataAnonymizationEditor.contextEditor.alwaysSubmenu",{defaultMessage:"Always"}),S.i18n.translate("xpack.elasticAssistant.assistant.dataAnonymizationEditor.contextEditor.anonymizeAction",{defaultMessage:"Anonymize"})),bi=S.i18n.translate("xpack.elasticAssistant.assistant.dataAnonymizationEditor.contextEditor.anonymizedColumnTitle",{defaultMessage:"Anonymized"}),Ci=S.i18n.translate("xpack.elasticAssistant.assistant.dataAnonymizationEditor.contextEditor.bulkActions",{defaultMessage:"Bulk actions"}),ki=(S.i18n.translate("xpack.elasticAssistant.assistant.dataAnonymizationEditor.contextEditor.defaultsSubmenu",{defaultMessage:"Defaults"}),S.i18n.translate("xpack.elasticAssistant.assistant.dataAnonymizationEditor.contextEditor.denyAction",{defaultMessage:"Deny"})),Si=S.i18n.translate("xpack.elasticAssistant.assistant.dataAnonymizationEditor.contextEditor.fieldColumnTitle",{defaultMessage:"Field"}),Ei=S.i18n.translate("xpack.elasticAssistant.assistant.dataAnonymizationEditor.contextEditor.noButtonLabel",{defaultMessage:"No"}),wi=e=>S.i18n.translate("xpack.elasticAssistant.dataAnonymizationEditor.contextEditor.selectedFields",{values:{selected:e},defaultMessage:"Selected {selected} fields"}),Ai=(S.i18n.translate("xpack.elasticAssistant.assistant.dataAnonymizationEditor.contextEditor.resetButton",{defaultMessage:"Reset"}),S.i18n.translate("xpack.elasticAssistant.assistant.dataAnonymizationEditor.contextEditor.unanonymizeAction",{defaultMessage:"Unanonymize"})),ji=S.i18n.translate("xpack.elasticAssistant.assistant.dataAnonymizationEditor.contextEditor.valuesColumnTitle",{defaultMessage:"Values"}),_i=S.i18n.translate("xpack.elasticAssistant.assistant.dataAnonymizationEditor.contextEditor.yesButtonLabel",{defaultMessage:"Yes"}),Pi="primary-panel-id",Ti=({appliesTo:e,disabled:t,disableAllow:s=!1,disableAnonymize:n=!1,disableDeny:a=!1,disableUnanonymize:i=!1,onListUpdated:r,selectedField:l,selectedFields:d,handleRowChecked:c})=>{const[p,m]=(0,o.useState)(!1),h=(0,u.useGeneratedHtmlId)({prefix:"contextEditorBulkActions"}),v=(0,o.useCallback)((()=>m(!1)),[]),f=(0,o.useCallback)((()=>{m((e=>!e))}),[]),y=(0,o.useMemo)((()=>(0,g.jsx)(u.EuiToolTip,{content:"multipleRows"===e?void 0:vi},(0,g.jsx)(u.EuiButtonEmpty,{"data-test-subj":"bulkActionsButton",disabled:t,iconType:"multipleRows"===e?"arrowDown":"boxesVertical",iconSide:"multipleRows"===e?"right":void 0,onClick:f,size:"xs"},"multipleRows"===e?Ci:null))),[e,t,f]),x=(0,o.useMemo)((()=>(({disableAllow:e,disableAnonymize:t,disableDeny:s,disableUnanonymize:n,closePopover:a,onListUpdated:i,selectedField:o,selectedFields:r,handleRowChecked:l})=>{const d=o?[o]:r;return[{id:Pi,items:[{disabled:e,icon:"check",name:fi,onClick:()=>{a();const e=d.map((e=>({field:e,operation:"add",update:"allow"})));o&&l(e[0].field),i(e)}},{disabled:s,icon:"cross",name:ki,onClick:()=>{a();const e=d.map((e=>({field:e,operation:"remove",update:"allow"})));o&&l(e[0].field),i(e)}},{disabled:t,icon:"eyeClosed",name:xi,onClick:()=>{a();const e=d.map((e=>({field:e,operation:"add",update:"allowReplacement"})));o&&l(e[0].field),i(e)}},{disabled:n,icon:"eye",name:Ai,onClick:()=>{a();const e=d.map((e=>({field:e,operation:"remove",update:"allowReplacement"})));o&&l(e[0].field),i(e)}},{isSeparator:!0,key:"sep"}]}]})({disableAllow:s,disableAnonymize:n,disableDeny:a,disableUnanonymize:i,closePopover:v,onListUpdated:r,selectedField:l,selectedFields:d,handleRowChecked:c})),[v,s,n,a,i,c,r,l,d]);return(0,g.jsx)(u.EuiPopover,{anchorPosition:"downLeft",button:y,closePopover:v,"data-test-subj":"bulkActions",id:h,isOpen:p,panelPaddingSize:"none"},(0,g.jsx)(u.EuiContextMenu,{initialPanelId:Pi,panels:x,size:"s"}))},Ii=r().memo(Ti),Mi=c()(u.EuiButtonEmpty).withConfig({displayName:"AnonymizedButton",componentId:"sc-1mj1rjf-0"})(["max-height:24px;"]),zi=({compressed:e=!0,handleRowChecked:t,hasUpdateAIAssistantAnonymization:s,onListUpdated:n,rawData:a,selectedFields:i})=>{const o={field:"actions",name:"",render:(e,s)=>r().createElement(Ii,{appliesTo:"singleRow",disabled:!1,disableAllow:s.allowed,disableDeny:!s.allowed,disableAnonymize:!s.allowed||s.allowed&&s.anonymized,disableUnanonymize:!s.allowed||s.allowed&&!s.anonymized,onListUpdated:n,selectedField:s.field,selectedFields:i,handleRowChecked:t}),sortable:!1,width:"36px"},l={field:"rawValues",name:ji,render:e=>r().createElement(u.EuiCode,{"data-test-subj":"rawValues"},e.join(",")),sortable:!1},d=[{field:mi,name:yi,render:(i,{allowed:o,field:l})=>r().createElement(u.EuiSwitch,{"data-test-subj":"allowed",checked:o,disabled:!s,label:"",showLabel:!1,compressed:e,onChange:()=>{t(l),n([{field:l,operation:o?"remove":"add",update:null==a?"defaultAllow":"allow"}])}}),sortable:!0,width:"75px"},{field:gi,name:bi,render:(e,{allowed:i,anonymized:o,field:l})=>r().createElement(Mi,{"data-test-subj":"anonymized",disabled:!i||!s,color:o?"primary":"text",flush:"both",iconType:o?"eyeClosed":"eye",isSelected:!!o,onClick:()=>{t(l),n([{field:l,operation:o?"remove":"add",update:null==a?"defaultAllowReplacement":"allowReplacement"}])}},r().createElement(u.EuiText,{size:"xs"},o?_i:Ei)),sortable:!0,width:"102px"},{field:hi,name:Si,sortable:!0,width:"260px"}];return null==a?[...d,...s?[o]:[]]:[...d,l,...s?[o]:[]]},Fi=({pageSize:e,sortDirection:t,sortField:s})=>({page:{size:null!=e?e:25,index:0},sort:{field:s,direction:null!=t?t:"desc"}}),Oi=({defaultTableOptions:e,nameSpace:t=M,inMemory:s,storageKey:n,totalItemCount:a=0})=>{const[i=e,r]=x()(`${t}.${n}`,e),l=(0,o.useMemo)((()=>{var e;return s?{initialPageSize:i.page.size,pageSizeOptions:[5,10,25,50],pageIndex:i.page.index}:{totalItemCount:a,pageSize:null!==(e=i.page.size)&&void 0!==e?e:25,pageSizeOptions:[5,10,25,50],pageIndex:i.page.index}}),[s,i,a]),d=(0,o.useMemo)((()=>{var t;return{sort:null!==(t=i.sort)&&void 0!==t?t:e.sort}}),[e.sort,i.sort]);return{onTableChange:(0,o.useCallback)((e=>{const{page:t,sort:s}=e;r({page:t,...s?{sort:s}:{}})}),[r]),pagination:l,sorting:d}},Ri=({anonymizationFields:e,rawData:t})=>{return null!==t&&"object"==typeof t?Object.keys(t).sort().reduce(((s,n)=>{var a,i,o;return[...s,{field:n,allowed:$n({anonymizationFields:null!==(a=null==e?void 0:e.data)&&void 0!==a?a:[],field:n}),anonymized:Gn({anonymizationFields:null!==(i=null==e?void 0:e.data)&&void 0!==i?i:[],field:n}),denied:Vn({anonymizationFields:null!==(o=null==e?void 0:e.data)&&void 0!==o?o:[],field:n}),rawValues:t[n]}]}),[]):(null!==(s=null==e?void 0:e.data)&&void 0!==s?s:[]).map((e=>{var t,s,n;return{field:e.field,allowed:null!==(t=e.allowed)&&void 0!==t&&t,anonymized:null!==(s=e.anonymized)&&void 0!==s&&s,denied:!(null!==(n=e.allowed)&&void 0!==n&&n),rawValues:[]}}));var s},Li=({handleRowChecked:e,onListUpdated:t,selectedFields:s})=>(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center","data-test-subj":"toolbar",gutterSize:"none"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiText,{color:"subdued","data-test-subj":"selectedFields",size:"xs"},wi(s.length))),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(Ii,{appliesTo:"multipleRows",disabled:0===s.length,onListUpdated:t,selectedFields:s,handleRowChecked:e})));Li.displayName="ToolbarComponent";const Di=r().memo(Li),Ni=Je("div",{target:"e1uxvv090"})({name:"r5zj6l",styles:">div>.euiSpacer{block-size:16px;}"}),Zi={box:{incremental:!0},filters:[{field:mi,type:"is",name:yi},{field:gi,type:"is",name:bi}]},Bi=({anonymizationFields:e,compressed:t=!0,onListUpdated:s,rawData:n})=>{const a=(0,o.useRef)(!1),{assistantAvailability:{hasUpdateAIAssistantAnonymization:i},nameSpace:r}=Ze(),[l,d]=(0,o.useState)([]),c=(0,o.useMemo)((()=>({selectable:()=>!0,onSelectionChange:e=>{!0===a.current?a.current=!1:d(e)},selected:l})),[l]),p=(0,o.useMemo)((()=>zi({compressed:t,handleRowChecked:()=>{},hasUpdateAIAssistantAnonymization:i,onListUpdated:s,rawData:n,selectedFields:l.map((e=>e.field))})),[t,i,s,n,l]),m=(0,o.useMemo)((()=>Ri({anonymizationFields:e,rawData:n})),[e,n]),{onTableChange:h,pagination:v,sorting:f}=Oi({defaultTableOptions:Fi({pageSize:10,sortDirection:"asc",sortField:"field"}),nameSpace:r,storageKey:"anonymizationPromptContextTable"}),y=(0,o.useMemo)((()=>(0,g.jsx)(Di,{handleRowChecked:e=>{const t=m.find((t=>t.field===e));t&&d((e=>[...e,t]))},onListUpdated:s,selectedFields:l.map((e=>e.field))})),[s,m,l]);return(0,g.jsx)(Ni,null,(0,g.jsx)(u.EuiInMemoryTable,{allowNeutralSort:!1,childrenBetween:i?y:void 0,columns:p,compressed:t,"data-test-subj":"contextEditor",itemId:hi,items:m,pagination:v,search:Zi,selection:c,sorting:f,onTableChange:h}))};Bi.displayName="ContextEditorComponent";const Ui=r().memo(Bi);var $i={name:"j1lte4",styles:"flex-direction:column;align-items:flex-start;padding-bottom:0"};const Vi=({onClose:e,onSave:t,promptContext:s})=>{var n,a;const{euiTheme:i}=(0,u.useEuiTheme)(),{http:l,toasts:d}=Ze(),[c,p]=(0,o.useState)(!1),m=(0,u.useGeneratedHtmlId)({prefix:"updateSettingPresetsCheckbox"}),h=(0,u.useGeneratedHtmlId)(),{data:v,refetch:f}=Dn(),[y,x]=r().useState([]),[b,C]=r().useState(s),[k,E]=(0,o.useState)({create:[],update:[],delete:{}}),w=(0,o.useMemo)((()=>Ka(b.rawData)),[b.rawData]),A=(0,o.useCallback)((async()=>{t&&t(y);try{await pi(l,k,d),f()}catch(e){}e()}),[k,f,y,l,e,t,d]),j=(0,o.useCallback)((e=>{x((t=>[...t,...e])),E((t=>{var s,n;return e.reduce(((e,t)=>{const s=(0,Yt.find)(v.data,["field",t.field]);var n,a;return s?null===(n=e.update)||void 0===n||n.push({id:s.id,..."allow"===t.update||"defaultAllow"===t.update?{allowed:"add"===t.operation}:{},..."allowReplacement"===t.update||"defaultAllowReplacement"===t.update?{anonymized:"add"===t.operation}:{}}):(null===(a=e.create)||void 0===a||a.push({field:t.field,allowed:"add"===t.operation&&("allow"===t.update||"defaultAllow"===t.update),anonymized:"add"===t.operation&&("allowReplacement"===t.update||"defaultAllowReplacement"===t.update)}),e.create=(0,Yt.uniqBy)(e.create,"field")),e}),{create:null!==(s=t.create)&&void 0!==s?s:[],update:null!==(n=t.update)&&void 0!==n?n:[]})})),C((t=>e.reduce(((e,{field:t,operation:s,update:n})=>qa({field:t,operation:s,selectedPromptContext:e,update:n})),t)))}),[v.data]),_=(0,o.useCallback)((e=>{p(e.target.checked)}),[]);return(0,g.jsx)(u.EuiModal,{onClose:e,"aria-labelledby":h},(0,g.jsx)(u.EuiModalHeader,{css:$i},(0,g.jsx)(u.EuiModalHeaderTitle,{id:h},ci),(0,g.jsx)(u.EuiSpacer,{size:"xs"}),(0,g.jsx)(u.EuiText,{size:"xs"},ui),(0,g.jsx)(u.EuiHorizontalRule,{margin:"s"})),(0,g.jsx)(u.EuiModalBody,null,(0,g.jsx)(di,{isDataAnonymizable:w,anonymizationFields:null===(n=b.contextAnonymizationFields)||void 0===n?void 0:n.data,rawData:b.rawData}),(0,g.jsx)(u.EuiSpacer,{size:"s"}),(0,g.jsx)(Ui,{anonymizationFields:null!==(a=b.contextAnonymizationFields)&&void 0!==a?a:{total:0,page:1,perPage:1e3,data:[],all:[]},onListUpdated:j,rawData:b.rawData})),(0,g.jsx)(u.EuiModalFooter,{css:(0,g.css)("background:",i.colors.backgroundBaseSubdued,";padding-block:16px;","")},(0,g.jsx)(u.EuiFlexGroup,{justifyContent:"spaceBetween"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiFormRow,{helpText:S.i18n.translate("xpack.elasticAssistant.dataAnonymizationEditor.updatePresetsCheckboxHelpText",{defaultMessage:"Apply new anonymization settings for current & future conversations."})},(0,g.jsx)(u.EuiCheckbox,{id:m,label:S.i18n.translate("xpack.elasticAssistant.dataAnonymizationEditor.updatePresetsCheckboxLabel",{defaultMessage:"Update presets"}),checked:c,onChange:_}))),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},(0,g.jsx)(u.EuiFlexItem,null,(0,g.jsx)(u.EuiButtonEmpty,{onClick:e,size:"s"},S.i18n.translate("xpack.elasticAssistant.dataAnonymizationEditor.closeButton",{defaultMessage:"Close"}))),(0,g.jsx)(u.EuiFlexItem,null,(0,g.jsx)(u.EuiButton,{onClick:A,fill:!0,size:"s"},S.i18n.translate("xpack.elasticAssistant.dataAnonymizationEditor.saveButton",{defaultMessage:"Save"}))))))))};Vi.displayName="SelectedPromptContextEditor";const Gi=r().memo(Vi),Ki=({currentReplacements:e,rawValue:t})=>{if(null!=e){const s=(0,h.invert)(e)[t];return null!=s?s:(0,k.v4)()}return(0,k.v4)()},qi=Je("strong",{target:"euqp2sh0"})("color:",(e=>e.showRealValues?e.theme.euiTheme.colors.textPrimary:e.theme.euiTheme.colors.textAccent),";cursor:pointer;");var Hi={name:"10mc5le",styles:"max-height:240px;overflow:auto"};const Qi=({selectedPromptContext:e,currentReplacements:t,showRealValues:s,onToggleShowAnonymizedValues:n})=>{const a=(0,o.useMemo)((()=>{var s,n;return qn({anonymizationFields:null!==(s=null===(n=e.contextAnonymizationFields)||void 0===n?void 0:n.data)&&void 0!==s?s:[],getAnonymizedValue:Ki,getAnonymizedValues:Hn,rawData:e.rawData,currentReplacements:t})}),[t,e]);return(0,g.jsx)(u.EuiText,{"data-test-subj":"selectedPromptContextPreview",color:"subdued",size:"xs",css:Hi},(0,g.jsx)("code",null,(0,g.jsx)(r().Fragment,null,Object.entries(a.anonymizedData).map((([e,t])=>(0,g.jsx)("div",{key:e},`${e},`,a.replacements[t[0]]?(0,g.jsx)(qi,{showRealValues:s,onClick:n},s?a.replacements[t[0]]:t):t))))))};Qi.displayName="SelectedPromptContextPreview";const Wi=r().memo(Qi),Yi=({selectedPromptContext:e,currentReplacements:t,onListUpdated:s,isDataAnonymizable:n})=>{const[a,i]=(0,o.useState)(!1),[l,d]=(0,o.useState)(!1),c=(0,o.useCallback)((()=>i(!0)),[]),p=(0,o.useCallback)((()=>{i(!1)}),[]),{allowed:m,anonymized:h,total:v}=(0,o.useMemo)((()=>{var t;return ni({anonymizationFields:null===(t=e.contextAnonymizationFields)||void 0===t?void 0:t.data,rawData:e.rawData})}),[e]),f=(0,o.useCallback)((()=>{d((e=>!e))}),[]);return(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween","data-test-subj":"summary",gutterSize:"m"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiFlexGroup,{gutterSize:"s"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(Xa,{allowed:m,total:v,inline:!0})),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(si,{anonymized:h,isDataAnonymizable:n,inline:!0})))),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiFlexGroup,{gutterSize:"s"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiButtonEmpty,{size:"xs",iconType:l?"eye":"eyeClosed",onClick:f},S.i18n.translate("xpack.elasticAssistant.dataAnonymizationEditor.hideRealValues",{defaultMessage:"Show anonymized"}))),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiButtonEmpty,{size:"xs",iconType:"documentEdit",onClick:c},S.i18n.translate("xpack.elasticAssistant.dataAnonymizationEditor.editButton",{defaultMessage:"Edit"})))))),(0,g.jsx)(u.EuiHorizontalRule,{margin:"xs"}),(0,g.jsx)(Wi,{showRealValues:l,selectedPromptContext:e,currentReplacements:t,onToggleShowAnonymizedValues:f}),a&&(0,g.jsx)(Gi,{promptContext:e,onClose:p,onSave:s}))};Yi.displayName="ContextEditorFlyoutComponent";const Ji=r().memo(Yi),Xi=({markdown:e,replacements:t})=>{const s=Object.keys(t).reduce(((e,s)=>e.replaceAll(s,t[s])),e);return(0,g.jsx)("div",{"data-test-subj":"replacementsContextViewer"},(0,g.jsx)(u.EuiMarkdownFormat,null,s))};Xi.displayName="ReplacementsContextViewer";const eo=r().memo(Xi),to=Je("div",{target:"e3hk6zn0"})({name:"1j3zebv",styles:"overflow-x:auto"}),so=({selectedPromptContext:e,setSelectedPromptContexts:t,currentReplacements:s})=>{const n=(0,o.useMemo)((()=>Ka(e.rawData)),[e]),a=(0,o.useCallback)((s=>{const n=s.reduce(((e,{field:t,operation:s,update:n})=>qa({field:t,operation:s,selectedPromptContext:e,update:n})),e);t((t=>({...t,[e.promptContextId]:n})))}),[e,t]);return(0,g.jsx)(to,{"data-test-subj":"dataAnonymizationEditor"},(0,g.jsx)(u.EuiPanel,{hasShadow:!1,paddingSize:"m"},"string"==typeof e.rawData?null!=e.replacements?(0,g.jsx)(eo,{markdown:e.rawData,replacements:e.replacements}):(0,g.jsx)(Qa,{rawData:e.rawData}):(0,g.jsx)(Ji,{selectedPromptContext:e,onListUpdated:a,currentReplacements:s,isDataAnonymizable:n})))},no=r().memo(so),ao=S.i18n.translate("xpack.elasticAssistant.assistant.promptEditor.selectedPromotContexts.removeContextTooltip",{defaultMessage:"Remove context"}),io=({promptContexts:e,selectedPromptContexts:t,setSelectedPromptContexts:s,currentReplacements:n})=>{const{euiTheme:a}=(0,u.useEuiTheme)(),i=(0,o.useCallback)((e=>{s((t=>(0,h.omit)(e,t)))}),[s]);return(0,h.isEmpty)(e)?null:(0,g.jsx)(u.EuiFlexGroup,{"data-test-subj":"selectedPromptContexts",direction:"column",gutterSize:"s"},Object.keys(t).sort().map(((o,r)=>{var l;return(0,g.jsx)(u.EuiFlexItem,{"data-test-subj":`selectedPromptContext-${o}`,grow:!1,key:o},(0,g.jsx)(u.EuiAccordion,{buttonContent:null===(l=e[o])||void 0===l?void 0:l.description,buttonProps:{"data-test-subj":`selectedPromptContext-${r}-button`},extraAction:(0,g.jsx)(u.EuiToolTip,{content:ao,disableScreenReaderOutput:!0},(0,g.jsx)(u.EuiButtonIcon,{"aria-label":ao,"data-test-subj":`removePromptContext-${o}`,iconType:"cross",onClick:()=>i(o)})),id:o,paddingSize:"s",css:(0,g.css)("background:",a.colors.backgroundBaseSubdued,";border-radius:",a.border.radius.medium,";>div:first-child{color:",a.colors.textPrimary,";padding:",a.size.m,";}",""),borders:"all",arrowProps:{color:"primary"}},(0,g.jsx)(no,{currentReplacements:n,selectedPromptContext:t[o],setSelectedPromptContexts:s})))})))},oo=r().memo(io),ro=S.i18n.translate("xpack.elasticAssistant.assistant.settings.settingsContextMenu.aiAssistantMenuAriaLabel",{defaultMessage:"Assistant settings menu"}),lo=S.i18n.translate("xpack.elasticAssistant.assistant.settings.settingsContextMenu.aiConvoMenuAriaLabel",{defaultMessage:"Conversation settings menu"}),co=S.i18n.translate("xpack.elasticAssistant.assistant.settings.aiAssistantSettings",{defaultMessage:"AI Assistant settings"}),uo=S.i18n.translate("xpack.elasticAssistant.assistant.settings.anonymization",{defaultMessage:"Anonymization"}),po=S.i18n.translate("xpack.elasticAssistant.assistant.settings.knowledgeBase",{defaultMessage:"Knowledge Base"}),mo=S.i18n.translate("xpack.elasticAssistant.assistant.settings.alertsToAnalyze",{defaultMessage:"Alerts to analyze"}),go=S.i18n.translate("xpack.elasticAssistant.assistant.settings.resetConversation",{defaultMessage:"Reset conversation"}),ho=S.i18n.translate("xpack.elasticAssistant.assistant.settings.anonymizeValues",{defaultMessage:"Show anonymized values"}),vo=S.i18n.translate("xpack.elasticAssistant.assistant.settings.showCitationsLabel",{defaultMessage:"Show citations"}),fo=S.i18n.translate("xpack.elasticAssistant.assistant.settings.chatOptions.label",{defaultMessage:"Chat options"}),yo=S.i18n.translate("xpack.elasticAssistant.assistant.resetConversationModal.cancelButtonText",{defaultMessage:"Cancel"}),xo=S.i18n.translate("xpack.elasticAssistant.assistant.resetConversationModal.resetButtonText",{defaultMessage:"Reset"}),bo=S.i18n.translate("xpack.elasticAssistant.assistant.resetConversationModal.clearChatConfirmation",{defaultMessage:"Are you sure you want to clear the current chat? All conversation data will be lost."}),Co=e=>{var t;return null!==(t=null==e?void 0:e.messages.some((e=>{var t;return!(0,Yt.isEmpty)(null===(t=e.metadata)||void 0===t?void 0:t.contentReferences)})))&&void 0!==t&&t},ko=e=>!(0,Yt.isEmpty)(null==e?void 0:e.replacements),So=navigator.platform.toLowerCase().indexOf("mac")>=0,Eo=({condition:e,wrap:t,children:s})=>e?t(s):s;var wo={name:"16s5rj8",styles:"width:280px"};const Ao=r().memo((({conversations:e,onConversationDeleted:t,onConversationSelected:s,isConversationOwner:n,isDisabled:a=!1,onChatCleared:i,refetchCurrentUserConversations:d,selectedConversation:c,setCurrentConversation:p})=>{const m=(0,u.useGeneratedHtmlId)(),{copyConversationUrl:h,duplicateConversation:v}=Nt(),{euiTheme:f}=(0,u.useEuiTheme)(),{setContentReferencesVisible:y,contentReferencesVisible:x,showAnonymizedValues:b,setShowAnonymizedValues:C}=Ze(),[k,S]=(0,o.useState)(!1),[E,w]=(0,o.useState)(null),[A,j]=(0,o.useState)(!1),_=(0,o.useCallback)((()=>j(!1)),[]),P=(0,o.useCallback)((()=>{S(!k)}),[k]),T=(0,o.useCallback)((()=>{S(!1)}),[]),I=(0,o.useCallback)((()=>{null==T||T(),j(!0)}),[T]),M=(0,o.useCallback)((e=>{null==T||T(),w(null!=e?e:null)}),[T]),z=(0,o.useCallback)((e=>{y(e.target.checked)}),[y]),F=(0,o.useCallback)((e=>{C(e.target.checked)}),[C]),O=(0,o.useMemo)((()=>Co(c)),[c]),R=(0,o.useMemo)((()=>ko(c)),[c]),L=(0,o.useMemo)((()=>c&&""!==c.id),[c]),D=(0,o.useCallback)((()=>h(c)),[h,c]),N=(0,o.useCallback)((()=>v({refetchCurrentUserConversations:d,selectedConversation:c,setCurrentConversation:p})),[v,d,c,p]),Z=(0,o.useMemo)((()=>[(0,g.jsx)(u.EuiContextMenuItem,{"aria-label":"copy-url",key:"copy-url",icon:"link","data-test-subj":"copy-url",onClick:D},dt),(0,g.jsx)(u.EuiContextMenuItem,{"aria-label":"duplicate",key:"duplicate",onClick:N,icon:"copy","data-test-subj":"duplicate"},it),...n?[(0,g.jsx)(u.EuiContextMenuItem,{"aria-label":"delete",key:"delete",onClick:()=>M(c),icon:"trash","data-test-subj":"delete"},ka)]:[],(0,g.jsx)(u.EuiPanel,{color:"transparent",paddingSize:"none",key:"chat-options-panel"},(0,g.jsx)(u.EuiTitle,{size:"xxxs",key:"chat-options-title",css:(0,g.css)("padding-left:",f.size.m,";padding-bottom:",f.size.xs,";","")},(0,g.jsx)("h3",null,fo)),(0,g.jsx)(u.EuiHorizontalRule,{margin:"none"}),(0,g.jsx)(u.EuiContextMenuItem,{"aria-label":"anonymize-values",key:"anonymize-values","data-test-subj":"anonymize-values"},(0,g.jsx)(u.EuiFlexGroup,{direction:"row",gutterSize:"s",alignItems:"center"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(Eo,{condition:!R,wrap:e=>(0,g.jsx)(u.EuiToolTip,{position:"top",key:"disabled-anonymize-values-tooltip","data-test-subj":"disabled-anonymize-values-tooltip",content:(0,g.jsx)(l.FormattedMessage,{id:"xpack.elasticAssistant.assistant.settings.anonymizeValues.disabled.tooltip",defaultMessage:"This conversation does not contain anonymized fields."})},e)},(0,g.jsx)(u.EuiSwitch,{"data-test-subj":"anonymize-switch",label:ho,checked:b,onChange:F,compressed:!0,disabled:!R}))),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiIconTip,{position:"top",key:"anonymize-values-tooltip",type:"info",content:(0,g.jsx)(l.FormattedMessage,{id:"xpack.elasticAssistant.assistant.settings.anonymizeValues.tooltip",defaultMessage:"Toggle to reveal or obfuscate field values in your chat stream. The data sent to the LLM is still anonymized based on settings in the Anonymization panel. Keyboard shortcut: <bold>{keyboardShortcut}</bold>",values:{keyboardShortcut:So?" + a":"Alt + a",bold:e=>(0,g.jsx)("strong",null,e)}})})))),(0,g.jsx)(u.EuiContextMenuItem,{"aria-label":"show-citations",key:"show-citations","data-test-subj":"show-citations"},(0,g.jsx)(u.EuiFlexGroup,{direction:"row",gutterSize:"s",alignItems:"center"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(Eo,{condition:!O,wrap:e=>(0,g.jsx)(u.EuiToolTip,{position:"top",key:"disabled-citations-values-tooltip","data-test-subj":"disabled-citations-values-tooltip",content:(0,g.jsx)(l.FormattedMessage,{id:"xpack.elasticAssistant.assistant.settings.showCitationsLabel.disabled.tooltip",defaultMessage:"This conversation does not contain citations."})},e)},(0,g.jsx)(u.EuiSwitch,{"data-test-subj":"citations-switch",label:vo,checked:x,onChange:z,compressed:!0,disabled:!O}))),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiIconTip,{position:"top",key:"show-citations-tooltip",type:"info",content:(0,g.jsx)(l.FormattedMessage,{id:"xpack.elasticAssistant.assistant.settings.showCitationsLabel.tooltip",defaultMessage:"Keyboard shortcut: <bold>{keyboardShortcut}</bold>",values:{keyboardShortcut:So?" + c":"Alt + c",bold:e=>(0,g.jsx)("strong",null,e)}})})))),L&&(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiHorizontalRule,{margin:"none"}),(0,g.jsx)(u.EuiContextMenuItem,{"aria-label":"clear-chat",key:"clear-chat",onClick:I,icon:"refresh",disabled:!n,"data-test-subj":"clear-chat",css:n?(0,g.css)("color:",f.colors.textDanger,";",""):null},go)))]),[D,N,n,f.size.m,f.size.xs,f.colors.textDanger,R,b,F,O,x,z,L,I,M,c]),B=(0,o.useCallback)((()=>{null==i||i(),_(),null==T||T()}),[i,_,T]);return(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiToolTip,{content:lo},(0,g.jsx)(u.EuiPopover,{button:(0,g.jsx)(u.EuiButtonIcon,{"aria-label":lo,isDisabled:a,iconType:"boxesVertical",onClick:P,"data-test-subj":"conversation-settings-menu"}),isOpen:k,closePopover:T,panelPaddingSize:"none",anchorPosition:"leftUp"},(0,g.jsx)(u.EuiContextMenuPanel,{items:Z,css:wo}))),A&&(0,g.jsx)(u.EuiConfirmModal,{"aria-labelledby":m,title:go,titleProps:{id:m},onCancel:_,onConfirm:B,cancelButtonText:yo,confirmButtonText:xo,buttonColor:"danger",defaultFocusedButton:"confirm","data-test-subj":"reset-conversation-modal"},(0,g.jsx)("p",null,bo)),(0,g.jsx)(Ta,{conversationList:Object.values(e),currentConversationId:null==c?void 0:c.id,deleteConversationItem:E,onConversationDeleted:t,onConversationSelected:s,setDeleteConversationItem:w}))}));Ao.displayName="ConversationSettingsMenu";const jo=S.i18n.translate("xpack.elasticAssistant.assistant.visibility.title",{defaultMessage:"Visibility"}),_o=S.i18n.translate("xpack.elasticAssistant.assistant.visibility.visibleToYou",{defaultMessage:"Only visible to you."}),Po=S.i18n.translate("xpack.elasticAssistant.assistant.visibility.visibleShared",{defaultMessage:"Visible to all space members."}),To=S.i18n.translate("xpack.elasticAssistant.assistant.visibility.visibleRestricted",{defaultMessage:"Only visible to selected space members."}),Io=S.i18n.translate("xpack.elasticAssistant.assistant.visibility.restricted",{defaultMessage:"Restricted"}),Mo=S.i18n.translate("xpack.elasticAssistant.assistant.visibility.share",{defaultMessage:"Share"}),zo=S.i18n.translate("xpack.elasticAssistant.assistant.visibility.private",{defaultMessage:"Private"}),Fo=S.i18n.translate("xpack.elasticAssistant.assistant.visibility.shared",{defaultMessage:"Shared"}),Oo=S.i18n.translate("xpack.elasticAssistant.assistant.visibility.selectVisibilityAriaLabel",{defaultMessage:"Select visibility"}),Ro=S.i18n.translate("xpack.elasticAssistant.assistant.visibility.inputPlaceholder",{defaultMessage:"An error occurred while fetching user suggestions."}),Lo=(S.i18n.translate("xpack.elasticAssistant.assistant.visibility.add",{defaultMessage:"Add"}),S.i18n.translate("xpack.elasticAssistant.assistant.visibility.done",{defaultMessage:"Done"})),Do=(S.i18n.translate("xpack.elasticAssistant.assistant.visibility.shareUsers",{defaultMessage:"Select users to share with"}),S.i18n.translate("xpack.elasticAssistant.assistant.visibility.privateSuccess",{defaultMessage:"Successfully set conversation to private"})),No=S.i18n.translate("xpack.elasticAssistant.assistant.visibility.privateError",{defaultMessage:"Could not set conversation to private"}),Zo=S.i18n.translate("xpack.elasticAssistant.assistant.visibility.sharedSuccess",{defaultMessage:"Successfully shared conversation with all users in the space"}),Bo=S.i18n.translate("xpack.elasticAssistant.assistant.visibility.sharedError",{defaultMessage:"Could not share conversation with all users in the space"}),Uo=S.i18n.translate("xpack.elasticAssistant.assistant.visibility.restrictedSuccess",{defaultMessage:"Successfully shared conversation with selected users"}),$o=S.i18n.translate("xpack.elasticAssistant.assistant.visibility.restrictedError",{defaultMessage:"Could not share conversation with selected users"});function Vo(e,t){if(t&&t.color)return t.color;const s=Ko(e).codePointAt(0)||97;return u.VISUALIZATION_COLORS[s%u.VISUALIZATION_COLORS.length]}function Go(e,t){if(t&&t.initials)return t.initials;const s=Ko(e).split(" "),n=Math.min(2,s.length);return s.splice(n,s.length),s.map((e=>e.substring(0,1))).join("")}function Ko(e){return e.full_name||e.email||e.username}function qo(e){const t=Ko(e);return e.email&&e.email!==t?`${t} (${e.email})`:t}const Ho=({user:e,avatar:t,...s})=>{const{euiTheme:n}=(0,u.useEuiTheme)();if(!e)return(0,g.jsx)(u.EuiAvatar,(0,Ue.default)({name:"",color:n.colors.lightestShade,initials:"?"},s));const a=qo(e);return null!=t&&t.imageUrl?(0,g.jsx)(u.EuiAvatar,(0,Ue.default)({name:a,imageUrl:t.imageUrl,color:"plain"},s)):(0,g.jsx)(u.EuiAvatar,(0,Ue.default)({name:a,initials:Go(e,t),initialsLength:2,color:Vo(e,t)},s))},Qo="null",Wo=({selectedOptions:e,defaultOptions:t,options:s,onChange:n,onSearchChange:a,isLoading:i=!1,singleSelection:d=!1,limit:c,height:p,loadingMessage:m,noMatchesMessage:h,emptyMessage:v,errorMessage:f,searchPlaceholder:y,searchInputId:x,selectedStatusMessage:b,limitReachedMessage:C,nullOptionLabel:k,nullOptionProps:E,defaultOptionsLabel:w,clearButtonLabel:A,...j})=>{const[_,P]=(0,o.useState)([]),[T,I]=(0,o.useState)(""),M=e?e.length:0,z=!!c&&M>=c,F=()=>{s||P((s=>{const n=[...s],a=e?e.filter((e=>!n.find((t=>Jo(t,e))))).map((e=>Yo(e,k,E))):[],i=t?t.filter((e=>!n.find((t=>Jo(t,e)))&&!a.find((t=>Jo(t,e))))).map((e=>Yo(e,k,E))):[];if(i.length){const e=(e=>{let t=e.findIndex((e=>e.isGroupLabel));return-1===t&&(t=e.push({label:null!=w?w:S.i18n.translate("userProfileComponents.userProfilesSelectable.defaultOptionsLabel",{defaultMessage:"Suggested"}),isGroupLabel:!0})-1),t})(n);n.splice(e,0,...a),n.push(...i)}else n.push(...a);return n}))};return(0,o.useEffect)((()=>{s?P(s.map((e=>Yo(e,k,E)))):(P([]),F())}),[s]),(0,o.useEffect)(F,[t,e]),(0,o.useEffect)((()=>{P((t=>t.map((t=>{if(e){var s;const n=void 0===e.find((e=>Jo(t,e)))?void 0:"on",a=!n&&z;return{...t,checked:n,disabled:a,prepend:t.data?(0,g.jsx)(Ho,{user:t.data.user,avatar:null===(s=t.data.data)||void 0===s?void 0:s.avatar,size:"s",isDisabled:a}):void 0}}return{...t,checked:void 0,disabled:void 0}}))))}),[s,t,e]),(0,g.jsx)(u.EuiSelectable,{"data-test-subj":j["data-test-subj"],options:_,onChange:t=>{if(!n)return;const s=t.filter((t=>!(t.isGroupLabel||"on"!==t.checked||e&&void 0!==e.find((e=>Jo(t,e)))))).map((e=>e.key===Qo?null:e.data));e&&!d&&e.forEach((e=>{const n=t.find((t=>Jo(t,e)));void 0!==n&&"on"!==n.checked||(n&&n.key===Qo?s.unshift(e):s.push(e))})),n(s)},css:(0,g.css)({maxHeight:p},"",""),singleSelection:d,searchable:!0,searchProps:{placeholder:null!=y?y:S.i18n.translate("userProfileComponents.userProfilesSelectable.searchPlaceholder",{defaultMessage:"Search"}),value:T,onChange:e=>{I(e),null==a||a(e)},isLoading:i,isClearable:!i,id:x},isPreFiltered:!0,listProps:{onFocusBadge:!1,rowHeight:48},loadingMessage:m,noMatchesMessage:h,emptyMessage:v,errorMessage:f,renderOption:(e,t)=>{if(e.user){const s=Ko(e.user);return(0,g.jsx)(r().Fragment,null,(0,g.jsx)("div",{className:"eui-textTruncate"},(0,g.jsx)(u.EuiHighlight,{search:t},s)),e.user.email&&e.user.email!==s?(0,g.jsx)(u.EuiText,{size:"xs",color:e.disabled?"disabled":"subdued",className:"eui-textTruncate"},t?(0,g.jsx)(u.EuiHighlight,{search:t},e.user.email):e.user.email):void 0)}return(0,g.jsx)(u.EuiHighlight,{search:t},e.label)}},((e,t)=>(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiPanel,{hasShadow:!1,paddingSize:"s"},t,d?void 0:(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiSpacer,{size:"s"}),(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween",gutterSize:"s",responsive:!1},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiText,{size:"xs",color:"subdued"},b?b(M):(0,g.jsx)(l.FormattedMessage,{id:"userProfileComponents.userProfilesSelectable.selectedStatusMessage",defaultMessage:"{count, plural, one {# user selected} other {# users selected}}",values:{count:M}}))),(0,g.jsx)(u.EuiFlexItem,{grow:!1},M?(0,g.jsx)(u.EuiButtonEmpty,{size:"xs",flush:"right",onClick:()=>null==n?void 0:n([])},null!=A?A:(0,g.jsx)(l.FormattedMessage,{id:"userProfileComponents.userProfilesSelectable.clearButtonLabel",defaultMessage:"Remove all users"})):void 0)))),c&&M>=c?(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiHorizontalRule,{margin:"none"}),(0,g.jsx)(u.EuiCallOut,{title:C?C(c):(0,g.jsx)(l.FormattedMessage,{id:"userProfileComponents.userProfilesSelectable.limitReachedMessage",defaultMessage:"You've selected the maximum of {count, plural, one {# user} other {# users}}",values:{count:c}}),color:"warning",size:"s"})):void 0,(0,g.jsx)(u.EuiHorizontalRule,{margin:"none"}),e)))};function Yo(e,t,s){return e?{key:e.uid,label:qo(e.user),data:e,"data-test-subj":`userProfileSelectableOption-${e.user.username}`}:{key:Qo,label:null!=t?t:S.i18n.translate("userProfileComponents.userProfilesSelectable.nullOptionLabel",{defaultMessage:"No users"}),"data-test-subj":"userProfileSelectableOption-null",...s}}function Jo(e,t){return e.key===(t?t.uid:Qo)}const Xo=__kbnSharedDeps__.ReactUse.useDebounce;var er=s.n(Xo);const tr=({forbiddenUsers:e,onUsersSelect:t,selectedUsers:s})=>{const{data:n}=(e=>{const{userProfileService:t}=Ze();return(0,C.useQuery)({queryKey:["bulkGetUsers",...e],queryFn:async()=>t.bulkGet({uids:new Set(e),dataPath:"avatar"}),enabled:e.length>0,keepPreviousData:!1,refetchOnWindowFocus:!1})})(s.map((e=>e.uid))),[a,i]=(0,o.useState)(""),{data:r,isLoading:l}=(({forbiddenUsers:e=[],searchTerm:t,size:s=5,onDebounce:n=Yt.noop})=>{const{http:a,toasts:i}=Ze(),[r,l]=(0,o.useState)(t);return er()((()=>{l(t),n()}),250,[t]),(0,C.useQuery)(["users","suggest",r,s],(({signal:e})=>(async({http:e,size:t=5,searchTerm:s,signal:n})=>await e.post(Ot,{body:JSON.stringify({searchTerm:s,size:t}),signal:n,version:Le}))({http:a,searchTerm:r,size:r.length>0?s:0,signal:e})),{retry:!1,keepPreviousData:!0,staleTime:6e4,select:t=>t.filter((t=>!e.includes(t.uid))),onError:e=>{"AbortError"!==e.name&&(null==i||i.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:Ro}))}})})({forbiddenUsers:e,searchTerm:a,size:s.length+5}),d=(0,o.useCallback)((e=>{const s=e.filter((e=>null!==e));t(s)}),[t]);return(0,g.jsx)(Wo,{"data-test-subj":"userProfilesSearch",isLoading:l,onChange:d,onSearchChange:i,options:Array.from(new Map([...null!=r?r:[],...null!=n?n:[]].map((e=>[e.uid,e]))).values()),selectedOptions:null!=n?n:[]})},sr=r().memo(tr),nr=({refetchCurrentConversation:e,refetchCurrentUserConversations:t,selectedConversation:s,setIsModalOpen:n})=>{const{copyConversationUrl:a,updateConversationUsers:i}=Nt(),{toasts:r}=Ze(),[l,d]=(0,o.useState)([]),c=(0,o.useMemo)((()=>tt(s)),[s]);(0,o.useEffect)((()=>{const e=(null==s?void 0:s.users.filter((e=>e.id!==(null==c?void 0:c.id)&&e.name!==(null==c?void 0:c.name))).map((({name:e,id:t})=>{var s,n;return{uid:null!==(s=null!=t?t:e)&&void 0!==s?s:"",enabled:!0,user:{username:null!==(n=null!=e?e:t)&&void 0!==n?n:""},data:{}}})))||[];d(e)}),[c,s]);const p=(0,o.useCallback)((()=>a(s)),[a,s]),m=(0,o.useCallback)((e=>{d(e)}),[]),h=(0,o.useCallback)((()=>{n(!1)}),[n]),v=(0,o.useCallback)((async()=>{n(!1);try{if(!s||""===(null==s?void 0:s.id))throw new Error("No conversation available to share");await i({conversationId:s.id,updatedUsers:[...l.map((e=>{var t,s,n;return{id:null!==(t=null==e?void 0:e.uid)&&void 0!==t?t:"",name:null!==(s=null==e||null===(n=e.user)||void 0===n?void 0:n.username)&&void 0!==s?s:""}})),...c?[{id:c.id,name:c.name}]:[]]}),await t(),e({}),null==r||r.addSuccess({title:Uo})}catch(e){null==r||r.addError(e,{title:$o})}}),[c,l,e,t,s,n,r,i]);return(0,g.jsx)(u.EuiModal,{onClose:h,maxWidth:600,"data-test-subj":"shareConversationModal"},(0,g.jsx)(u.EuiModalHeader,null,(0,g.jsx)(u.EuiModalHeaderTitle,{className:"eui-textTruncate"},`${Mo} `," ",(0,g.jsx)("strong",null,null==s?void 0:s.title))),(0,g.jsx)(u.EuiModalBody,null,(0,g.jsx)(sr,{onUsersSelect:m,selectedUsers:l,forbiddenUsers:[...null!=c&&c.id?[null==c?void 0:c.id]:[]]})),(0,g.jsx)(u.EuiModalFooter,null,(0,g.jsx)(u.EuiFlexGroup,{justifyContent:"spaceBetween"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiButton,{"data-test-subj":"copyConversationUrl",iconType:"copyClipboard",onClick:p},dt)),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiButton,{"data-test-subj":"shareConversation",onClick:v,fill:!0},Lo)))))},ar=r().memo(nr);var ir={name:"qamjgr",styles:"margin-right:4px"};const or=({conversationSharedState:e,isConversationOwner:t,isDropdown:s=!1,label:n,onClick:a})=>{const i=(0,o.useMemo)((()=>nt(e)),[e]),r=(0,o.useMemo)((()=>a?{onClick:a,onClickAriaLabel:Oo}:{}),[a]),l=(0,o.useMemo)((()=>s?{iconType:"arrowDown",iconSide:"right"}:{}),[s]);return(0,g.jsx)(u.EuiBadge,(0,Ue.default)({"aria-label":jo,color:"hollow","data-test-subj":"shareBadgeButton",isDisabled:!t},l,r),(0,g.jsx)(u.EuiIcon,{type:i,size:"s",css:ir}),n)};var rr={name:"oipjxo",styles:"width:230px"},lr={name:"xduje5",styles:"text-wrap:pretty"},dr={name:"1efi8gv",styles:"font-weight:bold"};const cr=({conversationSharedState:e,isConversationOwner:t,refetchCurrentConversation:s,refetchCurrentUserConversations:n,selectedConversation:a})=>{const{updateConversationUsers:i}=Nt(),{currentUser:l,toasts:d}=Ze(),[c,p]=(0,o.useState)(!1),m=(0,o.useMemo)((()=>[{checked:e===Xe.PRIVATE?"on":void 0,key:Xe.PRIVATE,data:{description:_o},"data-test-subj":Xe.PRIVATE,label:zo,isGroupLabel:!1},{checked:e===Xe.SHARED?"on":void 0,key:Xe.SHARED,data:{description:Po},"data-test-subj":Xe.SHARED,label:Fo,isGroupLabel:!1},{checked:e===Xe.RESTRICTED?"on":void 0,key:Xe.RESTRICTED,data:{description:To},"data-test-subj":Xe.RESTRICTED,label:Io,isGroupLabel:!1}]),[e]),h=(0,o.useCallback)((async()=>{try{l&&a&&""!==a.id&&(await i({conversationId:a.id,updatedUsers:[{id:l.id,name:l.name}]}),await n(),s({}),null==d||d.addSuccess({title:Do}))}catch(e){null==d||d.addError(e,{title:No})}}),[l,s,n,a,d,i]),v=(0,o.useCallback)((async()=>{try{if(!a||""===a.id)throw new Error("No conversation available to share globally");await i({conversationId:a.id,updatedUsers:[]}),await n(),s({}),null==d||d.addSuccess({title:Zo})}catch(e){null==d||d.addError(e,{title:Bo})}}),[s,n,a,d,i]),f=(0,o.useCallback)(((t,s,n)=>{n.key===Xe.PRIVATE&&e!==Xe.PRIVATE?h():n.key===Xe.SHARED&&e!==Xe.SHARED?v():n.key===Xe.RESTRICTED&&p(!0),x(!1)}),[e,v,h]),[y,x]=(0,o.useState)(!1),b=(0,o.useCallback)((()=>{x((e=>!e))}),[]),C=(0,o.useCallback)((()=>{x(!1)}),[]),k=(0,u.useGeneratedHtmlId)({prefix:"visibilityFilterGroupPopover"}),S=(0,o.useMemo)((()=>{const e=m.find((e=>"on"===e.checked));return null!=e?e.label:m[0].label}),[m]),E=(0,o.useCallback)((e=>(0,g.jsx)(u.EuiFlexGroup,{direction:"column",gutterSize:"none",justifyContent:"center"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiText,{css:dr,"data-test-subj":"optionLabel",size:"s"},e.label)),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiText,{css:lr,"data-test-subj":"optionDescription",size:"s"},e.description)))),[]);return(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiPopover,{button:(0,g.jsx)(or,{conversationSharedState:e,isConversationOwner:t,isDropdown:!0,label:S,onClick:b}),closePopover:C,"data-test-subj":"shareBadgePopover",id:k,isOpen:y,panelPaddingSize:"none"},(0,g.jsx)(u.EuiSelectable,{"aria-label":jo,"data-test-subj":"shareSelect",listProps:{isVirtualized:!1,rowHeight:60},options:m,onChange:f,renderOption:E,singleSelection:!0},(e=>(0,g.jsx)("div",{css:rr},e)))),c&&(0,g.jsx)(ar,{refetchCurrentConversation:s,refetchCurrentUserConversations:n,selectedConversation:a,setIsModalOpen:p}))},ur=r().memo(cr);var pr={name:"d3v9zr",styles:"overflow:hidden"};const mr=({title:e=wa,selectedConversation:t,refetchCurrentUserConversations:s,isDisabled:n=!1})=>{const[a,i]=(0,o.useState)(e),[r,l]=(0,o.useState)(!1),{updateConversationTitle:d}=Nt(),c=(0,o.useCallback)((async e=>{l(!1),t&&(await d({conversationId:t.id,updatedTitle:e}),await s())}),[s,t,d]);return(0,o.useEffect)((()=>{i(e)}),[e]),(0,g.jsx)(u.EuiFlexGroup,{gutterSize:"m",alignItems:"center"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)($t,{"data-test-subj":"titleIcon",size:"l"})),(0,g.jsx)(u.EuiFlexItem,{css:pr},(0,g.jsx)(u.EuiInlineEditTitle,{"data-test-subj":"conversationTitle",heading:"h2",inputAriaLabel:"Edit text inline",value:a,size:"xs",isInvalid:!!r,isReadOnly:n,onChange:e=>i(e.currentTarget.nodeValue||""),onCancel:()=>i(e),onSave:c,editModeProps:{formRowProps:{fullWidth:!0}}})))},gr={selectableAriaLabel:S.i18n.translate("xpack.aiAssistant.connectorSelector.selectableAriaLabel",{defaultMessage:"Select a connector"}),addConnectorAriaLabel:S.i18n.translate("xpack.aiAssistant.connectorSelector.addConnectorAriaLabel",{defaultMessage:"Add Connector"}),addConnectorLabel:S.i18n.translate("xpack.aiAssistant.connectorSelector.addConnectorLabel",{defaultMessage:"Add Connector"}),manageConnectorAriaLabel:S.i18n.translate("xpack.aiAssistant.connectorSelector.manageConnectorAriaLabel",{defaultMessage:"Manage Connector"}),preConfiguredConnectorLabel:S.i18n.translate("xpack.aiAssistant.connectorSelector.preConfiguredConnectorLabel",{defaultMessage:"Pre-configured"}),customConnectorLabel:S.i18n.translate("xpack.aiAssistant.connectorSelector.customConnectorLabel",{defaultMessage:"Custom"}),defaultConnectorLabel:S.i18n.translate("xpack.aiAssistant.connectorSelector.defaultConnectorLabel",{defaultMessage:"Default"})},hr=e=>{var t,s;const n=Object.prototype.hasOwnProperty.call(e,"value"),a=null!==(t=e.value)&&void 0!==t?t:void 0,[i,l]=(0,o.useState)((()=>{if(void 0!==e.defaultValue)return e.defaultValue})),d=n?a:i,c=(0,o.useMemo)((()=>(0,g.jsx)(u.EuiBadge,{color:"hollow","data-test-subj":"defaultConnectorBadge"},gr.defaultConnectorLabel)),[]),p=(0,o.useMemo)((()=>e.preConfiguredConnectors.map((t=>{var s;return{...t,key:t.value,checked:t.value===d?"on":void 0,append:t.value===e.defaultConnectorId?c:void 0,"data-test-subj":null!==(s=t["data-test-subj"])&&void 0!==s?s:t.value}}))),[e.preConfiguredConnectors,d,e.defaultConnectorId,c]),m=(0,o.useMemo)((()=>e.customConnectors.map((t=>{var s;return{...t,key:t.value,checked:t.value===d?"on":void 0,append:t.value===e.defaultConnectorId?c:void 0,"data-test-subj":null!==(s=t["data-test-subj"])&&void 0!==s?s:t.value}}))),[e.customConnectors,d,e.defaultConnectorId,c]),h=(0,o.useMemo)((()=>[...p.length>0?[{label:gr.preConfiguredConnectorLabel,isGroupLabel:!0,value:"preConfiguredLabel"}]:[],...p,...m.length>0?[{label:gr.customConnectorLabel,isGroupLabel:!0,value:"customLabel"}]:[],...m]),[p,m]);return(0,g.jsx)(u.EuiPanel,{hasShadow:!1,borderRadius:"none",paddingSize:"none",grow:!1,"data-test-subj":null!==(s=e["data-test-subj"])&&void 0!==s?s:"aiAssistantConnectorSelector"},(0,g.jsx)(u.EuiSelectable,{"aria-label":gr.selectableAriaLabel,singleSelection:!0,options:h,onChange:t=>{var s;const a=t.find((e=>"on"===e.checked));a&&(n||l(String(a.value)),null===(s=e.onValueChange)||void 0===s||s.call(e,String(a.value),a))},renderOption:e.renderOption},(t=>(0,g.jsx)(r().Fragment,null,t,e.footer))))},vr=e=>e.onAddConnectorClick||e.onManageConnectorsClick?(0,g.jsx)(u.EuiPopoverFooter,{paddingSize:"s"},(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center",gutterSize:"s",justifyContent:"flexEnd"},e.onAddConnectorClick&&(0,g.jsx)(u.EuiFlexItem,{grow:!0},(0,g.jsx)(u.EuiButton,{size:"s",fullWidth:!0,onClick:e.onAddConnectorClick,"aria-label":gr.addConnectorAriaLabel,"data-test-subj":"aiAssistantAddConnectorButton"},(0,g.jsx)(u.EuiIcon,{type:"plus"}),gr.addConnectorLabel)),e.onManageConnectorsClick&&(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiButtonIcon,{"data-test-subj":"aiAssistantManageConnectorsButton",size:"s",display:"base",iconType:"gear",onClick:e.onManageConnectorsClick,"aria-label":gr.manageConnectorAriaLabel})))):null,fr=e=>{const t=(0,o.useMemo)((()=>(0,g.jsx)(vr,{onAddConnectorClick:e.onAddConnectorClick,onManageConnectorsClick:e.onManageConnectorsClick})),[e.onAddConnectorClick,e.onManageConnectorsClick]);return(0,g.jsx)(hr,{value:e.value,onValueChange:e.onValueChange,customConnectors:e.customConnectors,preConfiguredConnectors:e.preConfiguredConnectors,defaultConnectorId:e.defaultConnectorId,footer:t,renderOption:e.renderOption,"data-test-subj":e["data-test-subj"]})},yr=e=>S.i18n.translate("xpack.elasticAssistant.attackDiscovery.statusSuccess",{values:{totalAttacks:e},defaultMessage:"The connector has updated with {totalAttacks} potential {totalAttacks, plural, =1 {attack} other {attacks}}"}),xr=S.i18n.translate("xpack.elasticAssistant.attackDiscovery.statusInProgress",{defaultMessage:"Attack discovery generation in progress."}),br=S.i18n.translate("xpack.elasticAssistant.attackDiscovery.statusFail",{defaultMessage:"The connector encountered an error while generating attack discoveries."}),Cr=({hasViewed:e,status:t,count:s})=>"running"===t?(0,g.jsx)(u.EuiFlexItem,{grow:!1,"data-test-subj":"status-running"},(0,g.jsx)(u.EuiToolTip,{"aria-label":xr,content:xr,position:"bottom"},(0,g.jsx)(u.EuiLoadingSpinner,{size:"s"}))):e?null:"succeeded"===t&&null!=s?(0,g.jsx)(u.EuiFlexItem,{grow:!1,"data-test-subj":"status-succeeded"},(0,g.jsx)(u.EuiToolTip,{"aria-label":yr(s),content:yr(s),position:"bottom"},(0,g.jsx)(u.EuiNotificationBadge,null,s))):"failed"===t?(0,g.jsx)(u.EuiFlexItem,{grow:!1,"data-test-subj":"status-failed"},(0,g.jsx)(u.EuiIconTip,{"aria-label":br,color:"warning",content:br,position:"bottom",size:"m",type:"warning"})):null,kr=r().memo((({isDisabled:e=!1,isOpen:t=!1,fullWidth:s=!1,displayFancy:n,selectedConnectorId:a,onConnectorSelectionChange:i,setIsOpen:l,stats:d=null,explicitConnectorSelection:c})=>{var p;const{actionTypeRegistry:m,http:h,assistantAvailability:v,inferenceEnabled:f,settings:y,navigateToApp:x}=Ze(),{euiTheme:b}=(0,u.useEuiTheme)(),[C,k]=(0,o.useState)(!1),[S,E]=(0,o.useState)(t),{data:w}=fn({http:h}),[A,j]=(0,o.useState)(null),{data:_,refetch:P}=Cn({http:h,inferenceEnabled:f,settings:y}),{effectiveValue:T,setOptimisticValue:I}=((e,t=5e3)=>{const[s,n]=(0,o.useState)(null),a=(0,o.useRef)(null);(0,o.useEffect)((()=>{null!==s&&e===s&&(n(null),a.current&&(clearTimeout(a.current),a.current=null))}),[e,s]),(0,o.useEffect)((()=>()=>{a.current&&clearTimeout(a.current)}),[]);const i=(0,o.useCallback)((e=>{n(e),a.current&&clearTimeout(a.current),a.current=setTimeout((()=>{n(null),a.current=null}),t)}),[t]);return{effectiveValue:null!==s?s:e,setOptimisticValue:i}})(a),M=(0,o.useMemo)((()=>(0,Yt.some)(_,["id",T])),[_,T]),z=(0,o.useCallback)((e=>{const t=(null!=_?_:[]).find((t=>t.id===e));t&&(I(e),i(t),E(!1))}),[_,i,E,I]),F=(0,o.useCallback)((()=>{null==l||l(!1),k(!1),j(null)}),[l]),O=(0,o.useCallback)((e=>{i({...e}),null==P||P(),F()}),[F,i,P]),R=y.client.get(yn,void 0),L=null!=T?T:c?void 0:R,D=null==_?void 0:_.find((e=>e.id===L)),N=null!==(p=null==D?void 0:D.name)&&void 0!==p?p:nn,Z=e||!v.hasConnectorsReadPrivilege,{customConnectors:B,preConfiguredConnectors:U}=(0,o.useMemo)((()=>(null!=_?_:[]).reduce(((e,t)=>(t.isPreconfigured?e.preConfiguredConnectors.push({label:t.name,value:t.id}):e.customConnectors.push({label:t.name,value:t.id}),e)),{customConnectors:[],preConfiguredConnectors:[]})),[_]),$=(0,o.useCallback)((e=>{var t;const s=null!==d&&null!==(t=d.statsPerConnector.find((t=>t.connectorId===e.key)))&&void 0!==t?t:null;return(0,g.jsx)(r().Fragment,{key:e.key},(0,g.jsx)(u.EuiFlexGroup,{justifyContent:"spaceBetween",gutterSize:"none",alignItems:"center"},(0,g.jsx)(u.EuiFlexItem,{grow:!1,"data-test-subj":`connector-${e.label}`},e.label),s&&(0,g.jsx)(Cr,s)))}),[d]),V=[{id:0,width:"100%",content:(0,g.jsx)(fr,{onAddConnectorClick:v.hasConnectorsAllPrivilege?()=>k(!0):void 0,onManageConnectorsClick:v.hasConnectorsReadPrivilege?()=>x("management",{path:"/insightsAndAlerting/triggersActionsConnectors/connectors"}):void 0,preConfiguredConnectors:U,customConnectors:B,defaultConnectorId:R,value:null==D?void 0:D.id,onValueChange:z,renderOption:$})}],G=(0,o.useMemo)((()=>{var e;return(0,g.jsx)(u.EuiButton,{iconType:"arrowDown",iconSide:"right",size:"s",color:"text",fullWidth:s,onClick:()=>E(!0),style:{borderWidth:s?1:0,backgroundColor:"transparent"},contentProps:{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",color:Z?b.colors.textDisabled:b.colors.textPrimary}},"data-test-subj":"connector-selector",isDisabled:Z},null!==(e=null==n?void 0:n(N,D))&&void 0!==e?e:N)}),[s,Z,n,N,D,E,b.colors.textDisabled,b.colors.textPrimary]);return(0,g.jsx)(r().Fragment,null,M||B.length+U.length!==0?(0,g.jsx)(u.EuiInputPopover,{input:G,isOpen:S,closePopover:()=>E(!1),panelPaddingSize:"none",anchorPosition:"downRight",fullWidth:s,panelMinWidth:300},(0,g.jsx)(u.EuiContextMenu,{initialPanelId:0,panels:V})):(0,g.jsx)(u.EuiButtonEmpty,{"data-test-subj":"addNewConnectorButton",iconType:"plusInCircle",isDisabled:Z,size:"xs",onClick:()=>k(!0)},sn),C&&(0,g.jsx)(o.Suspense,{fallback:!0},(0,g.jsx)(pn,{actionTypeRegistry:m,actionTypes:w,onClose:F,onSaveConnector:O,onSelectActionType:e=>j(e),selectedActionType:A})))}));kr.displayName="ConnectorSelector";const Sr=(0,Wt.css)({name:"o1fq1c",styles:"height:32px;.euiSuperSelectControl{border:none;box-shadow:none;background:none;padding-left:0;}.euiFormControlLayoutIcons{right:14px;top:2px;}"}),Er=(0,Wt.css)({name:"107imvz",styles:".euiSuperSelect{max-inline-size:100%!important;}.euiSuperSelectControl{max-inline-size:100%;}.euiFormControlLayout{max-inline-size:100%;}"}),wr=(0,Wt.css)({name:"1v31jro",styles:"margin-right:8px;overflow:hidden;text-overflow:ellipsis"}),Ar=r().memo((({fullWidth:e=!1,isDisabled:t=!1,selectedConnectorId:s,selectedConversation:n,onConnectorIdSelected:a,onConnectorSelected:i,stats:r=null,explicitConnectorSelection:l})=>{const[d,c]=(0,o.useState)(!1),{assistantAvailability:p}=Ze(),{setApiConfig:m}=Nt(),h=t||!p.hasConnectorsReadPrivilege,v=(0,o.useCallback)((async e=>{const t=e.id;if("ADD_NEW_CONNECTOR"===t)return;const s=vt(e),o=null==s?void 0:s.apiProvider,r=null==s?void 0:s.defaultModel;if(c(!1),null!=n)if(""===n.id&&null!=i)i(n,{...n.apiConfig,connectorId:t,actionTypeId:e.actionTypeId,provider:o,model:r});else{const s=await m({conversation:n,apiConfig:{...n.apiConfig,actionTypeId:e.actionTypeId,connectorId:t,provider:o,model:r}});s&&null!=i&&i(s)}null!=a&&a(t)}),[n,m,a,i]);return(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center",className:e?Er:Sr,direction:"row",gutterSize:"xs",justifyContent:"flexStart",responsive:!1},(0,g.jsx)(u.EuiFlexItem,null,(0,g.jsx)(kr,{fullWidth:e,displayFancy:e=>(0,g.jsx)(u.EuiText,{className:wr,size:"s"},e),isOpen:d,isDisabled:h,selectedConnectorId:s,setIsOpen:c,onConnectorSelectionChange:v,stats:r,explicitConnectorSelection:l})))}));Ar.displayName="ConnectorSelectorInline";const jr=Je("div",{target:"e1u2yunf0"})(":before{content:'';height:100%;border-left:",(e=>e.theme.euiTheme.border.thin),";}"),_r=(0,o.memo)((({isLoading:e,isExpanded:t,setIsExpanded:s,children:n,onConversationCreate:a,isAssistantEnabled:i})=>{const{euiTheme:l}=(0,u.useEuiTheme)(),d=(0,o.useCallback)((()=>s&&s(!t)),[t,s]),c=(0,o.useMemo)((()=>(0,g.jsx)(u.EuiButtonIcon,{disabled:e||!i,onClick:d,iconType:t?"arrowEnd":"arrowStart",size:"xs","data-test-subj":"aiAssistantFlyoutNavigationToggle","aria-label":t?S.i18n.translate("xpack.elasticAssistant.flyout.right.header.collapseDetailButtonAriaLabel",{defaultMessage:"Hide chats"}):S.i18n.translate("xpack.elasticAssistant.flyout.right.header.expandDetailButtonAriaLabel",{defaultMessage:"Show chats"})})),[i,t,e,d]);return(0,g.jsx)(u.EuiPanel,{hasShadow:!1,borderRadius:"none",paddingSize:"s",grow:!1,css:(0,g.css)("border-bottom:",l.border.thin,";","")},(0,g.jsx)(u.EuiFlexGroup,{direction:"row",justifyContent:"spaceBetween",alignItems:"center",gutterSize:"none"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},s&&(0,g.jsx)(u.EuiFlexItem,{grow:!1},c),a&&(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(jr,null)),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiButtonEmpty,{size:"xs",color:"primary",iconType:"newChat","data-test-subj":"newChatFromOverlay",onClick:a,disabled:e||!i},wa))))),n&&(0,g.jsx)(u.EuiFlexItem,{grow:!1},n)))}));_r.displayName="FlyoutNavigation";const Pr=(e,t)=>{const{assistantTelemetry:s,assistantStreamingEnabled:n,setAssistantStreamingEnabled:a,http:i,toasts:r}=Ze(),[l,d]=(0,o.useState)(e),[c,u]=(0,o.useState)({}),[p,m]=(0,o.useState)(n),g=(0,o.useCallback)((()=>{d(e),u({}),m(n)}),[n,e]),h=(0,o.useCallback)((t=>{var s,n;let a={};const i=new Set(null!==(s=null===(n=c.delete)||void 0===n?void 0:n.ids)&&void 0!==s?s:[]);Object.values(e).forEach((e=>{t.includes(e.id)&&(i.has(e.id)?a={...a,current:e}:i.add(e.id))})),d(a),u({...c,delete:{ids:Array.from(i)}})}),[e,c,d,u]),v=(0,o.useCallback)((t=>{var s,n,a;const i=null===(s=Object.values(e).find((e=>e.id===t)))||void 0===s?void 0:s.id;if(!i)return;const o={...e};delete o[i],d(o),u({...c,delete:{ids:[...null!==(n=null===(a=c.delete)||void 0===a?void 0:a.ids)&&void 0!==n?n:[],i]}})}),[e,c,d,u]),f=(0,o.useCallback)((async e=>{var t,o;const{isDeleteAll:l,bulkActions:d,excludedIds:m=[]}=null!=e?e:{},g=null!=d?d:c,h=g.create||g.update||g.delete,v=l||(null==m?void 0:m.length)>0?await(async({http:e,signal:t,toasts:s,excludedIds:n=[]})=>{try{const a=await e.fetch(St,{method:"DELETE",signal:t,version:Re,body:JSON.stringify({excludedIds:n})});if(null!=a&&a.failures){const e=new Error("Failed to delete all conversations");null==s||s.addError(e,{title:S.i18n.translate("xpack.elasticAssistant.conversations.deleteAllError",{defaultMessage:"Failed to delete all conversations"}),toastMessage:a.failures.join(",")})}return a}catch(e){null==s||s.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:S.i18n.translate("xpack.elasticAssistant.conversations.deleteAllConversationsError",{defaultMessage:"Error deleting conversations {error}",values:{error:e.message?Array.isArray(e.message)?e.message.join(","):e.message:e}})})}})({http:i,toasts:r,excludedIds:m}):h?await(async(e,t,s)=>{var n,a;const i=t.create?(o=t.create,r=null===(n=t.delete)||void 0===n?void 0:n.ids,Object.keys(o).reduce(((e,t)=>(!o||null!=r&&r.includes(t)||e.push(o[t]),e)),[])):void 0;var o,r;const l=t.update?((e,t)=>Object.keys(e).reduce(((s,n)=>(!e||null!=t&&t.includes(n)||s.push({...e[n],id:n}),s)),[]))(t.update,null===(a=t.delete)||void 0===a?void 0:a.ids):void 0;try{const s=await e.fetch(Et,{method:"POST",version:Le,body:JSON.stringify({update:l,create:i,delete:t.delete})});if(!s.success){var d;const e=null===(d=s.attributes.errors)||void 0===d?void 0:d.map((e=>`${e.status_code?`Error code: ${e.status_code}. `:""}Error message: ${e.message} for conversation ${e.conversations.map((e=>e.name)).join(",")}`)).join(",\n");throw new Error(e)}return s}catch(e){null==s||s.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:S.i18n.translate("xpack.elasticAssistant.conversations.bulkActionsConversationsError",{defaultMessage:"Error updating conversations {error}",values:{error:e.message?Array.isArray(e.message)?e.message.join(","):e.message:e}})})}})(i,g,r):void 0,f=n!==p;return a(p),f&&(null==s||s.reportAssistantSettingToggled({assistantStreamingEnabled:p})),u({}),null!==(t=null!==(o=null==v?void 0:v.success)&&void 0!==o?o:f)&&void 0!==t&&t}),[c,i,r,n,p,a,s]);return(0,o.useEffect)((()=>{t&&0===Object.keys(l).length&&d(e)}),[l,e,t]),{assistantStreamingEnabled:p,conversationSettings:l,conversationsSettingsBulkActions:c,onConversationDeleted:v,onConversationsBulkDeleted:h,resetConversationsSettings:g,saveConversationsSettings:f,setUpdatedAssistantStreamingEnabled:m,setConversationSettings:d,setConversationsSettingsBulkActions:u}},Tr=(S.i18n.translate("xpack.elasticAssistant.assistant.settings.settingsAriaLabel",{defaultMessage:"Settings"}),S.i18n.translate("xpack.elasticAssistant.assistant.settings.securityAiSettingsTitle",{defaultMessage:"AI Assistant for Security"}),S.i18n.translate("xpack.elasticAssistant.assistant.settings.settingsUpdatedToastTitle",{defaultMessage:"Settings updated"})),Ir=(S.i18n.translate("xpack.elasticAssistant.assistant.settings.genAiSettingsButton",{defaultMessage:"GenAI Settings"}),S.i18n.translate("xpack.elasticAssistant.assistant.settings.settingsConnectorsMenuItemTitle",{defaultMessage:"Connectors"}),S.i18n.translate("xpack.elasticAssistant.assistant.settings.settingsConversationsMenuItemTitle",{defaultMessage:"Conversations"}),S.i18n.translate("xpack.elasticAssistant.assistant.settings.settingsQuickPromptsMenuItemTitle",{defaultMessage:"Quick Prompts"}),S.i18n.translate("xpack.elasticAssistant.assistant.settings.settingsSystemPromptsMenuItemTitle",{defaultMessage:"System Prompts"}),S.i18n.translate("xpack.elasticAssistant.assistant.settings.settingsAnonymizationMenuItemTitle",{defaultMessage:"Anonymization"}),S.i18n.translate("xpack.elasticAssistant.assistant.settings.settingsKnowledgeBaseMenuItemTitle",{defaultMessage:"Knowledge Base"}),S.i18n.translate("xpack.elasticAssistant.assistant.settings.settingsEvaluationMenuItemTitle",{defaultMessage:"Evaluation"}),S.i18n.translate("xpack.elasticAssistant.assistant.promptEditor.systemPrompt.slCancelButtonTitle",{defaultMessage:"Cancel"})),Mr=S.i18n.translate("xpack.elasticAssistant.assistant.promptEditor.systemPrompt.slSaveButtonTitle",{defaultMessage:"Save"}),zr=(S.i18n.translate("xpack.elasticAssistant.assistant.promptEditor.systemPrompt.slDeleteButtonTitle",{defaultMessage:"Delete"}),S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.settings.settingsTitle",{defaultMessage:"Quick Prompts"})),Fr=S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.settings.settingsDescription",{defaultMessage:"Create and manage Quick Prompts. Quick Prompts are shortcuts to common actions."}),Or=S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.settings.nameLabel",{defaultMessage:"Name"}),Rr=S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.settings.promptLabel",{defaultMessage:"Prompt"}),Lr=S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.settings.promptPlaceholder",{defaultMessage:"Enter a Quick Prompt"}),Dr=S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.settings.badgeColorLabel",{defaultMessage:"Badge color"}),Nr=S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.settings.contextsLabel",{defaultMessage:"Contexts"}),Zr=S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.settings.contextsHelpText",{defaultMessage:"Select where this Quick Prompt will appear. Selecting none will make this prompt appear everywhere."}),Br=(S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.modalCancelButtonTitle",{defaultMessage:"Cancel"}),S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.modalSaveButtonTitle",{defaultMessage:"Save"}),(0,u.euiPaletteColorBlind)()),Ur=()=>{const e=Math.floor(Math.random()*Br.length);return Br[e]},$r=S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.quickPromptSelector.ariaLabel",{defaultMessage:"Select or type to create new..."}),Vr=S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.quickPromptSelector.deletePromptTitle",{defaultMessage:"Delete Quick Prompt"}),Gr=S.i18n.translate("xpack.elasticAssistant.assistant.quickPrompts.quickPromptSelector.customOptionText",{defaultMessage:"Create new Quick Prompt named"});var Kr={name:"4109g5",styles:"visibility:hidden;.parentFlexGroup:hover &{visibility:visible;}"},qr={name:"d3v9zr",styles:"overflow:hidden"},Hr={name:"1e5733u",styles:"width:calc(100% - 60px)"};const Qr=r().memo((({isDisabled:e=!1,quickPrompts:t,onQuickPromptDeleted:s,onQuickPromptSelectionChange:n,resetSettings:a,selectedColor:i,selectedQuickPrompt:r})=>{const[l,d]=(0,o.useState)(t.map((e=>{var t;return{value:{isDefault:null!==(t=e.isDefault)&&void 0!==t&&t},label:e.name,"data-test-subj":e.name,id:e.id,color:e.color}}))),c=(0,o.useMemo)((()=>r?[{value:{isDefault:!0},label:r.name,id:r.id,color:r.color}]:[]),[r]),p=(0,o.useCallback)((e=>{var s,o;null==a||a();const r=0===e.length?void 0:null!==(s=t.find((t=>{var s;return t.name===(null===(s=e[0])||void 0===s?void 0:s.label)})))&&void 0!==s?s:null===(o=e[0])||void 0===o?void 0:o.label;r&&n(r,i)}),[n,a,t,i]),m=(0,o.useCallback)(((e,t=[])=>{if(!e||!e.trim().toLowerCase())return;const s=e.trim().toLowerCase(),n={value:e,label:e,id:e};-1!==t.findIndex((e=>e.label.trim().toLowerCase()===s))||d([...l,n]),p([n])}),[p,l]),h=(0,o.useCallback)((e=>{0===e.length?p([]):-1!==l.findIndex((t=>t.label===(null==e?void 0:e[0].label)))&&p(e)}),[p,l]),v=(0,o.useCallback)((e=>{var t,n;const a=null===(t=l.find((t=>t.label===e)))||void 0===t?void 0:t.id;d(l.filter((t=>t.label!==e))),(null==c||null===(n=c[0])||void 0===n?void 0:n.label)===e&&p([]),s(null!=a?a:e)}),[p,s,l,c]);return(0,g.jsx)(u.EuiComboBox,{"data-test-subj":"quickPromptSelector","aria-label":$r,compressed:!0,isDisabled:e,placeholder:$r,customOptionText:`${Gr} {searchValue}`,singleSelection:!0,options:l,selectedOptions:c,onChange:h,onCreateOption:m,renderOption:(e,t)=>{const{color:s,label:n,value:a}=e;return(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center",className:"parentFlexGroup",component:"span",justifyContent:"spaceBetween"},(0,g.jsx)(u.EuiFlexItem,{component:"span",grow:!1,css:Hr},(0,g.jsx)(u.EuiHealth,{color:s,css:qr},(0,g.jsx)(u.EuiHighlight,{search:t},n))),!(null!=a&&a.isDefault)&&(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiToolTip,{position:"right",content:Vr,disableScreenReaderOutput:!0},(0,g.jsx)(u.EuiButtonIcon,{iconType:"cross","aria-label":Vr,"data-test-subj":"delete-quick-prompt",color:"danger",onClick:e=>{e.stopPropagation(),v(n)},css:Kr}))))},fullWidth:!0})}));Qr.displayName="QuickPromptSelector";const Wr=r().memo((({isDisabled:e,onPromptContextSelectionChange:t,promptContexts:s,selectedPromptContexts:n=[]})=>{const a=(0,o.useMemo)((()=>s.map((e=>({value:{category:e.category},label:e.description,"data-test-subj":e.description})))),[s]),i=(0,o.useMemo)((()=>null!=n?n.map((e=>({value:{category:e.category},label:e.description}))):[]),[n]),r=(0,o.useCallback)((e=>{const n=s.filter((t=>e.some((e=>t.description===e.label))));t(n)}),[t,s]),l=(0,o.useCallback)((e=>{0===e.length?r([]):-1!==a.findIndex((t=>t.label===(null==e?void 0:e[0].label)))&&r(e)}),[r,a]);return(0,g.jsx)(u.EuiComboBox,{"aria-label":Ps,compressed:!0,"data-test-subj":"promptContextSelector",fullWidth:!0,isDisabled:e,placeholder:Is,options:a,selectedOptions:i,onChange:l,renderOption:(e,t,s)=>{const{label:n,value:a}=e;return(0,g.jsx)("span",{className:s},(0,g.jsx)(u.EuiHighlight,{search:t},n),(0,g.jsx)("span",null,` / (${null==a?void 0:a.category})`))}})}));Wr.displayName="PromptContextSelector";var Yr={name:"xpz1vu",styles:"min-height:150px"};const Jr=({onPromptContentChange:e,onQuickPromptColorChange:t,onQuickPromptContextChange:s,onQuickPromptDelete:n,onQuickPromptSelect:a,resetSettings:i,selectedQuickPrompt:l,quickPromptSettings:d})=>{const{basePromptContexts:c}=Ze(),p=(0,o.useMemo)((()=>{var e;return null!==(e=null==l?void 0:l.content)&&void 0!==e?e:""}),[null==l?void 0:l.content]),m=(0,o.useCallback)((()=>{const e=Ur();return t(e,{hex:e,isValid:!0}),e}),[t]),h=(0,o.useMemo)((()=>{var e;return null!==(e=null==l?void 0:l.color)&&void 0!==e?e:m()}),[null==l?void 0:l.color,m]),v=(0,o.useMemo)((()=>{var e;return null!==(e=c.filter((e=>{var t;return null==l||null===(t=l.categories)||void 0===t?void 0:t.some((t=>(null==e?void 0:e.category)===t))})))&&void 0!==e?e:[]}),[c,null==l?void 0:l.categories]),f=(0,o.useCallback)((t=>e(t.target.value)),[e]);return(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiFormRow,{label:Or,display:"rowCompressed",fullWidth:!0},(0,g.jsx)(Qr,{onQuickPromptDeleted:n,onQuickPromptSelectionChange:a,quickPrompts:d,resetSettings:i,selectedQuickPrompt:l,selectedColor:h})),(0,g.jsx)(u.EuiFormRow,{label:Rr,display:"rowCompressed",fullWidth:!0},(0,g.jsx)(u.EuiTextArea,{compressed:!0,disabled:null==l,fullWidth:!0,"data-test-subj":"quick-prompt-prompt",onChange:f,placeholder:Lr,value:p,css:Yr})),(0,g.jsx)(u.EuiFormRow,{display:"rowCompressed",fullWidth:!0,label:Nr,helpText:Zr},(0,g.jsx)(Wr,{isDisabled:null==l,onPromptContextSelectionChange:s,promptContexts:c,selectedPromptContexts:v})),(0,g.jsx)(u.EuiFormRow,{display:"rowCompressed",label:Dr},(0,g.jsx)(u.EuiColorPicker,{color:h,compressed:!0,disabled:null==l,onChange:t})))},Xr=(0,o.memo)(Jr);Xr.displayName="QuickPromptSettingsEditor";const el=r().memo((({onPromptContentChange:e,onQuickPromptColorChange:t,onQuickPromptContextChange:s,onQuickPromptDelete:n,onQuickPromptSelect:a,resetSettings:i,selectedQuickPrompt:o,quickPromptSettings:l})=>(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiTitle,{size:"s"},(0,g.jsx)("h2",null,zr)),(0,g.jsx)(u.EuiSpacer,{size:"xs"}),(0,g.jsx)(u.EuiText,{size:"s"},Fr),(0,g.jsx)(u.EuiHorizontalRule,{margin:"s"}),(0,g.jsx)(Xr,{onPromptContentChange:e,onQuickPromptColorChange:t,onQuickPromptContextChange:s,onQuickPromptDelete:n,onQuickPromptSelect:a,resetSettings:i,selectedQuickPrompt:o,quickPromptSettings:l}))));el.displayName="AddQuickPromptModal";const tl=S.i18n.translate("xpack.elasticAssistant.assistant.promptEditor.systemPrompt.settings.settingsTitle",{defaultMessage:"System Prompts"}),sl=S.i18n.translate("xpack.elasticAssistant.assistant.promptEditor.systemPrompt.settings.settingsDescription",{defaultMessage:"Create and manage System Prompts. System Prompts are configurable chunks of context that are always sent for a given conversation."}),nl=S.i18n.translate("xpack.elasticAssistant.assistant.promptEditor.systemPrompt.settings.nameLabel",{defaultMessage:"Name"}),al=S.i18n.translate("xpack.elasticAssistant.assistant.promptEditor.systemPrompt.settings.promptLabel",{defaultMessage:"Prompt"}),il=S.i18n.translate("xpack.elasticAssistant.assistant.promptEditor.systemPrompt.settings.promptPlaceholder",{defaultMessage:"Enter a System Prompt"}),ol=S.i18n.translate("xpack.elasticAssistant.assistant.promptEditor.systemPrompt.settings.defaultConversationsLabel",{defaultMessage:"Default conversations"}),rl=S.i18n.translate("xpack.elasticAssistant.assistant.promptEditor.systemPrompt.settings.defaultNewConversationTitle",{defaultMessage:"Use as default for all new conversations"}),ll=S.i18n.translate("xpack.elasticAssistant.assistant.promptEditor.systemPrompt.settings.defaultConversationsHelpText",{defaultMessage:"Conversations that should use this System Prompt by default."});S.i18n.translate("xpack.elasticAssistant.assistant.promptEditor.systemPrompt.slCancelButtonTitle",{defaultMessage:"Cancel"}),S.i18n.translate("xpack.elasticAssistant.assistant.promptEditor.systemPrompt.slSaveButtonTitle",{defaultMessage:"Save"});var dl={name:"fna1i9",styles:"display:block;height:1px;width:1px"};const cl=r().memo((({conversations:e,isDisabled:t=!1,onConversationSelectionChange:s,selectedConversations:n=[],setPaginationObserver:a})=>{const i=(0,o.useMemo)((()=>{var t;const s=Object.values(e);return null===(t=s[s.length-1])||void 0===t?void 0:t.id}),[e]),r=(0,o.useCallback)((e=>{e&&a(e)}),[a]),l=(0,o.useMemo)((()=>e.map((e=>{var t,s;return{label:null!==(t=e.title)&&void 0!==t?t:"",id:e.id,"data-test-subj":(s=e.title,`conversationMultiSelectorOption-${s}`),append:e.id===i?(0,g.jsx)("div",{ref:r,css:dl}):void 0}}))),[e,i,r]),d=(0,o.useMemo)((()=>null!=n?n.map((e=>({label:e.title,id:e.id}))):[]),[n]),c=(0,o.useCallback)((t=>{const n=e.filter((e=>t.some((t=>e.id===t.id))));s(n)}),[e,s]),p=(0,o.useCallback)((e=>{0===e.length?c([]):-1!==l.findIndex((t=>t.id===(null==e?void 0:e[0].id)))&&c(e)}),[c,l]);return(0,g.jsx)(u.EuiComboBox,{"aria-label":ol,compressed:!0,"data-test-subj":"conversationMultiSelector",isDisabled:t,fullWidth:!0,options:l,selectedOptions:d,onChange:p})}));cl.displayName="ConversationMultiSelector";const ul=S.i18n.translate("xpack.elasticAssistant.assistant.promptEditor.systemPrompt.systemPromptModal.systemPromptSelector.ariaLabel",{defaultMessage:"Select or type to create new..."}),pl=S.i18n.translate("xpack.elasticAssistant.assistant.promptEditor.systemPrompt.systemPromptModal.systemPromptSelector.deletePromptTitle",{defaultMessage:"Delete System Prompt"}),ml=S.i18n.translate("xpack.elasticAssistant.assistant.promptEditor.systemPrompt.systemPromptModal.systemPromptSelector.customOptionText",{defaultMessage:"Create new System Prompt named"}),gl=e=>e.reduce(((e,t)=>{var s,n;return[...e,{value:{isDefault:null!==(s=t.isDefault)&&void 0!==s&&s,isNewConversationDefault:null!==(n=t.isNewConversationDefault)&&void 0!==n&&n},label:t.name,id:t.id,"data-test-subj":`${As}-${t.id}`}]}),[]);var hl={name:"4109g5",styles:"visibility:hidden;.parentFlexGroup:hover &{visibility:visible;}"},vl={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"},fl={name:"qhxz92",styles:"max-width:100%"},yl={name:"1e5733u",styles:"width:calc(100% - 60px)"};const xl=r().memo((({autoFocus:e=!1,onSystemPromptDeleted:t,onSystemPromptSelectionChange:s,resetSettings:n,selectedSystemPrompt:a,systemPrompts:i})=>{const[r,l]=(0,o.useState)(gl(i));(0,o.useEffect)((()=>{i.length&&!r.length&&l(gl(i))}),[r.length,i]);const d=(0,o.useMemo)((()=>{var e,t;return a?[{value:{isDefault:null!==(e=a.isDefault)&&void 0!==e&&e,isNewConversationDefault:null!==(t=a.isNewConversationDefault)&&void 0!==t&&t},id:a.id,label:a.name}]:[]}),[a]),c=(0,o.useCallback)((e=>{var t,a;null==n||n();const o=0===e.length?void 0:null!==(t=i.find((t=>{var s;return t.name===(null===(s=e[0])||void 0===s?void 0:s.label)})))&&void 0!==t?t:null===(a=e[0])||void 0===a?void 0:a.label;s(o)}),[s,n,i]),p=(0,o.useCallback)(((e,t=[])=>{if(!e||!e.trim().toLowerCase())return;const s=e.trim().toLowerCase(),n={value:e,id:e,label:e};-1!==t.findIndex((e=>e.label.trim().toLowerCase()===s))||l([...r,n]),c([n])}),[c,r]),m=(0,o.useCallback)((e=>{0===e.length?c([]):-1!==r.findIndex((t=>t.label===(null==e?void 0:e[0].label)))&&c(e)}),[c,r]),h=(0,o.useCallback)((e=>{var s,n;const a=null===(s=r.find((t=>t.label===e)))||void 0===s?void 0:s.id;l(r.filter((t=>t.label!==e))),(null==d||null===(n=d[0])||void 0===n?void 0:n.label)===e&&c([]),t(null!=a?a:e)}),[c,t,r,d]);return(0,g.jsx)(u.EuiComboBox,{"aria-label":ul,className:"systemPromptSelector",compressed:!0,"data-test-subj":As,fullWidth:!0,placeholder:ul,customOptionText:`${ml} {searchValue}`,singleSelection:{asPlainText:!0},options:r,selectedOptions:d,onChange:m,onCreateOption:p,renderOption:(e,t)=>{const{label:s,value:n}=e;return(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center",className:"parentFlexGroup",component:"span",justifyContent:"spaceBetween","data-test-subj":"systemPromptOptionSelector"},(0,g.jsx)(u.EuiFlexItem,{grow:!1,component:"span",css:yl},(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center",component:"span",gutterSize:"s"},(0,g.jsx)(u.EuiFlexItem,{component:"span",grow:!1,css:fl},(0,g.jsx)(u.EuiHighlight,{search:t,css:vl},s)),(null==n?void 0:n.isNewConversationDefault)&&(0,g.jsx)(u.EuiFlexItem,{grow:!1,component:"span"},(0,g.jsx)(u.EuiIconTip,{position:"right",content:rl,type:"starFilled"})))),!(null!=n&&n.isDefault)&&(0,g.jsx)(u.EuiFlexItem,{grow:!1,component:"span"},(0,g.jsx)(u.EuiToolTip,{position:"right",content:pl,disableScreenReaderOutput:!0},(0,g.jsx)(u.EuiButtonIcon,{iconType:"cross","aria-label":pl,color:"danger","data-test-subj":"delete-prompt",onClick:e=>{e.stopPropagation(),h(s)},css:hl}))))},autoFocus:e})}));xl.displayName="SystemPromptSelector";var bl={name:"xpz1vu",styles:"min-height:150px"};const Cl=({conversations:e,onConversationSelectionChange:t,onNewConversationDefaultChange:s,onPromptContentChange:n,onSystemPromptDelete:a,onSystemPromptSelect:i,resetSettings:l,selectedSystemPrompt:d,setPaginationObserver:c,systemPromptSettings:p})=>{const m=(0,o.useMemo)((()=>null==d),[d]),h=(0,o.useMemo)((()=>{var e;return null!==(e=null==d?void 0:d.content)&&void 0!==e?e:""}),[null==d?void 0:d.content]),v=(0,o.useMemo)((()=>Object.values(e)),[e]),f=(0,o.useMemo)((()=>!m&&d?d.conversations:[]),[m,d]),y=(0,o.useMemo)((()=>{var e;return null!==(e=null==d?void 0:d.isNewConversationDefault)&&void 0!==e&&e}),[null==d?void 0:d.isNewConversationDefault]),x=(0,o.useCallback)((e=>n(e.target.value)),[n]),b=(0,o.useCallback)((e=>s(e.target.checked)),[s]);return(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiFormRow,{display:"rowCompressed",label:nl,fullWidth:!0},(0,g.jsx)(xl,{onSystemPromptDeleted:a,onSystemPromptSelectionChange:i,selectedSystemPrompt:d,resetSettings:l,systemPrompts:p})),(0,g.jsx)(u.EuiFormRow,{display:"rowCompressed",label:al,fullWidth:!0},(0,g.jsx)(u.EuiTextArea,{"data-test-subj":js,disabled:m,onChange:x,placeholder:il,value:h,compressed:!0,fullWidth:!0,css:bl})),(0,g.jsx)(u.EuiFormRow,{display:"rowCompressed",fullWidth:!0,helpText:ll,label:ol},(0,g.jsx)(cl,{conversations:v,isDisabled:m,onConversationSelectionChange:t,selectedConversations:f,setPaginationObserver:c})),(0,g.jsx)(u.EuiFormRow,{display:"rowCompressed"},(0,g.jsx)(u.EuiCheckbox,{"data-test-subj":_s,disabled:m,id:"defaultNewConversation",label:(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},(0,g.jsx)(u.EuiFlexItem,null,rl),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiIcon,{type:y?"starFilled":"starEmpty"}))),checked:y,onChange:b})))},kl=r().memo(Cl);kl.displayName="SystemPromptEditor";const Sl=r().memo((({conversations:e,onConversationSelectionChange:t,onNewConversationDefaultChange:s,onPromptContentChange:n,onSystemPromptDelete:a,onSystemPromptSelect:i,resetSettings:o,selectedSystemPrompt:l,systemPromptSettings:d,setPaginationObserver:c})=>(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiTitle,{size:"s"},(0,g.jsx)("h2",{"data-test-subj":"systemPromptSettingsTitle"},tl)),(0,g.jsx)(u.EuiSpacer,{size:"xs"}),(0,g.jsx)(u.EuiText,{size:"s"},sl),(0,g.jsx)(u.EuiHorizontalRule,{margin:"s"}),(0,g.jsx)(kl,{conversations:e,onConversationSelectionChange:t,onNewConversationDefaultChange:s,onPromptContentChange:n,onSystemPromptDelete:a,onSystemPromptSelect:i,resetSettings:o,selectedSystemPrompt:l,setPaginationObserver:c,systemPromptSettings:d}))));Sl.displayName="SystemPromptSettings";const El=async(e,t,s)=>{try{const s=await e.fetch(jt,{method:"POST",version:Re,body:JSON.stringify(t)});if(!s.success){var n;const e=null===(n=s.attributes.errors)||void 0===n?void 0:n.map((e=>`${e.status_code?`Error code: ${e.status_code}. `:""}Error message: ${e.message} for prompt ${e.prompts.map((e=>e.name)).join(",")}`)).join(",\n");throw new Error(e)}return s}catch(e){return null==s||s.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:S.i18n.translate("xpack.elasticAssistant.prompts.bulkActionspromptsError",{defaultMessage:"Error updating prompts {error}",values:{error:e.message?Array.isArray(e.message)?e.message.join(","):e.message:e}})}),{success:!1}}},wl=[],Al=[],jl={},_l=c()(u.EuiModal).withConfig({displayName:"StyledEuiModal",componentId:"sc-1qgqser-0"})(["width:800px;height:575px;"]),Pl=r().memo((({defaultConnector:e,onClose:t,onSave:s,conversations:n,conversationsLoaded:a,setPaginationObserver:i})=>{const{currentAppId:l,http:d,assistantAvailability:{isAssistantEnabled:c},selectedSettingsTab:p,setSelectedSettingsTab:m,toasts:g,settings:h}=Ze();(0,o.useEffect)((()=>{null==p&&m(Ms)}),[p,m]);const{data:v,isFetched:f}=Dt(),{data:y}=Cn({http:d,settings:h}),{conversationsSettingsBulkActions:x,resetConversationsSettings:b,saveConversationsSettings:C,setConversationsSettingsBulkActions:k}=Pr(n,a),{onPromptContentChange:S,onQuickPromptColorChange:E,onQuickPromptContextChange:w,onQuickPromptDelete:A,onQuickPromptSelect:j,quickPromptSettings:_,resetQuickPromptSettings:P,saveQuickPromptSettings:T,selectedQuickPrompt:I}=(({allPrompts:e,currentAppId:t,http:s,promptsLoaded:n,toasts:a})=>{const[i,r]=(0,o.useState)({}),[l,d]=(0,o.useState)(),[c,u]=(0,o.useState)(e.data.filter((e=>e.promptType===gs.quick)));(0,o.useEffect)((()=>{n&&u([...e.data.filter((e=>e.promptType===gs.quick))])}),[e.data,n]);const p=(0,o.useCallback)(((e,s)=>{if(null==e)return d(void 0);const n="string"==typeof e,a=s||(n?Ur():e.color),o=n?{name:e,id:"",content:"",color:a,categories:[],promptType:gs.quick,consumer:t}:e;n&&r((e=>{var t;return{...e,create:[...null!==(t=i.create)&&void 0!==t?t:[],{...o}]}})),d(o)}),[t,i.create]),m=(0,o.useCallback)((e=>{if(null!=l){var t,s;d({...l,content:e});const n={...i,...""!==l.id?{update:[...(null!==(t=i.update)&&void 0!==t?t:[]).filter((e=>e.id!==l.id)),{...l,content:e}]}:{create:[...(null!==(s=i.create)&&void 0!==s?s:[]).filter((e=>e.name!==l.name)),{...l,content:e}]}};r(n)}}),[i,l]),g=(0,o.useCallback)((e=>{var t,s;null!=l&&(d({...l,categories:e.map((e=>e.category))}),r({...i,...""!==l.id?{update:[...(null!==(t=i.update)&&void 0!==t?t:[]).filter((e=>e.id!==l.id)),{...l,categories:e.map((e=>e.category))}]}:{create:[...(null!==(s=i.create)&&void 0!==s?s:[]).filter((e=>e.name!==l.name)),{...l,categories:e.map((e=>e.category))}]}}))}),[i,l,r]),h=(0,o.useCallback)((e=>{var t,s;r({...i,delete:{ids:[...null!==(t=null===(s=i.delete)||void 0===s?void 0:s.ids)&&void 0!==t?t:[],e]}})}),[i,r]),v=(0,o.useCallback)((e=>{var t,s;null!=l&&(d({...l,color:e}),r({...i,...""!==l.id?{update:[...(null!==(t=i.update)&&void 0!==t?t:[]).filter((e=>e.id!==l.id)),{...l,color:e}]}:{create:[...(null!==(s=i.create)&&void 0!==s?s:[]).filter((e=>e.name!==l.name)),{...l,color:e}]}}))}),[i,l,r]),f=(0,o.useCallback)((()=>{r({}),d(void 0)}),[]),y=(0,o.useCallback)((async()=>{var e;const t=i.create||i.update||i.delete?await El(s,i,a):void 0;return f(),null!==(e=null==t?void 0:t.success)&&void 0!==e&&e}),[s,i,f,a]);return{onPromptContentChange:m,onQuickPromptColorChange:v,onQuickPromptContextChange:g,onQuickPromptDelete:h,onQuickPromptSelect:p,quickPromptSettings:c,resetQuickPromptSettings:f,saveQuickPromptSettings:y,selectedQuickPrompt:l}})({allPrompts:v,currentAppId:l,http:d,promptsLoaded:f,toasts:g}),{onConversationSelectionChange:M,onNewConversationDefaultChange:z,onPromptContentChange:F,onSystemPromptDelete:O,onSystemPromptSelect:R,refetchSystemPromptConversations:L,resetSystemPromptSettings:D,saveSystemPromptSettings:N,selectedSystemPrompt:Z,systemPromptSettings:B}=(({allPrompts:e,connectors:t,conversationsSettingsBulkActions:s,currentAppId:n,defaultConnector:a,http:i,isAssistantEnabled:r,setConversationsSettingsBulkActions:l,toasts:d})=>{const[c,u]=(0,o.useState)(wl),[p,m]=(0,o.useState)(Al),[g,h]=(0,o.useState)(jl),[v,f]=(0,o.useState)(),y=(0,o.useMemo)((()=>e.data.filter((e=>e.promptType===gs.system))),[e.data]),x=(0,o.useMemo)((()=>{const e=y.map((e=>e.id));return Array.isArray(e)&&0!==e.length?e.map((e=>`api_config.default_system_prompt_id: "${e}"`)).join(" OR "):""}),[y]),{data:b,refetch:C}=Zn({http:i,isAssistantEnabled:r&&x.length>0,filter:x,fields:["id","title","apiConfig","updatedAt","createdBy","users"],isConversationOwner:!0});(0,o.useEffect)((()=>{const e=e=>{const t=y.map((e=>{const t=Object.values(b).filter((t=>{var s;return(null===(s=t.apiConfig)||void 0===s?void 0:s.defaultSystemPromptId)===e.id}));return{...e,conversations:t}}));return JSON.stringify(e)!==JSON.stringify(t)?t:e};u((t=>e(t))),m((t=>e(t)))}),[b,y]);const k=(0,o.useCallback)((e=>{if(null==e)return f(void 0);const t="string"==typeof e,s=t?{id:"",content:"",name:null!=e?e:"",promptType:"system",consumer:n,conversations:[]}:e;t&&h((e=>({...e,create:[s]}))),f(s)}),[n]),S=(0,o.useCallback)((e=>{var t,s;h({...g,delete:{ids:[...null!==(t=null===(s=g.delete)||void 0===s?void 0:s.ids)&&void 0!==t?t:[],e]}})}),[g,h]),E=(0,o.useCallback)((e=>{if(null!=v){var t,s;f({...v,content:e});const n={...g,...""!==v.id?{update:[...(null!==(t=g.update)&&void 0!==t?t:[]).filter((e=>e.id!==v.id)),{...v,content:e}]}:{create:[...(null!==(s=g.create)&&void 0!==s?s:[]).filter((e=>e.name!==v.name)),{...v,content:e}]}};h(n)}}),[g,v]),w=(0,o.useCallback)((e=>{const t=p.filter((e=>e.isNewConversationDefault)),s=""===(null==v?void 0:v.id),n=""!==(null==v?void 0:v.id);null!=v&&(f({...v,isNewConversationDefault:e}),h((()=>({update:[...t.filter((e=>{return e.id!==v.id&&(null==(t=e)?void 0:t.name)!==(null==t?void 0:t.id);var t})).map((e=>({...e,isNewConversationDefault:!1}))),...n?[{...v,isNewConversationDefault:e}]:[]],create:[...t.filter((e=>{return e.name!==v.name&&(null==(t=e)?void 0:t.name)===(null==t?void 0:t.id);var t})).map((e=>({...e,isNewConversationDefault:!1}))),...s?[{...v,isNewConversationDefault:e}]:[]]}))))}),[v,p]),[A,j]=(0,o.useState)([]),_=(0,o.useCallback)((e=>{var s;const n=e.map((e=>e.id)),i=null!==(s=null==v?void 0:v.conversations.filter((e=>!n.includes(e.id))))&&void 0!==s?s:[];let o=[];j((e=>(i.forEach((t=>{e.find((e=>e.id===t.id))||e.push(t)})),o=e.filter((e=>!n.includes(e.id))),o)));const r=e=>{var t;return n.includes(e.id)?null==v?void 0:v.id:e.apiConfig&&e.apiConfig.defaultSystemPromptId===(null==v?void 0:v.id)||null===(t=e.apiConfig)||void 0===t?void 0:t.defaultSystemPromptId};if(null!=v){f({...v,conversations:e});let s={create:{},update:{}};Object.values(e).forEach((e=>{var n;const i=""!==e.id?{update:{...null!==(n=s.update)&&void 0!==n?n:{},[e.id]:{...e.apiConfig?{apiConfig:{...e.apiConfig,defaultSystemPromptId:r(e)}}:{apiConfig:{...bt({allSystemPrompts:c,connectors:t,conversation:e,defaultConnector:a}).apiConfig,defaultSystemPromptId:r(e)}}}}}:{};s={...s,...i}})),o.forEach((e=>{var n;const i=""!==e.id?{update:{...null!==(n=s.update)&&void 0!==n?n:{},[e.id]:{...e.apiConfig?{apiConfig:{...e.apiConfig,defaultSystemPromptId:void 0}}:{apiConfig:{...bt({allSystemPrompts:c,connectors:t,conversation:e,defaultConnector:a}).apiConfig,defaultSystemPromptId:void 0}}}}}:{};s={...s,...i}})),l(s)}}),[c,v,l,a,t]),P=(0,o.useCallback)((()=>{l({}),h({}),f(void 0)}),[l]),T=(0,o.useCallback)((async()=>{var e;const t=g.create||g.update||g.delete?await El(i,g,d):void 0;let n;if((!t||null!=t&&t.success)&&null!=s&&s.update){var a,o,r;const e=s.update&&null!=t&&null!==(a=t.attributes)&&void 0!==a&&null!==(o=a.results)&&void 0!==o&&null!==(r=o.created)&&void 0!==r&&r.length?Object.entries(s.update).reduce(((e,[s,n])=>{var a;if(""===(null===(a=n.apiConfig)||void 0===a?void 0:a.defaultSystemPromptId)){var i,o;const a=null==t||null===(i=t.attributes)||void 0===i||null===(o=i.results)||void 0===o?void 0:o.created[0];if(a)return{...e,[s]:{...n,apiConfig:{...n.apiConfig,defaultSystemPromptId:a.id}}}}return e}),{}):{};n={...s,update:{...s.update,...e}}}return P(),{success:null===(e=null==t?void 0:t.success)||void 0===e||e,conversationUpdates:n}}),[s,i,g,P,d]);return{onConversationSelectionChange:_,onNewConversationDefaultChange:w,onPromptContentChange:E,onSystemPromptDelete:S,onSystemPromptSelect:k,refetchSystemPromptConversations:C,resetSystemPromptSettings:P,saveSystemPromptSettings:T,selectedSystemPrompt:v,systemPromptSettings:p}})({allPrompts:v,connectors:y,conversationsSettingsBulkActions:x,currentAppId:l,defaultConnector:e,http:d,isAssistantEnabled:c,setConversationsSettingsBulkActions:k,toasts:g}),U=(0,o.useCallback)((()=>{b(),D()}),[b,D]),$=(0,o.useCallback)((async()=>{let e=!1;if(p===Ms&&(e=await T()),p===zs){const{success:t,conversationUpdates:s}=await N();e=!!t&&await C({bulkActions:s}),await L()}await s(e)}),[s,L,C,T,N,p]);return r().createElement(_l,{"data-test-subj":"settingsModal",onClose:t},r().createElement(u.EuiPage,{paddingSize:"none"},r().createElement(u.EuiPageBody,{paddingSize:"none",panelled:!0},r().createElement(u.EuiSplitPanel.Outer,{grow:!0},r().createElement(Tl,{className:"eui-scrollBar",grow:!0},p===Ms&&r().createElement(el,{onPromptContentChange:S,onQuickPromptColorChange:E,onQuickPromptContextChange:w,onQuickPromptDelete:A,onQuickPromptSelect:j,resetSettings:P,selectedQuickPrompt:I,quickPromptSettings:_}),p===zs&&r().createElement(Sl,{conversations:n,onConversationSelectionChange:M,onNewConversationDefaultChange:z,onPromptContentChange:F,onSystemPromptDelete:O,onSystemPromptSelect:R,resetSettings:U,selectedSystemPrompt:Z,setPaginationObserver:i,systemPromptSettings:B})),r().createElement(Il,{grow:!1,color:"subdued"},r().createElement(Ml,null,r().createElement(u.EuiButtonEmpty,{size:"s","data-test-subj":"cancel-button",onClick:t},Ir),r().createElement(u.EuiButton,{size:"s",type:"submit","data-test-subj":"save-button",onClick:$,fill:!0},Mr)))))))}));Pl.displayName="AssistantSettings";var Tl=c()(u.EuiSplitPanel.Inner).withConfig({displayName:"_StyledEuiSplitPanelInner",componentId:"sc-1qgqser-1"})(["max-height:519px;overflow-y:scroll;"]),Il=c()(u.EuiSplitPanel.Inner).withConfig({displayName:"_StyledEuiSplitPanelInner2",componentId:"sc-1qgqser-2"})(["padding:8px;"]),Ml=c()(u.EuiModalFooter).withConfig({displayName:"_StyledEuiModalFooter",componentId:"sc-1qgqser-3"})(["padding:4px;"]);const zl=r().memo((({defaultConnector:e,isSettingsModalVisible:t,setIsSettingsModalVisible:s,onConversationSelected:n,conversations:a,conversationsLoaded:i,refetchCurrentConversation:r,refetchCurrentUserConversations:l,refetchPrompts:d,setPaginationObserver:c})=>{const{toasts:u}=Ze(),p=(0,o.useCallback)((()=>{s(!1)}),[s]),m=(0,o.useCallback)((()=>{p()}),[p]),h=(0,o.useCallback)((async e=>{p(),await r({isStreamRefetch:!1}),await l(),d&&await d(),e&&(null==u||u.addSuccess({iconType:"check",title:Tr}))}),[p,r,l,d,u]);return t&&(0,g.jsx)(Pl,{defaultConnector:e,onConversationSelected:n,onClose:m,onSave:h,conversations:a,conversationsLoaded:i,setPaginationObserver:c})}));zl.displayName="AssistantSettingsModal";let Fl=function(e){return e.administration="administration",e.alerts="alerts",e.aiValue="ai_value",e.assetInventory="asset_inventory",e.attackDiscovery="attack_discovery",e.blocklist="blocklist",e.case="cases",e.caseConfigure="cases_configure",e.caseCreate="cases_create",e.cloudSecurityPostureBenchmarks="cloud_security_posture-benchmarks",e.cloudSecurityPostureDashboard="cloud_security_posture-dashboard",e.cloudSecurityPostureVulnerabilityDashboard="cloud_security_posture-vulnerability_dashboard",e.cloudSecurityPostureFindings="cloud_security_posture-findings",e.cloudSecurityPostureRules="cloud_security_posture-rules",e.dashboards="dashboards",e.dataQuality="data_quality",e.detections="detections",e.detectionAndResponse="detection_response",e.endpoints="endpoints",e.endpointExceptions="endpoint_exceptions",e.eventFilters="event_filters",e.exceptions="exceptions",e.exploreLanding="explore",e.hostIsolationExceptions="host_isolation_exceptions",e.hosts="hosts",e.hostsAll="hosts-all",e.hostsAnomalies="hosts-anomalies",e.hostsRisk="hosts-risk",e.hostsEvents="hosts-events",e.hostsSessions="hosts-sessions",e.hostsUncommonProcesses="hosts-uncommon_processes",e.kubernetes="kubernetes",e.landing="get_started",e.network="network",e.networkAnomalies="network-anomalies",e.networkDns="network-dns",e.networkEvents="network-events",e.networkFlows="network-flows",e.networkHttp="network-http",e.networkTls="network-tls",e.noPage="",e.overview="overview",e.policies="policy",e.responseActionsHistory="response_actions_history",e.rules="rules",e.rulesAdd="rules-add",e.rulesCreate="rules-create",e.rulesLanding="rules-landing",e.rulesManagement="rules-management",e.siemReadiness="siem_readiness",e.siemMigrationsLanding="siem_migrations",e.siemMigrationsRules="siem_migrations-rules",e.siemMigrationsDashboards="siem_migrations-dashboards",e.threatIntelligence="threat_intelligence",e.timelines="timelines",e.timelinesTemplates="timelines-templates",e.trustedApps="trusted_apps",e.trustedDevices="trusted_devices",e.users="users",e.usersAll="users-all",e.usersAnomalies="users-anomalies",e.usersAuthentications="users-authentications",e.usersEvents="users-events",e.usersRisk="users-risk",e.entityAnalytics="entity_analytics",e.entityAnalyticsManagement="entity_analytics-management",e.entityAnalyticsLanding="entity_analytics-landing",e.entityAnalyticsPrivilegedUserMonitoring="entity_analytics-privileged_user_monitoring",e.entityAnalyticsOverview="entity_analytics-overview",e.entityAnalyticsEntityStoreManagement="entity_analytics-entity_store_management",e.coverageOverview="coverage-overview",e.notes="notes",e.alertSummary="alert_summary",e.configurations="configurations",e.configurationsIntegrations="configurations-integrations",e.configurationsAiSettings="configurations-ai_settings",e.configurationsBasicRules="configurations-basic_rules",e}({});const Ol={page:0,perPage:0,total:0,data:[],all:[]},Rl=({anonymizationPageFields:e=[],selectedFields:t=[],handlePageChecked:s,handlePageUnchecked:n,totalItemCount:a,handlePageReset:i})=>{const r=(0,o.useMemo)((()=>e.map((e=>e.field))),[e]),[l,d]=(0,o.useState)(t.length>0&&r.every((e=>t.includes(e))));return(0,o.useEffect)((()=>{d(t.length>0&&r.every((e=>t.includes(e))))}),[t,r]),0===a||0===r.length?null:(0,g.jsx)(u.EuiCheckbox,{"data-test-subj":"checkboxSelectAll",id:"checkboxSelectAll",checked:l,onChange:e=>{e.target.checked?(d(!0),s()):(d(!1),n(),i(r))}})},Ll=({row:e,selectedFields:t=[],handleRowChecked:s,handleRowUnChecked:n,handleRowReset:a})=>{const[i,r]=(0,o.useState)(t.includes(e.field));return(0,o.useEffect)((()=>{r(t.includes(e.field))}),[t,e.field]),(0,g.jsx)(u.EuiCheckbox,{"data-test-subj":`field-${e.field}`,id:`field-${e.field}`,checked:i,onChange:t=>{t.target.checked?(r(!0),s(e.field)):(r(!1),n(e.field),a(e.field))}})},Dl=({anonymizationPageFields:e,handlePageChecked:t,handlePageReset:s,handlePageUnchecked:n,handleRowChecked:a,handleRowReset:i,handleRowUnChecked:o,hasUpdateAIAssistantAnonymization:r,selectedFields:l,totalItemCount:d})=>{const c={field:"",name:(0,g.jsx)(Rl,{handlePageChecked:t,handlePageUnchecked:n,anonymizationPageFields:e,selectedFields:l,totalItemCount:d,handlePageReset:s}),render:e=>(0,g.jsx)(Ll,{row:e,selectedFields:l,handleRowChecked:a,handleRowUnChecked:o,handleRowReset:i}),width:"70px",sortable:!1};return r?[c]:[]},Nl=({anonymizationAllFieldsData:e,onListUpdated:t,onSelectAll:s,handleUnselectAll:n,selectedFields:a,totalFields:i,handleRowChecked:r})=>{const l=(0,o.useCallback)((()=>{s(i)}),[s,i]);return(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center","data-test-subj":"toolbar",gutterSize:"none"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiText,{color:"subdued","data-test-subj":"selectedFields",size:"xs"},wi(a.length))),(0,g.jsx)(u.EuiFlexItem,{grow:!1},a.length===i?(0,g.jsx)(u.EuiButtonEmpty,{"data-test-subj":"unselectAllFields",iconType:"pagesSelect",onClick:n,size:"xs"},(e=>S.i18n.translate("xpack.elasticAssistant.dataAnonymizationEditor.contextEditor.unselectAllFields",{defaultMessage:"Unselect all {totalFields} fields",values:{totalFields:e}}))(a.length)):(0,g.jsx)(u.EuiButtonEmpty,{"data-test-subj":"selectAllFields",iconType:"pagesSelect",onClick:l,size:"xs"},(e=>S.i18n.translate("xpack.elasticAssistant.dataAnonymizationEditor.contextEditor.selectAllFields",{values:{totalFields:e},defaultMessage:"Select all {totalFields} fields"}))(i))),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(Ii,{appliesTo:"multipleRows",disabled:0===a.length,onListUpdated:t,selectedFields:a,handleRowChecked:r})))};Nl.displayName="ToolbarComponent";const Zl=r().memo(Nl),Bl=Je("div",{target:"e9jzbiz0"})({name:"r5zj6l",styles:">div>.euiSpacer{block-size:16px;}"});var Ul={name:"1bdfdp2",styles:"min-height:455px"};const $l=({anonymizationAllFields:e,anonymizationPageFields:t,compressed:s=!0,onListUpdated:n,rawData:a,onTableChange:i,pagination:r,sorting:l,search:d,handleSearch:c,handleRowReset:p,handlePageReset:m,handleTableReset:h,selectionState:v,selectionActions:f})=>{const{assistantAvailability:{hasUpdateAIAssistantAnonymization:y}}=Ze(),x=(0,o.useMemo)((()=>({pageSize:r.pageSize,pageIndex:r.pageIndex,showPerPageOptions:!0,totalItemCount:t.total})),[t.total,r.pageIndex,r.pageSize]),b=(0,o.useMemo)((()=>Ri({anonymizationFields:t,rawData:a})),[t,a]),C=(0,o.useCallback)((({page:e,sort:t})=>{null==i||i({page:e,sort:t})}),[i]),{selectedFields:k}=v,{handleSelectAll:S,handlePageUnchecked:E,handlePageChecked:w,handleRowUnChecked:A,handleRowChecked:j}=f,_=(0,o.useMemo)((()=>[...Dl({anonymizationPageFields:t.data||[],handlePageChecked:w,handlePageReset:m,handlePageUnchecked:E,handleRowChecked:j,handleRowReset:p,handleRowUnChecked:A,hasUpdateAIAssistantAnonymization:y,selectedFields:k,totalItemCount:t.total}),...zi({compressed:s,handleRowChecked:j,hasUpdateAIAssistantAnonymization:y,onListUpdated:n,rawData:a,selectedFields:k})]),[t.data,t.total,w,m,E,j,p,A,y,k,s,n,a]),P=(0,o.useMemo)((()=>(0,g.jsx)(Zl,{anonymizationAllFieldsData:e.data,handleRowChecked:j,handleUnselectAll:h,onListUpdated:n,onSelectAll:S,selectedFields:k,totalFields:e.total})),[e.data,e.total,j,S,h,n,k]);return(0,g.jsx)(Bl,null,(0,g.jsx)(u.EuiSearchBar,{box:d.box,filters:d.filters,onChange:c}),y?P:void 0,(0,g.jsx)(u.EuiBasicTable,{columns:_,compressed:s,"data-test-subj":"contextEditor",itemId:hi,items:b,pagination:x,onChange:C,sorting:l,css:Ul}))};$l.displayName="ContextEditorComponent";const Vl=r().memo($l),Gl=r().memo((({hasPendingChanges:e,onCancelClick:t,onSaveButtonClicked:s})=>e?(0,g.jsx)(u.EuiPageTemplate.BottomBar,{paddingSize:"s",position:"fixed","data-test-subj":"bottom-bar"},(0,g.jsx)(u.EuiFlexGroup,{justifyContent:"flexEnd",gutterSize:"s"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiButtonEmpty,{size:"s",color:"text",iconType:"cross","data-test-subj":"cancel-button",onClick:t},Ir)),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiButton,{size:"s",type:"submit","data-test-subj":"save-button",onClick:s,iconType:"check",fill:!0},Mr)))):null));Gl.displayName="AssistantSettingsBottomBar";const Kl={box:{incremental:!0},filters:[{field:mi,type:"is",name:yi},{field:gi,type:"is",name:bi}]},ql=[],Hl=({modalMode:e=!1,onClose:t})=>{const{euiTheme:s}=(0,u.useEuiTheme)(),{http:n,toasts:a,nameSpace:i}=Ze(),{anonymizationFields:l,anonymizationAllFields:d,anonymizationFieldsStatus:c,onTableChange:p,pagination:m,sorting:h,handleSearch:v,refetch:f}=(e=>{var t,s,n,a;const i=(0,o.useMemo)((()=>Fi({pageSize:10,sortDirection:"asc",sortField:"field"})),[]),{onTableChange:r,pagination:l,sorting:d}=Oi({defaultTableOptions:i,nameSpace:e,storageKey:"anonymizationTable",inMemory:!1}),[c,u]=(0,o.useState)(""),p=(0,o.useCallback)((e=>{u(e.queryText||"")}),[u]),{data:m,refetch:g}=Dn({page:l.pageIndex,perPage:l.pageSize,sortField:null===(t=d.sort)||void 0===t?void 0:t.field,sortOrder:null===(s=d.sort)||void 0===s?void 0:s.direction,filter:c,all:!0}),h=(0,o.useMemo)((()=>{var e,t,s;return{page:null!==(e=null==m?void 0:m.page)&&void 0!==e?e:0,perPage:null!==(t=null==m?void 0:m.perPage)&&void 0!==t?t:0,total:null!==(s=null==m?void 0:m.total)&&void 0!==s?s:0}}),[m]);return{anonymizationFieldsStatus:null==m||null===(n=m.aggregations)||void 0===n||null===(a=n.field_status)||void 0===a?void 0:a.buckets,anonymizationAllFields:(0,o.useMemo)((()=>({...h,data:m.all||[]})),[m.all,h]),anonymizationFields:(0,o.useMemo)((()=>({...h,data:m.data||[]})),[m.data,h]),onTableChange:r,pagination:l,sorting:d,searchQuery:c,handleSearch:p,refetch:g}})(i),{handlePageReset:y,handleRowReset:x,hasPendingChanges:b,onListUpdated:C,resetAnonymizationSettings:k,saveAnonymizationSettings:S,updatedAnonymizationData:E}=(({anonymizationAllFields:e,anonymizationFields:t=Ol,http:s,toasts:n})=>{var a,i,r;const[l,d]=(0,o.useState)(!1),[c,u]=(0,o.useState)({}),[p,m]=(0,o.useState)(t);(0,o.useEffect)((()=>{m((()=>{var e,s,n,a;return null!==(e=c.create)&&void 0!==e&&e.length||null!==(s=c.update)&&void 0!==s&&s.length||null!==(n=c.delete)&&void 0!==n&&null!==(a=n.ids)&&void 0!==a&&a.length?{...t,data:t.data.map((e=>{var t,s,n;const a=null===(t=c.update)||void 0===t?void 0:t.find((t=>t.id===e.id));return{...e,allowed:null!==(s=null==a?void 0:a.allowed)&&void 0!==s?s:e.allowed,anonymized:null!==(n=null==a?void 0:a.anonymized)&&void 0!==n?n:e.anonymized}}))}:t}))}),[t,null===(a=c.create)||void 0===a?void 0:a.length,null===(i=c.delete)||void 0===i||null===(r=i.ids)||void 0===r?void 0:r.length,c.update]);const g=(0,o.useCallback)((()=>{u((e=>({...e,update:[]}))),d(!1),m(t)}),[t]),h=(0,o.useCallback)((async()=>{var e;const a=c.create||c.update||c.delete?await pi(s,c,n):void 0;return d(!1),null!=a&&a.success||m(t),null!==(e=null==a?void 0:a.success)&&void 0!==e&&e}),[t,c,s,n]),v=(0,o.useCallback)((t=>{const s=t.map((e=>e.field)),n=t.map((t=>{var s,n;return{...null!==(s=(null!==(n=null==e?void 0:e.data)&&void 0!==n?n:[]).find((e=>e.field===t.field)))&&void 0!==s?s:{id:"",field:""},..."allow"===t.update||"defaultAllow"===t.update?{allowed:"add"===t.operation}:{},..."allowReplacement"===t.update||"defaultAllowReplacement"===t.update?{anonymized:"add"===t.operation}:{}}}));d(!0),u((()=>{var e;return{...c,update:[...n].reduce(((e,t)=>{const s=e.findIndex((e=>e.id===t.id));return-1!==s?e[s]=t:e.push(t),e}),[...null!==(e=null==c?void 0:c.update)&&void 0!==e?e:[]])}})),m((()=>({...p,data:[...p.data].reduce(((e,t)=>{const a=s.indexOf(t.field);return-1!==a?e.push(n[a]):e.push(t),e}),[])})))}),[null==e?void 0:e.data,c,p]),f=(0,o.useCallback)((e=>{var s;const n=t.data.find((t=>t.field===e)),a=(null!==(s=c.update)&&void 0!==s?s:[]).length;u((e=>{var t,s;const a=null!==(t=null===(s=e.update)||void 0===s?void 0:s.filter((e=>e.id!==(null==n?void 0:n.id))))&&void 0!==t?t:[];return{...e,update:a}})),m((e=>({...e,data:e.data.map((e=>e.id===(null==n?void 0:n.id)?n:e),[])}))),d(a-1>0)}),[t.data,c.update]),y=(0,o.useCallback)((e=>{var s;const n=t.data.reduce(((t,s)=>(e.includes(s.field)&&t.push(s.id),t)),[]),a=(null!==(s=c.update)&&void 0!==s?s:[]).length;u((e=>{var t,s;const a=null!==(t=null===(s=e.update)||void 0===s?void 0:s.filter((e=>!n.includes(e.id))))&&void 0!==t?t:[];return{...e,update:a}})),m((e=>({...e,data:t.data}))),d(a-e.length>0)}),[t.data,c.update]);return{hasPendingChanges:l,onListUpdated:v,resetAnonymizationSettings:g,saveAnonymizationSettings:h,updatedAnonymizationData:p,handleRowReset:f,handlePageReset:y}})({anonymizationAllFields:d,anonymizationFields:l,http:n,toasts:a}),{selectionActions:w,selectionState:A}=(({anonymizationAllFields:e,anonymizationPageFields:t})=>{const[s,n]=(0,o.useState)(!1),[a,i]=(0,o.useState)(ql),[r,l]=(0,o.useState)(0),d=e.total,c=(0,o.useMemo)((()=>{var e;return(null===(e=t.data)||void 0===e?void 0:e.map((e=>e.field)))||[]}),[t.data]),u=(0,o.useMemo)((()=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.map((e=>e.field)))||[]}),[e.data]),p=(0,o.useCallback)((()=>{n(!1),i([]),l(0)}),[]),m=(0,o.useCallback)((()=>{n(!0),l(d),i([...u])}),[u,d]),g=(0,o.useCallback)((()=>{const e=c.reduce(((e,t)=>(a.includes(t)||e.push(t),e)),[...a]);i(e),l((e=>e+a.filter((e=>!a.includes(e))).length)),e.length===d&&n(!0)}),[c,a,d]),h=(0,o.useCallback)((()=>{i(a.filter((e=>!c.includes(e)))),l((e=>(e||d)-c.length)),n(!1)}),[c,a,d]),v=(0,o.useCallback)((e=>{const t=a.includes(e)?a:[...a,e];i(t),t.length===d&&n(!0),l(t.length)}),[a,d]),f=(0,o.useCallback)((e=>{i((t=>t.filter((t=>t!==e)))),n(!1),l((e=>(e||d)-1))}),[d]);return{selectionState:{isSelectAll:s,selectedFields:a,totalSelectedItems:r},selectionActions:{handleUnselectAll:p,handleSelectAll:m,handlePageUnchecked:h,handlePageChecked:g,handleRowUnChecked:f,handleRowChecked:v,setSelectedFields:i,setIsSelectAll:n,setTotalSelectedItems:l}}})({anonymizationAllFields:d,anonymizationPageFields:l}),j=(0,o.useCallback)((()=>{k(),null==w||w.handleUnselectAll()}),[k,w]),_=(0,o.useCallback)((()=>{null==t||t(),j()}),[t,j]),P=(0,o.useCallback)((async()=>{await S()&&(null==a||a.addSuccess({iconType:"check",title:Tr})),await f(),null==w||w.handleUnselectAll()}),[f,S,w,a]),T=(0,o.useCallback)((()=>{P(),null==t||t()}),[P,t]),I=(0,u.useGeneratedHtmlId)();return e?(0,g.jsx)(u.EuiModal,{onClose:_,"aria-labelledby":I},(0,g.jsx)(u.EuiModalHeader,null,(0,g.jsx)(u.EuiModalHeaderTitle,{id:I},ci)),(0,g.jsx)(u.EuiModalBody,null,(0,g.jsx)(u.EuiText,{size:"m"},ui),(0,g.jsx)(u.EuiSpacer,{size:"m"}),(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center","data-test-subj":"summary",gutterSize:"none"},(0,g.jsx)(di,{anonymizationFieldsStatus:c,isDataAnonymizable:!0,anonymizationFields:l.data,titleSize:"m",gap:s.size.s})),(0,g.jsx)(u.EuiSpacer,{size:"m"}),(0,g.jsx)(Vl,{anonymizationAllFields:d,anonymizationPageFields:E,compressed:!1,onListUpdated:C,rawData:null,onTableChange:p,pagination:m,sorting:h,search:Kl,handleSearch:v,handleTableReset:j,handleRowReset:x,handlePageReset:y,selectionState:A,selectionActions:w})),(0,g.jsx)(u.EuiModalFooter,null,(0,g.jsx)(u.EuiButtonEmpty,{onClick:_},Ir),(0,g.jsx)(u.EuiButton,{type:"submit",onClick:T,fill:!0,disabled:!b},Mr))):(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiPanel,{hasShadow:!1,hasBorder:!0,paddingSize:"l"},(0,g.jsx)(u.EuiText,{size:"m"},ui),(0,g.jsx)(u.EuiSpacer,{size:"m"}),(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center","data-test-subj":"summary",gutterSize:"none"},(0,g.jsx)(di,{anonymizationFieldsStatus:c,isDataAnonymizable:!0,anonymizationFields:d.data,titleSize:"m",gap:s.size.s})),(0,g.jsx)(u.EuiSpacer,{size:"m"}),(0,g.jsx)(Vl,{anonymizationAllFields:d,anonymizationPageFields:E,compressed:!1,onListUpdated:C,rawData:null,onTableChange:p,pagination:m,sorting:h,search:Kl,handleSearch:v,handleRowReset:x,handlePageReset:y,handleTableReset:j,selectionState:A,selectionActions:w})),(0,g.jsx)(Gl,{hasPendingChanges:b,onCancelClick:_,onSaveButtonClicked:T}))};Hl.displayName="AnonymizationSettingsManagementComponent";const Ql=r().memo(Hl),Wl=S.i18n.translate("xpack.elasticAssistant.assistant.settings.knowledgeBaseSettings.alertsLabel",{defaultMessage:"Alerts"}),Yl=S.i18n.translate("xpack.elasticAssistant.assistant.settings.knowledgeBaseSettings.yourAnonymizationSettingsLabel",{defaultMessage:"Your anonymization settings will apply to these alerts."}),Jl=S.i18n.translate("xpack.elasticAssistant.assistant.settings.knowledgeBaseSettings.selectFewerAlertsLabel",{defaultMessage:"Send fewer alerts if the model's context window is too small."}),Xl=S.i18n.translate("xpack.elasticAssistant.assistant.settings.knowledgeBaseSettings.alertsRangeSliderLabel",{defaultMessage:"Alerts range"}),ed=(S.i18n.translate("xpack.elasticAssistant.assistant.settings.knowledgeBaseSettings.settingsTitle",{defaultMessage:"Knowledge Base"}),S.i18n.translate("xpack.elasticAssistant.assistant.settings.knowledgeBaseSettings.settingsBadgeTitle",{defaultMessage:"Experimental"}),S.i18n.translate("xpack.elasticAssistant.assistant.settings.knowledgeBaseSettings.settingsDescription",{defaultMessage:"documentation"}),S.i18n.translate("xpack.elasticAssistant.assistant.settings.knowledgeBaseSettings.knowledgeBaseLabel",{defaultMessage:"Knowledge Base"}),S.i18n.translate("xpack.elasticAssistant.assistant.settings.knowledgeBaseSettings.setupKnowledgeBaseButton",{defaultMessage:"Setup"}),S.i18n.translate("xpack.elasticAssistant.assistant.settings.knowledgeBaseSettings.setupKnowledgeBaseButtonToolTip",{defaultMessage:"Knowledge Base unavailable, please see documentation for more details."}),S.i18n.translate("xpack.elasticAssistant.assistant.settings.knowledgeBaseSettings.knowledgeBaseDescription",{defaultMessage:"Index where Knowledge Base docs are stored"}),S.i18n.translate("xpack.elasticAssistant.assistant.settings.knowledgeBaseSettings.elserLabel",{defaultMessage:"ELSER Configured"}),r().memo((({compressed:e=!0,knowledgeBase:t,maxAlerts:s=sd,minAlerts:n=td,onChange:a,setUpdatedKnowledgeBaseSettings:i,step:r=nd,value:l})=>{const d=(0,u.useGeneratedHtmlId)({prefix:"inputRangeSlider"}),c=(0,o.useCallback)((e=>{null!=t&&null!=i&&i({...t,latestAlerts:Number(e.currentTarget.value)}),null!=a&&a(e)}),[t,a,i]);return(0,g.jsx)(u.EuiRange,{"aria-label":Xl,fullWidth:!0,compressed:e,css:(0,g.css)("max-inline-size:",649,"px;& .euiRangeTrack{margin-inline-start:0;margin-inline-end:0;}",""),"data-test-subj":"alertsRange",id:d,max:s,min:n,onChange:c,showTicks:!0,step:r,value:l})})));ed.displayName="AlertsRange";const td=50,sd=500,nd=50,ad=({knowledgeBase:e,setUpdatedKnowledgeBaseSettings:t})=>{return(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiFormRow,{display:"columnCompressed",label:Wl,css:(0,g.css)(".euiFormRow__labelWrapper{min-width:",95,"px!important;}","")},(0,g.jsx)(r().Fragment,null)),(0,g.jsx)(u.EuiSpacer,{size:"xs"}),(0,g.jsx)(u.EuiFlexGroup,{direction:"column",gutterSize:"none"},(0,g.jsx)(u.EuiFlexItem,{css:(0,g.css)("width:",600,"px;",""),grow:!1},(0,g.jsx)(u.EuiSpacer,{size:"xs"}),(0,g.jsx)(ed,{knowledgeBase:e,setUpdatedKnowledgeBaseSettings:t,value:e.latestAlerts}),(0,g.jsx)(u.EuiSpacer,{size:"s"})),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiText,{color:"subdued",size:"xs"},(0,g.jsx)("span",null,(s=e.latestAlerts,S.i18n.translate("xpack.elasticAssistant.assistant.settings.knowledgeBaseSettings.latestAndRiskiestOpenAlertsLabel",{defaultMessage:"Send AI Assistant information about your {alertsCount} newest and riskiest open or acknowledged alerts.",values:{alertsCount:s}}))))),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiText,{color:"subdued",size:"xs"},(0,g.jsx)("span",null,Yl))),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiText,{color:"subdued",size:"xs"},(0,g.jsx)("span",null,Jl)))));var s},id=r().memo(ad),od=({onClose:e})=>{const{assistantTelemetry:t,knowledgeBase:s,setKnowledgeBase:n}=Ze(),{knowledgeBaseSettings:a,saveKnowledgeBaseSettings:i,setUpdatedKnowledgeBaseSettings:r}=(({assistantTelemetry:e,knowledgeBase:t,setKnowledgeBase:s})=>{const[n,a]=(0,o.useState)(t),i=(0,o.useCallback)((()=>{a(t)}),[t]),r=(0,o.useCallback)((()=>{const a=t.latestAlerts!==n.latestAlerts;return a&&(null==e||e.reportAssistantSettingToggled({alertsCountUpdated:a})),s(n),!0}),[e,t.latestAlerts,n,s]);return{knowledgeBaseSettings:n,resetKnowledgeBaseSettings:i,saveKnowledgeBaseSettings:r,setUpdatedKnowledgeBaseSettings:a}})({assistantTelemetry:t,knowledgeBase:s,setKnowledgeBase:n}),l=(0,u.useGeneratedHtmlId)(),d=(0,o.useCallback)((()=>{i(),e()}),[e,i]);return(0,g.jsx)(u.EuiModal,{onClose:e,"aria-labelledby":l},(0,g.jsx)(u.EuiModalHeader,null,(0,g.jsx)(u.EuiModalHeaderTitle,{id:l},Wl)),(0,g.jsx)(u.EuiModalBody,null,(0,g.jsx)(id,{knowledgeBase:a,setUpdatedKnowledgeBaseSettings:r})),(0,g.jsx)(u.EuiModalFooter,null,(0,g.jsx)(u.EuiButtonEmpty,{onClick:e},Ir),(0,g.jsx)(u.EuiButton,{type:"submit",onClick:d,fill:!0},Mr)))};var rd={name:"16s5rj8",styles:"width:280px"};const ld=r().memo((({isDisabled:e=!1})=>{const{assistantAvailability:t,navigateToApp:s,knowledgeBase:n,showAssistantOverlay:a}=Ze(),[i,l]=(0,o.useState)(!1),[d,c]=(0,o.useState)(!1),p=(0,o.useCallback)((()=>c(!1)),[]),m=(0,o.useCallback)((()=>c(!0)),[]),[h,v]=(0,o.useState)(!1),f=(0,o.useCallback)((()=>v(!1)),[]),y=(0,o.useCallback)((()=>v(!0)),[]),x=(0,o.useCallback)((()=>{l(!i)}),[i]),b=(0,o.useCallback)((()=>{l(!1)}),[]),C=(0,o.useCallback)((()=>{t.hasSearchAILakeConfigurations?(s("securitySolutionUI",{deepLinkId:Fl.configurationsAiSettings}),null==a||a({showOverlay:!1})):s("management",{path:"ai/securityAiAssistantManagement"})}),[t.hasSearchAILakeConfigurations,s,a]),k=(0,o.useCallback)((()=>{y(),b()}),[b,y]),S=(0,o.useCallback)((()=>{t.hasSearchAILakeConfigurations?(s("securitySolutionUI",{deepLinkId:Fl.configurationsAiSettings,path:`?tab=${Fs}`}),null==a||a({showOverlay:!1})):s("management",{path:`ai/securityAiAssistantManagement?tab=${Fs}`})}),[t.hasSearchAILakeConfigurations,s,a]),E=(0,o.useCallback)((()=>{m(),b()}),[b,m]),w=(0,o.useMemo)((()=>[(0,g.jsx)(u.EuiContextMenuItem,{"aria-label":"ai-assistant-settings",key:"ai-assistant-settings",onClick:C,icon:"gear","data-test-subj":"ai-assistant-settings"},co),(0,g.jsx)(u.EuiContextMenuItem,{"aria-label":"knowledge-base",key:"knowledge-base",icon:"documents","data-test-subj":"knowledge-base",onClick:S},po),(0,g.jsx)(u.EuiContextMenuItem,{"aria-label":"anonymization",key:"anonymization",onClick:k,icon:"eye","data-test-subj":"anonymization"},uo),(0,g.jsx)(u.EuiContextMenuItem,{"aria-label":"alerts-to-analyze",key:"alerts-to-analyze",onClick:E,icon:"magnifyWithExclamation","data-test-subj":"alerts-to-analyze"},(0,g.jsx)(u.EuiFlexGroup,{justifyContent:"spaceBetween"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},mo),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiNotificationBadge,{color:"subdued"},n.latestAlerts))))]),[k,S,C,E,n.latestAlerts]);return(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiToolTip,{content:ro},(0,g.jsx)(u.EuiPopover,{button:(0,g.jsx)(u.EuiButtonIcon,{"aria-label":ro,isDisabled:e,iconType:"controls",onClick:x,"data-test-subj":"chat-context-menu"}),isOpen:i,closePopover:b,panelPaddingSize:"none",anchorPosition:"leftUp"},(0,g.jsx)(u.EuiContextMenuPanel,{items:w,css:rd}))),d&&(0,g.jsx)(od,{onClose:p}),h&&(0,g.jsx)(Ql,{modalMode:!0,onClose:f}))}));ld.displayName="AssistantSettingsContextMenu";const dd=S.i18n.translate("xpack.elasticAssistant.assistant.assistantHeader.closeButtonLabel",{defaultMessage:"Close"}),cd=S.i18n.translate("xpack.elasticAssistant.elasticLLM.tour.title",{defaultMessage:"Elastic Managed LLM connector now available"}),ud=S.i18n.translate("xpack.elasticAssistant.elasticLLM.tour.subtitle",{defaultMessage:"New AI feature!"}),pd=S.i18n.translate("xpack.elasticAssistant.elasticLLM.tour.learnMore",{defaultMessage:"Learn more"}),md=S.i18n.translate("xpack.elasticAssistant.elasticLLM.tour.finishTour",{defaultMessage:"Ok"}),gd=(S.i18n.translate("xpack.elasticAssistant.elasticLLM.tour.asDefaultConnector",{defaultMessage:"Make Elastic Managed LLM the default connector"}),S.i18n.translate("xpack.elasticAssistant.elasticLLM.tour.aiFeature",{defaultMessage:"Elastic AI features"}),S.i18n.translate("xpack.elasticAssistant.elasticLLM.tour.usageCost",{defaultMessage:"additional costs incur"})),hd=(S.i18n.translate("xpack.elasticAssistant.elasticLLM.tour.thirdParty",{defaultMessage:"connect to a third party LLM provider"}),S.i18n.translate("xpack.elasticAssistant.elasticLLM.tour.performance",{defaultMessage:"performance"}),{currentTourStep:1,isTourActive:!0}),vd={title:cd,subTitle:ud,content:(0,g.jsx)((()=>{const{docLinks:{links:{observability:{elasticManagedLlm:e,elasticManagedLlmUsageCost:t}}}}=Ze();return(0,g.jsx)(l.FormattedMessage,{id:"xpack.elasticAssistant.elasticLLM.tour.content",defaultMessage:"This new default LLM connector is optimized for Elastic AI features ({usageCost}). You can continue using existing LLM connectors if you prefer. {learnMore}",values:{usageCost:(0,g.jsx)(u.EuiLink,{href:t,target:"_blank",rel:"noopener noreferrer",external:!0},gd),learnMore:(0,g.jsx)(u.EuiLink,{href:e,target:"_blank",rel:"noopener noreferrer",external:!0},pd)}})}),null)};let fd=function(e){return e.KNOWLEDGE_BASE="KNOWLEDGE_BASE",e.ANONYMIZED_VALUES_AND_CITATIONS="ANONYMIZED_VALUES_AND_CITATIONS",e.ELASTIC_LLM_USAGE_ATTACK_DISCOVERY="ELASTIC_LLM_USAGE_ATTACK_DISCOVERY",e.ELASTIC_LLM_USAGE_ATTACK_DISCOVERY_FLYOUT="ELASTIC_LLM_USAGE_ATTACK_DISCOVERY_FLYOUT",e.ELASTIC_LLM_USAGE_ASSISTANT_HEADER="ELASTIC_LLM_USAGE_ASSISTANT_HEADER",e.ELASTIC_LLM_USAGE_AUTOMATIC_TROUBLESHOOTING="ELASTIC_LLM_USAGE_AUTOMATIC_TROUBLESHOOTING",e.CONVERSATION_CONNECTOR_ELASTIC_LLM="CONVERSATION_CONNECTOR_ELASTIC_LLM",e}({});const yd={KNOWLEDGE_BASE:"elasticAssistant.knowledgeBase.newFeaturesTour.v8.16",ANONYMIZED_VALUES_AND_CITATIONS:"elasticAssistant.anonymizedValuesAndCitationsTourCompleted.v8.18",ELASTIC_LLM_USAGE_ATTACK_DISCOVERY:"elasticAssistant.elasticLLM.costAwarenessTour.attackDiscovery.v8.19",ELASTIC_LLM_USAGE_ATTACK_DISCOVERY_FLYOUT:"elasticAssistant.elasticLLM.costAwarenessTour.attackDiscoveryFlyout.v8.19",ELASTIC_LLM_USAGE_ASSISTANT_HEADER:"elasticAssistant.elasticLLM.costAwarenessTour.assistantHeader.v8.19",CONVERSATION_CONNECTOR_ELASTIC_LLM:"elasticAssistant.elasticLLM.conversation.costAwarenessTour.v8.19",ELASTIC_LLM_USAGE_AUTOMATIC_TROUBLESHOOTING:"elasticAssistant.elasticLLM.costAwarenessTour.automaticTroubleshooting.v9.0"},xd=e=>{const t=Xn();return`${yd[e]}.${t}`};var bd={name:"zjik7",styles:"display:flex"};const Cd=({children:e,isDisabled:t,selectedConnectorId:s,storageKey:n,zIndex:a,wrapper:i=!0})=>{const{http:r,inferenceEnabled:l,settings:d}=Ze(),{euiTheme:c}=(0,u.useEuiTheme)(),p=xd(n),[m,h]=f()(p,hd),[v,y]=(0,o.useState)(!(null!=m&&m.isTourActive||t)),[x,b]=(0,o.useState)(!1);(0,o.useEffect)((()=>{const e=setTimeout((()=>{b(!0)}),1e3);return()=>clearTimeout(e)}),[]);const C=(0,o.useCallback)((()=>{h(((e=hd)=>({...e,isTourActive:!1}))),y(!1)}),[h,y]),{data:k}=Cn({http:r,inferenceEnabled:l,settings:d}),S=(0,o.useMemo)((()=>null==k?void 0:k.some((e=>yt(e)&&e.id===s))),[k,s]);return(0,o.useEffect)((()=>{l&&!t&&null!=m&&m.isTourActive&&0!==(null==k?void 0:k.length)&&S?y(!0):y(!1)}),[m,t,e,v,l,null==k?void 0:k.length,S,h]),e?v?(0,g.jsx)(u.EuiTourStep,{id:"elasticLLMTourStep",css:bd,content:(0,g.jsx)(u.EuiText,{size:"m"},vd.content),isStepOpen:x,maxWidth:384,onFinish:C,panelProps:{"data-test-subj":"elasticLLMTourStepPanel"},step:1,stepsTotal:1,title:(0,g.jsx)(u.EuiTitle,{size:"xs"},(0,g.jsx)("span",null,vd.title)),subtitle:(0,g.jsx)(u.EuiTitle,{size:"xxs",css:(0,g.css)("color:",c.colors.textSubdued,";","")},(0,g.jsx)("span",null,vd.subTitle)),footerAction:[(0,g.jsx)(u.EuiButtonEmpty,{size:"s",color:"text",flush:"right",onClick:C},md)],panelStyle:{fontSize:c.size.m},zIndex:a},i?(0,g.jsx)("div",{css:(0,g.css)("padding-left:",c.size.m,";","")},e):e):e:null},kd=r().memo(Cd),Sd="aiAssistantSettingsMenuContainer";var Ed={name:"d3v9zr",styles:"overflow:hidden"},wd={name:"15uob5y",styles:"overflow:hidden;min-width:160px"};const Ad=({conversationSharedState:e,chatHistoryVisible:t,conversations:s,conversationsLoaded:n,currentUser:a,defaultConnector:i,isConversationOwner:l,isAssistantEnabled:d,isDisabled:c,isLoading:p,isSettingsModalVisible:m,onChatCleared:h,onCloseFlyout:v,onConversationCreate:f,onConversationDeleted:y,onConversationSelected:x,refetchCurrentConversation:b,refetchCurrentUserConversations:C,refetchPrompts:k,selectedConversation:S,setChatHistoryVisible:E,setCurrentConversation:w,setIsSettingsModalVisible:A,setPaginationObserver:j})=>{var _;const{euiTheme:P}=(0,u.useEuiTheme)(),T=(0,o.useMemo)((()=>{var e;return null==S||null===(e=S.apiConfig)||void 0===e?void 0:e.connectorId}),[null==S||null===(_=S.apiConfig)||void 0===_?void 0:_.connectorId]),I=(0,o.useCallback)(((e,t)=>{x({cId:e.id,cTitle:e.title,...t?{apiConfig:t}:{}})}),[x]),M=(0,o.useMemo)((()=>!S||""===S.id),[S]),z=(0,o.useMemo)((()=>Object.values(s).reduce(((e,t)=>t.isConversationOwner?{...e,[t.id]:t}:e),{})),[s]);return(0,g.jsx)(r().Fragment,null,(0,g.jsx)(_r,{isLoading:p,isExpanded:!!t,setIsExpanded:E,onConversationCreate:f,isAssistantEnabled:d},(0,g.jsx)(u.EuiFlexGroup,{gutterSize:"s"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(zl,{defaultConnector:i,isDisabled:c,isSettingsModalVisible:m,setIsSettingsModalVisible:A,onConversationSelected:x,conversations:z,conversationsLoaded:n,refetchCurrentConversation:b,refetchCurrentUserConversations:C,refetchPrompts:k,setPaginationObserver:j})),v&&(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiButtonIcon,{"aria-label":dd,"data-test-subj":"euiFlyoutCloseButton",iconType:"cross",color:"text",size:"xs",onClick:v})))),(0,g.jsx)(u.EuiPanel,{hasShadow:!1,paddingSize:"m",css:(0,g.css)("padding-top:",P.size.s,";padding-bottom:",P.size.s,";","")},(0,g.jsx)(u.EuiFlexGroup,{gutterSize:"xs",wrap:!0,justifyContent:"flexEnd"},(0,g.jsx)(u.EuiFlexItem,{css:wd},(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center",justifyContent:"flexStart",gutterSize:"s"},(0,g.jsx)(u.EuiFlexItem,{grow:!1,css:Ed},p?(0,g.jsx)(u.EuiSkeletonTitle,{"data-test-subj":"skeletonTitle",size:"xs"}):(0,g.jsx)(mr,{isDisabled:c||""===(null==S?void 0:S.id)||!l,title:(null==S?void 0:S.title)||wa,selectedConversation:S,refetchCurrentUserConversations:C})),!M&&!!a&&(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(ur,{conversationSharedState:e,isConversationOwner:l,selectedConversation:S,refetchCurrentUserConversations:C,refetchCurrentConversation:b})))),(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiFlexGroup,{gutterSize:"xs",alignItems:"center",justifyContent:"spaceBetween"},(0,g.jsx)(u.EuiFlexItem,null,(0,g.jsx)(kd,{isDisabled:c,selectedConnectorId:T,storageKey:fd.ELASTIC_LLM_USAGE_ASSISTANT_HEADER},(0,g.jsx)(Ar,{isDisabled:c||void 0===S||!l,selectedConnectorId:T,selectedConversation:S,onConnectorSelected:I}))),!M&&(0,g.jsx)(u.EuiFlexItem,null,(0,g.jsx)("div",{id:Sd},(0,g.jsx)(Ao,{isConversationOwner:l,isDisabled:c,conversations:s,onConversationSelected:x,onConversationDeleted:y,onChatCleared:h,refetchCurrentUserConversations:C,selectedConversation:S,setCurrentConversation:w}))),(0,g.jsx)(u.EuiFlexItem,null,(0,g.jsx)(ld,{isDisabled:c})))))))},jd=navigator.platform.toLowerCase().indexOf("mac")>=0,_d={title:(0,g.jsx)(l.FormattedMessage,{id:"xpack.elasticAssistant.anonymizedValuesAndCitations.tour.title",defaultMessage:"Citations & Anonymized values"}),subTitle:(0,g.jsx)(l.FormattedMessage,{id:"xpack.elasticAssistant.anonymizedValuesAndCitations.tour.subtitle",defaultMessage:"New and improved!"}),anchor:`#${Sd}`,content:(0,g.jsx)(u.EuiText,{size:"s"},(0,g.jsx)(l.FormattedMessage,{id:"xpack.elasticAssistant.anonymizedValuesAndCitations.tour.content.citedKnowledgeBaseEntries",defaultMessage:"AI Assistant can now cite sources in its responses. Toggle citations by using this menu or <bold>{keyboardShortcut}</bold>",values:{keyboardShortcut:jd?" + c":"Alt + c",bold:e=>(0,g.jsx)("strong",null,e)}}),(0,g.jsx)(u.EuiSpacer,{size:"s"}),(0,g.jsx)(l.FormattedMessage,{id:"xpack.elasticAssistant.anonymizedValuesAndCitations.tour.content.anonymizedValues",defaultMessage:"Quickly toggle the obfuscation of anonymized values in your conversation by using this menu, or <bold>{keyboardShortcut}</bold>. This does not affect the anonymization of data sent to the LLM",values:{keyboardShortcut:jd?" + a":"Alt + a",bold:e=>(0,g.jsx)("strong",null,e)}}))},Pd=(0,Yt.throttle)((e=>{const t=localStorage.getItem(e);if(t)return JSON.parse(t)}),5e3),Td=({conversation:e})=>{const t=xd(fd.KNOWLEDGE_BASE),s=xd(fd.ANONYMIZED_VALUES_AND_CITATIONS),[n,a]=f()(s,!1),i=xd(fd.ELASTIC_LLM_USAGE_ASSISTANT_HEADER),[r]=f()(i,hd),[l,d]=(0,o.useState)(!1);(0,o.useEffect)((()=>{if(l||!e||n)return;const s=Pd(t);if(null!=s&&s.isTourActive&&1===(null==s?void 0:s.currentTourStep)||null!=r&&r.isTourActive&&1===(null==r?void 0:r.currentTourStep))return;const a=Co(e),i=ko(e);if(a||i){const e=setTimeout((()=>{d(!0)}),1e3);return()=>{clearTimeout(e)}}}),[e,n,l,t,i,null==r?void 0:r.isTourActive,null==r?void 0:r.currentTourStep]);const c=(0,o.useCallback)((()=>{a(!0),d(!1)}),[a,d]);return(0,g.jsx)(u.EuiTourStep,{"data-test-subj":"anonymizedValuesAndCitationsTourStep",panelProps:{"data-test-subj":"anonymizedValuesAndCitationsTourStepPanel"},anchor:_d.anchor,content:_d.content,isStepOpen:l,maxWidth:300,onFinish:c,step:1,stepsTotal:1,title:_d.title,subtitle:_d.subTitle,anchorPosition:"rightUp"})},Id=__kbnSharedDeps__.KbnUiTheme;var Md=s(218);const zd=r().memo((({setIsConnectorModalVisible:e})=>{const{assistantAvailability:t}=Ze(),s=t.hasConnectorsAllPrivilege?an:rn,n=t.hasConnectorsAllPrivilege?on:ln,a=(0,o.useCallback)((()=>{null==e||e(!0)}),[e]);return(0,g.jsx)(u.EuiFlexGroup,{gutterSize:"l",justifyContent:"spaceAround"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiCard,{"data-test-subj":"connectorButton",layout:"horizontal",icon:(0,g.jsx)(u.EuiIcon,{size:"xl",type:Md.OpenAILogo}),title:s,description:n,onClick:t.hasConnectorsAllPrivilege?a:void 0})))}));zd.displayName="ConnectorButton";const Fd=r().memo((({isConnectorConfigured:e})=>{const{assistantAvailability:t}=Ze(),s=t.hasConnectorsAllPrivilege||t.hasConnectorsReadPrivilege&&e;return(0,g.jsx)(r().Fragment,null,s?(0,g.jsx)(u.EuiCallOut,{"data-test-subj":"connectorMissingCallout",color:"danger",iconType:"controlsVertical",size:"m",title:dn,css:(0,g.css)("padding-left:",Id.euiLightVars.euiPanelPaddingModifiers.paddingMedium,"!important;padding-right:",Id.euiLightVars.euiPanelPaddingModifiers.paddingMedium,"!important;","")},(0,g.jsx)("p",null,(0,g.jsx)(l.FormattedMessage,{defaultMessage:"Select a connector above to continue",id:"xpack.elasticAssistant.assistant.connectors.connectorMissingCallout.calloutDescription"}))):(0,g.jsx)(zd,null))}));Fd.displayName="ConnectorMissingCallout";const Od=({showEISCallout:e})=>{const{getUrlForApp:t,docLinks:{links:{observability:{elasticManagedLlmUsageCost:s}}}}=Ze(),{euiTheme:n}=(0,u.useEuiTheme)(),a=xd(fd.CONVERSATION_CONNECTOR_ELASTIC_LLM),[i,r]=f()(a,!1),[d,c]=(0,o.useState)(e),p=(0,o.useCallback)((()=>{c(!1),r(!0)}),[r]);return(0,o.useEffect)((()=>{c(!(!e||i))}),[e,i]),d?(0,g.jsx)(u.EuiCallOut,{"data-test-subj":"elasticLlmCallout",onDismiss:p,iconType:"info",title:S.i18n.translate("xpack.elasticAssistant.assistant.connectors.elasticLlmCallout.title",{defaultMessage:"You are now using the Elastic Managed LLM connector"}),size:"s",css:(0,g.css)("padding:",n.size.s,"!important;","")},(0,g.jsx)("p",null,(0,g.jsx)(l.FormattedMessage,{id:"xpack.elasticAssistant.assistant.connectors.tour.elasticLlmDescription",defaultMessage:"Elastic AI Assistant and other AI features are powered by an LLM. The Elastic Managed LLM connector is used by default ({costLink}) when no custom connectors are available. You can configure a {customConnector} if you prefer.",values:{costLink:(0,g.jsx)(u.EuiLink,{"data-test-subj":"elasticLlmUsageCostLink",href:s,target:"_blank",rel:"noopener noreferrer",external:!0},(0,g.jsx)(l.FormattedMessage,{id:"xpack.elasticAssistant.assistant.eisCallout.extraCost.label",defaultMessage:"additional costs incur"})),customConnector:(0,g.jsx)(u.EuiLink,{"data-test-subj":"elasticLlmConnectorLink",href:t("management",{path:"/insightsAndAlerting/triggersActionsConnectors/connectors"}),target:"_blank",rel:"noopener noreferrer",external:!0},(0,g.jsx)(l.FormattedMessage,{id:"xpack.elasticAssistant.assistant.eisCallout.connector.label",defaultMessage:"custom connector"}))}}))):null},Rd=r().memo((({isSettingsModalVisible:e,setIsSettingsModalVisible:t,shouldShowMissingConnectorCallout:s,currentConversation:n,connectors:a})=>{const{inferenceEnabled:i}=Ze(),r=(0,o.useMemo)((()=>{var e;if(i&&n&&""!==n.id&&null!=n&&null!==(e=n.apiConfig)&&void 0!==e&&e.connectorId)return null==a?void 0:a.some((e=>{var t;return e.id===(null===(t=n.apiConfig)||void 0===t?void 0:t.connectorId)&&yt(e)}))}),[i,n,a]);var l;return s?(0,g.jsx)(Fd,{isConnectorConfigured:(null!==(l=null==a?void 0:a.length)&&void 0!==l?l:0)>0,isSettingsModalVisible:e,setIsSettingsModalVisible:t}):r?(0,g.jsx)(Od,{showEISCallout:r}):null}));Rd.displayName="AssistantConversationBanner";const Ld=Je("span",{target:"efzts870"})({name:"1dd35ky",styles:"display:flex;flex:1;overflow:hidden"});var Dd={name:"1qmr6ab",styles:"overflow:auto"},Nd={name:"13yqj0e",styles:"min-height:100px;flex:1;>div{display:flex;flex-direction:column;align-items:stretch;>.euiFlyoutBody__banner{overflow-x:unset;}>.euiFlyoutBody__overflowContent{display:flex;flex:1;overflow:auto;}}"},Zd={name:"qhxz92",styles:"max-width:100%"},Bd={name:"d3v9zr",styles:"overflow:hidden"},Ud={name:"d3v9zr",styles:"overflow:hidden"};const $d=({chatHistoryVisible:e,lastConversation:t,onCloseFlyout:s,promptContextId:n="",setChatHistoryVisible:a,shouldRefocusPrompt:i=!1})=>{const{euiTheme:l}=(0,u.useEuiTheme)(),{assistantAvailability:{isAssistantEnabled:d},assistantTelemetry:c,currentAppId:p,augmentMessageCodeBlocks:h,getComments:v,http:y,promptContexts:x,currentUser:b,contentReferencesVisible:C,showAnonymizedValues:k,setContentReferencesVisible:S,setShowAnonymizedValues:E,settings:w}=Ze(),[A,j]=(0,o.useState)({}),_=(0,o.useMemo)((()=>Object.keys(A).length),[A]),{allPrompts:P,allSystemPrompts:T,anonymizationFields:I,conversations:M,isErrorAnonymizationFields:z,isFetchedAnonymizationFields:F,isFetchedCurrentUserConversations:O,isFetchedPrompts:R,isFetchingCurrentUserConversations:L,isLoadingAnonymizationFields:D,isLoadingCurrentUserConversations:N,setPaginationObserver:Z,refetchPrompts:B,refetchCurrentUserConversations:U,setIsStreaming:$}=(({currentUser:e,http:t,isAssistantEnabled:s})=>{const[n,a]=(0,o.useState)(!1),{data:i,isLoading:r,refetch:l,isFetching:d,isFetched:c,setPaginationObserver:u}=Zn({currentUser:e,http:t,perPage:28,refetchOnWindowFocus:!n,isAssistantEnabled:s,fields:["id","title","apiConfig","updatedAt","users","createdBy"]}),{data:p,isLoading:m,isError:g,isFetched:h}=Dn(),{data:{data:v},refetch:f,isLoading:y,isFetched:x}=Dt(),b=(0,o.useMemo)((()=>y?[]:v.filter((e=>e.promptType===gs.system))),[v,y]);return{allPrompts:v,allSystemPrompts:b,anonymizationFields:p,conversations:i,isErrorAnonymizationFields:g,isFetchedAnonymizationFields:h,isFetchedCurrentUserConversations:c,isFetchedPrompts:x,isFetchingCurrentUserConversations:d,isLoadingAnonymizationFields:m,isLoadingCurrentUserConversations:r,isLoadingPrompts:y,refetchCurrentUserConversations:l,refetchPrompts:f,setIsStreaming:a,setPaginationObserver:u}})({currentUser:b,http:y,isAssistantEnabled:d}),{data:V,isFetchedAfterMount:G}=Cn({http:y,settings:w}),K=(0,o.useMemo)((()=>((e,t)=>{const s=t.client.get(yn,void 0),n=null==e?void 0:e.filter((e=>!e.isMissingSecrets)),a=null==n?void 0:n.find((e=>e.id===s));return a||(null!=n&&n.length?[...n].sort(((e,t)=>{const s=e=>"Elastic-Managed-LLM"===e.id?0:e.apiProvider===ht.OpenAi||e.apiProvider===ht.AzureAi?1:2;return s(e)-s(t)}))[0]:void 0)})(V,w)),[V,w]),q=Xn(),{getLastConversation:H,setLastConversation:Q}=na({spaceId:q}),W=(0,o.useMemo)((()=>H()),[H]),{conversationSharedState:Y,currentConversation:J,currentSystemPrompt:X,handleCreateConversation:ee,handleOnConversationDeleted:te,handleOnConversationSelected:se,isConversationOwner:ne,refetchCurrentConversation:ae,setCurrentConversation:ie,setCurrentSystemPromptId:oe}=(({allSystemPrompts:e,connectors:t,currentAppId:s,lastConversation:n,conversations:a,currentUser:i,spaceId:r,defaultConnector:l,mayUpdateConversations:d,refetchCurrentUserConversations:c,setLastConversation:u})=>{const{deleteConversation:p,getConversation:m,setApiConfig:g}=Nt(),[h,v]=(0,o.useState)(),y=(0,o.useMemo)((()=>xt({allSystemPrompts:e,conversation:h})),[e,h]),x=(0,o.useCallback)((async e=>{if(""===(null==h?void 0:h.id))return v({...h,apiConfig:null!=h&&h.apiConfig?{...null==h?void 0:h.apiConfig,defaultSystemPromptId:e}:void 0});if(h&&h.apiConfig){const t=await g({conversation:h,apiConfig:{...h.apiConfig,defaultSystemPromptId:e}});t&&v(t),await c()}}),[h,c,g]),b=(0,o.useCallback)((async({cId:e,isStreamRefetch:t=!1,silent:s}={})=>{if(""===e)return;const n=null!=e?e:null==h?void 0:h.id;if(n){let e=await m(n,s),a=0;const i=5;for(;t&&e&&"assistant"!==e.messages[e.messages.length-1].role&&a<i;)a++,await Rn(2e3),e=await m(n);return e&&v(e),e}}),[null==h?void 0:h.id,m]),C=(0,o.useCallback)((({cTitle:t,apiConfig:s})=>{var n,a;const o=null!=s?s:null!=h&&h.apiConfig?h.apiConfig:l?{connectorId:null!==(n=l.id)&&void 0!==n?n:"",actionTypeId:null!==(a=l.actionTypeId)&&void 0!==a?a:""}:void 0,r=(e=>e.find((e=>e.isNewConversationDefault)))(e);return u({id:"",title:null!=t?t:""}),v({...o?{apiConfig:{...o,...null!=r&&r.id?{defaultSystemPromptId:null==r?void 0:r.id}:{}}}:{},id:"",users:[null!=i?i:{}],createdBy:null!=i?i:{},createdAt:(new Date).toISOString(),messages:[],replacements:{},category:"assistant",title:null!=t?t:""})}),[e,null==h?void 0:h.apiConfig,i,l,u]);(0,o.useEffect)((()=>{!l||null!=h&&h.apiConfig||""!==(null==h?void 0:h.id)||C({})}),[l,h,C]);const[k]=f()(`securitySolution.onboarding.assistantCard.connectorId.${r}`),S=(0,o.useCallback)((async({cId:e,cTitle:n,apiConfig:a,silent:i})=>{if(""===e){if("securitySolutionUI"===s&&k&&!a&&null!=t&&t.length){const e=t.find((e=>e.id===k));if(e)return C({apiConfig:{connectorId:e.id,actionTypeId:e.actionTypeId},cTitle:n})}return C({apiConfig:a,cTitle:n})}try{await b({cId:e,silent:i}),u({id:e})}catch(e){throw C({apiConfig:a,cTitle:n}),e}}),[t,s,C,k,b,u]);(0,o.useEffect)((()=>{d&&!h&&S({cId:n.id,cTitle:n.title,silent:!1})}),[n,S,h,d]);const E=(0,o.useCallback)((async e=>{await p(a[e].id),await c()}),[a,p,c]),w=(0,o.useCallback)((async()=>S({cId:""})),[S]),A=(0,o.useMemo)((()=>st(h,i)),[h,i]);return{conversationSharedState:(0,o.useMemo)((()=>et(h)),[h]),currentConversation:h,currentSystemPrompt:y,handleCreateConversation:w,handleOnConversationDeleted:E,handleOnConversationSelected:S,isConversationOwner:A,refetchCurrentConversation:b,setCurrentConversation:v,setCurrentSystemPromptId:x}})({allSystemPrompts:T,currentAppId:p,connectors:V,conversations:M,currentUser:b,defaultConnector:K,spaceId:q,refetchCurrentUserConversations:U,lastConversation:null!=t?t:W,mayUpdateConversations:G&&O&&R,setLastConversation:Q}),re=(0,o.useMemo)((()=>!(!d||(F||O||R)&&J)),[J,d,F,O,R]),le=(0,o.useMemo)((()=>{var e;return!Object.keys(M).some((e=>{var t,s,n,a;return null!=(null===(t=M[e])||void 0===t||null===(s=t.apiConfig)||void 0===s?void 0:s.connectorId)&&""!==(null===(n=M[e])||void 0===n||null===(a=n.apiConfig)||void 0===a?void 0:a.connectorId)}))&&0===(null!==(e=null==V?void 0:V.length)&&void 0!==e?e:0)}),[null==V?void 0:V.length,M]),de=(0,o.useMemo)((()=>le||!d||re),[le,d,re]),[ce,ue]=(0,o.useState)(!1),[pe,me]=(0,o.useState)(!1),[ge,he]=(0,o.useState)(!1);(0,o.useLayoutEffect)((()=>{let e=()=>{};return J&&setTimeout((()=>{e=h.mount({currentConversation:J,showAnonymizedValues:k})}),0),()=>{e()}}),[h,J,k]);const ve=(0,o.useCallback)((e=>{if(e.altKey&&"KeyC"===e.code){if(!Co(J))return;e.preventDefault(),S(!C)}if(e.altKey&&"KeyA"===e.code){if(!ko(J))return;e.preventDefault(),E(!k)}}),[S,C,E,k,J]);m()("keydown",ve);const fe=(0,o.useMemo)((()=>{var e;return!(N||!G||!J||""===J.id||null!=J&&null!==(e=J.apiConfig)&&void 0!==e&&e.connectorId&&null!=V&&V.some((e=>{var t;return e.id===(null===(t=J.apiConfig)||void 0===t?void 0:t.connectorId)})))}),[G,V,J,N]),ye=(0,o.useMemo)((()=>de||fe),[fe,de]);(0,o.useEffect)((()=>{const e=()=>{const e=document.querySelectorAll(".euiCodeBlock__controls");he(e.length>0)};e();const t=new MutationObserver(e);return t.observe(document.body,{subtree:!0,childList:!0}),()=>{t.disconnect()}}),[]),[...document.getElementsByClassName("euiCodeBlock")].forEach((e=>e.style.minHeight="85px"));const{abortStream:xe,handleOnChatCleared:be,handleChatSend:Ce,handleRegenerateResponse:ke,isLoading:Se,setUserPrompt:Ee,userPrompt:we}=aa({currentConversation:J,http:y,refetchCurrentUserConversations:U,selectedPromptContexts:A,setSelectedPromptContexts:j,setCurrentConversation:ie});(0,o.useEffect)((()=>{pe&&J&&(null==t?void 0:t.title)!==(null==J?void 0:J.title)&&(me(!1),j({}),Ee(null))}),[pe,J,null==t?void 0:t.title,Ee]),(0,o.useEffect)((()=>{if(J&&(null==t?void 0:t.title)!==(null==J?void 0:J.title)||null!=J&&J.messages.length||pe)return;const e=x[n];null!=e&&!D&&!z&&F&&I&&(me(!0),Object.keys(A).includes(e.id)||(async()=>{const t=await pa({anonymizationFields:I,promptContext:e});j((s=>({...s,[e.id]:t})))})(),null!=e.suggestedUserPrompt&&Ee(e.suggestedUserPrompt))}),[I,pe,J,z,F,D,null==t?void 0:t.title,n,x,A,Ee]);const Ae=(0,o.useMemo)((()=>(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiCommentList,{comments:v({abortStream:xe,currentConversation:J,isConversationOwner:ne,showAnonymizedValues:k,refetchCurrentConversation:ae,regenerateMessage:ke,isFetchingResponse:Se,setIsStreaming:$,systemPromptContent:null==X?void 0:X.content,contentReferencesVisible:C}),css:(0,g.css)("padding-bottom:",l.size.l,";>li>div:nth-child(2){overflow:hidden;}","")}),0!==(null==J?void 0:J.messages.length)&&_>0&&(0,g.jsx)(u.EuiSpacer,{size:"m"}))),[v,xe,J,k,ae,ke,ne,Se,$,null==X?void 0:X.content,C,l.size.l,_]),je=(0,o.useCallback)((e=>{null!=J&&J.title&&(null==c||c.reportAssistantQuickPrompt({promptTitle:e}))}),[c,null==J?void 0:J.title]);return(0,g.jsx)(r().Fragment,null,(0,g.jsx)(Td,{conversation:J}),(0,g.jsx)(u.EuiFlexGroup,{direction:"row",wrap:!1,gutterSize:"none"},e&&(0,g.jsx)(u.EuiFlexItem,{grow:!1,css:(0,g.css)("inline-size:",220,"px;border-right:",l.border.thin,";","")},(0,g.jsx)(Ga,{currentConversation:J,currentUser:b,onConversationSelected:se,conversations:M,onConversationDeleted:te,onConversationCreate:ee,isFetchingCurrentUserConversations:L,refetchCurrentUserConversations:U,setPaginationObserver:Z,setCurrentConversation:ie})),(0,g.jsx)(u.EuiFlexItem,{css:Ud},(0,g.jsx)(Ld,{"data-test-subj":"assistantChat"},(0,g.jsx)(u.EuiFlexGroup,{css:Bd},(0,g.jsx)(u.EuiFlexItem,{css:Zd},(0,g.jsx)(u.EuiFlyoutHeader,{hasBorder:!0},(0,g.jsx)(Ad,{chatHistoryVisible:e,conversations:M,conversationsLoaded:O,conversationSharedState:Y,currentUser:b,defaultConnector:K,isAssistantEnabled:d,isConversationOwner:ne,isDisabled:de||Se,isLoading:re,isSettingsModalVisible:ce,onChatCleared:be,onCloseFlyout:s,onConversationCreate:ee,onConversationDeleted:te,onConversationSelected:se,refetchCurrentConversation:ae,refetchCurrentUserConversations:U,refetchPrompts:B,selectedConversation:J,setChatHistoryVisible:a,setCurrentConversation:ie,setIsSettingsModalVisible:ue,setPaginationObserver:Z})),(0,g.jsx)(u.EuiFlyoutBody,{css:Nd,banner:!de&&G&&(0,g.jsx)(Rd,{isSettingsModalVisible:ce,setIsSettingsModalVisible:ue,shouldShowMissingConnectorCallout:fe,currentConversation:J,connectors:V})},(0,g.jsx)(Fn,{allSystemPrompts:T,comments:Ae,conversationSharedState:Y,currentConversation:J,currentSystemPromptId:null==X?void 0:X.id,handleOnConversationSelected:se,http:y,isAssistantEnabled:d,isConversationOwner:ne,isLoading:re,isSettingsModalVisible:ce,isWelcomeSetup:le,setUserPrompt:Ee,setCurrentSystemPromptId:oe,setIsSettingsModalVisible:ue})),(0,g.jsx)(u.EuiFlyoutFooter,{css:(0,g.css)("background:none;border-top:",ne?l.border.thin:"none",";overflow:hidden;max-height:60%;display:flex;flex-direction:column;","")},ne||re?(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiPanel,{paddingSize:"m",hasShadow:!1,css:Dd},!de&&Object.keys(x).length!==_&&(0,g.jsx)(u.EuiFlexGroup,null,(0,g.jsx)(u.EuiFlexItem,null,(0,g.jsx)(r().Fragment,null,(0,g.jsx)(ga,{anonymizationFields:I,promptContexts:x,selectedPromptContexts:A,setSelectedPromptContexts:j}),Object.keys(x).length>0&&(0,g.jsx)(u.EuiSpacer,{size:"s"})))),(0,g.jsx)(u.EuiFlexGroup,{direction:"column",gutterSize:"s"},Object.keys(A).length?(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(oo,{promptContexts:x,selectedPromptContexts:A,setSelectedPromptContexts:j,currentReplacements:null==J?void 0:J.replacements})):null,(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(ua,{handleChatSend:Ce,setUserPrompt:Ee,handleRegenerateResponse:ke,isDisabled:ye,isLoading:Se,shouldRefocusPrompt:i,userPrompt:we})))),!de&&(0,g.jsx)(u.EuiPanel,{css:(0,g.css)("background:",l.colors.backgroundBaseSubdued,";",""),hasShadow:!1,paddingSize:"m",borderRadius:"none"},(0,g.jsx)(ba,{setInput:Ee,setIsSettingsModalVisible:ue,trackPrompt:je,allPrompts:P}))):(0,g.jsx)(Bt,{selectedConversation:J,refetchCurrentUserConversations:U,setCurrentConversation:ie}))))))))};$d.displayName="AssistantComponent";const Vd=r().memo($d),Gd=navigator.platform.toLowerCase().indexOf("mac")>=0,Kd=(0,d.createGlobalStyle)(["body:has(.timeline-portal-overlay-mask) .euiOverlayMask{z-index:1003 !important;}"]),qd=r().memo((()=>{const e=Xn(),[t,s]=(0,o.useState)(!1),[n,a]=(0,o.useState)(void 0),[i,l]=(0,o.useState)(),{assistantTelemetry:d,setShowAssistantOverlay:c}=Ze(),{getLastConversation:u}=na({spaceId:e}),[p,g]=(0,o.useState)(!1),h=(0,o.useCallback)((()=>({showOverlay:e,promptContextId:t,selectedConversation:n})=>{const i=u(n);e&&(null==d||d.reportAssistantInvoked({invokedBy:"click"})),s(e),l(t),a(i)}),[d,u]);(0,o.useEffect)((()=>{c(h)}),[c,h]);const v=(0,o.useCallback)((()=>{t||(a(u()),null==d||d.reportAssistantInvoked({invokedBy:"shortcut"})),s(!t)}),[t,u,d]),f=(0,o.useRef)(!1),y=(0,o.useCallback)((e=>{t||(a(u({id:e})),null==d||d.reportAssistantInvoked({invokedBy:"url"}),s(!0))}),[t,u,d]);(0,o.useEffect)((()=>{if(f.current)return;const e=new URLSearchParams(window.location.search).get("assistant");e&&!t&&(f.current=!0,y(e))}),[y,t]);const x=(0,o.useCallback)((e=>{";"===e.key&&(Gd?e.metaKey:e.ctrlKey)&&(e.preventDefault(),v())}),[v]);m()("keydown",x);const b=(0,o.useCallback)((()=>{s(!1),l(void 0),a(n)}),[n]),C=(0,o.useCallback)((()=>{b()}),[b]),k=(0,o.useCallback)((()=>{g((e=>{if(null!=S&&S.current){const t=parseInt(S.current.style.inlineSize.split("px")[0],10);S.current.style.inlineSize=`${e?t-220:t+220}px`}return!e}))}),[]),S=(0,o.useRef)();return t?r().createElement(r().Fragment,null,r().createElement(Hd,{ref:S,onClose:C,"data-test-subj":"ai-assistant-flyout",paddingSize:"none",hideCloseButton:!0},r().createElement(Vd,{lastConversation:n,promptContextId:i,onCloseFlyout:C,chatHistoryVisible:p,setChatHistoryVisible:k})),r().createElement(Kd,null)):null}));qd.displayName="AssistantOverlay";var Hd=c()(u.EuiFlyoutResizable).withConfig({displayName:"_StyledEuiFlyoutResizable",componentId:"sc-1u573qw-0"})(["max-inline-size:calc(100% - 20px);min-inline-size:400px;> div{height:100%;}"]),Qd=s(215);const Wd=navigator.platform.toLowerCase().indexOf("mac")>=0,Yd=S.i18n.translate("xpack.elasticAssistant.assistantContext.assistantNavLinkShortcutTooltip",{values:{keyboardShortcut:Wd?" ;":"Ctrl ;"},defaultMessage:"Keyboard shortcut {keyboardShortcut}"}),Jd=S.i18n.translate("xpack.elasticAssistant.assistantContext.assistantNavLink",{defaultMessage:"AI Assistant"}),Xd=()=>{const{chrome:e,showAssistantOverlay:t,assistantAvailability:s,openChatTrigger$:n,completeOpenChat:a}=Ze(),[i,r]=(0,o.useState)(void 0);(0,o.useEffect)((()=>{const t=e.getChromeStyle$().subscribe(r);return()=>t.unsubscribe()}),[e]);const l=(0,o.useCallback)((()=>t({showOverlay:!0})),[t]);if((0,o.useEffect)((()=>{if(!n)return;const e=n.subscribe((e=>{"security"===e.assistant&&(l(),null==a||a())}));return()=>e.unsubscribe()}),[a,n,l]),!s.hasAssistantPrivilege||!i)return null;const d="project"===i?u.EuiButtonEmpty:u.EuiButton;return(0,g.jsx)(u.EuiToolTip,{content:Yd},(0,g.jsx)(d,{onClick:l,color:"primary",size:"s",iconType:$t,"data-test-subj":"assistantNavLink"},Jd))},ec=__kbnSharedDeps__.KbnReactKibanaContextTheme,tc=(0,o.createContext)(null),sc=({core:e,children:t})=>(0,g.jsx)(tc.Provider,{value:e},t),nc=()=>{const e=(0,o.useContext)(tc);if(!e)throw new Error("Kibana services not found in navigation context");return e};var ac=s(880),ic=s(409);const oc=()=>(0,ic.useKibana)(),rc=({user:e})=>{var t,s;const{userProfile:n}=oc().services;return(0,C.useQuery)({queryKey:["userProfile",null!==(t=null==e?void 0:e.id)&&void 0!==t?t:""],queryFn:async()=>{var t;if(null==e||!e.id)return[];const s=await(null==n?void 0:n.bulkGet({uids:new Set([null!==(t=null==e?void 0:e.id)&&void 0!==t?t:""]),dataPath:"avatar"}));return null!=s?s:[]},select:e=>{var t;if(!e||!e[0])return null;const s=e[0];return{...s,avatar:null===(t=s.data)||void 0===t?void 0:t.avatar}},enabled:!(null==e||null===(s=e.id)||void 0===s||!s.length)})},lc=S.i18n.translate("xpack.elasticAssistantPlugin.assistant.getComments.system",{defaultMessage:"System"}),dc=S.i18n.translate("xpack.elasticAssistantPlugin.assistant.getComments.assistant",{defaultMessage:"Assistant"}),cc=S.i18n.translate("xpack.elasticAssistantPlugin.assistant.getComments.you",{defaultMessage:"You"}),uc=S.i18n.translate("xpack.elasticAssistantPlugin.assistant.apiErrorTitle",{defaultMessage:"An error occurred sending your message."}),pc=({user:e})=>{const{data:t}=rc({user:e});return t?(0,g.jsx)(Ho,{"data-test-subj":"userAvatar",user:t.user,avatar:t.avatar,size:"l"}):(0,g.jsx)(u.EuiAvatar,{"data-test-subj":"genericAvatar",name:"user",size:"l",color:"subdued",iconType:"userAvatar"})},mc=({user:e})=>{var t,s;const{data:n}=rc({user:e});var a;return n?null!==(a=n.user.full_name)&&void 0!==a?a:n.user.username:null!==(t=null!==(s=null==e?void 0:e.name)&&void 0!==s?s:null==e?void 0:e.id)&&void 0!==t?t:cc},gc=e=>e.reduce(((e,t)=>{if(t.length)try{const s=JSON.parse(t);return"content"===s.type&&s.payload.length>0?[...e,s.payload]:e}catch(t){return e}return e}),[]);function hc(e){return(0,g.jsx)(u.EuiButtonEmpty,(0,Ue.default)({"data-test-subj":"stopGeneratingButton",color:"text",iconType:"stop",size:"s"},e),S.i18n.translate("xpack.elasticAssistantPlugin.aiAssistant.stopGeneratingButtonLabel",{defaultMessage:"Stop generating"}))}function vc(e){return(0,g.jsx)(u.EuiButtonEmpty,(0,Ue.default)({size:"s","data-test-subj":"regenerateResponseButton",iconType:"sparkles"},e),S.i18n.translate("xpack.elasticAssistantPlugin.aiAssistant.regenerateResponseButtonLabel",{defaultMessage:"Regenerate"}))}function fc(){return(0,g.jsx)(u.EuiFlexGroup,{direction:"row",gutterSize:"s",alignItems:"center"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiIcon,{type:"alert",color:"danger",size:"s"})),(0,g.jsx)(u.EuiFlexItem,null,(0,g.jsx)(u.EuiText,{size:"s",color:"danger"},S.i18n.translate("xpack.elasticAssistantPlugin.aiAssistant.failedLoadingResponseText",{defaultMessage:"Failed to load response"}))))}function yc(e){return(0,g.jsx)(r().Fragment,null,e.body,e.error?(0,g.jsx)("span",{"data-test-subj":"message-error"},e.body?(0,g.jsx)(u.EuiSpacer,{size:"xs"}):null,(0,g.jsx)(fc,null)):null,e.controls?(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiSpacer,{size:"m"}),(0,g.jsx)(u.EuiHorizontalRule,{margin:"none"}),(0,g.jsx)(u.EuiSpacer,{size:"s"}),e.controls):null)}const xc=()=>{const e=t=>{"children"in t&&t.children.forEach((t=>{e(t)})),"code"!==t.type||"eql"!==t.lang&&"esql"!==t.lang&&"kql"!==t.lang&&"dsl"!==t.lang&&"json"!==t.lang||(t.type="customCodeBlock")};return t=>{e(t)}},bc=({value:e,lang:t})=>{const s=(0,u.useEuiTheme)();return(0,g.jsx)(u.EuiPanel,{hasShadow:!1,hasBorder:!1,paddingSize:"s",className:(0,Wt.css)("background-color:",s.euiTheme.colors.lightestShade,";.euiCodeBlock__pre{margin-bottom:0;padding:",s.euiTheme.size.m,";min-block-size:48px;}.euiCodeBlock__controls{inset-block-start:",s.euiTheme.size.m,";inset-inline-end:",s.euiTheme.size.m,";}","")},(0,g.jsx)(u.EuiFlexGroup,{direction:"column",gutterSize:"xs"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(u.EuiCodeBlock,{isCopyable:!0,fontSize:"m",language:t},e))))},Cc="\\u0020?\\{reference",kc=({contentReferences:e})=>function(){const t=this.Parser,s=t.prototype.inlineTokenizers,n=t.prototype.inlineMethods;let a=1;const i={},o=function(t,s,n){const[o]=s.match(new RegExp(`^${Cc}`))||[];if(!o)return!1;if("("!==s[o.length])return!1;let r=o.length;const l=function(){if("("!==s[r])return"";r++;let e="",t=0;for(;r<s.length;r++){const n=s[r];if(")"===n&&0===t)return r++,e;")"===n?t--:"("===n&&t++,e+=n}return""}();if("}"!==s[r])return!1;const d=t.now();if(l||this.file.info("No content reference id found",{line:d.line,column:d.column+o.length+1}),n)return!0;d.column+=o.length+1,d.offset+=o.length+1;const c=`{reference(${l})}`,u=null==e?void 0:e[l],p=()=>(l in i||(i[l]=a++),i[l]),m=`${o.startsWith(" ")?" ":""}${c}`;if(null===e){const e={type:"contentReference",contentReferenceId:l,contentReferenceCount:p(),contentReferenceBlock:c,contentReference:void 0};return t(m)(e)}if(void 0===u){const e={type:"contentReference",contentReferenceId:l,contentReferenceCount:void 0,contentReferenceBlock:c,contentReference:u};return t(m)(e)}const g={type:"contentReference",contentReferenceId:l,contentReferenceCount:p(),contentReferenceBlock:c,contentReference:u};return t(m)(g)};o.notInLink=!0,o.locator=(e,t)=>{var s;const n=null===(s=e.substring(t).match(new RegExp(Cc)))||void 0===s?void 0:s.index;return void 0===n?-1:n+1},s.contentReference=o,n.splice(n.indexOf("text"),0,"contentReference")},Sc=S.i18n.translate("xpack.elasticAssistantPlugin.assistant.contentReferences.securityAlertReference.label",{defaultMessage:"View alert"}),Ec=S.i18n.translate("xpack.elasticAssistantPlugin.assistant.contentReferences.securityAlertsPageReference.label",{defaultMessage:"View alerts"}),wc=S.i18n.translate("xpack.elasticAssistantPlugin.assistant.contentReferences.knowledgeBaseEntryReference.label",{defaultMessage:"Knowledge base entry"}),Ac=({contentReferenceCount:e,...t})=>(0,g.jsx)(u.EuiButtonEmpty,(0,Ue.default)({size:"xs",className:(0,Wt.css)({name:"bj37dw",styles:"padding:0px;block-size:auto"}),"data-test-subj":"ContentReferenceButton"},t),(0,g.jsx)("sup",{className:(0,Wt.css)({name:"ogkyt4",styles:"vertical-align:baseline;position:relative;top:-0.3em"})},`[${e}]`)),jc=({contentReferenceCount:e,children:t,...s})=>{const[n,a]=(0,o.useState)(!1),i=(0,o.useCallback)((()=>a((e=>!e))),[]),r=(0,o.useCallback)((()=>a(!1)),[]),l=(0,o.useCallback)((()=>a(!0)),[]),d=(0,o.useMemo)((()=>(0,g.jsx)(Ac,{onClick:i,onMouseEnter:l,contentReferenceCount:e})),[e,l,i]);return(0,g.jsx)(u.EuiPopover,(0,Ue.default)({button:d,isOpen:n,closePopover:r,onMouseLeave:r,anchorPosition:"upCenter",className:(0,Wt.css)({name:"1yq3syn",styles:"vertical-align:baseline"})},s),t)},_c=__kbnSharedDeps__.KbnRison,Pc="query",Tc=e=>`${(e=>(0,h.isEmpty)(e)?"":`${null!=e&&e.startsWith("?")?e:`?${e}`}`)(e)}`,Ic="open",Mc="acknowledged",zc=({contentReferenceNode:e})=>{const{navigateToApp:t}=oc().services.application,{assistantAvailability:s}=Ze(),n=(0,o.useCallback)((n=>(n.preventDefault(),((e,t,s)=>s?((e,t)=>e("securitySolutionUI",{deepLinkId:Fl.configurationsAiSettings,path:`?tab=${Fs}&entry_search_term=${t}`,openInNewTab:!0}))(e,t):((e,t)=>e("management",{path:`ai/securityAiAssistantManagement?tab=${Fs}&entry_search_term=${t}`,openInNewTab:!0}))(e,t))(t,e.contentReference.knowledgeBaseEntryId,s.hasSearchAILakeConfigurations))),[s.hasSearchAILakeConfigurations,t,e.contentReference.knowledgeBaseEntryId]);return(0,g.jsx)(jc,{contentReferenceCount:e.contentReferenceCount,"data-test-subj":"KnowledgeBaseEntryReference"},(0,g.jsx)(u.EuiLink,{onClick:n,"data-test-subj":"knowledgeBaseEntryReferenceLink"},`${wc}: ${e.contentReference.knowledgeBaseEntryName}`))},Fc=({contentReferenceNode:e})=>{const{navigateToApp:t}=oc().services.application,{assistantAvailability:s}=Ze(),n=(0,o.useCallback)((n=>(n.preventDefault(),((e,t,s)=>s?((e,t)=>{const s=(0,_c.encode)({language:"kuery",query:`_id: ${t}`}),n=new URLSearchParams({[Pc]:s});return e("securitySolutionUI",{deepLinkId:Fl.alertSummary,path:Tc(n.toString()),openInNewTab:!0})})(e,t):((e,t)=>e("security",{path:`alerts/redirect/${t}`,openInNewTab:!0}))(e,t))(t,e.contentReference.alertId,s.hasSearchAILakeConfigurations))),[s.hasSearchAILakeConfigurations,e.contentReference.alertId,t]);return(0,g.jsx)(jc,{contentReferenceCount:e.contentReferenceCount,"data-test-subj":"SecurityAlertReference"},(0,g.jsx)(u.EuiLink,{onClick:n,"data-test-subj":"alertReferenceLink"},Sc))},Oc="securitySolutionUI",Rc=()=>{const{navigateTo:e}=(()=>{const{navigateToApp:e,navigateToUrl:t}=nc().application;return{navigateTo:(0,o.useCallback)((({url:s,appId:n=Oc,restoreScroll:a,...i})=>{a&&(()=>{const e=window.scrollY;window.addEventListener("scroll",(()=>window.scrollTo(0,e)),{once:!0})})(),s?t(s):e(n,i)}),[e,t])}})(),{getAppUrl:t}=(()=>{const{getUrlForApp:e}=nc().application;return{getAppUrl:(0,o.useCallback)((({appId:t=Oc,...s})=>e(t,s)),[e])}})();return{navigateTo:e,getAppUrl:t}},Lc=({contentReferenceNode:e})=>{const t=(()=>{const{navigateTo:e}=Rc();return(t,s=!1,n)=>{const a=(0,_c.encode)((Array.isArray(t)?t:[t]).map((({title:e,fieldName:t,selectedOptions:s=[],existsSelected:n=!1,exclude:a=!1,hideActionBar:i=!1})=>({title:null!=e?e:t,selectedOptions:s,fieldName:t,existsSelected:n,exclude:a,hideActionBar:i})))),i=n?`&timerange=${n}`:"";e({deepLinkId:Fl.alerts,path:`?pageFilters=${a}${i}`,openInNewTab:s})}})(),{assistantAvailability:s}=Ze(),{navigateToApp:n}=oc().services.application,a=(0,o.useCallback)((e=>(e.preventDefault(),((e,t,s)=>{if(s)return(e=>{const t=(0,_c.encode)({language:"kuery",query:`kibana.alert.workflow_status: ${Ic} OR kibana.alert.workflow_status: ${Mc}`}),s=new URLSearchParams({[Pc]:t});return e("securitySolutionUI",{deepLinkId:Fl.alertSummary,path:Tc(s.toString()),openInNewTab:!0})})(e);(e=>{e({selectedOptions:[Ic,Mc],fieldName:"kibana.alert.workflow_status",persist:!1},!0,"(global:(timerange:(fromStr:now-24h,kind:relative,toStr:now)))")})(t)})(n,t,s.hasSearchAILakeConfigurations))),[s.hasSearchAILakeConfigurations,n,t]);return(0,g.jsx)(jc,{contentReferenceCount:e.contentReferenceCount,"data-test-subj":"SecurityAlertsPageReference"},(0,g.jsx)(u.EuiLink,{onClick:a,"data-test-subj":"alertsReferenceLink"},Ec))},Dc=({contentReferenceNode:e})=>(0,g.jsx)(jc,{contentReferenceCount:e.contentReferenceCount,"data-test-subj":"ProductDocumentationReference"},(0,g.jsx)(u.EuiLink,{href:e.contentReference.url,target:"_blank"},e.contentReference.title)),Nc=({contentReferenceNode:e})=>{const{discover:{locator:t},application:{navigateToApp:s}}=oc().services,n=(0,o.useCallback)((async n=>{if(n.preventDefault(),!t)return;const a=await t.getLocation({query:{esql:e.contentReference.query},timeRange:e.contentReference.timerange});s(a.app,{path:a.path,openInNewTab:!0})}),[t,e,s]);return(0,g.jsx)(jc,{contentReferenceCount:e.contentReferenceCount,"data-test-subj":"EsqlQueryReference"},(0,g.jsx)(u.EuiLink,{onClick:n},e.contentReference.label))},Zc=({contentReferenceNode:e})=>{var t;return(0,g.jsx)(jc,{contentReferenceCount:e.contentReferenceCount,"data-test-subj":"HrefReference"},(0,g.jsx)(u.EuiLink,{href:e.contentReference.href,target:"_blank",css:(0,g.css)((0,u.euiTextTruncate)("300px"),";","")},null!==(t=e.contentReference.label)&&void 0!==t?t:e.contentReference.href))},Bc=({contentReferencesVisible:e,contentReferenceNode:t})=>{if(!e)return null;if(void 0===t.contentReferenceCount)return null;if(void 0===t.contentReference)return(0,g.jsx)(Ac,{disabled:!0,contentReferenceCount:t.contentReferenceCount});switch(t.contentReference.type){case"KnowledgeBaseEntry":return(0,g.jsx)(zc,{contentReferenceNode:t});case"SecurityAlert":return(0,g.jsx)(Fc,{contentReferenceNode:t});case"SecurityAlertsPage":return(0,g.jsx)(Lc,{contentReferenceNode:t});case"ProductDocumentation":return(0,g.jsx)(Dc,{contentReferenceNode:t});case"EsqlQuery":return(0,g.jsx)(Nc,{contentReferenceNode:t});case"Href":return(0,g.jsx)(Zc,{contentReferenceNode:t});default:const e=t.contentReference;throw new Error(`Unhandled case: ${e}`)}},Uc=()=>{const{euiTheme:e}=(0,u.useEuiTheme)(),t=(0,g.css)("@keyframes blink{0%{opacity:0;}50%{opacity:1;}100%{opacity:0;}}width:10px;height:16px;vertical-align:middle;display:inline-block;animation:blink ",1,"s infinite;background:",e.colors.backgroundLightText,";","");return(0,g.jsx)("span",{"data-test-subj":"cursor",key:"cursor",css:t})},$c=" ",Vc=()=>{const e=(t,s)=>{var n;if("children"in t){const s=t;s.children.forEach((t=>{e(t,s)}))}if("text"!==t.type&&"inlineCode"!==t.type&&"code"!==t.type)return;const a=t;if(-1===a.value.indexOf($c))return;a.value=a.value.replace($c,"");const i=null!==(n=null==s?void 0:s.children.indexOf(a))&&void 0!==n?n:0;null==s||s.children.splice(i+1,0,{type:"cursor",value:$c})};return t=>{e(t)}};var Gc={name:"26bywx",styles:"overflow-wrap:anywhere"};function Kc({loading:e,content:t,contentReferences:s,contentReferencesVisible:n,contentReferencesDisabled:a,index:i,"data-test-subj":l}){const d=Gc,{parsingPluginList:c,processingPluginList:p}=(0,o.useMemo)((()=>(({contentReferences:e,contentReferencesVisible:t,contentReferencesDisabled:s})=>{const n=(0,u.getDefaultEuiMarkdownParsingPlugins)(),a=(0,u.getDefaultEuiMarkdownProcessingPlugins)(),{components:i}=a[1][1];return a[1][1].components={...i,contentReference:e=>(0,g.jsx)(Bc,{contentReferencesVisible:t,contentReferenceNode:e}),cursor:Uc,customCodeBlock:e=>(0,g.jsx)(r().Fragment,null,(0,g.jsx)(bc,{value:e.value,lang:e.lang}),(0,g.jsx)(u.EuiSpacer,{size:"m"})),table:e=>(0,g.jsx)(r().Fragment,null,(0,g.jsx)(u.EuiTable,e),(0,g.jsx)(u.EuiSpacer,{size:"m"})),th:e=>{const{children:t,...s}=e;return(0,g.jsx)(u.EuiTableHeaderCell,s,t)},tr:e=>(0,g.jsx)(u.EuiTableRow,e),td:e=>{const{children:t,...s}=e;return(0,g.jsx)(u.EuiTableRowCell,(0,Ue.default)({truncateText:!0},s),t)}},{parsingPluginList:[Vc,xc,...n,...s?[]:[kc({contentReferences:e})]],processingPluginList:a}})({contentReferences:s,contentReferencesVisible:n,contentReferencesDisabled:a})),[s,n,a]);return(0,g.jsx)(u.EuiText,{css:d,"data-test-subj":l},(0,g.jsx)(u.EuiMarkdownFormat,{className:`message-${i}`,"data-test-subj":"messageText",parsingPluginList:c,processingPluginList:p,textSize:"s"},`${t}${e?$c:""}`))}const qc=({abortStream:e,content:t,contentReferences:s,contentReferencesVisible:n,index:a,isControlsEnabled:i=!1,isError:r=!1,isFetching:l=!1,reader:d,refetchCurrentConversation:c,regenerateMessage:p,setIsStreaming:m,transformMessage:h,messageRole:v})=>{const{error:f,isLoading:y,isStreaming:x,pendingMessage:b,setComplete:C}=(({content:e,isError:t,reader:s,refetchCurrentConversation:n})=>{const[a,i]=(0,o.useState)(),[r,l]=(0,o.useState)(!1),[d,c]=(0,o.useState)(),[u,p]=(0,o.useState)(),m=(0,o.useMemo)((()=>null==e&&null!=s?(({isError:e,reader:t,setLoading:s})=>new ea.Observable((s=>{s.next({chunks:[],loading:!0});const n=new TextDecoder,a=[];let i="";return function o(){t.read().then((({done:t,value:r})=>{try{if(t){if(i){const e=gc([i])[0];e&&e.length>0&&a.push(e)}return s.next({chunks:a,message:a.join(""),loading:!1}),void s.complete()}const o=n.decode(r);let l;if(e)l=[`${uc}\n\n${JSON.parse(o).message}`],l.forEach((e=>{a.push(e),s.next({chunks:a,message:a.join(""),loading:!0})}));else{const e=o.split("\n");e[0]=i+e[0],i=e.pop()||"",l=gc(e),l.forEach((e=>{a.push(e),s.next({chunks:a,message:a.join(""),loading:!0})}))}}catch(e){return void s.error(e)}o()})).catch((e=>{s.error(e)}))}(),()=>{t.cancel()}})).pipe((0,ea.timestamp)(),(0,ea.scan)(((e,t)=>{const s=e.timestamp||0;return{timestamp:Math.max(s+10,t.timestamp),value:t.value}})),(0,ea.concatMap)((e=>{const t=Date.now(),s=e.timestamp-t;return s<=0?(0,ea.of)(e.value):(0,ea.of)(e.value).pipe((0,ea.delay)(s))})),(0,ea.finalize)((()=>s(!1)))))({reader:s,setLoading:l,isError:t}):new ea.Observable),[e,t,s]),g=(0,o.useCallback)((e=>{null==u||u.unsubscribe(),l(!1),e||n({isStreamRefetch:!0})}),[n,u]),[h,v]=(0,o.useState)({complete:!1,didAbort:!1});return(0,o.useEffect)((()=>{h.complete&&(g(h.didAbort),v({complete:!1,didAbort:!1}))}),[h,g]),(0,o.useEffect)((()=>{const e=m.subscribe({next:({message:e,loading:t})=>{l(t),i(e)},complete:()=>{v({complete:!0,didAbort:!1})},error:e=>{"AbortError"===e.name||c(e.message)}});p(e)}),[m]),{error:d,isLoading:r,isStreaming:r&&null!=a,pendingMessage:null!=a?a:"",setComplete:v}})({refetchCurrentConversation:c,content:t,reader:d,isError:r});(0,o.useEffect)((()=>{m(x)}),[x,m]);const k=(0,o.useCallback)((()=>{C({complete:!0,didAbort:!0}),e()}),[e,C]),S=(0,o.useRef)({isStreaming:x,stopStream:k});(0,o.useEffect)((()=>{S.current={isStreaming:x,stopStream:k}}),[k,x]),(0,o.useEffect)((()=>()=>{S.current.isStreaming&&S.current.stopStream()}),[]);const E=(0,o.useMemo)((()=>null!=t?t:h(b).content),[t,h,b]),w=(0,o.useMemo)((()=>l||y||x||0===E.length),[E,l,y,x]),A=(0,o.useMemo)((()=>{if(i)return w&&d?(0,g.jsx)(hc,{onClick:k}):(0,g.jsx)(u.EuiFlexGroup,{direction:"row",justifyContent:"flexEnd"},(0,g.jsx)(u.EuiFlexItem,{grow:!1},(0,g.jsx)(vc,{onClick:p})))}),[w,i,d,p,k]);return(0,g.jsx)(yc,{body:(0,g.jsx)(Kc,{"data-test-subj":r?"errorComment":void 0,content:E,contentReferences:s,index:a,contentReferencesVisible:n,contentReferencesDisabled:"user"===v,loading:w}),error:f?new Error(f):void 0,controls:A})},Hc=Je("div",{target:"e3o63700"})({name:"18iguwq",styles:"width:40px;height:40px;display:flex;justify-content:center"}),Qc=e=>(0,h.has)("message",e)&&(0,h.has)("body.message",e)&&(0,h.has)("body.statusCode",e),Wc=e=>(0,h.has)("message",e)&&(0,h.has)("body.message",e)&&(0,h.has)("body.status_code",e),Yc=__kbnSharedDeps__.KbnSearchErrors,Jc=e=>null!=e&&(0,Yc.isEsError)(e)?Xc(e):(e=>Qc(e)||Wc(e))(e)?eu(e):e instanceof Error?tu(e):su(e),Xc=e=>{var t,s,n,a,i,o,r;const l=null!=e.err?e.err:e,d=null!=(null===(t=e.err)||void 0===t?void 0:t.statusCode)?`(${e.err.statusCode})`:null!=e.statusCode?`(${e.statusCode})`:"",c=nu(l),u=new Error(`${null!==(s=null===(n=e.attributes)||void 0===n||null===(a=n.error)||void 0===a?void 0:a.reason)&&void 0!==s?s:e.message} ${d}`);return u.name=null!==(i=null===(o=e.attributes)||void 0===o||null===(r=o.error)||void 0===r?void 0:r.reason)&&void 0!==i?i:e.message,null!=c&&(u.stack=c),u},eu=e=>{const t=Qc(e)?`(${e.body.statusCode})`:Wc(e)?`(${e.body.status_code})`:"",s=nu(e),n=new Error(`${""!==String(e.body.message).trim()?e.body.message:e.message} ${t}`);return n.name=null!=e.name?e.name:"",null!=s&&(n.stack=s),n},tu=e=>{const t=nu(e),s=new Error(e.message);return s.name=e.name,null!=t&&(s.stack=t),s},su=e=>{const t=nu(e),s=(0,h.isString)(e)?e:e instanceof Object&&null!=t?t:String(e),n=new Error(s);return n.name=s,null!=t&&(n.stack=t),n},nu=e=>{try{return JSON.stringify(e,((e,t)=>{const s=au(t);return iu(s)?void 0:s}),2)}catch(e){return}},au=e=>e instanceof Error?{...e,name:e.name,message:e.message,stack:e.stack}:e,iu=e=>{if(!(e instanceof Object))return!1;try{return"{}"===JSON.stringify(e)}catch(e){return!1}},ou="securitySolutionAssistant",ru=new class LicenseService{constructor(){(0,n.default)(this,"observable",null),(0,n.default)(this,"subscription",null),(0,n.default)(this,"licenseInformation",null)}updateInformation(e){this.licenseInformation=e}start(e){this.observable=e,this.subscription=this.observable.subscribe(this.updateInformation.bind(this))}stop(){this.subscription&&this.subscription.unsubscribe()}getLicenseInformation(){return this.licenseInformation}getLicenseInformation$(){return this.observable}getLicenseType(){return this.licenseInformation&&this.licenseInformation.type?this.licenseInformation.type:""}getLicenseUID(){return this.licenseInformation&&this.licenseInformation.uid?this.licenseInformation.uid:""}isAtLeast(e){return((e,t)=>!!e&&e.isAvailable&&e.isActive&&e.hasAtLeast(t))(this.licenseInformation,e)}isGoldPlus(){return this.isAtLeast("gold")}isPlatinumPlus(){return this.isAtLeast("platinum")}isEnterprise(){return this.isAtLeast("enterprise")}};var lu=s(390),du=s(630);function cu(e){const{application:{currentAppId$:t,applications$:s},aiAssistantManagementSelection:n,spaces:a}=oc().services,[i,r]=(0,o.useState)(!1),l=a.getActiveSpace$();return(0,o.useEffect)((()=>{const a=(0,ea.combineLatest)([t,s,n.aiAssistantType$,l]).subscribe({next:([t,s,n,a])=>{r(function(e,t,s,n,a){var i,o;if("security"===n.solution||a)return!0;if(s===du.AIAssistantType.Never)return!1;const r=e&&(null===(i=t.get(e))||void 0===i||null===(o=i.category)||void 0===o?void 0:o.id)||lu.DEFAULT_APP_CATEGORIES.kibana.id;return s===du.AIAssistantType.Security?lu.DEFAULT_APP_CATEGORIES.observability.id!==r&&lu.DEFAULT_APP_CATEGORIES.enterpriseSearch.id!==r:lu.DEFAULT_APP_CATEGORIES.security.id===r}(t,s,n,a,e))}});return()=>a.unsubscribe()}),[t,s,n.aiAssistantType$,l,e]),{isVisible:i}}const uu=S.i18n.translate("xpack.elasticAssistantPlugin.assistant.commentActions.copyToClipboard",{defaultMessage:"Copy to clipboard"});function pu(e){return(e=>{let t="",s=0;for(;s<e.length;){const n=e.indexOf("{reference(",s);if(-1===n){t+=e.slice(s);break}const a=e.indexOf(")}",n);if(-1===a){t+=e.slice(s);break}t+=e.slice(s,n),s=a+2}return t})(e).trim()}const mu=({message:e,children:t})=>{var s;const n=null!==(s=e.content)&&void 0!==s?s:"";return(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center",gutterSize:"none"},t,(0,g.jsx)(u.EuiFlexItem,{grow:!1,"data-test-subj":"copy-to-clipboard-action"},(0,g.jsx)(u.EuiToolTip,{position:"top",content:uu},(0,g.jsx)(u.EuiCopy,{textToCopy:pu(n)},(e=>(0,g.jsx)(u.EuiButtonIcon,{"aria-label":uu,color:"primary",iconType:"copyClipboard",onClick:e}))))))},gu=r().memo(mu),hu=({message:e,getActions$:t})=>{const s=(0,ac.A)(t,[]),n=(0,o.useRef)(null);return(0,o.useEffect)((()=>{const t=n.current,a=t?s.map((s=>s.mount({message:e})(t))):[];return()=>{a.forEach((e=>e()))}}),[s,e]),(0,g.jsx)(gu,{message:e},(0,g.jsx)(u.EuiFlexGroup,{alignItems:"center",gutterSize:"none",ref:n}))};let vu=function(e){return e.AssistantInvoked="Assistant Invoked",e.AssistantMessageSent="Assistant Message Sent",e.AssistantQuickPrompt="Assistant Quick Prompt",e.AssistantStarterPrompt="Assistant Starter Prompt",e.AssistantSettingToggled="Assistant Setting Toggled",e}({});const fu=S.i18n.translate("xpack.elasticAssistantPlugin.assistant.title",{defaultMessage:"Elastic AI Assistant"});function yu({children:e,isServerless:t,openChatTrigger$:s,completeOpenChat:n}){const{application:{navigateToApp:a,currentAppId$:i,getUrlForApp:r},http:l,triggersActionsUi:{actionTypeRegistry:d},docLinks:c,userProfile:p,chrome:m,productDocBase:v,elasticAssistantSharedState:y,settings:k}=oc().services,w=(()=>{const{triggersActionsUi:{actionTypeRegistry:e}}=oc().services;let t=!1;try{e.get(".inference"),t=!0}catch(e){}return t})(),A=oc().services.http.basePath.get(),{isVisible:j}=cu(t),_=(()=>{var e,t,s,n,a,i,o,r,l,d;const{isVisible:c}=cu(),u=ru.isEnterprise(),{application:{capabilities:p}}=oc().services,m=!0===(null===(e=p[ou])||void 0===e?void 0:e["ai-assistant"]),g=!0===(null===(t=p[ou])||void 0===t?void 0:t.updateAIAssistantAnonymization),h=!0===(null===(s=p[ou])||void 0===s?void 0:s.manageGlobalKnowledgeBaseAIAssistant),v=!0===(null===(n=p.siemV4)||void 0===n?void 0:n.configurations),f=!0===(null==p||null===(a=p.management)||void 0===a||null===(i=a.ai)||void 0===i?void 0:i.aiAssistantManagementSelection),y=!0===(null===(o=p.actions)||void 0===o?void 0:o.show)&&!0===(null===(r=p.actions)||void 0===r?void 0:r.execute);return{hasSearchAILakeConfigurations:v,hasAssistantPrivilege:m,hasConnectorsAllPrivilege:y&&!0===(null===(l=p.actions)||void 0===l?void 0:l.delete)&&!0===(null===(d=p.actions)||void 0===d?void 0:d.save),hasConnectorsReadPrivilege:y,isAssistantEnabled:u,isAssistantVisible:u&&c,isAssistantManagementEnabled:u&&f,hasUpdateAIAssistantAnonymization:g,hasManageGlobalKnowledgeBase:h}})(),P=(()=>{const{services:{telemetry:e}}=oc(),t=(0,o.useCallback)((async({eventType:t,params:s})=>{e.reportEvent(t,s)}),[e]);return(0,o.useMemo)((()=>({reportAssistantInvoked:e=>t({eventType:vu.AssistantInvoked,params:e}),reportAssistantMessageSent:e=>t({eventType:vu.AssistantMessageSent,params:e}),reportAssistantQuickPrompt:e=>t({eventType:vu.AssistantQuickPrompt,params:e}),reportAssistantStarterPrompt:e=>t({eventType:vu.AssistantStarterPrompt,params:e}),reportAssistantSettingToggled:t=>e.reportEvent(vu.AssistantSettingToggled,t)})),[t,e])})(),T=(0,ac.A)(i,""),I=(0,ac.A)(y.promptContexts.getPromptContext$(),{}),z=(0,ac.A)(y.signalIndex.getSignalIndex$(),void 0),O=(0,ac.A)(y.augmentMessageCodeBlocks.getAugmentMessageCodeBlocks$(),{mount:()=>()=>{}}),R=(()=>{const e=oc().services.notifications.toasts,t=(0,o.useRef)(e.addError.bind(e)).current,s=(0,o.useRef)(e.addSuccess.bind(e)).current,n=(0,o.useRef)(e.addWarning.bind(e)).current,a=(0,o.useRef)(e.remove.bind(e)).current,i=(0,o.useCallback)(((e,s)=>{const n=Jc(e);return t(n,s)}),[t]);return(0,o.useMemo)((()=>({api:e,addError:i,addSuccess:s,addWarning:n,remove:a})),[i,s,n,a,e])})(),L=(0,o.useCallback)((e=>(0,g.jsx)(hu,{message:e.message,getActions$:y.comments.getActions$()})),[y.comments]),D=(0,o.useMemo)((()=>{return e={CommentActions:L},({abortStream:t,contentReferencesVisible:s,currentConversation:n,isConversationOwner:a,isFetchingResponse:i,refetchCurrentConversation:o,regenerateMessage:r,setIsStreaming:l,showAnonymizedValues:d,systemPromptContent:c})=>{if(!n)return[];const p=()=>{r(n.id)},m=i?[{username:dc,timelineAvatar:(0,g.jsx)(Hc,null,(0,g.jsx)(u.EuiLoadingSpinner,{size:"xl"})),timestamp:"...",children:(0,g.jsx)(qc,{abortStream:t,content:"",refetchCurrentConversation:o,regenerateMessage:p,setIsStreaming:l,contentReferencesVisible:s,transformMessage:()=>({content:""}),contentReferences:null,messageRole:"assistant",isFetching:!0,index:999})}]:[];return[...c&&n.messages.length?[{username:lc,timelineAvatar:(0,g.jsx)(Gt,{name:"machine",size:"l",color:"subdued"}),timestamp:0===n.messages[0].timestamp.length?(new Date).toLocaleString():new Date(n.messages[0].timestamp).toLocaleString(),children:(0,g.jsx)(qc,{abortStream:t,content:c,refetchCurrentConversation:o,regenerateMessage:p,setIsStreaming:l,contentReferences:null,contentReferencesVisible:s,transformMessage:()=>({content:""}),messageRole:"assistant",index:999})}]:[],...n.messages.map(((i,r)=>{var c,u,m;const h=r===n.messages.length-1,v="user"===i.role,f=n.replacements,y=v?null!==(c=i.user)&&void 0!==c?c:tt(n):void 0,x={timelineAvatar:v?(0,g.jsx)(pc,{user:y}):(0,g.jsx)(Gt,{name:"machine",size:"l",color:"subdued"}),timestamp:(b=0===i.timestamp.length?(new Date).toLocaleString():new Date(i.timestamp).toLocaleString(),S.i18n.translate("xpack.elasticAssistantPlugin.assistant.getComments.at",{defaultMessage:"at: {timestamp}",values:{timestamp:b}})),username:v?(0,g.jsx)(mc,{user:y}):dc,eventColor:i.isError?"danger":void 0};var b;const C=h&&!v&&a,k=e=>(({message:e,content:t,showAnonymizedValues:s,replacements:n})=>({...e,content:s?t:Kn({messageContent:t,replacements:n})}))({message:i,content:e,showAnonymizedValues:d,replacements:f});if(!i.content||!i.content.length)return{...x,children:(0,g.jsx)(qc,{abortStream:t,contentReferences:null,contentReferencesVisible:s,index:r,isControlsEnabled:C,isError:i.isError,reader:i.reader,refetchCurrentConversation:o,regenerateMessage:p,setIsStreaming:l,transformMessage:k,messageRole:i.role})};const E=k(null!==(u=i.content)&&void 0!==u?u:"");return{...x,actions:(0,g.jsx)(e.CommentActions,{message:E}),children:(0,g.jsx)(qc,{abortStream:t,content:E.content,contentReferences:null===(m=i.metadata)||void 0===m?void 0:m.contentReferences,contentReferencesVisible:s,index:r,isControlsEnabled:C,isError:i.isError,reader:E.reader,regenerateMessage:p,refetchCurrentConversation:o,setIsStreaming:l,transformMessage:k,messageRole:i.role})}})),...m]};var e}),[L]),N=(e=>{const{actionTypeRegistry:t,alertsIndexPattern:s,assistantAvailability:n,assistantTelemetry:a,augmentMessageCodeBlocks:i,docLinks:r,basePath:l,basePromptContexts:d=[],getComments:c,getUrlForApp:u,http:p,inferenceEnabled:m=!1,settings:g,navigateToApp:v,nameSpace:y=M,productDocBase:k,title:w=E,toasts:A,currentAppId:j,userProfileService:_,chrome:P,openChatTrigger$:T,completeOpenChat:I}=e,z={apmUrl:`${p.basePath.serverBasePath}/app/apm`,langSmithProject:"",langSmithApiKey:""},[O=z,R]=x()(`${y}.traceOptions`,z),[L,D]=f()(`${y}.knowledgeBase`,F),[N,Z]=f()(`${y}.streaming`,!0),[B,U]=f()(`${y}.contentReferencesVisible`,!0),[$,V]=f()(`${y}.showAnonymizedValues`,!1),[G,K]=(0,o.useState)({}),q=(0,o.useCallback)((e=>{K((t=>null!=e&&null==t[e.id]?(({prevPromptContexts:e,promptContext:t})=>({...e,[t.id]:{...t}}))({prevPromptContexts:t,promptContext:e}):t))}),[]),H=(0,o.useCallback)((e=>K((t=>null==t[e]?t:(0,h.omit)(e,t)))),[]),[Q,W]=(0,o.useState)((()=>{})),{data:Y}=(0,C.useQuery)({queryKey:["currentUser"],queryFn:async()=>_.getCurrent(),select:e=>({id:e.uid,name:e.user.username}),keepPreviousData:!0,refetchOnWindowFocus:!1}),[J,X]=(0,o.useState)(null),ee=(0,o.useRef)((()=>{})),{data:te}=(({http:e,toasts:t})=>(0,C.useQuery)({queryKey:De,queryFn:async({signal:t})=>(async({http:e,signal:t})=>{try{const s="/internal/elastic_assistant/capabilities";return await e.get(s,{signal:t,version:Le})}catch(e){return e}})({http:e,signal:t}),retry:!1,keepPreviousData:!0,onError:e=>{"AbortError"!==e.name&&(null==t||t.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:S.i18n.translate("xpack.elasticAssistant.capabilities.statusError",{defaultMessage:"Error fetching capabilities"})}))}}))({http:p,toasts:A});return(0,o.useMemo)((()=>({actionTypeRegistry:t,alertsIndexPattern:s,assistantAvailability:n,assistantFeatures:null!=te?te:b,assistantTelemetry:a,augmentMessageCodeBlocks:i,basePath:l,basePromptContexts:d,currentUser:Y,docLinks:r,getComments:c,getUrlForApp:u,http:p,settings:g,inferenceEnabled:m,knowledgeBase:{...F,...L},promptContexts:G,navigateToApp:v,nameSpace:y,productDocBase:k,registerPromptContext:q,selectedSettingsTab:J,assistantStreamingEnabled:null==N||N,setAssistantStreamingEnabled:Z,setKnowledgeBase:D,contentReferencesVisible:null==B||B,setContentReferencesVisible:U,showAnonymizedValues:null!=$&&$,setShowAnonymizedValues:V,setSelectedSettingsTab:X,setShowAssistantOverlay:W,setTraceOptions:R,showAssistantOverlay:Q,title:w,toasts:A,traceOptions:O,unRegisterPromptContext:H,currentAppId:j,codeBlockRef:ee,userProfileService:_,chrome:P,openChatTrigger$:T,completeOpenChat:I})),[t,s,n,te,a,i,l,d,Y,r,g,c,u,p,m,L,G,v,y,k,q,J,N,Z,D,$,V,B,U,R,Q,w,A,O,H,j,ee,_,P,T,I])})({actionTypeRegistry:d,alertsIndexPattern:z,augmentMessageCodeBlocks:O,assistantAvailability:_,assistantTelemetry:P,docLinks:c,basePath:A,basePromptContexts:Object.values(I),getComments:D,http:l,inferenceEnabled:w,navigateToApp:a,productDocBase:v,title:fu,toasts:R,currentAppId:null!=T?T:"securitySolutionUI",userProfileService:p,chrome:m,getUrlForApp:r,openChatTrigger$:s,settings:k,completeOpenChat:n});return(0,o.useEffect)((()=>{y.assistantContextValue.setAssistantContextValue(N)}),[N,y.assistantContextValue]),j?(0,g.jsx)(Be,{value:N},e):null}class ElasticAssistantQueryClient extends C.QueryClient{constructor(e={}){var t,s,n;super({...e,defaultOptions:{...null!==(t=e.defaultOptions)&&void 0!==t?t:{},queries:{refetchIntervalInBackground:!1,refetchOnWindowFocus:!1,refetchOnMount:!0,keepPreviousData:!0,...null!==(s=null==e||null===(n=e.defaultOptions)||void 0===n?void 0:n.queries)&&void 0!==s?s:{}}}})}}const xu=new ElasticAssistantQueryClient,bu=(0,o.memo)((({queryClient:e,children:t})=>{const s=(0,o.useMemo)((()=>e||xu),[e]);return(0,g.jsx)(C.QueryClientProvider,{client:s},t)}));bu.displayName="ReactQueryClientProvider";const Cu=({children:e})=>{const t=(()=>{const{spaces:e}=oc().services,[t,s]=(0,o.useState)();return(0,o.useEffect)((()=>{e&&e.getActiveSpace().then((e=>s(e.id)))}),[e]),t})();return t?(0,g.jsx)(Jn,{spaceId:t},e):null},ku=[{eventType:vu.AssistantInvoked,schema:{invokedBy:{type:"keyword",_meta:{description:"Invocation method",optional:!1}}}},{eventType:vu.AssistantMessageSent,schema:{role:{type:"keyword",_meta:{description:"Conversation role",optional:!1}},actionTypeId:{type:"keyword",_meta:{description:"Kibana connector type",optional:!1}},model:{type:"keyword",_meta:{description:"LLM model",optional:!0}},provider:{type:"keyword",_meta:{description:"OpenAI provider",optional:!0}},isEnabledKnowledgeBase:{type:"boolean",_meta:{description:"Is knowledge base enabled"}}}},{eventType:vu.AssistantQuickPrompt,schema:{promptTitle:{type:"keyword",_meta:{description:"Title of the quick prompt",optional:!1}}}},{eventType:vu.AssistantSettingToggled,schema:{alertsCountUpdated:{type:"boolean",_meta:{description:"Did alerts count update",optional:!0}},assistantStreamingEnabled:{type:"boolean",_meta:{description:"Is streaming enabled",optional:!0}}}}];class TelemetryService{constructor(e=null){this.analytics=e}setup({analytics:e}){this.analytics=e,ku.forEach((t=>e.registerEventType(t)))}start(){var e;const t=null===(e=this.analytics)||void 0===e?void 0:e.reportEvent.bind(this.analytics);if(!this.analytics||!t)throw new Error("The TelemetryService.setup() method has not been invoked, be sure to call it during the plugin setup.");return{reportEvent:t}}}class ElasticAssistantPublicPlugin{constructor(e){(0,n.default)(this,"storage",new Qd.Storage(localStorage)),(0,n.default)(this,"telemetry",new TelemetryService),(0,n.default)(this,"isServerless",void 0),this.isServerless="serverless"===e.env.packageInfo.buildFlavor}setup(e){return this.telemetry.setup({analytics:e.analytics}),{}}start(e,t){const s=()=>{const{...s}=e.security;ru.start(t.licensing.license$);const n=this.telemetry.start();return{...e,...s,licensing:t.licensing,triggersActionsUi:t.triggersActionsUi,security:t.security,telemetry:n,productDocBase:t.productDocBase,storage:this.storage,discover:t.discover,spaces:t.spaces,elasticAssistantSharedState:t.elasticAssistantSharedState,aiAssistantManagementSelection:t.aiAssistantManagementSelection}};return e.chrome.navControls.registerRight({order:1001,mount:t=>{const n=s();return this.mountAIAssistantButton(t,e,n)}}),{}}mountAIAssistantButton(e,t,s){const{openChat$:n,completeOpenChat:a}=s.aiAssistantManagementSelection;return i().render((0,g.jsx)(l.I18nProvider,null,(0,g.jsx)(ic.KibanaContextProvider,{services:{appName:"securitySolution",...s}},(0,g.jsx)(ec.KibanaThemeProvider,t,(0,g.jsx)(sc,{core:s},(0,g.jsx)(bu,null,(0,g.jsx)(Cu,null,(0,g.jsx)(yu,{isServerless:this.isServerless,openChatTrigger$:n,completeOpenChat:a},(0,g.jsx)(o.Suspense,{fallback:null},(0,g.jsx)(Xd,null),(0,g.jsx)(qd,null))))))))),e),()=>i().unmountComponentAtNode(e)}stop(){}}const Su=e=>new ElasticAssistantPublicPlugin(e)},563:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNavigator=t.isBrowser=t.off=t.on=t.noop=void 0,t.noop=function(){},t.on=function(e){for(var t=[],s=1;s<arguments.length;s++)t[s-1]=arguments[s];e&&e.addEventListener&&e.addEventListener.apply(e,t)},t.off=function(e){for(var t=[],s=1;s<arguments.length;s++)t[s-1]=arguments[s];e&&e.removeEventListener&&e.removeEventListener.apply(e,t)},t.isBrowser="undefined"!=typeof window,t.isNavigator="undefined"!=typeof navigator},357:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(286);t.default=function(e){n.useEffect(e,[])}},943:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(286),a=s(563).isBrowser?n.useLayoutEffect:n.useEffect;t.default=a},145:(e,t,s)=>{"use strict";var n=s(941),a=s(286),i=n.__importDefault(s(943)),o=s(563),r={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};t.A=o.isBrowser&&void 0!==window.ResizeObserver?function(){var e=a.useState(null),t=e[0],s=e[1],n=a.useState(r),o=n[0],l=n[1],d=a.useMemo((function(){return new window.ResizeObserver((function(e){if(e[0]){var t=e[0].contentRect,s=t.x,n=t.y,a=t.width,i=t.height,o=t.top,r=t.left,d=t.bottom,c=t.right;l({x:s,y:n,width:a,height:i,top:o,left:r,bottom:d,right:c})}}))}),[]);return i.default((function(){if(t)return d.observe(t),function(){d.disconnect()}}),[t]),[s,o]}:function(){return[o.noop,r]}},880:(e,t,s)=>{"use strict";var n=s(941),a=s(286),i=n.__importDefault(s(943));t.A=function(e,t){var s=a.useState(t),n=s[0],o=s[1];return i.default((function(){var t=e.subscribe(o);return function(){return t.unsubscribe()}}),[e]),n}},375:(e,t,s)=>{"use strict";var n=s(941),a=s(286),i=n.__importDefault(s(729));t.A=function(e){var t=a.useRef(0),s=a.useState(e),n=s[0],o=s[1],r=a.useCallback((function(e){cancelAnimationFrame(t.current),t.current=requestAnimationFrame((function(){o(e)}))}),[]);return i.default((function(){cancelAnimationFrame(t.current)})),[n,r]}},729:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(941),a=s(286),i=n.__importDefault(s(357));t.default=function(e){var t=a.useRef(e);t.current=e,i.default((function(){return function(){return t.current()}}))}},66:(e,t,s)=>{s.p=window.__kbnPublicPath__.elasticAssistant},728:(e,t,s)=>{s.r(t);var n=__kbnBundles__.get("plugin/actions/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},630:(e,t,s)=>{s.r(t);var n=__kbnBundles__.get("plugin/aiAssistantManagementSelection/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},390:(e,t,s)=>{s.r(t);var n=__kbnBundles__.get("entry/core/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},409:(e,t,s)=>{s.r(t);var n=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},215:(e,t,s)=>{s.r(t);var n=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},218:(e,t,s)=>{s.r(t);var n=__kbnBundles__.get("plugin/stackConnectors/public/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},701:(e,t,s)=>{s.r(t);var n=__kbnBundles__.get("plugin/triggersActionsUi/public/common/constants");Object.defineProperties(t,Object.getOwnPropertyDescriptors(n))},81:(e,t,s)=>{e.exports=s(497)(28995)},557:(e,t,s)=>{e.exports=s(497)(36295)},519:(e,t,s)=>{e.exports=s(497)(36873)},185:(e,t,s)=>{e.exports=s(497)(51858)},59:(e,t,s)=>{e.exports=s(497)(65811)},915:(e,t,s)=>{e.exports=s(497)(67493)},718:(e,t,s)=>{e.exports=s(497)(89779)},286:e=>{"use strict";e.exports=__kbnSharedDeps__.React},941:e=>{"use strict";e.exports=__kbnSharedDeps__.TsLib},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},t={};function s(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,s),i.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var a=n.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=n[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),s(66),__kbnBundles__.define("plugin/elasticAssistant/public",s,134)})();