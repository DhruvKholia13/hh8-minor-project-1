/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */(()=>{var e={978:(e,t,n)=>{"use strict";n.r(t),n.d(t,{apiHasDynamicActions:()=>d,plugin:()=>l});var r=n(118),i=n(899),a=n.n(i);const o=__kbnSharedDeps__.Rxjs;var s=n(546);class DynamicActionStorage extends r.UiActionsEnhancedAbstractActionStorage{constructor(e,t,n){super(),this.id=e,this.getPanelTitle=t,this.api=n}put(e){this.api.setDynamicActions({dynamicActions:e})}async create(e){const t=this.getEvents();if(t.find((({eventId:t})=>t===e.eventId)))throw new Error(`[EEXIST]: Event with [eventId = ${e.eventId}] already exists on [embeddable.id = ${this.id}, embeddable.title = ${this.getPanelTitle()}].`);this.put({events:[...t,e]})}async update(e){const t=this.api.dynamicActionsState$.getValue(),n=this.getEvents(),r=n.findIndex((({eventId:t})=>t===e.eventId));if(-1===r)throw new Error(`[ENOENT]: Event with [eventId = ${e.eventId}] could not be updated as it does not exist in [embeddable.id = ${this.id}, embeddable.title = ${this.getPanelTitle()}].`);this.put({...t,events:[...n.slice(0,r),e,...n.slice(r+1)]})}async remove(e){const t=this.api.dynamicActionsState$.getValue(),n=this.getEvents(),r=n.findIndex((t=>e===t.eventId));if(-1===r)throw new Error(`[ENOENT]: Event with [eventId = ${e}] could not be removed as it does not exist in [embeddable.id = ${this.id}, embeddable.title = ${this.getPanelTitle()}].`);this.put({...t,events:[...n.slice(0,r),...n.slice(r+1)]})}async read(e){const t=this.getEvents().find((t=>e===t.eventId));if(!t)throw new Error(`[ENOENT]: Event with [eventId = ${e}] could not be found in [embeddable.id = ${this.id}, embeddable.title = ${this.getPanelTitle()}].`);return t}async list(){return this.getEvents()}getEvents(){var e,t;const n=this.api.dynamicActionsState$.getValue(),r=null!==(e=null==n||null===(t=n.dynamicActions)||void 0===t?void 0:t.events)&&void 0!==e?e:[];return this.migrate(r)}migrate(e){return e.map((e=>{if("DASHBOARD_TO_DASHBOARD_DRILLDOWN"===e.action.factoryId){const t=e.triggers.filter((e=>e!==s.VALUE_CLICK_TRIGGER&&e!==s.SELECT_RANGE_TRIGGER));return t.length===e.triggers.length||t.includes("FILTER_TRIGGER")||t.push("FILTER_TRIGGER"),{...e,triggers:t}}return e}))}}function c(e){var t;return{dynamicActions:{events:[],...null!==(t=null==e?void 0:e.dynamicActions)&&void 0!==t?t:{}}}}var u=n(721);class EmbeddableEnhancedPlugin{constructor(e){this.context=e}setup(e,t){return{}}start(e,t){return{initializeEmbeddableDynamicActions:(e,n,i)=>function(e,t,n,i){var s,d;const l=i.embeddable.getEnhancement("dynamicActions"),f=l&&null!==(s=n.rawState.enhancements)&&void 0!==s&&s.dynamicActions?{dynamicActions:l.inject(n.rawState.enhancements.dynamicActions,null!==(d=n.references)&&void 0!==d?d:[])}:n.rawState.enhancements,p=new o.BehaviorSubject(c(f)),h={dynamicActionsState$:p,setDynamicActions:e=>{p.next(c(e))}},m=new DynamicActionStorage(e,t,h),y=new r.UiActionsEnhancedDynamicActionManager({isCompatible:async t=>{const{embeddable:n}=t;return r=n,Boolean(r&&void 0!==(null==r?void 0:r.uuid))&&n.uuid===e;var r},storage:m,uiActions:i.uiActionsEnhanced});function b(){return{enhancements:p.getValue()}}return{api:{...h,enhancements:{dynamicActions:y}},comparators:{enhancements:(e,t)=>a()(c(e),c(t))},anyStateChange$:p.pipe((0,o.map)((()=>{}))),getLatestState:b,serializeState:()=>{var e;const t=b();if(!l||null===(e=t.enhancements)||void 0===e||!e.dynamicActions)return{rawState:t,references:[]};const n=l.extract(t.enhancements.dynamicActions);return{rawState:{enhancements:{dynamicActions:n.state}},references:n.references}},reinitializeState:e=>{h.setDynamicActions(e.enhancements)},startDynamicActions:()=>(y.start().catch((e=>{u.log("Failed to start embeddable dynamic actions",y),u.error(e)})),{stopDynamicActions:()=>{y.stop().catch((e=>{u.log("Failed to stop embeddable dynamic actions",y),u.error(e)}))}})}}(e,n,i,t)}}stop(){}}const d=e=>{const t=e;return Boolean(t&&t.enhancements&&"object"==typeof t.enhancements.dynamicActions&&"function"==typeof t.setDynamicActions&&t.dynamicActionsState$)};function l(e){return new EmbeddableEnhancedPlugin(e)}},899:(e,t,n)=>{var r=n(721),i="undefined"!=typeof Element,a="function"==typeof Map,o="function"==typeof Set,s="function"==typeof ArrayBuffer&&!!ArrayBuffer.isView;function c(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(e.constructor!==t.constructor)return!1;var n,r,u,d;if(Array.isArray(e)){if((n=e.length)!=t.length)return!1;for(r=n;0!==r--;)if(!c(e[r],t[r]))return!1;return!0}if(a&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(d=e.entries();!(r=d.next()).done;)if(!t.has(r.value[0]))return!1;for(d=e.entries();!(r=d.next()).done;)if(!c(r.value[1],t.get(r.value[0])))return!1;return!0}if(o&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(d=e.entries();!(r=d.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(s&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if((n=e.length)!=t.length)return!1;for(r=n;0!==r--;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&"function"==typeof e.valueOf&&"function"==typeof t.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&"function"==typeof e.toString&&"function"==typeof t.toString)return e.toString()===t.toString();if((n=(u=Object.keys(e)).length)!==Object.keys(t).length)return!1;for(r=n;0!==r--;)if(!Object.prototype.hasOwnProperty.call(t,u[r]))return!1;if(i&&e instanceof Element)return!1;for(r=n;0!==r--;)if(("_owner"!==u[r]&&"__v"!==u[r]&&"__o"!==u[r]||!e.$$typeof)&&!c(e[u[r]],t[u[r]]))return!1;return!0}return e!=e&&t!=t}e.exports=function(e,t){try{return c(e,t)}catch(e){if((e.message||"").match(/stack|recursion/i))return r.warn("react-fast-compare cannot handle circular refs"),!1;throw e}}},366:(e,t,n)=>{n.p=window.__kbnPublicPath__.embeddableEnhanced},546:(e,t,n)=>{n.r(t);var r=__kbnBundles__.get("plugin/embeddable/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},118:(e,t,n)=>{n.r(t);var r=__kbnBundles__.get("plugin/uiActionsEnhanced/public");Object.defineProperties(t,Object.getOwnPropertyDescriptors(r))},721:(e,t,n)=>{e.exports=n(497)(4971)},497:e=>{"use strict";e.exports=__kbnSharedDeps_npm__}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var i=r.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=r[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n(366),__kbnBundles__.define("plugin/embeddableEnhanced/public",n,978)})();